{"version":3,"sources":["ri-backoffice.js"],"names":["angular","makeArray","arr","isArray","provideRootElement","modules","element","unshift","$provide","value","createInjector","injectorModules","concat","injector","bootstrapApplication","angularApp","document","ready","bootstrap","lazy","app","$q","get","promises","errorCallback","noop","loadingCallback","doneCallback","resolve","promise","when","instantiate","push","this","all","then","finally","loading","callback","done","error","createCSSNodes","obj","div","createElement","i","link","href","rel","appendChild","getScripts","scripts","length","progress","internalCallback","$","ajaxSetup","async","forEach","script","getScript","module","$rootScopeProvider","digestTtl","run","$rootScope","configs","$http","resp","constant","data","deferred","defer","extensions","assets","cache","asset","src","attributes","nodeValue","type","files","j","pages","p","backoffice","getMultiScripts","path","_arr","map","scr","Deferred","apply","config","$routeProvider","customMenuProvider","authCheck","$location","loginProvider","auth","getUser","user","defaults","headers","common","Authorization","token","login","undefined","allowedUser","$inject","homePage","home","templateUrl","controller","reloadOnSearch","logout","images","gallery","menu","page","url","template","modelName","setCustomMenu","otherwise","redirectTo","$translateProvider","$translatePartialLoaderProvider","i18n","addPart","useLoader","urlTemplate","registerAvailableLanguageKeys","def","fallbackLanguage","useLocalStorage","uniqueLanguage","use","preferredLanguage","provider","menuElements","$get","cookieStore","factory","profile","userModel","cb","post","success","res","role","cookieOptions","end","Infinity","put","JSON","stringify","$broadcast","err","remove","parse","password","logged","extend","overrides","service","override","_method","_function","getService","Upload","modelsConfig","singlesCache","shards","prefix","$on","invalidate","console","log","getHttp","getUpload","setShard","key","model","shard","getShard","removeShard","getModels","schemas","models","getModel","schema","ajax","responseText","getModelElements","skip","limit","plural","body","elements","result","status","count","getModelSchema","getModelConfig","postDocument","response","getUrl","Error","getDocument","id","qParams","params","cfg","shardKey","putDocument","removeDocument","opts","delete","removeDocumentByMongoId","uploadImage","fieldName","index","image","upload","file","fileFormDataName","evt","parseInt","loaded","total","uploadFile","deleteImage","deleteFile","getImageUrl","imageName","getRandomQuery","getFileUrl","fileName","getSingleModel","search","query","documents","search_count","export","format","searchQuery","by","postAsForm","import","method","form","setAttribute","replace","hasOwnProperty","hiddenField","submit","getGraph","graphID","encodeURI","galleryGetByPath","isGalleryEnabled","getGalleryPath","galleryDeleteByPath","galleryPostByPath","endpoint","getFieldFromSchema","field","retElem","split","properties","ref","denormalize","indexOf","refSchema","copy","title","lastIndexOf","prettifyTitle","substring","Object","keys","TIMEOUT_MS","timers","selectCacheService","httpCall","q","gets","$or","singleQ","doc","idKey","getObj","cbks","event","next","current","m","clearTimeout","b","posts","cached","cbk","setTimeout","$routeParams","flash","$injector","version","ngDialog","getOpenDialogs","open","className","responseError","rejection","handleError","ignoreError","redirectError","warning","errors","e","message","splice","Math","floor","errorInReferencedProperty","modelId","reject","$httpProvider","interceptors","find","innerDependsOn","each","k","v","depArr","func","indexArray","pop","join","scope","updateFunc","modelConfig","dependsValue","arrayIndex","newVal","oldVal","param","safeAccess","replaced","setField","test","root","targetField","$watchCollection","nV","oV","Array","normPath","$watch","hasAngularVariable","deAngularizeUrl","ng","matched","f","getField","getAngularVariables","exec","separator","str","toUpperCase","splitted","returnArray","parentArr","ret","rootElem","match","tmp","elem","newPath","arrInd","getAllSchemaFields","searchFields","parent","fields","processForm","submitButtons","innerForm","tabs","items","randomNumber","Date","getTime","setQuery","clearQuery","getQuery","setSortBy","sort","sortBy","addSortBy","asc","getSort","setSkip","setLimit","searchAndGroup","directive","restrict","$scope","customMenu","$window","actualSchema","isDisabled","isOpen","render","sections","Sections","add","section","clickTo","hideMenu","isSingle","openSection","actualSection","click","name","conf","parentSchema","location","isInstanceOf","Section","debug","a","levels","curLevel","scrollTo","$elm","attr","on","animate","scrollTop","offset","top","$compile","attrs","$eval","compile","html","contents","ngModel","graph","selected","punchCardData","graphs","g","groupMode","selectEnabled","barsData","values","$route","exportElements","checked","filter","x","_id","performAction","action","req","Content-Type","enableDelete","checkedValues","val","removeSelected","promptAlert","del","deletions","reload","parseMongoDate","txt","dt","parseDateTimeRange","updateYear","start","d1","d2","sec1","sec2","second","hour","year","month","day","minute","d","sec","isNaN","debugParse","Number","String","pieces","parseDateTime","trim","parseDateOrTime","dt1","dt2","parseTime","parseDate","Num","t","regex","o","toLocaleString","searches","buildPath","sc","updateSearch","elemSearch","noSearch","availableFields","fieldFromSchema","placeholder","addSearch","s","clear","allFields","displayField","singleQuery","sfield","alert","$regex","$options","$parent","getDocumentById","idSelect","forDisplay","forID","searchRes","present","some","elemsearch","select","disabled","searchEnabled","printSelectedElement","selectDisplayField","selectIdField","bind","raw","arguments","target","offsetHeight","scrollHeight","$select","children","width","css","$animate","leave","eq","$controller","m_copy","$sce","getTag","tag","prune","$anchorScroll","$timeout","$modal","dependsOn","$translate","walkThroughSchema","editOnCreate","toLowerCase","readonly","i18nTitle","instant","modified","buttonsPosition","equals","schemaHREF","hash","submitForm","isApply","$valid","validation","validationErrors","$error","yOffset","cancel","history","back","ngForm","preventDefault","modalInstance","size","basePathLength","absUrl","http","window","$modalInstance","ok","close","dismiss","$document","update","loginError","encodeURIComponent","postLoginFuncs","pretty","args","defaultItemsPerPage","removeDisabled","maxSize","create","checkedGroupIds","schemaForm","allDisplayFields","extraDisplayFields","totalElements","itemsPerPage","userItemsPerPage","defaultSearch","pageChanged","currentPage","hasShard","__t","displayCustomField","sch","property","text","trustAsHtml","toString","navbar","$$route","shardKeyText","shardValues","filtered","locked","languages","showLanguages","lang"],"mappings":"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","file":"ri-backoffice.min.js","sourcesContent":["(function (angular) {\n\n    'use strict';\n\n    //Generic   \n\n    function makeArray(arr) {\n        if(!arr){\n            return [];\n        }\n        return angular.isArray(arr) ? arr : [arr];\n    }\n\n    //Angular\n\n    function provideRootElement(modules, element) {\n        element = angular.element(element);\n        modules.unshift(['$provide',\n            function ($provide) {\n                $provide.value('$rootElement', element);\n            }]);\n    }\n\n    function createInjector(injectorModules, element) {\n        var modules = ['ng'].concat(makeArray(injectorModules));\n        if (element) {\n            provideRootElement(modules, element);\n        }\n        return angular.injector(modules);\n    }\n\n    function bootstrapApplication(angularApp) {\n        angular.element(document).ready(function () {\n            angular.bootstrap(document, [angularApp]);\n        });\n    }\n\n    angular.lazy = function (app, modules) {\n\n        var injector = createInjector(modules),\n            $q = injector.get('$q'),\n            promises = [],\n            errorCallback = angular.noop,\n            loadingCallback = angular.noop,\n            doneCallback = angular.noop;\n\n        return {\n\n            resolve: function (promise) {\n                promise = $q.when(injector.instantiate(promise));\n                promises.push(promise);\n                return this;\n            },\n\n            bootstrap: function () {\n\n                loadingCallback();\n\n                return $q.all(promises)\n                    .then(function () {\n                        bootstrapApplication(app);\n                    }, errorCallback)\n                    .finally(doneCallback);\n            },\n\n            loading: function(callback){\n                loadingCallback = callback;\n                return this;\n            },\n\n            done: function(callback){\n                doneCallback = callback;\n                return this;\n            },\n\n            error: function(callback){\n                errorCallback = callback;\n                return this;\n            }\n        };\n\n    };\n\n})(angular);\n(function () {\r\n    'use strict';\r\n    var app = angular.module('injectorApp', ['ngRoute', 'ngBiscuit', 'schemaForm', 'datePicker', 'ui.select',\r\n            'ui.ace', 'ui.codemirror', 'ui.bootstrap', 'ngFileUpload', 'ngDroplet', 'punchCard', 'nvd3ChartDirectives', 'flash', 'ngDialog', 'angular-loading-bar',\r\n            'pascalprecht.translate', 'ngCookies', 'ui.tinymce'],\r\n        ['$rootScopeProvider', function ($rootScopeProvider) {\r\n            $rootScopeProvider.digestTtl(15);\r\n        }])\r\n        .run(['$rootScope', 'configs', function ($rootScope, configs) {\r\n            $rootScope.configs = configs;\r\n        }]);\r\n\r\n    angular.lazy(\"injectorApp\")\r\n        .resolve(['$http', function ($http) {\r\n            return $http.get('/configs')\r\n                .then(function (resp) {\r\n                    app.constant('configs', resp.data);\r\n                });\r\n        }])\r\n        .resolve(['$http', '$q', function ($http, $q) {\r\n\r\n            var deferred = $q.defer();\r\n            $http.get('/admin/extensions').then(function (resp) {\r\n                app.constant('extensions', resp.data);\r\n\r\n                var extensions = resp.data;\r\n                var assets = $('asset-loader');\r\n                var scripts = [];\r\n\r\n                for (var i = 0; i < assets.length; i++) {\r\n                    var cache = [];\r\n\r\n                    var asset = assets[i];\r\n                    var src = asset.attributes.src.nodeValue;\r\n                    var type = asset.attributes.type.nodeValue;\r\n\r\n                    if (src === 'files') {\r\n                        if (extensions.files[type] && extensions.files[type].length) {\r\n                            cache = cache.concat(extensions.files[type]);\r\n                        }\r\n                    } else if (src === 'pages') {\r\n                        for (var j in extensions.pages) {\r\n                            var p = extensions.pages[j];\r\n                            if (p.backoffice) {\r\n                                if (p[type] && p[type].length) {\r\n                                    cache = cache.concat(p[type]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (type === 'css') {\r\n                        asset.appendChild(createCSSNodes(cache));\r\n                    } else if (type === 'js') {\r\n                        if (cache && cache.length) {\r\n                            scripts = scripts.concat(cache);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                //$.getMultiScripts(scripts).done(function () {\r\n                //    deferred.resolve();\r\n                //});\r\n                getScripts(scripts, function () {\r\n                    deferred.resolve();\r\n                });\r\n\r\n            });\r\n\r\n            return deferred.promise;\r\n        }])\r\n        .bootstrap();\r\n\r\n    function createCSSNodes(obj) {\r\n        var div = document.createElement('div');\r\n        for (var i in obj) {\r\n            var link = document.createElement('link');\r\n            link.href = obj[i];\r\n            link.rel = 'stylesheet';\r\n            div.appendChild(link);\r\n        }\r\n        return div;\r\n    }\r\n\r\n    function getScripts(scripts, callback) {\r\n        if (!scripts || !scripts.length) {\r\n            return callback();\r\n        }\r\n        var progress = 0;\r\n        var internalCallback = function () {\r\n            if (++progress == scripts.length) {\r\n                $.ajaxSetup({async: true});\r\n                callback();\r\n            }\r\n        };\r\n\r\n        $.ajaxSetup({async: false});\r\n        scripts.forEach(function (script) {\r\n            $.getScript(script, internalCallback);\r\n        });\r\n\r\n    }\r\n\r\n    $.getMultiScripts = function (arr, path) {\r\n        var _arr = $.map(arr, function (scr) {\r\n            return $.getScript((path || \"\") + scr);\r\n        });\r\n\r\n        _arr.push($.Deferred(function (deferred) {\r\n            $(deferred.resolve);\r\n        }));\r\n\r\n        return $.when.apply($, _arr);\r\n    };\r\n})();\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .config(['$routeProvider', 'configs', 'extensions', 'customMenuProvider', function ($routeProvider, configs, extensions, customMenuProvider) {\r\n\r\n            var authCheck = function ($q, $rootScope, $location, $http, loginProvider, configs) {\r\n                var defer = $q.defer();\r\n                if (configs.auth) {\r\n                    loginProvider.getUser(function (user) {\r\n                        if (!user) {\r\n                            $location.path('/login');\r\n                        } else {\r\n                            $http.defaults.headers.common.Authorization = 'BEARER ' + user.token;\r\n                            $rootScope.login = undefined;\r\n                        }\r\n                        defer.resolve();\r\n                    });\r\n\r\n                } else {\r\n                    $rootScope.allowedUser = true;\r\n                    defer.resolve();\r\n                }\r\n                return defer.promise;\r\n            };\n            authCheck.$inject = ['$q', '$rootScope', '$location', '$http', 'loginProvider', 'configs'];\r\n\r\n            var homePage = 'html/models.html';\r\n            if (configs.backoffice.home) {\r\n                homePage = configs.backoffice.home;\r\n            }\r\n\r\n            $routeProvider\r\n                .when('/', {\r\n                    templateUrl: homePage,\r\n                    controller: 'MainController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    }\r\n                })\r\n                .when('/model/:schema', {\r\n                    templateUrl: 'html/model.html',\r\n                    controller: 'ModelController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    }\r\n                })\r\n                .when('/model/:schema/new', {\r\n                    templateUrl: 'html/create-and-update.html',\r\n                    controller: 'CreateController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    },\r\n                    reloadOnSearch: false\r\n                })\r\n                .when('/model/:schema/update/:id', {\r\n                    templateUrl: 'html/create-and-update.html',\r\n                    controller: 'UpdateController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    },\r\n                    reloadOnSearch: false\r\n                })\r\n                .when('/model/:schema/update/:id/:shard', {\r\n                    templateUrl: 'html/create-and-update.html',\r\n                    controller: 'UpdateController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    },\r\n                    reloadOnSearch: false\r\n                })\r\n                .when('/model/:schema/graphs', {\r\n                    templateUrl: 'html/graphs.html',\r\n                    controller: 'GraphsController',\r\n                    resolve: {\r\n                        app: authCheck\r\n                    }\r\n                })\r\n                .when('/login', {\r\n                    // login / password\r\n                    templateUrl: 'html/login.html',\r\n                    controller: 'LoginController',\r\n                    resolve: {\r\n                        app: ['$q', '$rootScope', '$location', 'loginProvider', function ($q, $rootScope, $location, loginProvider) {\r\n                            var defer = $q.defer();\r\n                            loginProvider.getUser(function (user) {\r\n                                if (user) {\r\n                                    $location.path('/');\r\n                                } else {\r\n                                    $rootScope.login = true;\r\n                                }\r\n                                defer.resolve();\r\n                            });\r\n                            return defer.promise;\r\n                        }]\r\n                    }\r\n                })\r\n                .when('/logout', {\r\n                    resolve: {\r\n                        app: ['$q', '$rootScope', '$location', 'loginProvider', function ($q, $rootScope, $location, loginProvider) {\r\n                            var defer = $q.defer();\r\n                            loginProvider.logout();\r\n                            $location.path('/');\r\n                            defer.resolve();\r\n                            return defer.promise;\r\n                        }]\r\n                    }\r\n                })\r\n                .when('/settings', {\r\n                    templateUrl: 'html/settings.html',\r\n                    controller: 'SettingsController'\r\n                });\r\n\r\n            if (configs.images && configs.images.gallery) {\r\n                $routeProvider\r\n                    .when('/gallery', {\r\n                        templateUrl: 'html/gallery.html',\r\n                        resolve: {\r\n                            app: authCheck\r\n                        }\r\n                    });\r\n            }\r\n\r\n\r\n            if (extensions && extensions.pages) {\r\n                var menu = [];\r\n                for (var i in extensions.pages) {\r\n                    var page = extensions.pages[i];\r\n\r\n                    //Add the route for the custom page. modelName controls the sharding selector if given\r\n                    if (page.backoffice) {\r\n                        $routeProvider.when('/' + page.url, {\r\n                            templateUrl: page.template,\r\n                            controller: page.controller,\r\n                            resolve: {\r\n                                app: authCheck\r\n                            },\r\n                            modelName: page.modelName\r\n                        });\r\n                    }\r\n\r\n                    if (page.menu) {\r\n                        menu.push(page.menu);\r\n                    }\r\n                }\r\n                customMenuProvider.setCustomMenu(menu);\r\n            }\r\n\r\n            $routeProvider.otherwise({redirectTo: '/'});\r\n        }]);\r\n}());\r\n\n(function () {\n    'use strict';\n\n    angular.module('injectorApp')\n        .config(['$translateProvider', '$translatePartialLoaderProvider', 'configs', function ($translateProvider, $translatePartialLoaderProvider, configs) {\n            var i18n = configs.backoffice.i18n;\n            $translatePartialLoaderProvider.addPart('login');\n            $translatePartialLoaderProvider.addPart('model');\n            $translatePartialLoaderProvider.addPart('models');\n            $translatePartialLoaderProvider.addPart('navbar');\n            $translatePartialLoaderProvider.addPart('search');\n            $translatePartialLoaderProvider.addPart('create_update');\n            //$translatePartialLoaderProvider.addPart('flash');\n            $translatePartialLoaderProvider.addPart('version_dialog');\n\n            if (i18n && i18n.length) {\n                for (var i = 0; i < i18n.length; i++) {\n                    $translatePartialLoaderProvider.addPart(i18n[i]);\n                }\n            }\n\n            $translateProvider.useLoader('$translatePartialLoader', {\n                urlTemplate: 'i18n/{part}/{lang}.json'\n            });\n            $translateProvider.registerAvailableLanguageKeys(['en', 'es']);\n            var def = \"en\";\n            $translateProvider.fallbackLanguage('en');\n            $translateProvider.useLocalStorage();\n            if (configs.backoffice.uniqueLanguage) {\n                def = configs.backoffice.uniqueLanguage;\n                $translateProvider.use(def);\n            }\n            $translateProvider.preferredLanguage(def);\n        }]);\n\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .provider('customMenu', function () {\r\n        var menuElements;\r\n\r\n        this.setCustomMenu = function(value) {\r\n            menuElements = value;\r\n        };\r\n\r\n        this.$get = function(){\r\n            return menuElements;\r\n        };\r\n    });\r\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .provider('loginProvider', function () {\r\n\r\n            this.$get = ['$http', '$location', 'cookieStore', '$rootScope', function ($http, $location, cookieStore, $rootScope) {\r\n                var factory = {};\r\n                $http.defaults.headers.common['Client-Type'] = 'backoffice';\r\n                $http.defaults.headers.common.profile = 'back';\r\n                factory.login = function (userModel, cb) {\r\n                    $http.post('/auth/login', userModel).success(function (res) {\r\n                        var user = {};\r\n                        //user.name = userModel.login;\r\n                        user.login = userModel.login;\r\n                        user.role = res.role;\r\n                        user.token = res.token;\r\n                        var cookieOptions = {path: '/', end: Infinity};\r\n                        cookieStore.put('user', JSON.stringify(user), cookieOptions);\r\n                        $http.defaults.headers.common.Authorization = 'BEARER ' + res.token;\r\n                        $rootScope.$broadcast('login', user);\r\n                        $rootScope.allowedUser = true;\r\n                        cb(user);\r\n                    }).error(function (err) {\r\n                        var cookieOptions = {path: '/'};\r\n                        cookieStore.remove('user', cookieOptions);\r\n                        $rootScope.$broadcast('logout', undefined);\r\n                        $rootScope.allowedUser = false;\r\n                        cb(false);\r\n                    });\r\n                };\r\n\r\n                factory.getUser = function (cb) {\r\n                    var user = JSON.parse(cookieStore.get('user'));\r\n                    if (user && !$rootScope.allowedUser && user.login && (user.password || user.token)) {\r\n                        factory.login(user, function (logged) {\r\n                            if (logged) {\r\n                                angular.extend(user, logged);\r\n                                cb(logged);\r\n                            } else {\r\n                                cb(undefined);\r\n                            }\r\n                        });\r\n                    } else {\r\n                        if (!user) {\r\n                            $rootScope.allowedUser = false;\r\n                        } else {\r\n                            //$rootScope.$broadcast('login', user);\r\n                        }\r\n\r\n                        cb(user);\r\n                    }\r\n                };\r\n\r\n                factory.logout = function () {\r\n                    var cookieOptions = {path: '/'};\r\n                    cookieStore.remove('user', cookieOptions);\r\n                    $location.path('/login');\r\n                    $rootScope.$broadcast('logout', undefined);\r\n                };\r\n\r\n                return factory;\r\n            }];\r\n        });\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .provider('models', function () {\r\n                var overrides = {};\r\n                var service = {};\r\n\r\n                this.override = function (_method, _function) {\r\n                    overrides[_method] = _function;\r\n                };\r\n\r\n                this.getService = function () {\r\n                    return service;\r\n                };\r\n\r\n\r\n                this.$get = ['$rootScope', '$http', 'Upload', 'configs', 'common', function ($rootScope, $http, Upload, configs, common) {\r\n\r\n                    var modelsConfig = {};\r\n                    var singlesCache = {};\r\n                    var shards = {};\r\n                    var prefix = '';\r\n\r\n                    $rootScope.$on('logout', function () {\r\n                        service.invalidate();\r\n                    });\r\n\r\n                    $rootScope.$on('invalidate', function () {\r\n                        console.log(\"invalidate models provider\");\r\n                        service.invalidate();\r\n                    });\r\n\r\n                    service.invalidate = function () {\r\n                        shards = {};\r\n                        singlesCache = {};\r\n                        modelsConfig = {};\r\n                    };\r\n\r\n                    service.getHttp = function () {\r\n                        return $http;\r\n                    };\r\n\r\n                    service.getUpload = function () {\r\n                        return Upload;\r\n                    };\r\n\r\n                    service.setShard = function (key, value, model) {\r\n                        var shard = {};\r\n                        shard.key = key;\r\n                        shard.value = value;\r\n                        shard.model = model;\r\n                        shards[model] = shard;\r\n                    };\r\n\r\n                    service.getShard = function (model) {\r\n                        return shards[model];\r\n                    };\r\n\r\n                    service.removeShard = function (model) {\r\n                        delete shards[model];\r\n                    };\r\n\r\n                    service.getModels = function (cb) {\r\n                        prefix = configs.app.prefix;\r\n\r\n                        //AVOID CACHE (FOR CHANGING MODELS WHEN LOGIN LOGOUT :)\r\n                        $http.get('/schemas').then(function (schemas) {\r\n                            var models = schemas.data;\r\n                            cb(models);\r\n                        });\r\n                    };\r\n\r\n                    service.getModel = function (modelName, cb) {\r\n                        if (!modelsConfig[modelName] && cb) {\r\n                            $http.get('/schema/' + modelName).then(function (schema) {\r\n                                $http.get('/schema/' + modelName + '/formconfig').then(function (config) {\r\n                                    modelsConfig[modelName] = {};\r\n                                    modelsConfig[modelName].schema = schema.data;\r\n                                    modelsConfig[modelName].config = config.data;\r\n                                    cb(modelsConfig[modelName]);\r\n                                });\r\n                            });\r\n                        } else if (!modelsConfig[modelName] && !cb) {\r\n                            var schema = JSON.parse($.ajax({\r\n                                type: \"GET\",\r\n                                url: '/schema/' + modelName,\r\n                                async: false\r\n                            }).responseText);\r\n\r\n                            var config = JSON.parse($.ajax({\r\n                                type: \"GET\",\r\n                                url: '/schema/' + modelName + '/formconfig',\r\n                                async: false\r\n                            }).responseText);\r\n\r\n                            modelsConfig[modelName] = {};\r\n                            modelsConfig[modelName].schema = schema;\r\n                            modelsConfig[modelName].config = config;\r\n\r\n                            return modelsConfig[modelName];\r\n\r\n                        } else {\r\n                            if (cb) {\r\n                                cb(modelsConfig[modelName]);\r\n                            } else {\r\n                                return modelsConfig[modelName];\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    service.getModelElements = function (modelName, skip, limit, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var plural = (data.config.plural || data.config.path + 's' || modelName + 's');\r\n                            var body = {\r\n                                skip: skip,\r\n                                limit: limit\r\n                            };\r\n                            if (service.getShard(modelName)) {\r\n                                body[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n                            $http.post(prefix + '/' + plural, body).success(function (elements) {\r\n                                cb(elements.result, elements.status.count);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.getModelSchema = function (modelName, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            return cb(data.schema);\r\n                        });\r\n                    };\r\n\r\n                    service.getModelConfig = function (modelName, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            return cb(data.config);\r\n                        });\r\n                    };\r\n\r\n                    service.postDocument = function (modelName, model, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            $http.post(prefix + '/' + path, JSON.stringify(model)).then(function (response) {\r\n                                return cb(response);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.getUrl = function (modelName, cb) {\r\n                        throw new Error(\"Not implemented\");\r\n                    };\r\n\r\n                    service.getDocument = function (modelName, id, shard, cb) {\r\n                        if (!cb) {\r\n                            cb = shard;\r\n                            shard = undefined;\r\n                        }\r\n\r\n                        if (!modelName) {\r\n                            return cb();\r\n                        }\r\n                        if (!id) {\r\n                            return cb();\r\n                        }\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            var qParams = {\r\n                                params: {\r\n                                    type: \"back\"\r\n                                }\r\n                            };\r\n\r\n                            service.getModelConfig(modelName, function (cfg) {\r\n                                if (shard && cfg.shard && cfg.shard.shardKey) {\r\n                                    qParams.params[cfg.shard.shardKey] = shard;\r\n                                } else if (service.getShard(modelName)) {\r\n                                    qParams.params[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                                }\r\n\r\n                                $http.get(prefix + '/' + path + '/' + id, qParams).success(function (document) {\r\n                                    return cb(document, null);\r\n                                }).error(function (data) {\r\n                                    return cb(null, data);\r\n                                });\r\n                            });\r\n\r\n                        });\r\n                    };\r\n\r\n                    service.putDocument = function (modelName, id, model, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            $http.put(prefix + '/' + path + '/' + id, JSON.stringify(model)).then(function (document) {\r\n                                return cb(document);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.removeDocument = function (modelName, id, shard, cb) {\r\n                        if (!cb) {\r\n                            cb = shard;\r\n                            shard = undefined;\r\n                        }\r\n\r\n\r\n                        service.getModel(modelName, function (data) {\r\n                            var cfg = data.config;\r\n                            var path = (cfg.path || modelName);\r\n\r\n                            var opts = {params: {}};\r\n\r\n                            if (shard && cfg.shard && cfg.shard.shardKey) {\r\n                                opts.params[cfg.shard.shardKey] = shard;\r\n                            } else if (service.getShard(modelName)) {\r\n                                opts.params[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n                            $http.delete(prefix + '/' + path + '/' + id, opts).then(cb);\r\n                        });\r\n                    };\r\n\r\n                    service.removeDocumentByMongoId = function (modelName, id, shard, cb) {\r\n                        if (!cb) {\r\n                            cb = shard;\r\n                            shard = undefined;\r\n                        }\r\n\r\n                        service.getModel(modelName, function (data) {\r\n                            var cfg = data.config;\r\n                            var path = (data.config.path || modelName);\r\n\r\n                            var opts = {\r\n                                params: {\r\n                                    type: 'raw'\r\n                                }\r\n                            };\r\n\r\n                            if (shard && cfg.shard && cfg.shard.shardKey) {\r\n                                opts.params[cfg.shard.shardKey] = shard;\r\n                            } else if (service.getShard(modelName)) {\r\n                                opts.params[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n                            $http.delete(prefix + '/' + path + '/' + id, opts).then(cb);\r\n                        });\r\n                    };\r\n\r\n                    service.uploadImage = function (modelName, id, fieldName, index, image, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            Upload.upload({\r\n                                url: prefix + '/' + path + '/' + id + '/' + fieldName, //upload.php script, node.js route, or servlet url\r\n                                data: {index: index},\r\n                                file: image,\r\n                                fileFormDataName: ['image']\r\n                            }).progress(function (evt) {\r\n                                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\r\n                            }).success(function (data, status, headers, config) {\r\n                                cb(data);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.uploadFile = function (modelName, id, fieldName, index, file, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            Upload.upload({\r\n                                url: prefix + '/' + path + '/' + id + '/' + fieldName, //upload.php script, node.js route, or servlet url\r\n                                data: {index: index},\r\n                                file: file,\r\n                                fileFormDataName: ['file']\r\n                            }).progress(function (evt) {\r\n                                console.log('percent: ' + parseInt(100.0 * evt.loaded / evt.total));\r\n                            }).success(function (data, status, headers, config) {\r\n                                cb(data);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.deleteImage = function (modelName, id, index, image, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            $http.delete(prefix + '/' + path + '/' + id + '/image/' + image).then(cb);\r\n                        });\r\n                    };\r\n\r\n\r\n                    service.deleteFile = function (modelName, id, index, file, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            $http.delete(prefix + '/' + path + '/' + id + '/file/' + file).then(cb);\r\n                        });\r\n                    };\r\n\r\n                    service.getImageUrl = function (modelName, id, imageName, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            var url = prefix + '/' + path + '/image/' + imageName + common.getRandomQuery();\r\n                            cb(url);\r\n                        });\r\n                    };\r\n\r\n                    service.getFileUrl = function (modelName, id, fileName, cb) {\r\n                        service.getModel(modelName, function (data) {\r\n                            var path = (data.config.path || modelName);\r\n                            var url = prefix + '/' + path + '/file/' + fileName + common.getRandomQuery();\r\n                            cb(url);\r\n                        });\r\n                    };\r\n\r\n                    service.getSingleModel = function (modelName, cb) {\r\n                        if (singlesCache[modelName]) {\r\n                            cb(singlesCache[modelName]);\r\n                        }\r\n                        else {\r\n                            service.search(modelName, {skip: 0, limit: 1}, function (elements, count) {\r\n                                if (count > 0) {\r\n                                    //We only cach if we found THE single document\r\n                                    singlesCache[modelName] = elements[0];\r\n                                    cb(elements[0]);\r\n                                } else {\r\n                                    //Do nothing from now\r\n                                    cb(null);\r\n                                }\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    service.search = function (modelName, query, shard, cb) {\r\n                        if (!cb) {\r\n                            cb = shard;\r\n                            shard = undefined;\r\n                        }\r\n\r\n                        service.getModelConfig(modelName, function (config) {\r\n                            var path = (config.plural || modelName);\r\n                            if (shard && config.shard && config.shard.shardKey) {\r\n                                query[config.shard.shardKey] = shard;\r\n                            } else if (service.getShard(modelName)) {\r\n                                query[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n                            $http.post(prefix + '/' + path, JSON.stringify(query)).success(function (documents) {\r\n                                if (documents.status.search_count !== undefined) {\r\n                                    cb(documents.result, documents.status.search_count);\r\n                                }\r\n                                else {\r\n                                    cb(documents.result, documents.status.count);\r\n                                }\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.export = function (modelName, format, searchQuery, cb) {\r\n                        service.getModelConfig(modelName, function (config) {\r\n                            var query = {};\r\n                            var path = (config.plural || modelName);\r\n                            if (service.getShard(modelName)) {\r\n                                query[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n\r\n                            query.format = format;\r\n                            query.by = config.id;\r\n                            query.query = searchQuery || {};\r\n\r\n                            service.postAsForm(prefix + '/' + path + '/export', query);\r\n                            cb();\r\n                        });\r\n                    };\r\n\r\n                    service.import = function (modelName, format, file, query, cb) {\r\n                        service.getModelConfig(modelName, function (config) {\r\n                            var path = (config.plural || modelName);\r\n                            if (service.getShard(modelName)) {\r\n                                query[service.getShard(modelName).key] = service.getShard(modelName).value;\r\n                            }\r\n\r\n                            query.format = format;\r\n\r\n                            service.postAsForm(prefix + '/' + path + '/export', query, \"POST\", file);\r\n                            cb();\r\n                        });\r\n                    };\r\n\r\n                    service.postAsForm = function (path, params, method, file) {\r\n                        method = method || \"post\"; // Set method to post by default if not specified.\r\n\r\n                        if (file) {\r\n                            console.log(\"FILE\", file);\r\n                        }\r\n\r\n                        console.log(\"POST AS FORM\", path, params, method, file);\r\n\r\n                        // The rest of this code assumes you are not using a library.\r\n                        // It can be made less wordy if you use one.\r\n                        var form = document.createElement(\"form\");\r\n                        form.setAttribute(\"method\", method);\r\n                        form.setAttribute(\"action\", path + \"?token=\" + $http.defaults.headers.common.Authorization.replace(\"BEARER \", \"\"));\r\n\r\n                        for (var key in params) {\r\n\r\n                            if (params.hasOwnProperty(key)) {\r\n                                var hiddenField = document.createElement(\"input\");\r\n                                hiddenField.setAttribute(\"type\", \"hidden\");\r\n                                hiddenField.setAttribute(\"name\", key);\r\n                                if (typeof(params[key]) == \"object\") {\r\n                                    hiddenField.setAttribute(\"value\", JSON.stringify(params[key]));\r\n                                } else {\r\n                                    hiddenField.setAttribute(\"value\", params[key]);\r\n                                }\r\n\r\n                                form.appendChild(hiddenField);\r\n                            }\r\n                        }\r\n\r\n                        /*fieldAttr(params);\r\n\r\n                         function fieldAttr(obj, parent) {\r\n\r\n                         for (var key in obj) {\r\n                         var full = parent ? parent + \".\" + key : key;\r\n                         if(typeof(obj[key]) == \"object\"){\r\n                         fieldAttr(obj[key], full);\r\n                         }\r\n                         if (obj.hasOwnProperty(key)) {\r\n                         var hiddenField = document.createElement(\"input\");\r\n                         hiddenField.setAttribute(\"type\", \"hidden\");\r\n                         hiddenField.setAttribute(\"name\", full);\r\n                         hiddenField.setAttribute(\"value\", obj[full]);\r\n\r\n                         form.appendChild(hiddenField);\r\n                         }\r\n                         }\r\n                         }*/\r\n\r\n                        form.submit();\r\n                    };\r\n\r\n                    service.getGraph = function (modelName, graphID, cb) {\r\n                        service.getModelConfig(modelName, function (config) {\r\n                            var path = (config.path || modelName);\r\n                            $http.post(prefix + '/' + path + '/graphs/' + encodeURI(graphID)).success(function (data) {\r\n                                cb(data);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    service.galleryGetByPath = function (path, cb) {\r\n                        if (!service.isGalleryEnabled())\r\n                            return\r\n                        $http.get(service.getGalleryPath() + path).success(function (data) {\r\n                            cb(data);\r\n                        });\r\n\r\n                    };\r\n\r\n                    service.galleryDeleteByPath = function (path, cb) {\r\n                        if (!service.isGalleryEnabled())\r\n                            return\r\n                        $http.delete(service.getGalleryPath() + path).success(function (data) {\r\n                            cb(data);\r\n                        });\r\n                    };\r\n\r\n                    service.galleryPostByPath = function (path, cb) {\r\n                        Upload.upload({\r\n                            url: service.getGalleryPath() + path,\r\n                            file: \"\",\r\n                            fileFormDataName: ['file[]']\r\n                        }).success(function (data, status, headers, config) {\r\n                            cb(data);\r\n                        });\r\n                    };\r\n\r\n                    service.isGalleryEnabled = function () {\r\n                        return (configs.images && configs.images.gallery && configs.images.gallery.endpoint)\r\n                    }\r\n\r\n                    service.getGalleryPath = function () {\r\n                        var path = configs.images.gallery.endpoint;\r\n                        if (path[0] !== \"/\")\r\n                            path = \"/\" + path;\r\n                        if (path[path.length - 1] !== \"/\")\r\n                            path += \"/\";\r\n                        return prefix + path\r\n                    };\r\n\r\n                    /**\r\n                     * Obtains point separated field {{field}} from schema {{schema}}\r\n                     * @param field\r\n                     * @param schema\r\n                     * @returns {*}\r\n                     */\r\n                    service.getFieldFromSchema = function (field, schema) {\r\n                        if (schema[field]) {\r\n                            return schema[field];\r\n                        } else {\r\n                            var elements = field.split('.');\r\n                            var retElem;\r\n                            for (var i in elements) {\r\n                                if (retElem && retElem.properties) {\r\n                                    retElem = retElem.properties[elements[i]];\r\n                                } else if (retElem && retElem.ref && retElem.denormalize && retElem.denormalize.indexOf(elements[i]) > -1) {\r\n                                    //Todo: Call api and resolve the model field\r\n                                    var refSchema = service.getModel(retElem.ref);\r\n                                    retElem = angular.copy(service.getFieldFromSchema(elements[i], refSchema.schema));\r\n                                    if (retElem && retElem.title) {\r\n                                        var index = field.lastIndexOf(\".\");\r\n                                        retElem.title = common.prettifyTitle(field.substring(0, index) + '.' + retElem.title);\r\n                                        //retElem.title = \"A \"+retElem.title;\r\n                                    }\r\n                                } else {\r\n                                    retElem = schema[elements[i]];\r\n                                }\r\n                            }\r\n\r\n                            return retElem;\r\n                        }\r\n                    };\r\n\r\n                    angular.forEach(Object.keys(overrides), function (key) {\r\n                        service[key] = overrides[key];\r\n                    });\r\n\r\n                    return service;\r\n                }];\r\n            }\r\n        );\r\n}());\n(function () {\n    'use strict';\n    angular.module('injectorApp')\n        .factory('selectCacheService', function () {\n            return {\n                TIMEOUT_MS: 750,\n                timers: {},\n                cache: {}\n            };\n        })\n        .provider('selectCache', function () {\n            this.$get = ['$rootScope', 'models', 'selectCacheService', function ($rootScope, models, selectCacheService) {\n                var provider = {};\n\n                $rootScope.$on('$routeChangeStart', function (event, next, current) {\n                    if (next != current) {\n                        selectCacheService.cache = {};\n                        angular.forEach(Object.keys(selectCacheService.timers), function (m) {\n                            clearTimeout(selectCacheService.timers[m]);\n                            delete selectCacheService.timers[m];\n                        });\n                        //console.log(\"[SelectCache] CACHE CLEARED\");\n                    }\n                });\n\n                provider.search = function (modelName, b, shard, cb) {\n                    var body = JSON.stringify(b);\n                    //console.log(\"[SelectCache] POST FROM SELECT\", modelName, b);\n\n                    if (!selectCacheService.cache[modelName]) {\n                        selectCacheService.cache[modelName] = {};\n                    }\n\n                    if (!selectCacheService.cache[modelName].posts) {\n                        selectCacheService.cache[modelName].posts = {};\n                    }\n\n                    var cached = selectCacheService.cache[modelName].posts[body];\n                    if (!cached) {//A new query\n                        selectCacheService.cache[modelName].posts[body] = {}; //CALLBACKS\n                        selectCacheService.cache[modelName].posts[body].cbks = [cb]; //CALLBACKS\n\n                        //console.log(\"[SelectCache] >>>>>>>>>>>>>> HTTP POST\", modelName, b);\n                        models.search(modelName, b, shard, function (response, count) {\n                            //console.log(\"[SelectCache] POST SELECT RESULT\", modelName, b, {\n                            //    count: count,\n                            //    response: response\n                            //});\n                            selectCacheService.cache[modelName].posts[body].res = {\n                                response: response,\n                                count: count\n                            };\n                            angular.forEach(selectCacheService.cache[modelName].posts[body].cbks, function (cbk) {\n                                cbk(response, count);\n                            });\n                            selectCacheService.cache[modelName].posts[body].cbks = [];\n                        });\n\n                    } else if (!cached.res && cached.cbks) {//Not finished query\n                        cached.cbks.push(cb);\n                        //console.log(\"[SelectCache] ADDED CB FOR POST\", modelName, b);\n                    } else { //Finished query\n                        cached.cbks.push(cb);\n                        angular.forEach(cached.cbks, function (cbk) {\n                            //console.log(\"[SelectCache] CACHED POST\", modelName, b, {\n                            //    count: cached.res.count,\n                            //    response: cached.res.response\n                            //});\n                            cbk(cached.res.response, cached.res.count);\n                        });\n                        cached.cbks = [];\n                    }\n                };\n\n                provider.getDocument = function (modelName, id, shard, cb) {\n                    //console.log(\"[SelectCache] GET FROM SELECT\", modelName, id);\n\n                    if (!selectCacheService.cache[modelName]) {\n                        selectCacheService.cache[modelName] = {};\n                    }\n\n                    if (!selectCacheService.cache[modelName].gets) {\n                        selectCacheService.cache[modelName].gets = {};\n                    }\n\n                    if (id) {\n                        if (!selectCacheService.cache[modelName].gets[id]) {\n                            selectCacheService.cache[modelName].gets[id] = {};\n                        }\n\n                        if (!selectCacheService.cache[modelName].gets[id].cbks) {\n                            selectCacheService.cache[modelName].gets[id].cbks = [];\n                        }\n\n                        if (selectCacheService.cache[modelName].gets[id].result) {\n                            //console.log(\"[SelectCache] CACHED VALUE\", modelName, id, selectCacheService.cache[modelName].gets[id].result);\n                            cb(selectCacheService.cache[modelName].gets[id].result);\n                        } else if (selectCacheService.cache[modelName].gets[id].cbks.indexOf(cb) == -1) {\n                            selectCacheService.cache[modelName].gets[id].cbks.push(cb);\n                            //console.log(\"[SelectCache] ADDED CB FOR GET\", modelName, id);\n\n                            if (selectCacheService.timers[modelName]) {\n                                clearTimeout(selectCacheService.timers[modelName]);\n                            }\n\n                            //TODO: Possible bug, ASYNC MODELNAME && SHARD !!!!!\n                            selectCacheService.timers[modelName] = setTimeout(function(){\n                                httpCall(modelName, shard);\n                            }, selectCacheService.TIMEOUT_MS);\n                        }\n                    } else{\n                        //WE HAVE TO RELEASE THE GETDOCUMENT CALLBACK!!!\n                        cb();\n                    }\n                };\n\n                function httpCall(model, shard) {\n                    models.getModelConfig(model, function (cfg) {\n                        var q = {};\n                        if (shard && cfg.shard.shardKey) {\n                            q[cfg.shard.shardKey] = shard;\n                        }\n\n                        var keys = Object.keys(selectCacheService.cache[model].gets);\n                        if (keys.length == 1) {\n                            q[cfg.id] = keys[0];\n                        } else {\n                            q.$or = [];\n                            angular.forEach(keys, function (id) {\n                                if (!selectCacheService.cache[model].gets[id].result) {\n                                    var singleQ = {};\n                                    singleQ[cfg.id] = id;\n                                    q.$or.push(singleQ);\n                                }\n                            });\n                        }\n\n                        //console.log(\"[SelectCache] >>>>>>>>>>>>>> HTTP GETS\", model, q);\n                        models.search(model, {query: q}, function (result, count) {\n                            //console.log(\"[SelectCache] GET SELECT RESULT\", model, q, result);\n                            angular.forEach(result, function (doc) {\n                                var id = doc[cfg.id];\n                                selectCacheService.cache[model].gets[id].result = doc;\n                            });\n\n                            angular.forEach(Object.keys(selectCacheService.cache[model].gets), function (idKey) {\n                                var getObj = selectCacheService.cache[model].gets[idKey];\n                                if (getObj.cbks) {\n                                    angular.forEach(getObj.cbks, function (cb) {\n                                        cb(getObj.result);\n                                    });\n                                    delete getObj.cbks;\n                                }\n                            });\n                        });\n                    });\n                }\n\n                return provider;\n            }];\n        });\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .factory('httpResponseInterceptor', ['$q', '$location', '$routeParams', 'flash', '$injector', 'configs', function ($q, $location, $routeParams, flash, $injector, configs) {\r\n\r\n            return {\r\n                response: function (response) {\r\n                    //console.log(response);\r\n                    if (response.headers(\"routeinjector\") && (response.headers(\"routeinjector\") !== configs.backoffice.version)) {\r\n                        var ngDialog = $injector.get(\"ngDialog\");\r\n                        if (ngDialog.getOpenDialogs().length === 0) {\r\n                            ngDialog.open({\r\n                                template: \"dialogVersionMismatch\",\r\n                                className: 'ngdialog-theme-default ngdialog-theme-custom'\r\n                            });\r\n                        }\r\n                    }\r\n                    if (response.status === 401) {\r\n                        console.log(\"Response 401\");\r\n                    } else if (response.status === 201) {\r\n                        flash.success(\"Done\", \"Document saved successfully\");\r\n                    }\r\n                    return response || $q.when(response);\r\n                },\r\n                responseError: function (rejection) {\r\n\r\n                    var models = $injector.get(\"models\");\r\n\r\n                    var modelName = $routeParams.schema;\r\n                    var modelId = $routeParams.id;\r\n\r\n                    var errorInReferencedProperty;\r\n                    var prefix = configs.app.prefix;\r\n\r\n                    if (modelName) {\r\n                        models.getModelConfig(modelName, function (model) {\r\n                            var path = \"/\" + model.path + \"/\" + modelId;\r\n                            if (prefix) {\r\n                                path = \"/\" + path;\r\n                            }\r\n\r\n                            errorInReferencedProperty = path !== rejection.config.url;\r\n                            handleError(errorInReferencedProperty);\r\n\r\n                        });\r\n                    } else {\r\n                        handleError(true);\r\n                    }\r\n\r\n                    function handleError(ignoreError) {\r\n                        function redirectError() {\r\n                            if ($location.url() != \"/login\" && $location.url() != \"/logout\" && $location.url() != \"/\") {\r\n                                if ($routeParams.schema) {\r\n                                    $location.path('/model/' + $routeParams.schema);\r\n                                } else {\r\n                                    $location.path('/');\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (rejection.status === 401) {\r\n                            console.log(\"Response Error 401\", rejection);\r\n                            redirectError();\r\n\r\n                            if ($location.url() != \"/login\") {\r\n                                flash.error(\"Unauthorized\", JSON.stringify(rejection.data));\r\n                            }\r\n                        } else if (rejection.status === 500) {\r\n                            flash.error(\"Internal server error\", JSON.stringify(rejection.data));\r\n                        } else if (rejection.status === 400) {  //Client error\r\n                            flash.error(\"Bad Request\", JSON.stringify(rejection.data));\r\n                        } else if (rejection.status === 404 && !ignoreError) {\r\n                            redirectError();\r\n                            flash.error(\"Not Found\", JSON.stringify(rejection.data));\r\n                        } else if (rejection.status === 404 && ignoreError) {\r\n                            flash.warning(\"Property Not Found\", JSON.stringify(rejection.data));\r\n                        } else if (rejection.status === 403) {\r\n                            if (rejection.data && rejection.data.errors) {\r\n                                var errors = [];\r\n                                angular.forEach(Object.keys(rejection.data.errors), function (e) {\r\n                                    errors.push(\"<strong>\" + e + \"</strong> validation failed. Caused by: \" + rejection.data.errors[e].message);\r\n                                });\r\n                                errors.splice(0, 0, \"Validation Error \" + rejection.status + \"\");\r\n                                flash.error.apply(this, errors);\r\n                            } else {\r\n                                flash.error(\"Validation Error \" + rejection.status + \"\", JSON.stringify(rejection.data));\r\n                            }\r\n                        } else if (Math.floor(rejection.status / 100) == 4 || Math.floor(rejection.status / 100) == 5) {\r\n                            redirectError();\r\n                            flash.error(\"Error \" + rejection.status, JSON.stringify(rejection.data));\r\n                        }\r\n                    }\r\n\r\n                    return $q.reject(rejection);\r\n                }\r\n            };\r\n        }\r\n        ])\r\n        .config(['$httpProvider', function ($httpProvider) {\r\n            //Http Interceptor to check failures\r\n            $httpProvider.interceptors.push('httpResponseInterceptor');\r\n        }]);\r\n}());\r\n\n//(function () {\r\n//    'use strict';\r\n//    angular.module('injectorApp')\r\n//        .factory('flash', function ($rootScope) {\r\n//            var queue = [];\r\n//            var currentMessage = \"\";\r\n//\r\n//            $rootScope.$on(\"$routeChangeSuccess\", function () {\r\n//                currentMessage = queue.shift() || \"\";\r\n//            });\r\n//\r\n//            return {\r\n//                setMessage: function (message) {\r\n//                    queue.push(message);\r\n//                },\r\n//                getMessage: function () {\r\n//                    return currentMessage;\r\n//                }\r\n//            };\r\n//        });\r\n//}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .factory('dependsOn', ['$http', 'configs', 'common', 'models', function ($http, configs, common, models) {\r\n        var factory = {};\r\n\r\n        factory.find = function (obj) {\r\n            var depArr = [];\r\n            function innerDependsOn(obj, index) {\r\n                if (typeof obj == \"object\") {\r\n                    $.each(obj, function (k, v) {\r\n                        // k is either an array index or object key\r\n                        if (k == 'dependsOn') {\r\n                            depArr.push({\r\n                                path: index,\r\n                                field: v.field,\r\n                                params: v.params,\r\n                                func: v.func\r\n                            });\r\n                        }\r\n                        if (!index) {\r\n                            index = k;\r\n                        }\r\n                        else {\r\n                            index = index + '.' + k;\r\n                        }\r\n                        innerDependsOn(v, index);\r\n                        var indexArray = index.split('.');\r\n                        indexArray.pop();\r\n                        index = indexArray.join('.');\r\n                    });\r\n                }\r\n                else {\r\n                    var indexArray = index.split('.');\r\n                    indexArray.pop();\r\n                    index = indexArray.join('.');\r\n                }\r\n            }\r\n\r\n            innerDependsOn(obj);\r\n            return depArr;\r\n        };\r\n\r\n        factory.apply = function (scope, modelName, doc) {\r\n            function updateFunc(modelConfig, dependsValue, arrayIndex) {\r\n                return function(newVal, oldVal) {\r\n                    if (newVal) {\r\n                        //configs.getRoutesConfig(function (c) {\r\n                            var url = configs.app.prefix + '/_' + modelConfig.path + '/' + dependsValue.func ;\r\n                            var body = {};\r\n                            angular.forEach(dependsValue.params, function (param) {\r\n                                body[param]= safeAccess(doc, param);\r\n                            });\r\n\r\n                            /*if(arrayIndex !== undefined){ //TODO: I'm not sure...\r\n                                url += '/' + arrayIndex;\r\n                            }*/\r\n\r\n                            $http.post(url, body).success(function (data) {\r\n                                var replaced = dependsValue.path.replace(/properties\\./g, '');\r\n\r\n                                if(arrayIndex !== undefined){\r\n                                    replaced = replaced.replace(/\\.items/g, '[' + arrayIndex + ']');\r\n                                }\r\n\r\n                                common.setField(replaced, doc, data);\r\n                            });\r\n                        //});\r\n                    }\r\n                };\r\n            }\r\n\r\n\r\n            models.getModel(modelName, function (m) {\r\n                var depArr = factory.find(m.schema);\r\n                $.each(depArr, function (k, v) {\r\n                    if ((/(this\\.)/).test(v.field)) {\r\n                        var path = v.path.replace(/properties\\./g, '');\r\n                        var root = path.split('.')[0];\r\n                        var targetField = v.field.replace(/(this\\.)/, \"\");\r\n\r\n                        if ((/(items)/).test(path)) { //Is an array\r\n                            scope.$watchCollection(\"model.\" + root, function (nV, oV) {\r\n                                if (nV && nV instanceof Array) {\r\n                                    for (var i in nV) {\r\n                                        var normPath = root + \"[\" + i + \"].\" + targetField;\r\n                                        for (var p in v.params) {\r\n                                            v.params[p] = normPath;\r\n                                        }\r\n                                        scope.$watch(\"model.\" + normPath, updateFunc(m.config, angular.copy(v), angular.copy(i)));\r\n                                    }\r\n                                }\r\n                            });\r\n                        } else{ // Is an object\r\n                            var normPath = root + \".\" + targetField;\r\n                            scope.$watch('model' + '.' + normPath, updateFunc(m.config, angular.copy(v)));\r\n                        }\r\n                    } else {\r\n                        scope.$watch('model' + '.' + v.field, updateFunc(m.config, v));\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        return factory;\r\n    }]);\r\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .factory('common', ['$rootScope', function ($rootScope) {\r\n\r\n            var factory = {};\r\n\r\n            factory.hasAngularVariable = function (url) {\r\n                return (/\\{{(.*)\\}}/).test(url);\r\n            };\r\n\r\n            factory.deAngularizeUrl = function (doc, url) {\r\n                return url.replace(/\\{{(.*)\\}}/g, function (ng, matched) {\r\n\r\n                    var f = factory.getField(matched, doc);\r\n                    return f;\r\n                });\r\n            };\r\n\r\n            factory.getAngularVariables = function (url) {\r\n                return /\\{{(.*)\\}}/.exec(url)[1];\r\n            };\r\n\r\n            factory.prettifyTitle = function (title, separator) {\r\n                title = title || \"\";\r\n                separator = separator || \".\";\r\n                return title\r\n                    // look for \".\"  user.age will be User -> Age\r\n                    //TODO: Look for separator instead of \".\"\r\n                    .replace(/(\\.([a-z]|[A-Z]))/g, function (str) {\r\n                        return \" <i class='fa fa-angle-right'></i> \" + str.replace(\".\", \"\").toUpperCase();\r\n                    })\r\n                    // insert a space before all caps\r\n                    .replace(/([A-Z])/g, ' $1')\r\n                    // uppercase the first character\r\n                    .replace(/^./, function (str) {\r\n                        return str.toUpperCase();\r\n                    });\r\n            };\r\n\r\n            /**\r\n             * Gets field value in point separated {{field}} from the model {{element}}. Also accepts [] notation.\r\n             * @param field\r\n             * @param element\r\n             * @returns {*}\r\n             */\r\n            factory.getField = function (field, element) {\r\n                if (element) {\r\n                    var splitted = field.split('.');\r\n                    if (splitted instanceof Array && splitted.length > 0) {\r\n                        var ret = element;\r\n                        var returnArray;\r\n                        var parentArr;\r\n                        for (var path in splitted) {\r\n\r\n                            //Method for extract array[].a fields or array[0].a fields.\r\n                            if ((/(\\[\\d*\\])/).test(splitted[path])) {\r\n                                //Is an array !!!\r\n                                var rootElem = splitted[path].replace(/(\\[\\d*\\])/, \"\");\r\n                                var index = splitted[path].match(/(\\d*)(?=\\])/)[0];\r\n\r\n                                if (ret) {\r\n                                    if (index) {\r\n                                        ret = ret[rootElem][index];\r\n                                    }\r\n                                    else {\r\n                                        parentArr = rootElem;\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                if (parentArr) {\r\n                                    var tmp = ret;\r\n                                    returnArray = [];\r\n                                    for (var elem in tmp[parentArr]) {\r\n                                        returnArray.push(tmp[parentArr][elem][splitted[path]]);\r\n                                    }\r\n                                } else {\r\n                                    if (ret) {\r\n                                        ret = ret[splitted[path]];\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        if (returnArray) {\r\n                            return returnArray;\r\n                        }\r\n                        return ret;\r\n                    } else {\r\n                        return element[field];\r\n                    }\r\n                }\r\n            };\r\n\r\n            /**\r\n             * Sets value {{value}} to model {{model}} in the point separated field {{field}}\r\n             * @param field\r\n             * @param model\r\n             * @param value\r\n             */\r\n            factory.setField = function (field, model, value) {\r\n                if (model) {\r\n                    var splitted = field.split('.');\r\n                    if (splitted instanceof Array && splitted.length > 0) {\r\n                        var ref = model;\r\n                        for (var i = 0; i < splitted.length; i++) {\r\n                            var path = splitted[i];\r\n                            if ((/(\\[\\d*\\])/).test(path)) {\r\n                                var rootElem = path.replace(/(\\[\\d*\\])/, \"\");\r\n                                var index = path.match(/(\\d*)(?=\\])/)[0];\r\n\r\n                                var newPath;\r\n                                if (index === undefined) {\r\n                                    for (var arrInd in ref[rootElem]) {\r\n                                        newPath = splitted[i + 1];\r\n                                        factory.setField(newPath, ref[rootElem][arrInd], value);\r\n                                    }\r\n                                } else {\r\n                                    newPath = splitted[i + 1];\r\n                                    factory.setField(newPath, ref[rootElem][index], value);\r\n                                }\r\n                            } else {\r\n                                if (i < splitted.length - 1) {\r\n                                    if (!ref[path]) {\r\n                                        ref[path] = {};\r\n                                    }\r\n                                    ref = ref[path];\r\n                                } else {\r\n                                    ref[path] = value;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n            /**\r\n             * Obtains all the keys of an schema (using {{separator}} as nested level indicator)\r\n             * @param schema\r\n             * @param separator\r\n             * @returns {Array}\r\n             */\r\n            factory.getAllSchemaFields = function (schema, separator) {\r\n                separator = separator || \".\";\r\n                var fields = [];\r\n\r\n                function searchFields(obj, parent) {\r\n                    var keys = Object.keys(obj);\r\n                    angular.forEach(keys, function (k) {\r\n                        if (obj[k].properties) {\r\n                            searchFields(obj[k].properties, parent ? (parent + separator + k) : k);\r\n                        } else if (obj[k].denormalize) {\r\n                            angular.forEach(obj[k].denormalize, function (field) {\r\n                                fields.push((parent ? (parent + separator) : \"\") + k + separator + field);\r\n                            });\r\n                        } else {\r\n                            fields.push(parent ? (parent + separator + k) : k);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                searchFields(schema);\r\n\r\n                return fields;\r\n            };\r\n\r\n            /**\r\n             * Process the form and returns the schema form for the schemaForm module\r\n             * @param form\r\n             * @param submitButtons\r\n             * @returns {*|string[]}\r\n             */\r\n            factory.processForm = function (form, submitButtons) {\r\n                var showSubmitButtons = (submitButtons === undefined || submitButtons);\r\n                var innerForm;\r\n\r\n                if (form && form.tabs) {\r\n                    innerForm = innerForm || [];\r\n                    innerForm.push({\r\n                        \"type\": \"tabs\",\r\n                        \"tabs\": form.tabs\r\n                    });\r\n                } else if (form && form.items) {\r\n                    innerForm = form.items;\r\n                }\r\n\r\n                innerForm = innerForm || [\"*\"];\r\n\r\n                //TODO: Keep this comment out to wait if someone complains of missing feature\r\n                //if (showSubmitButtons) {\r\n                //    var hasSubmitButton = false;\r\n                //    angular.forEach(innerForm, function (item) {\r\n                //        if (item.type == \"submit\") {\r\n                //            hasSubmitButton = true;\r\n                //        }\r\n                //    });\r\n                //\r\n                //    if (!hasSubmitButton) {\r\n                //        innerForm.push({\r\n                //            type: \"submit\",\r\n                //            title: \"Save\"\r\n                //        });\r\n                //    }\r\n                //\r\n                //}\r\n\r\n                return innerForm;\r\n            };\r\n\r\n            factory.randomNumber = function () {\r\n                return (new Date()).getTime();\r\n            };\r\n\r\n            factory.getRandomQuery = function () {\r\n                return '?r=' + factory.randomNumber();\r\n            };\r\n\r\n            return factory;\r\n        }]);\r\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .factory('search', ['$rootScope', 'models', function ($rootScope, models) {\r\n            var query = {};\r\n\r\n            return {\r\n                setQuery: function (q) {\r\n                    query.query = q;\r\n                },\r\n                clearQuery: function() {\r\n                    this.setQuery({});\r\n                },\r\n                getQuery: function () {\r\n                    return query.query;\r\n                },\r\n                setSortBy: function (sort) {\r\n                    query.sortBy = sort;\r\n                },\r\n                addSortBy: function(field, asc) {\r\n                    query.sortBy = {};\r\n                    query.sortBy[field] = asc ? 1 : -1;\r\n                },\r\n                getSort: function(field) {\r\n                    if(query.sortBy) {\r\n                        return query.sortBy[field];\r\n                    } else {\r\n                        return undefined;\r\n                    }\r\n                },\r\n                setSkip: function(skip){\r\n                    query.skip = skip;\r\n                },\r\n                setLimit: function(limit){\r\n                    query.limit = limit;\r\n                },\r\n                search: function (schema,  callback) {\r\n                    models.search(schema, query, function (elements, count) {\r\n                        callback(elements, count, null);\r\n                    });\r\n                },\r\n                searchAndGroup: function(schema, callback) {\r\n                    //TODO: Montar la query con grupos\r\n                    //TODO: Volver al modelController y aadir una columna de grupo (p.ej. count)\r\n                    //TODO: Pintar !!\r\n                }\r\n            };\r\n\r\n        }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .directive('sideMenu', function () {\r\n            return {\r\n                restrict: 'E',\r\n                scope: false,\r\n                templateUrl: 'html/side-menu.html',\r\n                controller: ['$scope', '$routeParams', '$location', 'common', 'models', 'customMenu', '$window', '$rootScope', function ($scope, $routeParams, $location, common, models, customMenu, $window, $rootScope) {\r\n                    $scope.common = common;\r\n\r\n                    $scope.$on(\"$routeChangeStart\", function (event, next, current) {\r\n                        if (next.params.schema) {\r\n                            $scope.actualSchema = next.params.schema;\r\n                        }\r\n                    });\r\n                    $scope.isDisabled = false;\r\n                    $scope.isOpen = false;\r\n\r\n                    var render = function () {\r\n                        $scope.sections = new Sections();\r\n\r\n                        angular.forEach(customMenu, function (elem) {\r\n                            $scope.sections.add(elem.section, elem.title, elem);\r\n                        });\r\n\r\n                        if (models.isGalleryEnabled()) {\r\n                            $scope.sections.add(\"Gallery\", \"Gallery\", {\r\n                                clickTo: \"gallery\"\r\n                            });\r\n                        }\r\n\r\n                        models.getModels(function (m) {\r\n                            angular.forEach(m, function (schema) {\r\n                                models.getModelConfig(schema, function (config) {\r\n                                    if (!config.hideMenu) {\r\n                                        if (config.isSingle) {\r\n                                            models.getSingleModel(schema, function (doc) {\r\n                                                if (doc) {\r\n                                                    config.clickTo = \"model/\" + schema + \"/update/\" + doc[config.id];\r\n                                                } else {\r\n                                                    config.clickTo = \"model/\" + schema + \"/new\";\r\n                                                }\r\n                                            });\r\n                                        } else {\r\n                                            config.clickTo = \"model/\" + schema;\r\n                                        }\r\n                                        $scope.sections.add(config.section, schema, config);\r\n                                    }\r\n                                });\r\n                            });\r\n                        });\r\n                    };\r\n\r\n\r\n                    render();\r\n                    $rootScope.$on('invalidate', function () {\r\n                        render();\r\n                    });\r\n\r\n                    $scope.openSection = function (section) {\r\n                        $scope.actualSection = section;\r\n                    };\r\n\r\n                    $scope.click = function (section, name, conf) {\r\n                        $scope.parentSchema = section;\r\n                        $scope.actualSchema = name;\r\n                        $scope.actualSection = section;\r\n                        if (conf.clickTo) {\r\n                            $location.path(conf.clickTo);\r\n                        } else if (conf.url) {\r\n                            $window.location.href = conf.url;\r\n                        }\r\n                    };\r\n\r\n                    $scope.isInstanceOf = function (obj) {\r\n                        return (obj instanceof Section);\r\n                    };\r\n\r\n                    $scope.debug = function (a, b) {\r\n                        console.log(a, b);\r\n                    };\r\n                }]\r\n            };\r\n        });\r\n}());\r\n\r\nvar Section = function () {\r\n};\r\nvar Sections = function () {\r\n\r\n\r\n    var menu = {};\r\n\r\n    this.get = function () {\r\n        return menu;\r\n    };\r\n\r\n\r\n    this.add = function (key, schema, config) {\r\n        /**\r\n         * Dot notation loop: http://stackoverflow.com/a/10253459/607354\r\n         */\r\n        var levels = key.split(\".\");\r\n        var curLevel = menu;\r\n        var i = 0;\r\n        while (i < levels.length - 1) {\r\n            if (typeof curLevel[levels[i]] === 'undefined') {\r\n                curLevel[levels[i]] = new Section();\r\n            }\r\n\r\n            curLevel = curLevel[levels[i]];\r\n            i++;\r\n        }\r\n\r\n        curLevel[levels[levels.length - 1]] = curLevel[levels[levels.length - 1]] || new Section();\r\n        curLevel[levels[levels.length - 1]][schema] = config;\r\n    };\r\n};\r\n\n(function () {\n    'use strict';\n    angular.module('injectorApp')\n        .directive('scrollToItem', function () {\n            return {\n                restrict: 'A',\n                scope: {\n                    scrollTo: \"@\"\n                },\n                link: function (scope, $elm, attr) {\n\n                    $elm.on('click', function () {\n                        $('html,body').animate({scrollTop: $(scope.scrollTo).offset().top}, \"slow\");\n                    });\n                }\n            };\n        });\n}());\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .directive('compile', ['$compile', function($compile) {\r\n        // directive factory creates a link function\r\n        return function(scope, element, attrs) {\r\n            scope.$watch(\r\n                function(scope) {\r\n                    // watch the 'compile' expression for changes\r\n                    return scope.$eval(attrs.compile);\r\n                },\r\n                function(value) {\r\n                    // when the 'compile' expression changes\r\n                    // assign it into the current DOM\r\n                    element.html(value);\r\n\r\n                    // compile the new DOM and link it to the current\r\n                    // scope.\r\n                    // NOTE: we only compile .childNodes so that\r\n                    // we don't get into infinite loop compiling ourselves\r\n                    $compile(element.contents())(scope);\r\n                }\r\n            );\r\n        };\r\n    }]);\r\n}());\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp').directive('injectorPunchcard', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'AE',\r\n            scope: true,\r\n            templateUrl: 'js/directives/injector-punchcard/injector-punchcard.html',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                models.getGraph(modelName, attrs.graph, function(data){\r\n                    scope.elements = Object.keys(data);\r\n                    scope.selected = scope.elements[0];\r\n                    scope.punchCardData = data[scope.selected];\r\n                    scope.$watch('selected', function(selected){\r\n                       scope.punchCardData = data[selected];\r\n                    });\r\n                });\r\n            }\r\n        };\r\n    }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp').directive('injectorBargraph', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'AE',\r\n            scope: true,\r\n            templateUrl: 'js/directives/injector-bargraph/injector-bargraph.html',\r\n            link: function (scope, element, attrs, ngModel) {\r\n\r\n                var modelName = $routeParams.schema;\r\n                models.getModelConfig(modelName, function (config) {\r\n                    models.getGraph(modelName, attrs.graph, function (data) {\r\n\r\n                        var graph = {};\r\n                        for(var i in config.graphs){\r\n                            var g = config.graphs[i];\r\n\r\n                            if(g.title == attrs.graph){\r\n                                graph = g;\r\n                            }\r\n                        }\r\n\r\n                        scope.elements = Object.keys(data);\r\n                        scope.selected = scope.elements[0];\r\n\r\n                        if(graph.groupMode == \"series\"){\r\n                            scope.selectEnabled = false;\r\n\r\n                        } else if(graph.groupMode == \"select\"){\r\n                            scope.selectEnabled = true;\r\n                        } else{\r\n                            console.error(\"Invalid configuration at bargraph group Mode:\", graph.groupMode);\r\n                        }\r\n\r\n                        if (scope.selectEnabled === true) {\r\n                            //GroupedBy with select2 !!\r\n                            scope.barsData = [\r\n                                {\r\n                                    key: scope.selected,\r\n                                    values: data[scope.selected]\r\n                                }\r\n                            ];\r\n\r\n                            scope.$watch('selected', function (selected) {\r\n                                if (scope.selectEnabled === true) {\r\n                                    scope.barsData = [\r\n                                        {\r\n                                            key: selected,\r\n                                            values: data[selected]\r\n                                        }\r\n                                    ];\r\n                                }\r\n                            });\r\n\r\n                        } else {\r\n                            //Grouped by in legend !\r\n                            scope.barsData = [];\r\n                            for (var key in data) {\r\n                                scope.barsData.push(\r\n                                    {\r\n                                        key: key,\r\n                                        values: data[key]\r\n                                    });\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        };\r\n    }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp').directive('modelButtons', ['$routeParams', '$http', '$q', '$route', 'models', '$location', function ($routeParams, $http, $q, $route, models, $location) {\r\n        return {\r\n            restrict: 'AE',\r\n            scope: false, //Use the parent scope, in this case the modelController (this directive always will be loaded in the model page!)\r\n            //If not, we should set scope to true and implement here all the functions\r\n            templateUrl: 'js/directives/model-buttons/model-buttons.html',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                scope.performAction = function (action) {\r\n                    if (action.type && action.type == \"form\") {\r\n                        //post as form\r\n                        models.postAsForm(action.path, action.data, 'post');\r\n                    } else if (action.type && action.type == \"location\") {\r\n                        $location.path(action.location);\r\n                    } else {\r\n                        var req = {\r\n                            method: action.method,\r\n                            url: action.path,\r\n                            headers: {\r\n                                'Content-Type': 'application/json'\r\n                            },\r\n                            data: action.data\r\n                        };\r\n\r\n                        $http(req);\r\n                    }\r\n                };\r\n\r\n                function exportElements() {\r\n                    var checked = scope.elements.filter(function (x) {\r\n                        return x.checked;\r\n                    });\r\n\r\n                    if (checked && checked.length > 0) {\r\n                        var query = {$or: []};\r\n                        angular.forEach(checked, function (elem) {\r\n                            query.$or.push({_id: elem._id});//We search by id\r\n                        });\r\n                        return query;\r\n                    } else {\r\n                        return scope.query;\r\n                    }\r\n                }\r\n\r\n                scope.export = function exportModels(format) {\r\n                    models.export(scope.schema, format, exportElements(), function (doc) {\r\n                    });\r\n                };\r\n\r\n\r\n                scope.import = function importModels(format) {\r\n                    console.log(\"IMPORT\", format, scope.schema);\r\n                    var file = \"\";\r\n                    models.import(scope.schema, format, file, function (doc) {\r\n                    });\r\n                };\r\n\r\n                scope.enableDelete = function () {\r\n                    if (!scope.elements) {\r\n                        return false;\r\n                    }\r\n                    var checkedValues = scope.elements.filter(function (val) {\r\n                        return val.checked;\r\n                    });\r\n\r\n                    return checkedValues.length > 0;\r\n                };\r\n\r\n                scope.removeSelected = function removeSelected() {\r\n                    var checkedValues = scope.elements.filter(function (val) {\r\n                        return val.checked;\r\n                    });\r\n\r\n                    if (checkedValues.length > 0) {\r\n                        scope.promptAlert(function (del) {\r\n                            if (del) {\r\n                                var deletions = [];\r\n                                angular.forEach(checkedValues, function (element) {\r\n                                    var deferred = $q.defer();\r\n                                    deletions.push(deferred.promise);\r\n\r\n                                    models.getModelConfig(scope.schema, function (cfg) {\r\n                                        var shard;\r\n\r\n                                        if (cfg.shard && cfg.shard.shardKey) {\r\n                                            shard = element[cfg.shard.shardKey];\r\n                                        }\r\n\r\n                                        if (scope.isDisabled(element)) {\r\n                                            models.removeDocumentByMongoId(scope.schema, element._id, shard, function (doc) {\r\n                                                deferred.resolve();\r\n                                            });\r\n                                        } else {\r\n                                            models.removeDocument(scope.schema, scope.id(element), shard, function (doc) {\r\n                                                deferred.resolve();\r\n                                            });\r\n                                        }\r\n                                    });\r\n                                });\r\n                                $q.all(deletions).then(function () {\r\n                                    $route.reload();\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        };\r\n    }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .directive('searchInModel', ['$routeParams', 'models', 'common', 'search', function ($routeParams, models, common, search) {\r\n            return {\r\n                restrict: 'AE',\r\n                scope: false,\r\n                templateUrl: 'js/directives/search-model/search-model.html',\r\n                link: function (scope, element, attrs, ngModel) {\r\n                    scope.searches = [];\r\n                    scope.models = models;\r\n                    var modelName = $routeParams.schema;\r\n\r\n\r\n                    scope.buildPath = function (field, schema) {\r\n                        var sc = models.getFieldFromSchema(field, schema);\r\n                        var title;\r\n                        if (sc && sc.title) {\r\n                            var i = field.lastIndexOf(\".\");\r\n                            if (i > -1 && sc.title.indexOf(\"<i\") == -1) {//TODO: APA DE LAS GUAPAS, ESTO HAY QUE CAMBIARLO\r\n                                title = common.prettifyTitle(field.substring(0, i) + '.' + sc.title);\r\n                            } else {\r\n                                title = sc.title;\r\n                            }\r\n\r\n                        } else {\r\n                            title = common.prettifyTitle(field);\r\n                        }\r\n\r\n                        return title;\r\n                    };\r\n\r\n                    scope.updateSearch = function (elemSearch, field, noSearch) {\r\n                        var index;\r\n                        if (elemSearch.field) {\r\n                            index = scope.availableFields.indexOf(elemSearch.field);\r\n                            if (index == -1) {\r\n                                scope.availableFields.push(elemSearch.field);\r\n                            }\r\n                        }\r\n\r\n                        var fieldFromSchema = models.getFieldFromSchema(field, scope.schema);\r\n\r\n                        elemSearch.title = fieldFromSchema.title;\r\n                        elemSearch.field = field;\r\n                        elemSearch.placeholder = {modelName: modelName, field: elemSearch.field};\r\n                        elemSearch.ref = (fieldFromSchema.ref && !fieldFromSchema.denormalize) ? fieldFromSchema.ref : undefined;\r\n\r\n                        index = scope.availableFields.indexOf(field);\r\n                        if (index > -1) {\r\n                            scope.availableFields.splice(index, 1);\r\n                        }\r\n\r\n                        if (!noSearch) {\r\n                            scope.search();\r\n                        }\r\n                    };\r\n\r\n                    scope.addSearch = function (field) {\r\n                        var s = {};\r\n                        field = field || scope.availableFields[0];\r\n\r\n                        s.clear = function () {\r\n                            s.value = \"\";\r\n                            scope.search();\r\n                        };\r\n\r\n                        s.remove = function () {\r\n\r\n                            var index = scope.searches.indexOf(s);\r\n                            if (index > -1) {\r\n                                scope.searches.splice(index, 1);\r\n                            }\r\n\r\n                            index = scope.availableFields.indexOf(s.field);\r\n                            if (index == -1) {\r\n                                scope.availableFields.push(s.field);\r\n                            }\r\n                            scope.search();\r\n                        };\r\n\r\n                        scope.updateSearch(s, field, true);\r\n                        scope.searches.push(s);\r\n                    };\r\n\r\n                    models.getModelSchema(modelName, function (schema) {\r\n                        if (schema) {\r\n                            scope.schema = schema;\r\n                            scope.allFields = common.getAllSchemaFields(schema);\r\n                            scope.availableFields = scope.allFields.filter(function (val) {\r\n                                var f = models.getFieldFromSchema(val, schema);\r\n                                return (f && f.format != \"image\" && f.format != \"mixed\");\r\n                            });\r\n                        }\r\n                    });\r\n                    models.getModelConfig(modelName, function (config) {\r\n                        scope.addSearch(config.displayField);\r\n                    });\r\n\r\n                    /*scope.$on('$routeChangeSuccess', function (event, current, previous) {\r\n                     searchFunc(current.params.schema);\r\n                     });*/\r\n\r\n                    //scope.newSearch = function () {\r\n                    //    scope.addSearch(scope.availableFields[0]);\r\n                    //};\r\n\r\n                    /*** MONGO DATE PARSING **/\r\n                    function parseMongoDate(txt) {\r\n                        var result = {};\r\n                        var dt = parseDateTimeRange(txt);\r\n\r\n                        if(dt.err) {\r\n                            return dt;\r\n                        }\r\n\r\n                        if(!dt.end) {\r\n                            //CASE 0 1/12/15 convert year\r\n                            updateYear(dt.start);\r\n                            var d = dt.start;\r\n\r\n                            if(d.day == undefined && d.month != undefined && d.year != undefined && d.hour == undefined) {\r\n                                //CASE 4 12/2015 -> gte 1/12/2015 0:00:00 .. lt 1/1/2016 0:00:00\r\n                                result[\"$gte\"] = new Date(d.year,d.month-1,1,0,0,0,0);\r\n                                result[\"$lt\"]  = new Date(d.year,d.month,1,0,0,0,0);\r\n                            } else if(d.day != undefined && d.month != undefined && d.year != undefined && d.hour == undefined) {\r\n                                //CASE 1 1/12/2015 -> 1/12/2015 0:00:00 .. lt 2/12/2015 0:00:00\r\n                                result[\"$gte\"] = new Date(d.year,d.month-1,d.day,0,0,0,0);\r\n                                result[\"$lt\"] =  new Date(d.year,d.month-1,d.day+1,0,0,0,0);\r\n                            } else if(d.day != undefined && d.month != undefined && d.year != undefined && d.hour != undefined) {\r\n                                //CASE 2 1/12/2015 HH:MM -> gte 1/12/2015 HH:MM:00 .. lte 1/12/2015 HH:MM:59\r\n                                //CASE 3 1/12/2015 HH:MM:SS\r\n                                var sec = 0;\r\n                                if(!isNaN(d.second)) {\r\n                                    sec = d.second;\r\n                                }\r\n                                result[\"$gte\"] = new Date(d.year,d.month-1,d.day,d.hour,d.minute,sec,0);\r\n                                result[\"$lte\"] = new Date(d.year,d.month-1,d.day,d.hour,d.minute,sec,999);\r\n                            } else {\r\n                                result = {err: \"format invalid\"};\r\n                            }\r\n                        } else {\r\n                            //CASE 0 1/12/15 convert year\r\n                            updateYear(dt.start);\r\n                            updateYear(dt.end);\r\n                            var d1 = dt.start;\r\n                            var d2 = dt.end;\r\n                            var sec1 = 0;\r\n                            var sec2 = 0;\r\n\r\n                            if(d1.second != undefined) {\r\n                                sec1 = d1.second;\r\n                            }\r\n\r\n                            if(d2.second != undefined) {\r\n                                sec2 = d2.second;\r\n                            }\r\n\r\n                            if(d1.hour == undefined && d2.hour == undefined && d1.year != undefined && d2.year != undefined) {\r\n                                // 1/2/90 - 2/2/90\r\n                                result[\"$gte\"] = new Date(d1.year,d1.month-1,d1.day,0,0,0,0);\r\n                                result[\"$lte\"] = new Date(d2.year,d2.month-1,d2.day,23,59,59,999);\r\n                            } else if(d1.hour != undefined && d2.hour != undefined && d1.year != undefined && d2.year != undefined) {\r\n                                // 1/2/90 H:M - 2/2/90 H:M\r\n                                result[\"$gte\"] = new Date(d1.year,d1.month-1,d1.day,d1.hour,d1.minute,sec1,0);\r\n                                result[\"$lte\"] = new Date(d2.year,d2.month-1,d2.day,d2.hour,d2.minute,sec2,999);\r\n                            } else if(d1.hour != undefined && d2.hour != undefined && d1.year != undefined && d2.year == undefined) {\r\n                                // 1/2/90 H:M - H:M\r\n                                result[\"$gte\"] = new Date(d1.year,d1.month-1,d1.day,d1.hour,d1.minute,sec1,0);\r\n                                result[\"$lte\"] = new Date(d1.year,d1.month-1,d1.day,d2.hour,d2.minute,sec2,999);\r\n                            } else if(d1.hour != undefined && d2.hour == undefined && d1.year != undefined && d2.year != undefined) {\r\n                                // 1/2/90 H:M - 2/2/90\r\n                                result[\"$gte\"] = new Date(d1.year,d1.month-1,d1.day,d1.hour,d1.minute,sec1,0);\r\n                                result[\"$lte\"] = new Date(d2.year,d2.month-1,d2.day,d1.hour,d1.minute,sec1,999);\r\n                            } else {\r\n                                result = {err: \"format invalid\"};\r\n                            }\r\n                        }\r\n                        debugParse(result);\r\n                        return result;\r\n                    }\r\n\r\n                    function updateYear(dt) {\r\n                        var year = Number(dt.year);\r\n                        if(year<100) {\r\n                            if(year<46) {\r\n                                year = 2000 + year;\r\n                            } else {\r\n                                year = 1900 + year;\r\n                            }\r\n                            dt.year = String(year);\r\n                        }\r\n                    }\r\n\r\n                    function parseDateTimeRange(txt) {\r\n                        var pieces = txt.split(\"-\");\r\n                        switch(pieces.length) {\r\n                            case 1:\r\n                                var d1 = parseDateTime(pieces[0].trim());\r\n                                if(d1) {\r\n                                    return {start: d1};\r\n                                } else {\r\n                                    return {err:\"format invalid\"};\r\n                                }\r\n                            case 2:\r\n                                var d1 = parseDateTime(pieces[0].trim());\r\n                                var d2 = parseDateTime(pieces[1].trim());\r\n                                if(d1 && d2) {\r\n                                    return {start: d1, end: d2};\r\n                                } else {\r\n                                    return {err:\"format invalid\"};\r\n                                }\r\n                            default:\r\n                                return {err:\"format invalid\"};\r\n                        }\r\n                    }\r\n\r\n                    function parseDateTime(dt) {\r\n                        var pieces = dt.split(\" \");\r\n                        switch(pieces.length) {\r\n                            case 1:\r\n                                return parseDateOrTime(pieces[0].trim());\r\n                            case 2:\r\n                                var dt1 = parseDateOrTime(pieces[0].trim());\r\n                                var dt2 = parseDateOrTime(pieces[1].trim());\r\n                                if(!dt1 || !dt2) {\r\n                                    return null;\r\n                                } else {\r\n                                    dt1.hour = dt2.hour;\r\n                                    dt1.minute = dt2.minute;\r\n                                    dt1.second = dt2.second;\r\n                                    return dt1;\r\n                                }\r\n                            default:\r\n                                return null;\r\n                        }\r\n                    }\r\n\r\n                    function parseDateOrTime(dt) {\r\n                        if(dt.indexOf(':')!=-1) {\r\n                            return parseTime(dt);\r\n                        } else if(dt.indexOf('/')!=-1) {\r\n                            return parseDate(dt);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    }\r\n\r\n                    function Num(txt) {\r\n                        if(txt==undefined) return undefined;\r\n                        return Number(txt);\r\n                    }\r\n\r\n                    function parseTime(t) {\r\n                        var regex = /^(\\d?\\d):(\\d\\d)(:(\\d\\d))?$/g\r\n                        var result = regex.exec(t);\r\n                        if(result) {\r\n                            return {hour: Num(result[1]) , minute: Num(result[2]), second: Num(result[4])};\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    }\r\n\r\n                    function parseDate(d) {\r\n                        var regex = /^((\\d?\\d)\\/)?(\\d?\\d)\\/(\\d{2,4})$/g\r\n                        var result = regex.exec(d);\r\n                        if(result) {\r\n                            var o = {day: Num(result[2]) , month: Num(result[3]), year: Num(result[4])};\r\n                            return o;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    }\r\n\r\n                    function debugParse(x) {\r\n                        if(x[\"$gte\"]) {\r\n                            console.log(\"GTE\", x[\"$gte\"].toLocaleString(\"es-ES\"));\r\n                        }\r\n                        if(x[\"$gt\"]) {\r\n                            console.log(\"GT \", x[\"$gt\"].toLocaleString(\"es-ES\"));\r\n                        }\r\n                        if(x[\"$lte\"]) {\r\n                            console.log(\"LTE\", x[\"$lte\"].toLocaleString(\"es-ES\"));\r\n                        }\r\n                        if(x[\"$lt\"]) {\r\n                            console.log(\"LT \", x[\"$lt\"].toLocaleString(\"es-ES\"));\r\n                        }\r\n                        console.log(\"----------------------------------------\");\r\n                    }\r\n\r\n                    /** END MONGO DATE PARSING ***/\r\n\r\n                    scope.search = function () {\r\n                        var query = {};\r\n\r\n                        models.getModelSchema(modelName, function (schema) {\r\n                            angular.forEach(scope.searches, function (s) {\r\n                                var singleQuery = {};\r\n                                if (s.value) {\r\n                                    var sfield = models.getFieldFromSchema(s.field, schema);\r\n                                    if (sfield) {\r\n                                        if (sfield.type == \"string\" && !sfield.format && !sfield.ref) {\r\n                                            if (s.value !== \"\") {\r\n                                                singleQuery[s.field] = {$regex: s.value, $options: 'i'};\r\n                                            }\r\n                                        } else if (sfield.type == \"string\" && sfield.format == \"date\") {\r\n                                            var q = parseMongoDate(s.value);\r\n\r\n                                            if (s.value !== \"\") {\r\n                                                if(q.err == undefined) {\r\n                                                    singleQuery[s.field] = q;\r\n                                                } else {\r\n                                                    alert(\"Format invalid in field \"+s.field);\r\n                                                }\r\n                                            }\r\n                                        } else if (sfield.ref && !sfield.denormalize) {\r\n                                            singleQuery[s.field] = s.value;\r\n                                            //References may be we should load before some useful information for querying references\r\n                                        } else if (sfield.ref && sfield.denormalize) {\r\n                                            singleQuery[s.field] = {$regex: s.value, $options: 'i'};\r\n                                        } else {\r\n                                            singleQuery[s.field] = s.value;\r\n                                        }\r\n                                    }\r\n                                }\r\n                                angular.extend(query, singleQuery);\r\n                            });\r\n                        });\r\n\r\n                        search.setQuery(query);\r\n                        search.setSkip(0);\r\n                        scope.$parent.search();\r\n\r\n                    };\r\n                }\r\n            };\r\n        }])\r\n        .directive(\"searchRefInModel\", ['models', 'common', function (models, common) {\r\n            return {\r\n                restrict: 'AE',\r\n                scope: false,\r\n                templateUrl: 'js/directives/search-model/search-ref-model.html',\r\n                link: function (scope, element, attrs, ngModel) {\r\n                    scope.elemsearch = scope.$eval(attrs.elemsearch);\r\n                    var ref = scope.elemsearch.ref;\r\n\r\n                    if (!element.select) {\r\n                        return;\r\n                    }\r\n\r\n                    var displayField = \"\";\r\n                    var idSelect = \"\";\r\n\r\n                    function getDocumentById(modelId) {\r\n                        return function (query, skip) {\r\n                            return models.getModel(ref, function (m) {\r\n                                var config = m.config;\r\n                                var elem = \"\";\r\n                                if (modelId instanceof Object) {\r\n                                    elem = modelId[config.id];\r\n                                } else {\r\n                                    elem = modelId;\r\n                                }\r\n                                models.getDocument(ref, elem, function (doc) {\r\n                                    displayField = config.displayField;\r\n                                    idSelect = config.id;\r\n\r\n                                    var q = {};\r\n                                    q.query = {};\r\n                                    var regex = query.search;\r\n                                    q.query.$or = [];\r\n\r\n                                    var forDisplay = {};\r\n                                    forDisplay[displayField] = {$regex: regex, $options: 'i'};\r\n                                    q.query.$or.push(forDisplay);\r\n\r\n\r\n                                    if (config.id != \"_id\" && m.schema[config.id] && m.schema[config.id].type == \"string\") {\r\n                                        var forID = {};\r\n                                        forID[idSelect] = {$regex: regex, $options: 'i'};\r\n                                        q.query.$or.push(forID);\r\n                                    }\r\n\r\n                                    q.limit = 20;\r\n                                    q.skip = skip;\r\n\r\n                                    //SHARDING\r\n                                    if (models.getShard(ref)) {\r\n                                        q[models.getShard(ref).key] = models.getShard(ref).value;\r\n                                    }\r\n\r\n                                    models.search(ref, q, function (response, count) {\r\n                                        if (skip) {\r\n                                            scope.searchRes = scope.searchRes.concat(response);\r\n                                        } else {\r\n                                            scope.searchRes = response;\r\n                                        }\r\n\r\n                                        if (doc) {\r\n                                            var present = scope.searchRes.some(function (element) {\r\n                                                return element[config.id] == doc[config.id];\r\n                                            });\r\n\r\n                                            if (!present) {\r\n                                                scope.searchRes.splice(0, 0, doc);\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                });\r\n                            });\r\n                        };\r\n                    }\r\n\r\n                    var elements = getDocumentById(scope.$eval(attrs.ngModel));\r\n\r\n                    scope.disabled = false;\r\n                    scope.searchEnabled = true;\r\n                    scope.searchRes = [];\r\n                    scope.search = elements;\r\n\r\n                    scope.printSelectedElement = function (document) {\r\n                        if (document) {\r\n                            var f = common.getField(displayField, document);\r\n                            if (f && f !== \"\" && f.length > 0) {\r\n                                return f + \" <\" + document[idSelect] + \">\";\r\n                            } else {\r\n                                return \"No display field. ID: <\" + document[idSelect] + \">\";\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    scope.selectDisplayField = function (document) {\r\n                        if (document) {\r\n                            var f = common.getField(displayField, document);\r\n                            if (f && f !== \"\" && f.length > 0) {\r\n                                return f;\r\n                            } else {\r\n                                return \"<empty>\";\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    scope.selectIdField = function (document) {\r\n                        if (document !== undefined) {\r\n                            return document[idSelect] || \"No ID\";\r\n                        }\r\n                    };\r\n\r\n                    scope.$on('refreshSelect2' + ref, function () {\r\n                        console.log(\"REFRESH SELECT2\");\r\n                        elements();\r\n                    });\r\n\r\n                    element.find('ul').bind('scroll', function () {\r\n                        var raw = arguments[0].target;\r\n                        if (raw.scrollTop + raw.offsetHeight > raw.scrollHeight) {\r\n                            elements(scope.$select, (raw.children[0].children.length - 2));\r\n                        }\r\n                    });\r\n\r\n                }\r\n            };\r\n        }]);\r\n}());\r\n\n(function () {\n    'use strict';\n    angular.module('injectorApp').directive('ellipsis', function () {\n        return {\n            restrict: 'A',\n            scope: true,\n            link: function (scope, element, attrs, ngModel) {\n                var width = element.width();\n                element.css(\"width\", width);\n                element.css(\"text-overflow\", 'ellipsis');\n                element.css(\"overflow\", 'hidden');\n                element.css(\"white-space\", 'nowrap');\n                // Do calculation\n                //var model = scope.$eval(attrs.ngModel);\n                //console.log(\"Model\", model);\n                //console.log(\"Model > Length\", model.width());\n            }\n        };\n    });\n}());\n(function () {\n    'use strict';\n    angular.module('injectorApp')\n        .directive(\n            \"mAppLoading\",\n            ['$animate', function ($animate) {\n                // Return the directive configuration.\n                return ({\n                    link: link,\n                    restrict: \"C\"\n                });\n                // I bind the JavaScript events to the scope.\n                function link(scope, element, attributes) {\n                    // Due to the way AngularJS prevents animation during the bootstrap\n                    // of the application, we can't animate the top-level container; but,\n                    // since we added \"ngAnimateChildren\", we can animated the inner\n                    // container during this phase.\n                    // --\n                    // NOTE: Am using .eq(1) so that we don't animate the Style block.\n                    $animate.leave(element.children().eq(1)).then(\n                        function cleanupAfterAnimation() {\n                            // Remove the root directive element.\n                            element.remove();\n                            // Clear the closed-over variable references.\n                            scope = element = attributes = null;\n                        }\n                    );\n                }\n            }]\n        );\n}());\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .controller('CreateController', ['$scope', '$http', '$location', '$routeParams', 'models', '$controller', function ($scope, $http, $location, $routeParams, models, $controller) {\r\n            var modelName = $routeParams.schema;\r\n            $scope.action = \"create\";\r\n            models.getModel(modelName, function (m) {\r\n                if (!m.config.post) {\r\n                    $location.path('/model/' + modelName);\r\n                } else {\r\n                    $scope.model = {};\r\n                    var m_copy = angular.copy(m);\r\n                    $scope.m = m;\r\n                    $scope.m_copy = m_copy;\r\n                    $scope.action = \"create\";\r\n                    $controller('FormController', {$scope: $scope}); //This works\r\n                }\r\n            });\r\n        }]);\r\n}());\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .controller('GraphsController', ['$scope', '$routeParams', '$sce', '$compile', 'models', function ($scope, $routeParams, $sce, $compile, models) {\r\n        $scope.schema = $routeParams.schema;\r\n\r\n        models.getModelConfig($scope.schema, function (config) {\r\n            $scope.config = config;\r\n            $scope.graphs = config.graphs;\r\n        });\r\n\r\n        $scope.getTag = function (graph) {\r\n            var tag = graph.type;\r\n            return '<injector-'+ tag +' graph=\"' + graph.title + '\"></injector-'+ tag +'>';\r\n        };\r\n    }]);\r\n}());\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .controller('UpdateController', ['$scope', '$http', '$routeParams', '$location', 'models', '$controller', function ($scope, $http, $routeParams, $location, models, $controller) {\r\n            var modelName = $routeParams.schema;\r\n            var id = $routeParams.id;\r\n            var shard = $routeParams.shard;\r\n\r\n            models.getModel(modelName, function (m) {\r\n                models.getDocument(modelName, id, shard, function (document) {\r\n                    $scope.prune(document);\r\n                    $scope.action = \"update\";\r\n                    $scope.model = document || {};\r\n                    var m_copy = angular.copy(m);\r\n                    $scope.m = m;\r\n                    $scope.m_copy = m_copy;\r\n                    $controller('FormController', {$scope: $scope}); //This works\r\n                });\r\n            });\r\n\r\n            //We made this in client because is an specific management of angular-schema-form\r\n            $scope.prune = function (document) {\r\n                for (var key in document) {\r\n                    var elem = document[key];\r\n                    if (elem && (typeof elem === 'object' || elem instanceof Array)) {\r\n                        $scope.prune(elem);\r\n                    }\r\n                    if (elem == null) {//Angular schema form does not allow null elements. Undefined is better\r\n                        document[key] = undefined;\r\n                    }\r\n                }\r\n            };\r\n        }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .controller('FormController', ['$rootScope', '$scope', '$http', '$location', '$routeParams', '$anchorScroll', '$timeout', '$modal', 'models', 'configs', 'dependsOn', 'common', '$window', 'flash', '$translate', function ($rootScope, $scope, $http, $location, $routeParams, $anchorScroll, $timeout, $modal, models, configs, dependsOn, common, $window, flash, $translate) {\r\n            var modelName = $routeParams.schema;\r\n            var id = $routeParams.id;\r\n            var modified = false;\r\n\r\n            $scope.buttonsPosition = configs.backoffice.buttonsPosition || 'bottom';\r\n\r\n            function walkThroughSchema(schema) {\r\n                var keys = Object.keys(schema);\r\n                for (var i in keys) {\r\n                    if(schema[keys[i]]) {\r\n                        if (schema[keys[i]].editOnCreate) {\r\n                            var action = $scope.action.toLowerCase();\r\n                            schema[keys[i]].readonly = !(action === \"create\");\r\n                        }\r\n\r\n                        if (schema[keys[i]].i18nTitle) {\r\n                            schema[keys[i]].title = $translate.instant(schema[keys[i]].i18nTitle);\r\n                        }\r\n\r\n                        var type = schema[keys[i]].type;\r\n                        if ((type === 'array' || type === 'object') && schema[keys[i]].properties) {\r\n                            walkThroughSchema(schema[keys[i]].properties);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            $scope.m = angular.copy($scope.m_copy);\r\n            walkThroughSchema($scope.m.schema);\r\n\r\n            $scope.schema = {\r\n                \"type\": \"object\",\r\n                \"title\": modelName,\r\n                \"action\": $scope.action,\r\n                \"properties\": $scope.m.schema\r\n            };\r\n\r\n            $scope.form = common.processForm($scope.m.config.form);\r\n\r\n            if ($scope.action.toLowerCase() == \"create\" && models.getShard(modelName) && models.getShard(modelName).value) {\r\n                $scope.model[models.getShard(modelName).key] = models.getShard(modelName).value;\r\n            }\r\n\r\n            $rootScope.$on('shardChangeEvent', function () {\r\n                if ($scope.action.toLowerCase() == \"create\" && models.getShard(modelName) && models.getShard(modelName).value) {\r\n                    $scope.model[models.getShard(modelName).key] = models.getShard(modelName).value;\r\n                }\r\n            });\r\n\r\n\r\n            dependsOn.apply($scope, modelName, $scope.model);\r\n\r\n            $timeout(function () {\r\n                $scope.$watch('model', function (newVal, oldVal) {\r\n                    if (!angular.equals(newVal, oldVal)) {\r\n                        modified = true;\r\n                    }\r\n                }, true);\r\n            }, 0);\r\n\r\n            $scope.schemaHREF = function () {\r\n                $location.path(\"/model/\" + modelName);\r\n                $location.hash('');\r\n            };\r\n\r\n            $scope.submitForm = function (form, model, isApply) {\r\n                $scope.$broadcast('schemaFormValidate');\r\n                if (form.$valid) {\r\n                    if ($scope.action.toLowerCase() == 'update' && $scope.m.config.put) {\r\n                        models.putDocument(modelName, id, model, function (response) {\r\n                            if (response.status == '200') {\r\n                                modified = false;\r\n                                flash.success(\"Done\", \"Document saved successfully\");\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $scope.$broadcast('puttedDocument', response.data);\r\n                                if (!isApply) {\r\n                                    $location.path('/model/' + modelName);\r\n                                    $location.hash('');\r\n                                }\r\n                            }\r\n                        });\r\n                    } else if ($scope.action.toLowerCase() == 'create' && $scope.m.config.post) {\r\n                        models.postDocument(modelName, model, function (response) {\r\n                            if (response.status == '201') {\r\n                                modified = false;\r\n                                flash.success(\"Done\", \"Document saved successfully\");\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                if (!isApply) {\r\n                                    $location.path('/model/' + modelName);\r\n                                    $location.hash('');\r\n                                } else {\r\n                                    $location.path('/model/' + modelName + '/update/' + response.data[Object.keys(response.data)[0]]);\r\n                                    $location.hash('');\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                } else {\r\n                    $scope.validation = !form.$valid;\r\n                    $scope.validationErrors = form.$error;\r\n                    $location.hash('error');\r\n                    $anchorScroll.yOffset = 100;\r\n                    $anchorScroll();\r\n\r\n                }\r\n            };\r\n\r\n            $scope.cancel = function () {\r\n                $window.history.back();\r\n            };\r\n\r\n            $scope.$on('$locationChangeStart', function (event, next, current) {\r\n                if ($scope.ngForm.$valid && modified) {\r\n                    event.preventDefault();\r\n\r\n                    var modalInstance = $modal.open({\r\n                        templateUrl: 'changedDocument.html',\r\n                        controller: 'ModalChangedCtrl',\r\n                        size: 'sm',\r\n                        resolve: {\r\n                            items: function () {\r\n                                return $scope.items;\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    modalInstance.result.then(function () { //CLOSE CALLBACK\r\n                        $scope.submitForm($scope.ngForm, $scope.model);\r\n                    }, function () { //DISMISS CALLBACK\r\n                        modified = false;\r\n                        var basePathLength = $location.absUrl().length - $location.url().length;\r\n                        $location.path(next.substring(basePathLength));\r\n                    });\r\n\r\n                }\r\n            });\r\n\r\n\r\n            $scope.$on('bkButton', function (event, form) {\r\n                if (form.action == 'api') {\r\n                    var http;\r\n                    var url = form.url;\r\n\r\n                    var getUrl = function (path) {\r\n                        return path.replace(/[^/]*:([^/]*)+/g, function (s, m) {\r\n                            return safeAccess($scope.model, m);\r\n                        });\r\n                    };\r\n\r\n                    url = getUrl(url);\r\n\r\n                    switch (form.method.toUpperCase()) {\r\n                        case 'GET':\r\n                            http = $http.get(url);\r\n                            break;\r\n                        case 'PUT':\r\n                            http = $http.put(url, $scope.model);\r\n                            break;\r\n                        case 'POST':\r\n                            var body = {};\r\n                            if (form.body) {\r\n                                angular.extend(body, form.body);\r\n                            } else {\r\n                                body = $scope.model;\r\n                            }\r\n                            http = $http.post(url, body);\r\n                            break;\r\n                        case 'DELETE':\r\n                            http = $http.delete(url);\r\n                            break;\r\n                        default :\r\n                            throw new Error('Method not configured properly');\r\n                    }\r\n                    if (http) {\r\n                        http.success(function (res) {\r\n                            angular.forEach(Object.keys(res), function (key) {\r\n                                $scope.model[key] = res[key];\r\n                            });\r\n                        }).error(function (err) {\r\n                            console.error(err);\r\n                        });\r\n                    }\r\n                } else if (form.action == 'function') {\r\n                    window[form.func]($scope.model, $scope.m.schema);\r\n                }\r\n            });\r\n\r\n            $rootScope.$on('$translateChangeSuccess', function () {\r\n                walkThroughSchema($scope.schema.properties);\r\n                $scope.$broadcast('schemaFormRedraw');\r\n            });\r\n        }])\r\n        // It is not the same as the $modal service used above.\r\n        .controller('ModalChangedCtrl', ['$scope', '$modalInstance', 'items', function ($scope, $modalInstance, items) {\r\n\r\n            $scope.ok = function () {\r\n                $modalInstance.close('ok');\r\n            };\r\n\r\n            $scope.cancel = function () {\r\n                $modalInstance.dismiss('cancel');\r\n            };\r\n        }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n        .controller('LoginController', ['$http', '$scope', '$document', '$location', 'loginProvider', function ($http, $scope, $document, $location, loginProvider) {\r\n        $scope.update = function (user) {\r\n            loginProvider.login(user, function (res) {\r\n                if (!res) {\r\n                    $scope.loginError = 'incorrect login';\r\n                } else{\r\n                    $location.path('/');\r\n                }\r\n            });\r\n        };\r\n    }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n\r\n        .filter('encodeURIComponent', function() {\r\n            return window.encodeURIComponent;\r\n        })\r\n\r\n        .controller('MainController', ['$rootScope', '$scope', '$q', 'loginProvider', 'models', 'common', function ($rootScope, $scope, $q, loginProvider, models, common) {\r\n            $scope.postLoginFuncs = [];\r\n            $scope.postLoginFuncs.push(function(){\r\n                models.getModels(function (m) {\r\n                    $scope.schemas = {};\r\n                    angular.forEach(m, function (schema) {\r\n                        models.getModelConfig(schema, function (config) {\r\n                            $scope.schemas[schema] = config;\r\n\r\n                            loginProvider.getUser(function(){}); //Force first login\r\n                            if (config.isSingle) {\r\n                                models.getSingleModel(schema, function (doc) {\r\n                                    if (!doc) {\r\n                                        $scope.schemas[schema].redirectTo = \"#/model/\" + schema + \"/new\";\r\n                                    } else {\r\n                                        $scope.schemas[schema].redirectTo = \"#/model/\" + schema + \"/update/\" + doc[config.id];\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n\r\n\r\n            $scope.pretty = function pretty(str) {\r\n                return common.prettifyTitle(str);\r\n            };\r\n\r\n            $scope.schemaHREF = function (name, conf) {\r\n                return conf.redirectTo || \"#/model/\" + name;\r\n            };\r\n\r\n            angular.element('body').ready(function () {\r\n                $rootScope.$broadcast('bodyReady', 'MainController');\r\n            });\r\n\r\n            $rootScope.$on('login', function (event, args) {\r\n                angular.forEach($scope.postLoginFuncs, function(v){\r\n                    v();\r\n                });\r\n                $scope.postLoginFuncs = [];\r\n            });\r\n\r\n            $rootScope.$on('logout', function (event, args) {\r\n            });\r\n    }]);\r\n}());\r\n\r\n\r\n\n(function () {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n\r\n        .controller('ModelController', ['$scope', '$http', '$route', '$routeParams', '$modal', '$location', 'common', 'models', 'flash', 'configs', 'search', function ($scope, $http, $route, $routeParams, $modal, $location, common, models, flash, configs, search) {\r\n            var defaultItemsPerPage = 20;\r\n            $scope.flash = flash;\r\n            $scope.common = common;\r\n            $scope.removeDisabled = 'disabled';\r\n\r\n            $scope.maxSize = 10;\r\n            $scope.schema = $routeParams.schema;\r\n            $scope.create = false;\r\n            $scope.checkedGroupIds = {};\r\n            search.clearQuery();\r\n\r\n            $scope.$watch(\"removeAll\", function (value) {\r\n                if (value !== undefined) {\r\n                    for (var i in $scope.elements) {\r\n                        $scope.elements[i].checked = value;\r\n                    }\r\n                }\r\n            });\r\n\r\n            models.getModel($scope.schema, function (model) {\r\n                $scope.config = model.config;\r\n                $scope.schemaForm = model.schema;\r\n\r\n                if (model.config.isSingle) { //In single documents, this page / controller should not appear anymore !\r\n                    $location.path('/');   //Redirect to home\r\n                    return;\r\n                }\r\n\r\n                //Build the array with all the displayable elements\r\n                $scope.config.allDisplayFields = [];\r\n                $scope.config.allDisplayFields.push($scope.config.displayField);\r\n                if ($scope.config.extraDisplayFields) {\r\n                    $scope.config.allDisplayFields = $scope.config.allDisplayFields.concat($scope.config.extraDisplayFields);\r\n                }\r\n\r\n                $scope.search = function (skip) {\r\n                    if (skip !== undefined) {\r\n                        search.setSkip(skip);\r\n                    }\r\n\r\n                    search.search($scope.schema, function (elements, count, err) {\r\n                        if (elements) {\r\n                            $scope.elements = elements;\r\n                        }\r\n                        $scope.totalElements = count;\r\n                    });\r\n                };\r\n\r\n                $scope.itemsPerPage = $scope.userItemsPerPage = configs.backoffice.itemsPerPage || defaultItemsPerPage;\r\n                search.setLimit($scope.itemsPerPage);\r\n                search.setSkip(0);\r\n\r\n                if(model.config.defaultSearch) {\r\n                    search.setSortBy(model.config.defaultSearch);\r\n                }\r\n\r\n                //Init elements\r\n                $scope.search();\r\n\r\n                // Init function of pageChanged\r\n                $scope.pageChanged = function () {\r\n                    $scope.itemsPerPage = $scope.userItemsPerPage;\r\n                    if ($scope.currentPage > 0 && $scope.itemsPerPage > 0) {\r\n                        var skip = (($scope.currentPage - 1) * $scope.itemsPerPage);\r\n                        search.setSkip(skip);\r\n                    } else {\r\n                        search.setSkip(0);\r\n                    }\r\n                    search.setLimit($scope.itemsPerPage);\r\n                    $scope.search();\r\n                };\r\n\r\n                $scope.id = function (element) {\r\n                    return element[$scope.config.id];\r\n                };\r\n\r\n                $scope.shard = function (element) {\r\n                    return element[$scope.config.shard.shardKey];\r\n                };\r\n\r\n                $scope.hasShard = function (element) {\r\n                    var hasShard = $scope.config.shard && $scope.config.shard.shardKey;\r\n                    return hasShard && element[$scope.config.shard.shardKey];\r\n                };\r\n\r\n                $scope.getUrl = function (element, schema) {\r\n                    var model;\r\n                    if(element.__t) {\r\n                        model = element.__t;\r\n                    } else {\r\n                        model = schema;\r\n                    }\r\n                    var url = \"#/model/\" + model + \"/update/\" + encodeURIComponent($scope.id(element));\r\n                    if ($scope.hasShard(element)) {\r\n                        url += \"/\" + encodeURIComponent($scope.shard(element));\r\n                    }\r\n                    return url;\r\n                };\r\n\r\n                $scope.isDisabled = function (element) {\r\n                    return !(element[$scope.config.id] && element[$scope.config.id] !== \"\");\r\n                };\r\n\r\n                $scope.displayCustomField = function (field, element, schema) {\r\n                    var s = common.getField(field, element);\r\n                    var sch = models.getFieldFromSchema(field, schema);\r\n                    if(sch && sch.format === 'date') {\r\n                        if(s && s !=='') {\r\n                            s = new Date(Date.parse(s)).toLocaleString();\r\n                        }\r\n                    }\r\n                    return (s === undefined || s === \"\") ? \"<empty>\" : s;\r\n                };\r\n\r\n                $scope.sortBy = function (property, asc) {\r\n                    search.addSortBy(property, asc);\r\n                    $scope.search(0);\r\n                };\r\n\r\n                $scope.getSort = function (property) {\r\n                    return search.getSort(property);\r\n                };\r\n\r\n                $scope.$on('shardChangeEvent', function (event, data) {\r\n                    $scope.search(0);\r\n                });\r\n            });\r\n\r\n            $scope.promptAlert = function (cb) {\r\n                var del;\r\n                if (del) {\r\n                    cb(del);\r\n                }\r\n                var modalInstance = $modal.open({\r\n                    templateUrl: 'myModalContent.html',\r\n                    controller: 'ModalInstanceCtrl',\r\n                    size: 'sm',\r\n                    resolve: {\r\n                        items: function () {\r\n                            return $scope.items;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                modalInstance.result.then(function () {\r\n                    del = true;\r\n                    cb(true);\r\n                });\r\n            };\r\n        }])\r\n\r\n        .filter('to_trusted', ['$sce', function ($sce) {\r\n            return function (text) {\r\n                if (text) {\r\n                    return $sce.trustAsHtml(text.toString());\r\n                } else {\r\n                    return text;\r\n                }\r\n            };\r\n        }])\r\n\r\n        // Please note that $modalInstance represents a modal window (instance) dependency.\r\n        // It is not the same as the $modal service used above.\r\n        .controller('ModalInstanceCtrl', ['$scope', '$modalInstance', 'items', function ($scope, $modalInstance, items) {\r\n\r\n            $scope.ok = function () {\r\n                $modalInstance.close('ok');\r\n            };\r\n\r\n            $scope.cancel = function () {\r\n                $modalInstance.dismiss('cancel');\r\n            };\r\n        }])\r\n\r\n        .controller('ImportModalInstanceCtrl', ['$scope', '$modalInstance', 'items', function ($scope, $modalInstance, items) {\r\n        }]);\r\n}());\r\n\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('injectorApp')\r\n        .controller('NavbarController', ['$scope', '$location', 'loginProvider', function ($scope, $location, loginProvider) {\r\n            var navbar = function () {\r\n                loginProvider.getUser(function (user) {\r\n                    $scope.user = user;\r\n                });\r\n            };\r\n            navbar();\r\n            $scope.$on('login', function (event, data) {\r\n                navbar();\r\n            });\r\n\r\n            $scope.logout = function () {\r\n                loginProvider.logout();\r\n                $location.path('/logout');\r\n            };\r\n        }]);\r\n}());\n(function() {\r\n    'use strict';\r\n    angular.module('injectorApp')\r\n\r\n        .controller('ShardingController', ['$scope', '$routeParams', '$rootScope', 'models', 'configs', function($scope, $routeParams, $rootScope, models, configs) {\r\n            var modelName;\r\n            $scope.$on('$routeChangeSuccess', function(event, current) {\r\n                modelName = current.params.schema;\r\n\r\n                // Gets configuration from custom page \"modelName\" parameter\r\n                if(modelName == undefined) {\r\n                    modelName = current.$$route.modelName;\r\n                }\r\n\r\n                if(modelName) {\r\n                    models.getModel(modelName, function(m) {\r\n                        if(m.config.shard) {\r\n                            $scope.shardKey = m.config.shard.shardKey;\r\n                            $scope.shardKeyText = 'Select ' + $scope.shardKey + ' shard';\r\n                            $scope.shardValues = m.config.shard.shardValues;\r\n\r\n                            if(models.getShard(modelName)) {\r\n                                $scope.shardKeyText = 'Using ' + models.getShard(modelName).key + ' ' + models.getShard(\r\n                                        modelName).value;\r\n                            } else {\r\n                                if(m.config.shard.filtered) {\r\n                                    $scope.locked = true;\r\n                                    $scope.setShard($scope.shardValues[0]);\r\n                                } else {\r\n                                    $scope.locked = false;\r\n                                }\r\n                            }\r\n\r\n                        } else {\r\n                            $scope.shardKey = undefined;\r\n                            $scope.shardKeyText = undefined;\r\n                            $scope.shardValues = undefined;\r\n                        }\r\n                    });\r\n                } else {\r\n                    $scope.shardKey = undefined;\r\n                    $scope.shardKeyText = undefined;\r\n                    $scope.shardValues = undefined;\r\n                }\r\n            });\r\n\r\n            $scope.setShard = function(value) {\r\n                $scope.shardKeyText = 'Using ' + $scope.shardKey + ' ' + value;\r\n                models.setShard($scope.shardKey, value, modelName);\r\n\r\n                $rootScope.$broadcast('shardChangeEvent');\r\n            };\r\n\r\n            $scope.removeShard = function() {\r\n                $scope.shardKeyText = 'Select ' + $scope.shardKey + ' shard';\r\n                //models.setShard($scope.shardKey, '', modelName);\r\n                models.removeShard(modelName);\r\n                $rootScope.$broadcast('shardChangeEvent');\r\n            };\r\n            $scope.shardKey = undefined;\r\n        }]);\r\n}());\r\n\n(function () {\n    'use strict';\n\n    angular.module('injectorApp')\n        .controller('TranslateController', ['$scope', '$translate', 'configs', function ($scope, $translate, configs) {\n            //$scope.languages = $translate.getAvailableLanguageKeys();\n            $scope.languages = ['en', 'es'];\n            if (configs.backoffice.uniqueLanguage) {\n                $scope.showLanguages = false;\n                $translate.use(configs.backoffice.uniqueLanguage);\n            } else {\n                $scope.showLanguages = true;\n                $scope.use = function (lang) {\n                    $translate.use(lang);\n                };\n            }\n        }]);\n}());"]}