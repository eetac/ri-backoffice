{"version":3,"sources":["ri-backoffice-angular-libs.js"],"names":["root","factory","define","amd","module","exports","safeAccess","this","helper","obj","tokens","ctx","fnArgs","length","currentToken","isUndefined","isNull","isTokenFunctionCall","isFunction","isArray","slice","isTokenArrayAccess","parseInt","substr","a","Array","token","test","tokenize","str","split","filter","t","access","accessStr","bind","funcArgs","prototype","call","arguments","mod","CodeMirror","place","options","copyObj","defaults","setGuttersForLineNumbers","doc","value","Doc","mode","display","Display","wrapper","updateGutters","themeChanged","lineWrapping","className","autofocus","mobile","focusInput","state","keyMaps","overlays","modeGen","overwrite","focused","suppressEdits","pasteIncoming","cutIncoming","draggingText","highlight","Delayed","keySeq","ie","ie_version","setTimeout","resetInput","registerEventHandlers","ensureGlobalHandlers","startOperation","curOp","forceUpdate","attachDoc","activeElt","input","onFocus","onBlur","opt","optionHandlers","hasOwnProperty","Init","maybeUpdateLineNumberWidth","i","initHooks","endOperation","d","elt","webkit","style","width","setAttribute","ios","border","inputDiv","scrollbarH","scrollbarV","scrollbarFiller","gutterFiller","lineDiv","selectionDiv","cursorDiv","measure","lineMeasure","lineSpace","mover","sizer","heightForcer","scrollerCutOff","gutters","lineGutter","scroller","zIndex","paddingRight","draggable","khtml","height","position","minHeight","minWidth","appendChild","viewFrom","viewTo","first","view","externalMeasured","viewOffset","lastWrapHeight","lastWrapWidth","updateLineNumbers","lineNumWidth","lineNumInnerWidth","lineNumChars","prevInput","alignWidgets","pollingFast","poll","cachedCharWidth","cachedTextHeight","cachedPaddingH","inaccurateSelection","maxLine","maxLineLength","maxLineChanged","wheelDX","wheelDY","wheelStartX","wheelStartY","shift","selForContextMenu","loadMode","cm","getMode","modeOption","resetModeState","iter","line","stateAfter","styles","frontier","startWorker","regChange","wrappingChanged","addClass","rmClass","findMaxLine","estimateLineHeights","clearCaches","updateScrollbars","estimateHeight","th","textHeight","wrapping","perLine","Math","max","clientWidth","charWidth","lineIsHidden","widgetsHeight","widgets","ceil","text","est","estHeight","updateLineHeight","replace","theme","guttersChanged","alignHorizontally","specs","removeChildren","gutterClass","gElt","updateGutterSpace","offsetWidth","marginLeft","left","fixedGutter","lineLength","merged","len","cur","collapsedSpanAtStart","found","find","from","ch","to","collapsedSpanAtEnd","getLine","indexOf","lineNumbers","concat","splice","hScrollbarTakesSpace","clientHeight","measureForScrollbars","scroll","barHeight","scrollWidth","barWidth","docHeight","round","paddingVert","sWidth","scrollbarWidth","scrollHeight","needsH","needsV","bottom","firstChild","right","coverGutterNextToScrollbar","checkedOverlayScrollbar","w","mac","mac_geMountainLion","barMouseDown","e","e_target","operation","onMouseDown","on","visibleLines","viewport","top","scrollTop","floor","paddingTop","lineAtHeight","ensure","ensureFrom","ensureTo","heightAtLine","min","lastLine","comp","compensateForHScroll","scrollLeft","gutterW","hidden","gutter","align","alignable","j","last","lineNumberFor","size","innerW","padding","String","lineNumberFormatter","firstLineNumber","getBoundingClientRect","DisplayUpdate","force","visible","editorIsHidden","wrapperHeight","wrapperWidth","oldViewFrom","oldViewTo","oldScrollerWidth","dims","getDimensions","updateDisplayIfNeeded","update","resetView","countDirtyView","end","viewportMargin","sawCollapsedSpans","visualLineNo","visualLineEndNo","different","adjustView","toUpdate","patchDisplay","offsetHeight","focus","postUpdateDisplay","updateHeightsInViewport","barMeasure","updateSelection","setDocumentHeight","signalLater","updateDisplaySimple","checkForWebkitWidthBug","prevBottom","offsetTop","bot","node","box","diff","updateWidgetHeight","rest","gutterLeft","clientLeft","n","nextSibling","offsetLeft","fixedPos","gutterTotalWidth","gutterWidth","updateNumbersFrom","rm","next","currentWheelTarget","parentNode","removeChild","container","lineN","lineView","updateNumber","lineNumber","changes","updateLineForChanges","document","createTextNode","buildLineElement","insertBefore","type","updateLineText","updateLineGutter","updateLineClasses","updateLineWidgets","ensureLineWrapped","replaceChild","updateLineBackground","cls","bgClass","background","wrap","getLineContent","ext","built","buildLineContent","pre","textClass","wrapClass","markers","gutterMarkers","gutterWrap","k","id","insertLineWidgets","insertLineWidgetsFor","allowAbove","ws","widget","handleMouseEvents","ignoreEvents","positionLineWidget","above","noHScroll","push","coverGutter","paddingLeft","copyPos","x","Pos","maxPos","b","cmp","minPos","Selection","ranges","primIndex","Range","anchor","head","normalizeSelection","prim","sort","prev","inv","empty","simpleSelection","clipLine","clipPos","pos","clipToLen","linelen","isLine","l","clipPosArray","array","out","extendRange","range","other","extend","posBefore","extendSelection","setSelection","sel","primary","extendSelections","heads","replaceOneSelection","setSimpleSelection","filterSelectionChange","signal","setSelectionReplaceHistory","done","history","lst","setSelectionNoUndo","addSelectionToHistory","NaN","hasHandler","setSelectionInner","skipAtomicInSelection","bias","ensureCursorVisible","equals","updateInput","selectionChanged","signalCursorActivity","reCheckSelection","sel_dontScroll","mayClear","newAnchor","skipAtomic","newHead","flipped","curPos","dir","cantEdit","search","markedSpans","sp","m","marker","inclusiveLeft","inclusiveRight","explicitlyCleared","atomic","newPos","drawSelection","result","curFragment","cursors","createDocumentFragment","selFragment","selection","collapsed","showCursorWhenSelecting","drawSelectionCursor","drawSelectionRange","moveInputWithCursor","headPos","cursorCoords","wrapOff","lineOff","teTop","teLeft","showSelection","drawn","removeChildrenAndAdd","output","singleCursorHeightPerLine","cursor","cursorHeight","otherCursor","add","fragment","rightSide","drawForLine","fromArg","toArg","coords","charCoords","lineObj","start","lineLen","iterateBidiSections","getOrder","rightPos","leftPos","tmp","leftSide","paddingH","sFrom","sTo","fromLine","toLine","singleVLine","visualLine","leftEnd","rightStart","restartBlink","clearInterval","blinker","visibility","cursorBlinkRate","setInterval","time","startState","set","highlightWorker","Date","workTime","copyState","getStateBefore","changedLines","oldStyles","highlighted","highlightLine","oldCls","styleClasses","newCls","classes","ischange","processLine","workDelay","runInOp","regLineChange","findStartLine","precise","minindent","minline","lim","innerMode","indented","countColumn","tabSize","save","window","getComputedStyle","currentStyle","data","isNaN","ensureLineHeights","rect","curWidth","heights","rects","getClientRects","abs","mapFromLineView","map","cache","maps","caches","lineNo","before","updateExternalMeasurement","LineView","measureChar","measureCharPrepared","prepareMeasureForLine","findViewForLine","findViewIndex","info","hasHeights","prepared","varHeight","key","measureCharInner","bogus","rtop","rbottom","collapse","mStart","mEnd","insertLeft","nodeType","isExtendingChar","charAt","nullRect","maybeUpdateRectForZooming","rSpan","rbot","mid","screen","logicalXDPI","deviceXDPI","hasBadZoomedRects","scaleX","scaleY","logicalYDPI","deviceYDPI","clearLineMeasurementCacheFor","clearLineMeasurementCache","externalMeasure","pageScrollX","pageXOffset","documentElement","body","pageScrollY","pageYOffset","intoCoordSystem","context","widgetHeight","yOff","lOff","xOff","fromCoordSystem","localBox","lineSpaceBox","preparedMeasure","get","getBidi","partPos","part","order","level","bidiLeft","bidiRight","getBidiPartAt","val","bidiOther","estimateCoords","PosWithInfo","outside","xRel","coordsChar","y","coordsCharInner","mergedPos","getX","wrongLine","innerOff","adjust","bidi","dist","lineLeft","lineRight","fromX","fromOutside","toX","toOutside","moveVisually","xDiff","step","middle","middleX","measureText","viewChanged","startHeight","typing","changeObjs","cursorActivityHandlers","cursorActivityCalled","updateMaxLine","scrollToPos","nextOpId","operationGroup","ops","ownsGroup","delayedCallbacks","fireCallbacksForOps","group","callbacks","op","endOperations","endOperation_R1","endOperation_W1","endOperation_R2","endOperation_W2","endOperation_finish","mustUpdate","updatedDisplay","adjustWidthTo","maxScrollLeft","newSelectionNodes","setScrollLeft","forceScroll","scrollPosIntoView","margin","isCursor","maybeScrollWindow","maybeHiddenMarkers","unhidden","maybeUnhiddenMarkers","lines","f","apply","methodOp","docMethodOp","visualLineContinued","buildViewArray","nextPos","lendiff","cut","viewCuttingPoint","index","cutTop","cutBot","arr","oldN","newN","dirty","slowPoll","pollInterval","readInput","fastPoll","p","missed","hasSelection","isReadOnly","disableInput","fakedLastChar","substring","somethingSelected","inputHasSelection","withOp","charCodeAt","same","inserted","textLines","splitLines","multiPaste","lastCopied","join","changeEvent","origin","makeChange","electricChars","smartIndent","getModeAt","changeEnd","indentLine","electricInput","minimal","selected","hasCopyEvent","getSelection","content","selectInput","readOnly","ensureFocus","reFocus","drag_","signalDOMEvent","e_stop","prepareCopyCut","getSelections","lineRange","getRange","setSelections","posFromMouse","clickInGutter","eventInWidget","e_preventDefault","word","findWordAt","captureRightClick","onContextMenu","setScrollTop","onScrollWheel","onKeyUp","onKeyDown","onKeyPress","dragDrop","onDragStart","onDrop","lastMiddleDown","selectionStart","selectionEnd","blur","onResize","setSize","liberal","forRect","target","space","clientX","clientY","colDiff","shiftKey","e_button","leftButtonDown","now","lastDoubleClick","lastClick","modifier","metaKey","ctrlKey","dragAndDrop","contains","leftButtonStartDrag","leftButtonSelect","dragEnd","e2","off","addNew","extendTo","lastPos","startCol","posCol","findColumn","startSel","ourIndex","scrollIntoView","oldRange","ourRange","sel_mouse","curCount","counter","editorSize","Infinity","move","up","lastSelOrigin","altKey","gutterEvent","prevent","signalfn","mX","mY","lineBox","e_defaultPrevented","g","childNodes","lastDrop","files","dataTransfer","FileReader","File","read","loadFile","file","reader","onload","change","readAsText","getData","listSelections","replaceRange","replaceSelection","setData","setDragImage","safari","img","src","presto","_top","gecko","isScroller","dx","wheelDeltaX","dy","wheelDeltaY","detail","axis","HORIZONTAL_AXIS","VERTICAL_AXIS","wheelDelta","outer","wheelPixelsPerUnit","pixels","wheelSamples","movedX","movedY","sample","doHandleBinding","bound","dropShift","commands","prevShift","Pass","lookupKeyForEditor","name","handle","lookupKey","extraKeys","keyMap","dispatchKey","seq","isModifierKey","stopSeq","handleKeyBinding","keyName","motion","handleCharBinding","keyCode","returnValue","code","handled","lastStoppedKey","showCrossHair","charCode","which","fromCharCode","prepareSelectAllHack","extval","rehide","cssText","oldCSS","scrollPos","selectAll","detectingSelectAll","contextMenuInGutter","resetSelectionOnContextMenu","oldScrollY","scrollY","scrollTo","clearTimeout","mouseup","adjustForChange","computeSelAfterChange","offsetPos","old","nw","computeReplacedSel","hint","oldPrev","newPrev","filterChange","canceled","cancel","undefined","ignoreReadOnly","sawReadOnlySpans","removeReadOnlyRanges","makeChangeInner","selAfter","addChangeToHistory","makeChangeSingleDoc","stretchSpansOverChange","rebased","linkedDocs","sharedHist","rebaseHist","makeChangeFromHistory","allowSelectionOnly","event","hist","source","undone","dest","lastOrigin","pop","pushSelectionToHistory","clearRedo","antiChanges","generation","maxGeneration","historyChangeFromChange","mergeOldSpans","shiftDoc","distance","spans","removed","getBetween","makeChangeSingleDocInEditor","updateDoc","recomputeMaxLength","checkWidthStart","isWholeLineUpdate","changesHandler","changeHandler","doScroll","innerHeight","phantom","scrollNode","limit","changed","endCoords","calculateScrollPos","startTop","startLeft","x1","y1","x2","y2","snapMargin","screentop","docBottom","atTop","atBottom","newTop","screenleft","screenw","tooWide","addToScrollPos","resolveScrollToPos","getCursor","cursorScrollMargin","sPos","how","aggressive","indent","curSpace","indentation","curSpaceString","match","indentUnit","indentString","indentWithTabs","spaceStr","changeLine","changeType","no","deleteNearSelection","compute","kill","toKill","replaced","findPosH","unit","visually","findNextLine","possible","moveOnce","boundToLine","moveLogically","origDir","sawType","getHelper","isWordChar","hitSide","findPosV","pageSize","option","deflt","notOnInit","normalizeKeyName","alt","ctrl","cmd","parts","Error","getKeyMap","markText","shared","markTextShared","TextMarker","clearWhenEmpty","replacedWith","widgetNode","conflictingCollapsedRange","addToHistory","curLine","addMarkedSpan","MarkedSpan","clearOnEnter","clear","clearHistory","nextMarkerId","title","startStyle","endStyle","cloneNode","linked","isParent","SharedTextMarker","findSharedMarkers","findMarks","parent","copySharedMarkers","mFrom","mTo","subMark","detachSharedMarkers","subMarker","getMarkedSpanFor","span","removeMarkedSpan","r","attachLine","markedSpansBefore","startCh","isInsert","startsBefore","endsAfter","markedSpansAfter","endCh","oldFirst","oldLast","sameLine","offset","clearEmptySpans","newMarkers","gapMarkers","gap","getOldSpans","stretched","oldCur","stretchCur","mark","mk","newParts","dfrom","dto","detachMarkedSpans","detachLine","attachMarkedSpans","extraLeft","extraRight","compareCollapsedMarkers","lenDiff","aPos","bPos","fromCmp","toCmp","collapsedSpanAtSide","sps","vis","lineIsHiddenInner","adjustScrollWhenAboveVisible","parentStyle","getGutterElement","addLineWidget","LineWidget","insertAt","aboveVisible","updateLine","cleanUpLine","extractLineClasses","lineClass","prop","RegExp","callBlankLine","blankLine","inner","readToken","stream","takeToken","asArray","getObj","copy","string","current","StringStream","eol","runMode","lineClasses","forceToEnd","flattenSpans","curStart","curStyle","addModeClass","maxHighlightLength","mName","st","o","overlay","at","i_end","opaque","getLineStyles","updateFrontier","startAt","interpretTokenStyle","styleToClassCacheWithMode","styleToClassCache","builder","col","addToken","buildToken","getOption","buildTokenSplitSpaces","hasBadBidiRects","buildTokenBadBidi","insertLineContent","joinClasses","zeroWidthElement","lastChild","defaultSpecialCharPlaceholder","toString","special","specialChars","mustWrap","lastIndex","exec","skipped","txt","tabWidth","specialCharPlaceholder","fullStyle","buildCollapsedSpan","ignoreWidget","allText","spanStyle","spanEndStyle","spanStartStyle","nextChange","foundBookmarks","upto","tokenText","wholeLineUpdateBefore","spansFor","firstLine","lastText","lastSpans","nlines","added","Line","remove","insert","LeafChunk","BranchChunk","children","chunkSize","sharedHistOnly","propagate","skip","rel","chunk","child","sz","getLines","h","lh","bidiOrdering","History","startGen","undoDepth","lastModTime","lastSelTime","lastOp","lastSelOp","histChange","attachLocalSpans","clearSelectionEvents","lastChangeEvent","opId","historyEventDelay","selectionEventCanBeMerged","existing","removeClearedSpans","copyHistoryArray","events","newGroup","instantiateSel","deepCopy","newChanges","Number","rebaseHistSelSingle","rebaseHistArray","sub","ok","copied","defaultPrevented","srcElement","button","emitter","bnd","args","_handlers","list","orphanDelayedCallbacks","fireOrphanDelayed","delayed","override","preventDefault","codemirrorIgnore","cursorActivity","eventMixin","ctor","goal","nextTab","spaceStrs","createObj","base","props","inst","Object","create","isWordCharBasic","isEmpty","extendingChars","tag","createElement","count","activeElement","classTest","as","forEachCodeMirror","getElementsByClassName","byClass","globalsRegistered","registerGlobalHandlers","resizeTimer","knownScrollbarWidth","zwspSupported","badBidiRects","r0","badZoomedRects","normal","fromRange","lineStart","visual","lineEnd","lineStartSmart","firstNonWS","inWS","compareBidiLevel","linedir","moveInLine","byUnit","navigator","userAgent","ie_upto10","ie_11up","documentMode","qtwebkit","chrome","vendor","platform","windows","presto_version","flipCtrlCmd","cmpPos","here","there","constructor","setOption","getDoc","addKeyMap","removeKeyMap","addOverlay","spec","modeSpec","removeOverlay","indentSelection","newRanges","getTokenAt","getLineTokens","getTokenTypeAt","after","getHelpers","helpers","help","helperType","_global","pred","getStateAfter","defaultTextHeight","defaultCharWidth","setGutterMarker","gutterID","clearGutter","removeLineWidget","lineInfo","getViewport","addWidget","vert","horiz","vspace","hspace","triggerOnKeyDown","triggerOnKeyPress","triggerOnKeyUp","execCommand","amount","moveH","extendSelectionsBy","rtlMoveVisually","sel_move","deleteH","goalColumn","moveV","goals","startChar","check","toggleOverwrite","hasFocus","getScrollInfo","co","interpret","refresh","oldHeight","swapDoc","getInputField","getWrapperElement","getScrollerElement","setValue","detach","attach","integer","disabled","tabIndex","modes","mimeModes","defineMode","dependencies","defineMIME","mime","resolveMode","mfactory","modeObj","modeExtensions","exts","modeProps","skipToEnd","extendMode","properties","defineExtension","func","defineDocExtension","defineOption","defineInitHook","registerHelper","registerGlobalHelper","predicate","nstate","a1","a2","singleSelection","killLine","deleteLine","delLineLeft","delWrappedLineLeft","delWrappedLineRight","undo","redo","undoSelection","redoSelection","goDocStart","goDocEnd","goLineStart","goLineStartSmart","goLineEnd","goLineRight","goLineLeft","goLineLeftSmart","goLineUp","goLineDown","goPageUp","goPageDown","goCharLeft","goCharRight","goColumnLeft","goColumnRight","goWordLeft","goGroupRight","goGroupLeft","goWordRight","delCharBefore","delCharAfter","delWordBefore","delWordAfter","delGroupBefore","delGroupAfter","indentAuto","indentMore","indentLess","insertTab","insertSoftTab","spaces","replaceSelections","defaultTab","transposeChars","newSel","newlineAndIndent","basic","Left","Right","Up","Down","End","Home","PageUp","PageDown","Delete","Backspace","Shift-Backspace","Tab","Shift-Tab","Enter","Insert","Esc","pcDefault","Ctrl-A","Ctrl-D","Ctrl-Z","Shift-Ctrl-Z","Ctrl-Y","Ctrl-Home","Ctrl-End","Ctrl-Up","Ctrl-Down","Ctrl-Left","Ctrl-Right","Alt-Left","Alt-Right","Ctrl-Backspace","Ctrl-Delete","Ctrl-S","Ctrl-F","Ctrl-G","Shift-Ctrl-G","Shift-Ctrl-F","Shift-Ctrl-R","Ctrl-[","Ctrl-]","Ctrl-U","Shift-Ctrl-U","Alt-U","fallthrough","emacsy","Ctrl-B","Ctrl-P","Ctrl-N","Alt-F","Alt-B","Ctrl-E","Ctrl-V","Shift-Ctrl-V","Ctrl-H","Alt-D","Alt-Backspace","Ctrl-K","Ctrl-T","macDefault","Cmd-A","Cmd-D","Cmd-Z","Shift-Cmd-Z","Cmd-Y","Cmd-Home","Cmd-Up","Cmd-End","Cmd-Down","Cmd-Left","Cmd-Right","Ctrl-Alt-Backspace","Alt-Delete","Cmd-S","Cmd-F","Cmd-G","Shift-Cmd-G","Cmd-Alt-F","Shift-Cmd-Alt-F","Cmd-[","Cmd-]","Cmd-Backspace","Cmd-Delete","Cmd-U","Shift-Cmd-U","normalizeKeyMap","keymap","keyname","keys","keyNames","noShift","altGraphKey","fromTextArea","textarea","getValue","tabindex","placeholder","getAttribute","form","leaveSubmitMethodAlone","realSubmit","submit","wrappedSubmit","getTextArea","toTextArea","lastColumnPos","lastColumnValue","sol","peek","eat","eatWhile","eatSpace","skipTo","backUp","column","pattern","consume","caseInsensitive","cased","toLowerCase","hideFirstChars","side","dHeight","oldH","removeInner","insertInner","iterN","spilled","newleaf","maybeSpill","me","sibling","myIndex","used","nextDocId","cleanGeneration","lineSep","getLineHandle","getLineNumber","getLineHandleVisualStart","lineCount","setCursor","addSelection","dup","setExtending","getExtending","historySize","markClean","changeGeneration","forceSplit","isClean","gen","getHistory","setHistory","histData","addLineClass","where","removeLineClass","setBookmark","realOpts","findMarksAt","getAllMarks","posFromIndex","indexFromPos","copyHistory","linkedDoc","unlinkDoc","link","splitIds","iterLinkedDocs","getEditor","eachLine","dontDelegate","method","e_stopPropagation","stopPropagation","cancelBubble","addEventListener","attachEvent","removeEventListener","detachEvent","ms","startIndex","startValue","select","_e","nonASCIISingleCaseWordChar","toUpperCase","createRange","setEnd","setStart","createTextRange","moveToElementText","moveEnd","moveStart","div","nl","rt","te","ownerDocument","parentElement","compareEndPoints","oncopy","3","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","44","45","46","59","61","91","92","93","107","109","127","173","186","187","188","189","190","191","192","219","220","221","222","63232","63233","63234","63235","63272","63273","63275","63276","63277","63302","charType","lowTypes","arabicTypes","BidiSpan","bidiRE","isNeutral","isStrong","countsAsLeft","countsAsNum","outerType","types","nstart","unshift","version","require","findMatchingBracket","strict","config","matching","scanForBracket","forward","maxScanLen","maxScanLineLength","maxScanLines","stack","re","bracketRegex","matchBrackets","autoclear","maxHighlightLen","maxHighlightLineLength","marks","ie_lt8","doMatchBrackets","currentlyHighlighted","(",")","[","]","{","}","doFold","allowFolded","finder","minSize","__isFold","cleared","myWidget","makeWidget","myRange","editorOptions","foldOptions","defaultOptions","newFoldFunction","rangeFinder","toggleFold","foldCode","fold","unfold","foldAll","unfoldAll","funcs","auto","minFoldSize","scanUp","State","parseOptions","opts","indicatorOpen","indicatorFolded","isFolded","updateFoldInfo","foldGutter","updateInViewport","vp","onGutterClick","onChange","changeUpdate","foldOnChangeTimeSpan","onViewportChange","updateViewportTimeSpan","onFold","findOpening","openCh","pass","lineText","lastIndexOf","tokenType","startToken","endToken","nextOpen","nextClose","hasImport","semi","has","hasInclude","jQuery","$","paletteTemplate","color","html","tiny","tinycolor","c","toHsl","formattedString","preferredFormat","swatchStyle","rgbaSupport","toRgbString","toFilter","append","attr","noColorSelectedText","hideAll","spectrums","hide","instanceOptions","callbackContext","defaultOpts","show","beforeShow","spectrum","element","applyOptions","showPaletteOnly","showPalette","toggleButton","togglePaletteMoreText","togglePaletteLessText","palette","paletteArray","paletteLookup","rgb","toggleClass","flat","showInput","showAlpha","allowEmpty","showButtons","togglePaletteOnly","showInitial","containerClassName","reflow","initialize","paletteElementClick","ignore","closest","updateOriginalInput","hideAfterPaletteSelect","IE","shouldReplace","boundElement","replacer","clearButton","appendTo","updateSelectionPaletteFromStorage","offsetElement","toggle","is","disable","click","textInput","setFromTextInput","keydown","cancelButton","cancelText","revert","clearText","chooseButton","chooseText","trigger","isValid","css","pickerContainer","outerWidth","alphaSlider","dragX","dragY","currentAlpha","alphaWidth","dragStart","dragStop","slider","currentHue","parseFloat","slideHeight","dragger","shiftMovementDirection","oldDragX","currentSaturation","dragWidth","oldDragY","dragHeight","currentValue","furtherFromX","setSaturation","initialColor","updateUI","currentPreferredFormat","format","addColorToSelectionPalette","paletteEvent","paletteContainer","delegate","initialColorContainer","localStorageKey","localStorage","oldPalette","each","selectionPalette","showSelectionPalette","inArray","maxSelectionSize","getUniqueSelectionPalette","unique","reverse","drawPalette","currentColor","drawInitial","initial","colorOnShow","isDragging","draggingClass","removeClass","Event","isDefaultPrevented","onkeydown","clickout","resize","clickoutFiresChange","unbind","ignoreFormatChange","newColor","newHsv","toHsv","s","v","getFormat","fromRatio","hasClass","updateHelperLocations","flatColor","toHexString","realColor","displayColor","previewElement","realHex","realRgb","alpha","toRgb","realAlpha","gradient","alphaSliderInner","gradientType","alphaSlideHelper","slideHelper","dragHelper","dragHelperHeight","alphaX","alphaSlideHelperWidth","slideY","slideHelperHeight","fireCallback","hasChanged","isInput","slideWidth","getOffset","destroy","spect","optionName","optionValue","enable","setOffset","coord","throttle","markup","isInputTypeColor","inputTypeColorSupport","replaceInput","replacerClassName","picker","extraY","dpWidth","dpHeight","outerHeight","inputHeight","docElem","viewWidth","viewHeight","noop","onmove","onstart","onstop","dragging","stop","t0","originalEvent","touches","pageX","pageY","maxWidth","maxHeight","hasTouch","duringDragEvents","wait","debounce","timeout","throttler","fn","elem","backgroundColor","gradientFix","dataID","extra","removeData","load","loadOpts","_cachedResult","colorInput","localization","palettes","processNativeColorInputs","colorInputs","inputToRGB","stringInputToObject","rgbToRgb","convertToPercentage","hsvToRgb","hslToRgb","boundAlpha","mathMin","mathMax","bound01","rgbToHsl","hue2rgb","q","rgbToHsv","math","rgbToHex","allow3Char","hex","pad2","mathRound","rgbaToHex","convertDecimalToHex","desaturate","hsl","clamp01","saturate","greyscale","lighten","brighten","darken","spin","hue","complement","triad","tetrad","splitcomplement","analogous","results","slices","ret","monochromatic","hsv","modification","flip","isOnePointZero","processPercent","isPercentage","parseIntFromHex","convertHexToDecimal","trimLeft","trimRight","named","names","matchers","rgba","hsla","hsva","hex8","hex6","hex3","tinyCounter","mathRandom","random","_originalInput","_r","_g","_b","_a","_roundA","_format","_gradientType","_ok","_tc_id","isDark","getBrightness","isLight","getOriginalInput","getAlpha","setAlpha","toHsvString","toHslString","toHex","toHex8","toHex8String","toPercentageRgb","toPercentageRgbString","toName","hexNames","secondColor","hex8String","secondHex8String","formatSet","hasAlpha","_applyModification","_applyCombination","color1","color2","mix","w1","rgb1","rgb2","w2","readability","c1","c2","brightnessA","brightnessB","colorDiff","brightness","isReadable","mostReadable","baseColor","colorList","bestColor","bestScore","bestIsReadable","readable","score","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","burntsienna","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","CSS_INTEGER","CSS_NUMBER","CSS_UNIT","PERMISSIVE_MATCH3","PERMISSIVE_MATCH4","angular","run","$templateCache","put","directive","$http","$routeParams","models","common","selectCache","restrict","scope","attrs","ngModel","getDocumentById","modelId","query","getModel","$eval","ref","getDocument","shard","isValidObjectID","displayField","idSelect","regex","$or","forDisplay","$regex","$options","schema","forID","dependsOn","model","userq","response","searchRes","some","userShard","actualShard","getField","elements","$watch","newValue","searchEnabled","printSelectedElement","selectDisplayField","selectIdField","$on","console","log","raw","$select","modalController","$scope","$modalInstance","configs","modelName","fromSchema","action","innerForm","processForm","getShard","submitForm","$broadcast","$valid","postDocument","status","close","putDocument","alert","dismiss","$inject","$rootScope","$modal","open","templateUrl","controller","resolve","then","schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","select2","stdFormObj","path","lookup","stringify","object","addMapping","createDirective","setMap","forEach","titleMap","dynMap","dynmap","dynEnum","dynenum","res","resultMap","number","modelDate","$render","$viewValue","updateDate","$setViewValue","mixed","dateFormat","$timeout","onFileSelect","$files","myFiles","getModelConfig","fieldName","uploadImage","arrayIndex","filename","getImageUrl","url","image","imageExists","downloadImage","deleteImage","newImageInjector","pathArray","defaultImage","imageinjector","uploadFile","defaultImageForFile","getFileUrl","fileExists","deleteFile","fileinjector","combine","brace","constant","uiCodemirrorConfig","priority","compile","iElement","iAttrs","codeMirror","initialTextValue","codemirror","uiCodemirror","uiCodemirrorOpts","tagName","cm_el","codemirrorDefaultsKeys","newValues","oldValue","isObject","$formatters","JSON","safeViewValue","instance","$apply","parsed","parse","uiRefresh","newVal","oldVal","callback","onLoad","$emit","params","function","onClick","rows","timeMinutes","timeSeconds","newval","seconds","convertToMap","error","addStringToMap","exists","grouping","separator","lock","availableElems","enum","item","getTitle","splitted","prettifyTitle","refreshData","hasAngularVariable","deAngularizeUrl","elems","getAngularVariables","choices","multiselect","items","enumUrl","locked","limitToOptions","minValue","maxValue","iconOn","iconOff","$window","defaultConf","plugins","toolbar1","image_advtab","forced_root_block","autoresize_min_height","autoresize_max_height","fullscreen_new_window","skin_url","fullscreen_settings","theme_advanced_path_location","paste_preprocess","pl","tinyvision","upload","tinymce","$set","isDefined","getContent","isString","setContent","init","selector","setup","ed","tinyMCE","PluginManager","$root","$$phase","contentAreaContainer","riTinymce","success","dropletint","allowedExtensions","defineHTTPSuccess","setRequestUrl","finally","contents","wysiwyg","tinymceOptions","punchCardTemplate","$compile","plural","singular","template","days","hours","description","flatten","JsonHuman","makePrefixer","prefix","sn","scn","linkNode","href","HYPERLINK_CLASS_NAME","getType","BOOL","STRING","INT","FLOAT","FUNCTION","ARRAY","OBJECT","SPECIAL_OBJECT","UNK","parentKey","keyNode","valNode","childs","tr","hyperlinksEnabled","aTarget","hyperlinkKeys","isSpecial","boolOpt","bool","showImage","BOOL_IMAGE","true","false","showText","BOOL_TRUE_CLASS_NAME","BOOL_FALSE_CLASS_NAME","STRING_EMPTY_CLASS_NAME","STRING_CLASS_NAME","INT_CLASS_NAME","FLOAT_CLASS_NAME","hyperlinks","OBJ_KEY_CLASS_NAME","OBJ_VAL_CLASS_NAME","OBJ_EMPTY_CLASS_NAME","OBJECT_CLASS_NAME","FUNCTION_CLASS_NAME","showArrayIndices","showArrayIndex","ARRAY_KEY_CLASS_NAME","ARRAY_VAL_CLASS_NAME","ARRAY_CLASS_NAME","ARRAY_EMPTY_CLASS_NAME","UNKNOWN_CLASS_NAME","validateOptions","prefixer","validateArrayIndexOption","validateHyperlinkOptions","validateBoolOptions","boolOptions","process","message","messages","emit","reset","cleanup","oldUrl","warning","getMessage","flash","processData","patchXHR","fnName","newFn","XMLHttpRequest","redefineProp","xhr","defineProperty","FileAPI","shouldLoad","FormData","forceLoad","initializeUploadListener","__listeners","origAddEventListener","orig","__url","__origError","__fileApiXHR","getResponseHeader","getAllResponseHeaders","abort","header","Function","__requestHeaders","__isFileAPIShim","formData","jsonp","complete","err","fileApiXHR","__completed","loaded","__loaded","total","__total","lengthComputable","loadend","statusText","resp","responseText","onreadystatechange","progress","_this","noContentTimeout","headers","hasFlash","__isFileAPIBlobShim","Blob","isInputTypeFile","ActiveXObject","mimeTypes","offsetParent","html5","jsUrl","basePath","script","allScripts","getElementsByTagName","jsPath","staticPath","ngfFixIE","createFileElemFn","bindAttr","changeFn","makeFlashInput","$$ngfRefElem","fileElem","evt","fileApiChangeFn","getFiles","__files_","disableFileInput","loadStarted","listeners","dispatchEvent","onabort","onerror","onloadstart","onloadend","onprogress","constructEvent","listener","readAsArrayBuffer","readAsBinaryString","readAsDataURL","setRequestHeader","ngFileUpload","service","$q","sendHttp","deferred","defer","promise","__setXHR_","__XHR","xhrFn","notify","progressFunc","reject","origXhrFn","addFieldToFormData","isDate","toISOString","sendFieldsAs","transformRequest","allFields","fields","formDataAppender","fileFormName","fileFormDataName","isFileFormNameString","fileName","http","ArrayBuffer","linkFileSelect","$parse","isUpdating","fileList","rejFiles","validate","updateModel","ngfChange","ngfSelect","bindAttrToFileInput","ngfMultiple","ngfCapture","accept","attributes","attribute","createFileInput","resetOnClick","replaceWith","resetModel","clickHandler","clickAndAssign","ngfResetOnClick","ngfResetModelOnClick","shouldClickLater","ua","globStringToRegex","ngfAccept","$file","$event","fileSizeMax","ngfMaxSize","fileSizeMin","ngfMinSize","regexp","fileChange","noDelay","ngfKeep","prevFiles","$modelValue","ngfKeepDistinct","assign","ngModelRejected","$rejectedFiles","linkDrop","$location","calculateDragOverClass","accepted","kind","clazz","ngfDragOverClass","delay","dragOverDelay","extractFiles","allowDir","multiple","addFile","traverseFileTree","entry","isDirectory","filePath","dirReader","createReader","entries","processing","readEntries","protocol","webkitGetAsEntry","getAsFile","delays","waitForProcess","available","dropAvailable","ngfHideOnDropNotAvailable","ngfDrop","actualDragOverClass","leaveTimeout","ngfStopPropagation","effectAllowed","dropEffect","ngfAllowDir","ngfDropAvailable","ngfSrc","URL","webkitURL","createObjectURL","fileReader","ngfDefaultSrc"],"mappings":"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","file":"ri-backoffice-angular-libs.min.temp.js","sourcesContent":["(function (root, factory) {\n  if(typeof define === \"function\" && define.amd) {\n    define(factory);\n  } else if(typeof module === \"object\" && module.exports) {\n    module.exports = factory();\n  } else {\n    root.safeAccess = factory();\n  }\n}(this, function() {\n\n  return function access(obj, accessStr) {\n    // auto-curry here\n    if (isUndefined(accessStr)) {\n      return access.bind(null, obj);\n    }\n\n    var funcArgs = Array.prototype.slice.call(arguments, 2);\n    return helper(obj, tokenize(accessStr), null, funcArgs);\n  };\n\n  function helper(obj, tokens, ctx, fnArgs) {\n    if (tokens.length === 0) {\n      return obj;\n    }\n\n    var currentToken = tokens[0];\n\n    if (isUndefined(obj) || isNull(obj) ||\n        (isTokenFunctionCall(currentToken) && !isFunction(obj))) {\n      return undefined;\n    }\n\n    if (isTokenFunctionCall(currentToken)) {\n\n      return helper(obj[isArray(fnArgs[0]) ? 'apply' : 'call'](ctx, fnArgs[0]),\n          tokens.slice(1),\n          // clear context because consecutive fn calls execute in global context\n          // e.g. `a.b()()`\n          null,\n          fnArgs.slice(1));\n\n    } else if (isTokenArrayAccess(currentToken)) {\n\n      return helper(obj[parseInt(currentToken.substr(1), 10)],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    } else {\n\n      return helper(obj[currentToken],\n          tokens.slice(1),\n          // lookahead two tokens for function calls\n          isTokenFunctionCall(tokens[1]) ? obj : ctx,\n          fnArgs);\n\n    }\n  }\n\n  function isUndefined(a) {\n    return a === void 0;\n  }\n\n  function isNull(a) {\n    return a === null;\n  }\n\n  function isArray(a) {\n    return Array.isArray(a);\n  }\n\n  function isFunction(a) {\n    return typeof a === 'function';\n  }\n\n  function isTokenFunctionCall(token) {\n    return token === '()';\n  }\n\n  function isTokenArrayAccess(token) {\n    return /^\\[\\d+\\]$/.test(token);\n  }\n\n  function tokenize(str) {\n    return str.split(/\\.|(\\(\\))|(\\[\\d+?])/).filter(function(t) { return t; });\n  }\n\n}));\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// This is CodeMirror (http://codemirror.net), a code editor\n// implemented in JavaScript on top of the browser's DOM.\n//\n// You can find some technical background for some of the code below\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    module.exports = mod();\n  else if (typeof define == \"function\" && define.amd) // AMD\n    return define([], mod);\n  else // Plain browser env\n    this.CodeMirror = mod();\n})(function() {\n  \"use strict\";\n\n  // BROWSER SNIFFING\n\n  // Kludges for bugs and behavior differences that can't be feature\n  // detected are enabled based on userAgent etc sniffing.\n\n  var gecko = /gecko\\/\\d/i.test(navigator.userAgent);\n  // ie_uptoN means Internet Explorer version N or lower\n  var ie_upto10 = /MSIE \\d/.test(navigator.userAgent);\n  var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(navigator.userAgent);\n  var ie = ie_upto10 || ie_11up;\n  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);\n  var webkit = /WebKit\\//.test(navigator.userAgent);\n  var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(navigator.userAgent);\n  var chrome = /Chrome\\//.test(navigator.userAgent);\n  var presto = /Opera\\//.test(navigator.userAgent);\n  var safari = /Apple Computer/.test(navigator.vendor);\n  var khtml = /KHTML\\//.test(navigator.userAgent);\n  var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(navigator.userAgent);\n  var phantom = /PhantomJS/.test(navigator.userAgent);\n\n  var ios = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\n  // This is woefully incomplete. Suggestions for alternative methods welcome.\n  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\n  var mac = ios || /Mac/.test(navigator.platform);\n  var windows = /win/i.test(navigator.platform);\n\n  var presto_version = presto && navigator.userAgent.match(/Version\\/(\\d*\\.\\d*)/);\n  if (presto_version) presto_version = Number(presto_version[1]);\n  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\n  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\n  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\n  var captureRightClick = gecko || (ie && ie_version >= 9);\n\n  // Optimize some code when these features are not used.\n  var sawReadOnlySpans = false, sawCollapsedSpans = false;\n\n  // EDITOR CONSTRUCTOR\n\n  // A CodeMirror instance represents an editor. This is the object\n  // that user code is usually dealing with.\n\n  function CodeMirror(place, options) {\n    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);\n\n    this.options = options = options ? copyObj(options) : {};\n    // Determine effective options based on given values and defaults.\n    copyObj(defaults, options, false);\n    setGuttersForLineNumbers(options);\n\n    var doc = options.value;\n    if (typeof doc == \"string\") doc = new Doc(doc, options.mode);\n    this.doc = doc;\n\n    var display = this.display = new Display(place, doc);\n    display.wrapper.CodeMirror = this;\n    updateGutters(this);\n    themeChanged(this);\n    if (options.lineWrapping)\n      this.display.wrapper.className += \" CodeMirror-wrap\";\n    if (options.autofocus && !mobile) focusInput(this);\n\n    this.state = {\n      keyMaps: [],  // stores maps added by addKeyMap\n      overlays: [], // highlighting overlays, as added by addOverlay\n      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\n      overwrite: false, focused: false,\n      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\n      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in readInput\n      draggingText: false,\n      highlight: new Delayed(), // stores highlight worker timeout\n      keySeq: null  // Unfinished key sequence\n    };\n\n    // Override magic textarea content restore that IE sometimes does\n    // on our hidden textarea on reload\n    if (ie && ie_version < 11) setTimeout(bind(resetInput, this, true), 20);\n\n    registerEventHandlers(this);\n    ensureGlobalHandlers();\n\n    startOperation(this);\n    this.curOp.forceUpdate = true;\n    attachDoc(this, doc);\n\n    if ((options.autofocus && !mobile) || activeElt() == display.input)\n      setTimeout(bind(onFocus, this), 20);\n    else\n      onBlur(this);\n\n    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))\n      optionHandlers[opt](this, options[opt], Init);\n    maybeUpdateLineNumberWidth(this);\n    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);\n    endOperation(this);\n  }\n\n  // DISPLAY CONSTRUCTOR\n\n  // The display handles the DOM integration, both for input reading\n  // and content drawing. It holds references to DOM nodes and\n  // display-related state.\n\n  function Display(place, doc) {\n    var d = this;\n\n    // The semihidden textarea that is focused when the editor is\n    // focused, and receives input.\n    var input = d.input = elt(\"textarea\", null, null, \"position: absolute; padding: 0; width: 1px; height: 1em; outline: none\");\n    // The textarea is kept positioned near the cursor to prevent the\n    // fact that it'll be scrolled into view on input from scrolling\n    // our fake cursor out of view. On webkit, when wrap=off, paste is\n    // very slow. So make the area wide instead.\n    if (webkit) input.style.width = \"1000px\";\n    else input.setAttribute(\"wrap\", \"off\");\n    // If border: 0; -- iOS fails to open keyboard (issue #1287)\n    if (ios) input.style.border = \"1px solid black\";\n    input.setAttribute(\"autocorrect\", \"off\"); input.setAttribute(\"autocapitalize\", \"off\"); input.setAttribute(\"spellcheck\", \"false\");\n\n    // Wraps and hides input textarea\n    d.inputDiv = elt(\"div\", [input], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\n    // The fake scrollbar elements.\n    d.scrollbarH = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");\n    d.scrollbarV = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");\n    // Covers bottom-right square when both scrollbars are present.\n    d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\n    // Covers bottom of gutter when coverGutterNextToScrollbar is on\n    // and h scrollbar is present.\n    d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\n    // Will contain the actual code, positioned to cover the viewport.\n    d.lineDiv = elt(\"div\", null, \"CodeMirror-code\");\n    // Elements are added to these to represent selection and cursors.\n    d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\n    d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");\n    // A visibility: hidden element used to find the size of things.\n    d.measure = elt(\"div\", null, \"CodeMirror-measure\");\n    // When lines outside of the viewport are measured, they are drawn in this.\n    d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");\n    // Wraps everything that needs to exist inside the vertically-padded coordinate system\n    d.lineSpace = elt(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\n                      null, \"position: relative; outline: none\");\n    // Moved around its parent to cover visible view.\n    d.mover = elt(\"div\", [elt(\"div\", [d.lineSpace], \"CodeMirror-lines\")], null, \"position: relative\");\n    // Set to the height of the document, allowing scrolling.\n    d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\n    // Behavior of elts with overflow: auto and padding is\n    // inconsistent across browsers. This is used to ensure the\n    // scrollable area is big enough.\n    d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerCutOff + \"px; width: 1px;\");\n    // Will contain the gutters, if any.\n    d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\n    d.lineGutter = null;\n    // Actual scrollable element.\n    d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\n    d.scroller.setAttribute(\"tabIndex\", \"-1\");\n    // The element in which the editor lives.\n    d.wrapper = elt(\"div\", [d.inputDiv, d.scrollbarH, d.scrollbarV,\n                            d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\n\n    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\n    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\n    // Needed to hide big blue blinking cursor on Mobile Safari\n    if (ios) input.style.width = \"0px\";\n    if (!webkit) d.scroller.draggable = true;\n    // Needed to handle Tab key in KHTML\n    if (khtml) { d.inputDiv.style.height = \"1px\"; d.inputDiv.style.position = \"absolute\"; }\n    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\n    if (ie && ie_version < 8) d.scrollbarH.style.minHeight = d.scrollbarV.style.minWidth = \"18px\";\n\n    if (place) {\n      if (place.appendChild) place.appendChild(d.wrapper);\n      else place(d.wrapper);\n    }\n\n    // Current rendered range (may be bigger than the view window).\n    d.viewFrom = d.viewTo = doc.first;\n    // Information about the rendered lines.\n    d.view = [];\n    // Holds info about a single rendered line when it was rendered\n    // for measurement, while not in view.\n    d.externalMeasured = null;\n    // Empty space (in pixels) above the view\n    d.viewOffset = 0;\n    d.lastWrapHeight = d.lastWrapWidth = 0;\n    d.updateLineNumbers = null;\n\n    // Used to only resize the line number gutter when necessary (when\n    // the amount of lines crosses a boundary that makes its width change)\n    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\n    // See readInput and resetInput\n    d.prevInput = \"\";\n    // Set to true when a non-horizontal-scrolling line widget is\n    // added. As an optimization, line widget aligning is skipped when\n    // this is false.\n    d.alignWidgets = false;\n    // Flag that indicates whether we expect input to appear real soon\n    // now (after some event like 'keypress' or 'input') and are\n    // polling intensively.\n    d.pollingFast = false;\n    // Self-resetting timeout for the poller\n    d.poll = new Delayed();\n\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n\n    // Tracks when resetInput has punted to just putting a short\n    // string into the textarea instead of the full selection.\n    d.inaccurateSelection = false;\n\n    // Tracks the maximum line length so that the horizontal scrollbar\n    // can be kept static when scrolling.\n    d.maxLine = null;\n    d.maxLineLength = 0;\n    d.maxLineChanged = false;\n\n    // Used for measuring wheel scrolling granularity\n    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\n\n    // True when shift is held down.\n    d.shift = false;\n\n    // Used to track whether anything happened since the context menu\n    // was opened.\n    d.selForContextMenu = null;\n  }\n\n  // STATE UPDATES\n\n  // Used to get the editor into a consistent state again when options change.\n\n  function loadMode(cm) {\n    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);\n    resetModeState(cm);\n  }\n\n  function resetModeState(cm) {\n    cm.doc.iter(function(line) {\n      if (line.stateAfter) line.stateAfter = null;\n      if (line.styles) line.styles = null;\n    });\n    cm.doc.frontier = cm.doc.first;\n    startWorker(cm, 100);\n    cm.state.modeGen++;\n    if (cm.curOp) regChange(cm);\n  }\n\n  function wrappingChanged(cm) {\n    if (cm.options.lineWrapping) {\n      addClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      cm.display.sizer.style.minWidth = \"\";\n    } else {\n      rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\n      findMaxLine(cm);\n    }\n    estimateLineHeights(cm);\n    regChange(cm);\n    clearCaches(cm);\n    setTimeout(function(){updateScrollbars(cm);}, 100);\n  }\n\n  // Returns a function that estimates the height of a line, to use as\n  // first approximation until the line becomes visible (and is thus\n  // properly measurable).\n  function estimateHeight(cm) {\n    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\n    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\n    return function(line) {\n      if (lineIsHidden(cm.doc, line)) return 0;\n\n      var widgetsHeight = 0;\n      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {\n        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;\n      }\n\n      if (wrapping)\n        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;\n      else\n        return widgetsHeight + th;\n    };\n  }\n\n  function estimateLineHeights(cm) {\n    var doc = cm.doc, est = estimateHeight(cm);\n    doc.iter(function(line) {\n      var estHeight = est(line);\n      if (estHeight != line.height) updateLineHeight(line, estHeight);\n    });\n  }\n\n  function themeChanged(cm) {\n    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\n      cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\n    clearCaches(cm);\n  }\n\n  function guttersChanged(cm) {\n    updateGutters(cm);\n    regChange(cm);\n    setTimeout(function(){alignHorizontally(cm);}, 20);\n  }\n\n  // Rebuild the gutter elements, ensure the margin to the left of the\n  // code matches their width.\n  function updateGutters(cm) {\n    var gutters = cm.display.gutters, specs = cm.options.gutters;\n    removeChildren(gutters);\n    for (var i = 0; i < specs.length; ++i) {\n      var gutterClass = specs[i];\n      var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\n      if (gutterClass == \"CodeMirror-linenumbers\") {\n        cm.display.lineGutter = gElt;\n        gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\n      }\n    }\n    gutters.style.display = i ? \"\" : \"none\";\n    updateGutterSpace(cm);\n  }\n\n  function updateGutterSpace(cm) {\n    var width = cm.display.gutters.offsetWidth;\n    cm.display.sizer.style.marginLeft = width + \"px\";\n    cm.display.scrollbarH.style.left = cm.options.fixedGutter ? width + \"px\" : 0;\n  }\n\n  // Compute the character length of a line, taking into account\n  // collapsed ranges (see markText) that might hide parts, and join\n  // other lines onto it.\n  function lineLength(line) {\n    if (line.height == 0) return 0;\n    var len = line.text.length, merged, cur = line;\n    while (merged = collapsedSpanAtStart(cur)) {\n      var found = merged.find(0, true);\n      cur = found.from.line;\n      len += found.from.ch - found.to.ch;\n    }\n    cur = line;\n    while (merged = collapsedSpanAtEnd(cur)) {\n      var found = merged.find(0, true);\n      len -= cur.text.length - found.from.ch;\n      cur = found.to.line;\n      len += cur.text.length - found.to.ch;\n    }\n    return len;\n  }\n\n  // Find the longest line in the document.\n  function findMaxLine(cm) {\n    var d = cm.display, doc = cm.doc;\n    d.maxLine = getLine(doc, doc.first);\n    d.maxLineLength = lineLength(d.maxLine);\n    d.maxLineChanged = true;\n    doc.iter(function(line) {\n      var len = lineLength(line);\n      if (len > d.maxLineLength) {\n        d.maxLineLength = len;\n        d.maxLine = line;\n      }\n    });\n  }\n\n  // Make sure the gutters options contains the element\n  // \"CodeMirror-linenumbers\" when the lineNumbers option is true.\n  function setGuttersForLineNumbers(options) {\n    var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\n    if (found == -1 && options.lineNumbers) {\n      options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\n    } else if (found > -1 && !options.lineNumbers) {\n      options.gutters = options.gutters.slice(0);\n      options.gutters.splice(found, 1);\n    }\n  }\n\n  // SCROLLBARS\n\n  function hScrollbarTakesSpace(cm) {\n    return cm.display.scroller.clientHeight - cm.display.wrapper.clientHeight < scrollerCutOff - 3;\n  }\n\n  // Prepare DOM reads needed to update the scrollbars. Done in one\n  // shot to minimize update/measure roundtrips.\n  function measureForScrollbars(cm) {\n    var scroll = cm.display.scroller;\n    return {\n      clientHeight: scroll.clientHeight,\n      barHeight: cm.display.scrollbarV.clientHeight,\n      scrollWidth: scroll.scrollWidth, clientWidth: scroll.clientWidth,\n      hScrollbarTakesSpace: hScrollbarTakesSpace(cm),\n      barWidth: cm.display.scrollbarH.clientWidth,\n      docHeight: Math.round(cm.doc.height + paddingVert(cm.display))\n    };\n  }\n\n  // Re-synchronize the fake scrollbars with the actual size of the\n  // content.\n  function updateScrollbars(cm, measure) {\n    if (!measure) measure = measureForScrollbars(cm);\n    var d = cm.display, sWidth = scrollbarWidth(d.measure);\n    var scrollHeight = measure.docHeight + scrollerCutOff;\n    var needsH = measure.scrollWidth > measure.clientWidth;\n    if (needsH && measure.scrollWidth <= measure.clientWidth + 1 &&\n        sWidth > 0 && !measure.hScrollbarTakesSpace)\n      needsH = false; // (Issue #2562)\n    var needsV = scrollHeight > measure.clientHeight;\n\n    if (needsV) {\n      d.scrollbarV.style.display = \"block\";\n      d.scrollbarV.style.bottom = needsH ? sWidth + \"px\" : \"0\";\n      // A bug in IE8 can cause this value to be negative, so guard it.\n      d.scrollbarV.firstChild.style.height =\n        Math.max(0, scrollHeight - measure.clientHeight + (measure.barHeight || d.scrollbarV.clientHeight)) + \"px\";\n    } else {\n      d.scrollbarV.style.display = \"\";\n      d.scrollbarV.firstChild.style.height = \"0\";\n    }\n    if (needsH) {\n      d.scrollbarH.style.display = \"block\";\n      d.scrollbarH.style.right = needsV ? sWidth + \"px\" : \"0\";\n      d.scrollbarH.firstChild.style.width =\n        (measure.scrollWidth - measure.clientWidth + (measure.barWidth || d.scrollbarH.clientWidth)) + \"px\";\n    } else {\n      d.scrollbarH.style.display = \"\";\n      d.scrollbarH.firstChild.style.width = \"0\";\n    }\n    if (needsH && needsV) {\n      d.scrollbarFiller.style.display = \"block\";\n      d.scrollbarFiller.style.height = d.scrollbarFiller.style.width = sWidth + \"px\";\n    } else d.scrollbarFiller.style.display = \"\";\n    if (needsH && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\n      d.gutterFiller.style.display = \"block\";\n      d.gutterFiller.style.height = sWidth + \"px\";\n      d.gutterFiller.style.width = d.gutters.offsetWidth + \"px\";\n    } else d.gutterFiller.style.display = \"\";\n\n    if (!cm.state.checkedOverlayScrollbar && measure.clientHeight > 0) {\n      if (sWidth === 0) {\n        var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";\n        d.scrollbarV.style.minWidth = d.scrollbarH.style.minHeight = w;\n        var barMouseDown = function(e) {\n          if (e_target(e) != d.scrollbarV && e_target(e) != d.scrollbarH)\n            operation(cm, onMouseDown)(e);\n        };\n        on(d.scrollbarV, \"mousedown\", barMouseDown);\n        on(d.scrollbarH, \"mousedown\", barMouseDown);\n      }\n      cm.state.checkedOverlayScrollbar = true;\n    }\n  }\n\n  // Compute the lines that are visible in a given viewport (defaults\n  // the the current scroll position). viewport may contain top,\n  // height, and ensure (see op.scrollToPos) properties.\n  function visibleLines(display, doc, viewport) {\n    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\n    top = Math.floor(top - paddingTop(display));\n    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\n\n    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\n    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\n    // forces those lines into the viewport (if possible).\n    if (viewport && viewport.ensure) {\n      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\n      if (ensureFrom < from)\n        return {from: ensureFrom,\n                to: lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight)};\n      if (Math.min(ensureTo, doc.lastLine()) >= to)\n        return {from: lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight),\n                to: ensureTo};\n    }\n    return {from: from, to: Math.max(to, from + 1)};\n  }\n\n  // LINE NUMBERS\n\n  // Re-align line numbers and gutter marks to compensate for\n  // horizontal scrolling.\n  function alignHorizontally(cm) {\n    var display = cm.display, view = display.view;\n    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;\n    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\n    var gutterW = display.gutters.offsetWidth, left = comp + \"px\";\n    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {\n      if (cm.options.fixedGutter && view[i].gutter)\n        view[i].gutter.style.left = left;\n      var align = view[i].alignable;\n      if (align) for (var j = 0; j < align.length; j++)\n        align[j].style.left = left;\n    }\n    if (cm.options.fixedGutter)\n      display.gutters.style.left = (comp + gutterW) + \"px\";\n  }\n\n  // Used to ensure that the line number gutter is still the right\n  // size for the current document size. Returns true when an update\n  // is needed.\n  function maybeUpdateLineNumberWidth(cm) {\n    if (!cm.options.lineNumbers) return false;\n    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\n    if (last.length != display.lineNumChars) {\n      var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\n                                                 \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\n      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\n      display.lineGutter.style.width = \"\";\n      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding);\n      display.lineNumWidth = display.lineNumInnerWidth + padding;\n      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\n      display.lineGutter.style.width = display.lineNumWidth + \"px\";\n      updateGutterSpace(cm);\n      return true;\n    }\n    return false;\n  }\n\n  function lineNumberFor(options, i) {\n    return String(options.lineNumberFormatter(i + options.firstLineNumber));\n  }\n\n  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\n  // but using getBoundingClientRect to get a sub-pixel-accurate\n  // result.\n  function compensateForHScroll(display) {\n    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;\n  }\n\n  // DISPLAY DRAWING\n\n  function DisplayUpdate(cm, viewport, force) {\n    var display = cm.display;\n\n    this.viewport = viewport;\n    // Store some values that we'll need later (but don't want to force a relayout for)\n    this.visible = visibleLines(display, cm.doc, viewport);\n    this.editorIsHidden = !display.wrapper.offsetWidth;\n    this.wrapperHeight = display.wrapper.clientHeight;\n    this.wrapperWidth = display.wrapper.clientWidth;\n    this.oldViewFrom = display.viewFrom; this.oldViewTo = display.viewTo;\n    this.oldScrollerWidth = display.scroller.clientWidth;\n    this.force = force;\n    this.dims = getDimensions(cm);\n  }\n\n  // Does the actual updating of the line display. Bails out\n  // (returning false) when there is nothing to be done and forced is\n  // false.\n  function updateDisplayIfNeeded(cm, update) {\n    var display = cm.display, doc = cm.doc;\n    if (update.editorIsHidden) {\n      resetView(cm);\n      return false;\n    }\n\n    // Bail out if the visible area is already rendered and nothing changed.\n    if (!update.force &&\n        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\n        countDirtyView(cm) == 0)\n      return false;\n\n    if (maybeUpdateLineNumberWidth(cm)) {\n      resetView(cm);\n      update.dims = getDimensions(cm);\n    }\n\n    // Compute a suitable new viewport (from & to)\n    var end = doc.first + doc.size;\n    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);\n    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);\n    if (sawCollapsedSpans) {\n      from = visualLineNo(cm.doc, from);\n      to = visualLineEndNo(cm.doc, to);\n    }\n\n    var different = from != display.viewFrom || to != display.viewTo ||\n      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n    adjustView(cm, from, to);\n\n    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\n    // Position the mover div to align with the current scroll position\n    cm.display.mover.style.top = display.viewOffset + \"px\";\n\n    var toUpdate = countDirtyView(cm);\n    if (!different && toUpdate == 0 && !update.force &&\n        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n      return false;\n\n    // For big changes, we hide the enclosing element during the\n    // update, since that speeds up the operations on most browsers.\n    var focused = activeElt();\n    if (toUpdate > 4) display.lineDiv.style.display = \"none\";\n    patchDisplay(cm, display.updateLineNumbers, update.dims);\n    if (toUpdate > 4) display.lineDiv.style.display = \"\";\n    // There might have been a widget with a focused element that got\n    // hidden or updated, if so re-focus it.\n    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();\n\n    // Prevent selection and cursors from interfering with the scroll\n    // width.\n    removeChildren(display.cursorDiv);\n    removeChildren(display.selectionDiv);\n\n    if (different) {\n      display.lastWrapHeight = update.wrapperHeight;\n      display.lastWrapWidth = update.wrapperWidth;\n      startWorker(cm, 400);\n    }\n\n    display.updateLineNumbers = null;\n\n    return true;\n  }\n\n  function postUpdateDisplay(cm, update) {\n    var force = update.force, viewport = update.viewport;\n    for (var first = true;; first = false) {\n      if (first && cm.options.lineWrapping && update.oldScrollerWidth != cm.display.scroller.clientWidth) {\n        force = true;\n      } else {\n        force = false;\n        // Clip forced viewport to actual scrollable area.\n        if (viewport && viewport.top != null)\n          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - scrollerCutOff -\n                                    cm.display.scroller.clientHeight, viewport.top)};\n        // Updated line heights might result in the drawn area not\n        // actually covering the viewport. Keep looping until it does.\n        update.visible = visibleLines(cm.display, cm.doc, viewport);\n        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n          break;\n      }\n      if (!updateDisplayIfNeeded(cm, update)) break;\n      updateHeightsInViewport(cm);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n\n    signalLater(cm, \"update\", cm);\n    if (cm.display.viewFrom != update.oldViewFrom || cm.display.viewTo != update.oldViewTo)\n      signalLater(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);\n  }\n\n  function updateDisplaySimple(cm, viewport) {\n    var update = new DisplayUpdate(cm, viewport);\n    if (updateDisplayIfNeeded(cm, update)) {\n      updateHeightsInViewport(cm);\n      postUpdateDisplay(cm, update);\n      var barMeasure = measureForScrollbars(cm);\n      updateSelection(cm);\n      setDocumentHeight(cm, barMeasure);\n      updateScrollbars(cm, barMeasure);\n    }\n  }\n\n  function setDocumentHeight(cm, measure) {\n    cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = measure.docHeight + \"px\";\n    cm.display.gutters.style.height = Math.max(measure.docHeight, measure.clientHeight - scrollerCutOff) + \"px\";\n  }\n\n  function checkForWebkitWidthBug(cm, measure) {\n    // Work around Webkit bug where it sometimes reserves space for a\n    // non-existing phantom scrollbar in the scroller (Issue #2420)\n    if (cm.display.sizer.offsetWidth + cm.display.gutters.offsetWidth < cm.display.scroller.clientWidth - 1) {\n      cm.display.sizer.style.minHeight = cm.display.heightForcer.style.top = \"0px\";\n      cm.display.gutters.style.height = measure.docHeight + \"px\";\n    }\n  }\n\n  // Read the actual heights of the rendered lines, and update their\n  // stored heights to match.\n  function updateHeightsInViewport(cm) {\n    var display = cm.display;\n    var prevBottom = display.lineDiv.offsetTop;\n    for (var i = 0; i < display.view.length; i++) {\n      var cur = display.view[i], height;\n      if (cur.hidden) continue;\n      if (ie && ie_version < 8) {\n        var bot = cur.node.offsetTop + cur.node.offsetHeight;\n        height = bot - prevBottom;\n        prevBottom = bot;\n      } else {\n        var box = cur.node.getBoundingClientRect();\n        height = box.bottom - box.top;\n      }\n      var diff = cur.line.height - height;\n      if (height < 2) height = textHeight(display);\n      if (diff > .001 || diff < -.001) {\n        updateLineHeight(cur.line, height);\n        updateWidgetHeight(cur.line);\n        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)\n          updateWidgetHeight(cur.rest[j]);\n      }\n    }\n  }\n\n  // Read and store the height of line widgets associated with the\n  // given line.\n  function updateWidgetHeight(line) {\n    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)\n      line.widgets[i].height = line.widgets[i].node.offsetHeight;\n  }\n\n  // Do a bulk-read of the DOM positions and sizes needed to draw the\n  // view, so that we don't interleave reading and writing to the DOM.\n  function getDimensions(cm) {\n    var d = cm.display, left = {}, width = {};\n    var gutterLeft = d.gutters.clientLeft;\n    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\n      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\n      width[cm.options.gutters[i]] = n.clientWidth;\n    }\n    return {fixedPos: compensateForHScroll(d),\n            gutterTotalWidth: d.gutters.offsetWidth,\n            gutterLeft: left,\n            gutterWidth: width,\n            wrapperWidth: d.wrapper.clientWidth};\n  }\n\n  // Sync the actual display DOM structure with display.view, removing\n  // nodes for lines that are no longer in view, and creating the ones\n  // that are not there yet, and updating the ones that are out of\n  // date.\n  function patchDisplay(cm, updateNumbersFrom, dims) {\n    var display = cm.display, lineNumbers = cm.options.lineNumbers;\n    var container = display.lineDiv, cur = container.firstChild;\n\n    function rm(node) {\n      var next = node.nextSibling;\n      // Works around a throw-scroll bug in OS X Webkit\n      if (webkit && mac && cm.display.currentWheelTarget == node)\n        node.style.display = \"none\";\n      else\n        node.parentNode.removeChild(node);\n      return next;\n    }\n\n    var view = display.view, lineN = display.viewFrom;\n    // Loop over the elements in the view, syncing cur (the DOM nodes\n    // in display.lineDiv) with the view as we go.\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (lineView.hidden) {\n      } else if (!lineView.node) { // Not drawn yet\n        var node = buildLineElement(cm, lineView, lineN, dims);\n        container.insertBefore(node, cur);\n      } else { // Already drawn\n        while (cur != lineView.node) cur = rm(cur);\n        var updateNumber = lineNumbers && updateNumbersFrom != null &&\n          updateNumbersFrom <= lineN && lineView.lineNumber;\n        if (lineView.changes) {\n          if (indexOf(lineView.changes, \"gutter\") > -1) updateNumber = false;\n          updateLineForChanges(cm, lineView, lineN, dims);\n        }\n        if (updateNumber) {\n          removeChildren(lineView.lineNumber);\n          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\n        }\n        cur = lineView.node.nextSibling;\n      }\n      lineN += lineView.size;\n    }\n    while (cur) cur = rm(cur);\n  }\n\n  // When an aspect of a line changes, a string is added to\n  // lineView.changes. This updates the relevant part of the line's\n  // DOM structure.\n  function updateLineForChanges(cm, lineView, lineN, dims) {\n    for (var j = 0; j < lineView.changes.length; j++) {\n      var type = lineView.changes[j];\n      if (type == \"text\") updateLineText(cm, lineView);\n      else if (type == \"gutter\") updateLineGutter(cm, lineView, lineN, dims);\n      else if (type == \"class\") updateLineClasses(lineView);\n      else if (type == \"widget\") updateLineWidgets(lineView, dims);\n    }\n    lineView.changes = null;\n  }\n\n  // Lines with gutter elements, widgets or a background class need to\n  // be wrapped, and have the extra elements added to the wrapper div\n  function ensureLineWrapped(lineView) {\n    if (lineView.node == lineView.text) {\n      lineView.node = elt(\"div\", null, null, \"position: relative\");\n      if (lineView.text.parentNode)\n        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);\n      lineView.node.appendChild(lineView.text);\n      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;\n    }\n    return lineView.node;\n  }\n\n  function updateLineBackground(lineView) {\n    var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;\n    if (cls) cls += \" CodeMirror-linebackground\";\n    if (lineView.background) {\n      if (cls) lineView.background.className = cls;\n      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\n    } else if (cls) {\n      var wrap = ensureLineWrapped(lineView);\n      lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);\n    }\n  }\n\n  // Wrapper around buildLineContent which will reuse the structure\n  // in display.externalMeasured when possible.\n  function getLineContent(cm, lineView) {\n    var ext = cm.display.externalMeasured;\n    if (ext && ext.line == lineView.line) {\n      cm.display.externalMeasured = null;\n      lineView.measure = ext.measure;\n      return ext.built;\n    }\n    return buildLineContent(cm, lineView);\n  }\n\n  // Redraw the line's text. Interacts with the background and text\n  // classes because the mode may output tokens that influence these\n  // classes.\n  function updateLineText(cm, lineView) {\n    var cls = lineView.text.className;\n    var built = getLineContent(cm, lineView);\n    if (lineView.text == lineView.node) lineView.node = built.pre;\n    lineView.text.parentNode.replaceChild(built.pre, lineView.text);\n    lineView.text = built.pre;\n    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\n      lineView.bgClass = built.bgClass;\n      lineView.textClass = built.textClass;\n      updateLineClasses(lineView);\n    } else if (cls) {\n      lineView.text.className = cls;\n    }\n  }\n\n  function updateLineClasses(lineView) {\n    updateLineBackground(lineView);\n    if (lineView.line.wrapClass)\n      ensureLineWrapped(lineView).className = lineView.line.wrapClass;\n    else if (lineView.node != lineView.text)\n      lineView.node.className = \"\";\n    var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;\n    lineView.text.className = textClass || \"\";\n  }\n\n  function updateLineGutter(cm, lineView, lineN, dims) {\n    if (lineView.gutter) {\n      lineView.node.removeChild(lineView.gutter);\n      lineView.gutter = null;\n    }\n    var markers = lineView.line.gutterMarkers;\n    if (cm.options.lineNumbers || markers) {\n      var wrap = ensureLineWrapped(lineView);\n      var gutterWrap = lineView.gutter =\n        wrap.insertBefore(elt(\"div\", null, \"CodeMirror-gutter-wrapper\", \"left: \" +\n                              (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +\n                              \"px; width: \" + dims.gutterTotalWidth + \"px\"),\n                          lineView.text);\n      if (lineView.line.gutterClass)\n        gutterWrap.className += \" \" + lineView.line.gutterClass;\n      if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\n        lineView.lineNumber = gutterWrap.appendChild(\n          elt(\"div\", lineNumberFor(cm.options, lineN),\n              \"CodeMirror-linenumber CodeMirror-gutter-elt\",\n              \"left: \" + dims.gutterLeft[\"CodeMirror-linenumbers\"] + \"px; width: \"\n              + cm.display.lineNumInnerWidth + \"px\"));\n      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {\n        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\n        if (found)\n          gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\", \"left: \" +\n                                     dims.gutterLeft[id] + \"px; width: \" + dims.gutterWidth[id] + \"px\"));\n      }\n    }\n  }\n\n  function updateLineWidgets(lineView, dims) {\n    if (lineView.alignable) lineView.alignable = null;\n    for (var node = lineView.node.firstChild, next; node; node = next) {\n      var next = node.nextSibling;\n      if (node.className == \"CodeMirror-linewidget\")\n        lineView.node.removeChild(node);\n    }\n    insertLineWidgets(lineView, dims);\n  }\n\n  // Build a line's DOM representation from scratch\n  function buildLineElement(cm, lineView, lineN, dims) {\n    var built = getLineContent(cm, lineView);\n    lineView.text = lineView.node = built.pre;\n    if (built.bgClass) lineView.bgClass = built.bgClass;\n    if (built.textClass) lineView.textClass = built.textClass;\n\n    updateLineClasses(lineView);\n    updateLineGutter(cm, lineView, lineN, dims);\n    insertLineWidgets(lineView, dims);\n    return lineView.node;\n  }\n\n  // A lineView may contain multiple logical lines (when merged by\n  // collapsed spans). The widgets for all of them need to be drawn.\n  function insertLineWidgets(lineView, dims) {\n    insertLineWidgetsFor(lineView.line, lineView, dims, true);\n    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n      insertLineWidgetsFor(lineView.rest[i], lineView, dims, false);\n  }\n\n  function insertLineWidgetsFor(line, lineView, dims, allowAbove) {\n    if (!line.widgets) return;\n    var wrap = ensureLineWrapped(lineView);\n    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\n      var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\n      if (!widget.handleMouseEvents) node.ignoreEvents = true;\n      positionLineWidget(widget, node, lineView, dims);\n      if (allowAbove && widget.above)\n        wrap.insertBefore(node, lineView.gutter || lineView.text);\n      else\n        wrap.appendChild(node);\n      signalLater(widget, \"redraw\");\n    }\n  }\n\n  function positionLineWidget(widget, node, lineView, dims) {\n    if (widget.noHScroll) {\n      (lineView.alignable || (lineView.alignable = [])).push(node);\n      var width = dims.wrapperWidth;\n      node.style.left = dims.fixedPos + \"px\";\n      if (!widget.coverGutter) {\n        width -= dims.gutterTotalWidth;\n        node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\n      }\n      node.style.width = width + \"px\";\n    }\n    if (widget.coverGutter) {\n      node.style.zIndex = 5;\n      node.style.position = \"relative\";\n      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + \"px\";\n    }\n  }\n\n  // POSITION OBJECT\n\n  // A Pos instance represents a position within the text.\n  var Pos = CodeMirror.Pos = function(line, ch) {\n    if (!(this instanceof Pos)) return new Pos(line, ch);\n    this.line = line; this.ch = ch;\n  };\n\n  // Compare two positions, return 0 if they are the same, a negative\n  // number when a is less, and a positive number otherwise.\n  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };\n\n  function copyPos(x) {return Pos(x.line, x.ch);}\n  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }\n  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }\n\n  // SELECTION / CURSOR\n\n  // Selection objects are immutable. A new one is created every time\n  // the selection changes. A selection is one or more non-overlapping\n  // (and non-touching) ranges, sorted, and an integer that indicates\n  // which one is the primary selection (the one that's scrolled into\n  // view, that getCursor returns, etc).\n  function Selection(ranges, primIndex) {\n    this.ranges = ranges;\n    this.primIndex = primIndex;\n  }\n\n  Selection.prototype = {\n    primary: function() { return this.ranges[this.primIndex]; },\n    equals: function(other) {\n      if (other == this) return true;\n      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var here = this.ranges[i], there = other.ranges[i];\n        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;\n      }\n      return true;\n    },\n    deepCopy: function() {\n      for (var out = [], i = 0; i < this.ranges.length; i++)\n        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));\n      return new Selection(out, this.primIndex);\n    },\n    somethingSelected: function() {\n      for (var i = 0; i < this.ranges.length; i++)\n        if (!this.ranges[i].empty()) return true;\n      return false;\n    },\n    contains: function(pos, end) {\n      if (!end) end = pos;\n      for (var i = 0; i < this.ranges.length; i++) {\n        var range = this.ranges[i];\n        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\n          return i;\n      }\n      return -1;\n    }\n  };\n\n  function Range(anchor, head) {\n    this.anchor = anchor; this.head = head;\n  }\n\n  Range.prototype = {\n    from: function() { return minPos(this.anchor, this.head); },\n    to: function() { return maxPos(this.anchor, this.head); },\n    empty: function() {\n      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;\n    }\n  };\n\n  // Take an unsorted, potentially overlapping set of ranges, and\n  // build a selection out of it. 'Consumes' ranges array (modifying\n  // it).\n  function normalizeSelection(ranges, primIndex) {\n    var prim = ranges[primIndex];\n    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });\n    primIndex = indexOf(ranges, prim);\n    for (var i = 1; i < ranges.length; i++) {\n      var cur = ranges[i], prev = ranges[i - 1];\n      if (cmp(prev.to(), cur.from()) >= 0) {\n        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\n        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n        if (i <= primIndex) --primIndex;\n        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n      }\n    }\n    return new Selection(ranges, primIndex);\n  }\n\n  function simpleSelection(anchor, head) {\n    return new Selection([new Range(anchor, head || anchor)], 0);\n  }\n\n  // Most of the external API clips given positions to make sure they\n  // actually exist within the document.\n  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}\n  function clipPos(doc, pos) {\n    if (pos.line < doc.first) return Pos(doc.first, 0);\n    var last = doc.first + doc.size - 1;\n    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);\n    return clipToLen(pos, getLine(doc, pos.line).text.length);\n  }\n  function clipToLen(pos, linelen) {\n    var ch = pos.ch;\n    if (ch == null || ch > linelen) return Pos(pos.line, linelen);\n    else if (ch < 0) return Pos(pos.line, 0);\n    else return pos;\n  }\n  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}\n  function clipPosArray(doc, array) {\n    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);\n    return out;\n  }\n\n  // SELECTION UPDATES\n\n  // The 'scroll' parameter given to many of these indicated whether\n  // the new cursor position should be scrolled into view after\n  // modifying the selection.\n\n  // If shift is held or the extend flag is set, extends a range to\n  // include a given position (and optionally a second position).\n  // Otherwise, simply returns the range between the given positions.\n  // Used for cursor motion and such.\n  function extendRange(doc, range, head, other) {\n    if (doc.cm && doc.cm.display.shift || doc.extend) {\n      var anchor = range.anchor;\n      if (other) {\n        var posBefore = cmp(head, anchor) < 0;\n        if (posBefore != (cmp(other, anchor) < 0)) {\n          anchor = head;\n          head = other;\n        } else if (posBefore != (cmp(head, other) < 0)) {\n          head = other;\n        }\n      }\n      return new Range(anchor, head);\n    } else {\n      return new Range(other || head, head);\n    }\n  }\n\n  // Extend the primary selection range, discard the rest.\n  function extendSelection(doc, head, other, options) {\n    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);\n  }\n\n  // Extend all selections (pos is an array of selections with length\n  // equal the number of selections)\n  function extendSelections(doc, heads, options) {\n    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)\n      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);\n    var newSel = normalizeSelection(out, doc.sel.primIndex);\n    setSelection(doc, newSel, options);\n  }\n\n  // Updates a single range in the selection.\n  function replaceOneSelection(doc, i, range, options) {\n    var ranges = doc.sel.ranges.slice(0);\n    ranges[i] = range;\n    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);\n  }\n\n  // Reset the selection to a single range.\n  function setSimpleSelection(doc, anchor, head, options) {\n    setSelection(doc, simpleSelection(anchor, head), options);\n  }\n\n  // Give beforeSelectionChange handlers a change to influence a\n  // selection update.\n  function filterSelectionChange(doc, sel) {\n    var obj = {\n      ranges: sel.ranges,\n      update: function(ranges) {\n        this.ranges = [];\n        for (var i = 0; i < ranges.length; i++)\n          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\n                                     clipPos(doc, ranges[i].head));\n      }\n    };\n    signal(doc, \"beforeSelectionChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj);\n    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);\n    else return sel;\n  }\n\n  function setSelectionReplaceHistory(doc, sel, options) {\n    var done = doc.history.done, last = lst(done);\n    if (last && last.ranges) {\n      done[done.length - 1] = sel;\n      setSelectionNoUndo(doc, sel, options);\n    } else {\n      setSelection(doc, sel, options);\n    }\n  }\n\n  // Set a new selection.\n  function setSelection(doc, sel, options) {\n    setSelectionNoUndo(doc, sel, options);\n    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\n  }\n\n  function setSelectionNoUndo(doc, sel, options) {\n    if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))\n      sel = filterSelectionChange(doc, sel);\n\n    var bias = options && options.bias ||\n      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\n    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\n\n    if (!(options && options.scroll === false) && doc.cm)\n      ensureCursorVisible(doc.cm);\n  }\n\n  function setSelectionInner(doc, sel) {\n    if (sel.equals(doc.sel)) return;\n\n    doc.sel = sel;\n\n    if (doc.cm) {\n      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;\n      signalCursorActivity(doc.cm);\n    }\n    signalLater(doc, \"cursorActivity\", doc);\n  }\n\n  // Verify that the selection does not partially select any atomic\n  // marked ranges.\n  function reCheckSelection(doc) {\n    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);\n  }\n\n  // Return a selection that does not partially select any atomic\n  // ranges.\n  function skipAtomicInSelection(doc, sel, bias, mayClear) {\n    var out;\n    for (var i = 0; i < sel.ranges.length; i++) {\n      var range = sel.ranges[i];\n      var newAnchor = skipAtomic(doc, range.anchor, bias, mayClear);\n      var newHead = skipAtomic(doc, range.head, bias, mayClear);\n      if (out || newAnchor != range.anchor || newHead != range.head) {\n        if (!out) out = sel.ranges.slice(0, i);\n        out[i] = new Range(newAnchor, newHead);\n      }\n    }\n    return out ? normalizeSelection(out, sel.primIndex) : sel;\n  }\n\n  // Ensure a given position is not inside an atomic range.\n  function skipAtomic(doc, pos, bias, mayClear) {\n    var flipped = false, curPos = pos;\n    var dir = bias || 1;\n    doc.cantEdit = false;\n    search: for (;;) {\n      var line = getLine(doc, curPos.line);\n      if (line.markedSpans) {\n        for (var i = 0; i < line.markedSpans.length; ++i) {\n          var sp = line.markedSpans[i], m = sp.marker;\n          if ((sp.from == null || (m.inclusiveLeft ? sp.from <= curPos.ch : sp.from < curPos.ch)) &&\n              (sp.to == null || (m.inclusiveRight ? sp.to >= curPos.ch : sp.to > curPos.ch))) {\n            if (mayClear) {\n              signal(m, \"beforeCursorEnter\");\n              if (m.explicitlyCleared) {\n                if (!line.markedSpans) break;\n                else {--i; continue;}\n              }\n            }\n            if (!m.atomic) continue;\n            var newPos = m.find(dir < 0 ? -1 : 1);\n            if (cmp(newPos, curPos) == 0) {\n              newPos.ch += dir;\n              if (newPos.ch < 0) {\n                if (newPos.line > doc.first) newPos = clipPos(doc, Pos(newPos.line - 1));\n                else newPos = null;\n              } else if (newPos.ch > line.text.length) {\n                if (newPos.line < doc.first + doc.size - 1) newPos = Pos(newPos.line + 1, 0);\n                else newPos = null;\n              }\n              if (!newPos) {\n                if (flipped) {\n                  // Driven in a corner -- no valid cursor position found at all\n                  // -- try again *with* clearing, if we didn't already\n                  if (!mayClear) return skipAtomic(doc, pos, bias, true);\n                  // Otherwise, turn off editing until further notice, and return the start of the doc\n                  doc.cantEdit = true;\n                  return Pos(doc.first, 0);\n                }\n                flipped = true; newPos = pos; dir = -dir;\n              }\n            }\n            curPos = newPos;\n            continue search;\n          }\n        }\n      }\n      return curPos;\n    }\n  }\n\n  // SELECTION DRAWING\n\n  // Redraw the selection and/or cursor\n  function drawSelection(cm) {\n    var display = cm.display, doc = cm.doc, result = {};\n    var curFragment = result.cursors = document.createDocumentFragment();\n    var selFragment = result.selection = document.createDocumentFragment();\n\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      var collapsed = range.empty();\n      if (collapsed || cm.options.showCursorWhenSelecting)\n        drawSelectionCursor(cm, range, curFragment);\n      if (!collapsed)\n        drawSelectionRange(cm, range, selFragment);\n    }\n\n    // Move the hidden textarea near the cursor to prevent scrolling artifacts\n    if (cm.options.moveInputWithCursor) {\n      var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");\n      var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\n      result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\n                                          headPos.top + lineOff.top - wrapOff.top));\n      result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\n                                           headPos.left + lineOff.left - wrapOff.left));\n    }\n\n    return result;\n  }\n\n  function showSelection(cm, drawn) {\n    removeChildrenAndAdd(cm.display.cursorDiv, drawn.cursors);\n    removeChildrenAndAdd(cm.display.selectionDiv, drawn.selection);\n    if (drawn.teTop != null) {\n      cm.display.inputDiv.style.top = drawn.teTop + \"px\";\n      cm.display.inputDiv.style.left = drawn.teLeft + \"px\";\n    }\n  }\n\n  function updateSelection(cm) {\n    showSelection(cm, drawSelection(cm));\n  }\n\n  // Draws a cursor for the given range\n  function drawSelectionCursor(cm, range, output) {\n    var pos = cursorCoords(cm, range.head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);\n\n    var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));\n    cursor.style.left = pos.left + \"px\";\n    cursor.style.top = pos.top + \"px\";\n    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\n\n    if (pos.other) {\n      // Secondary cursor, shown when on a 'jump' in bi-directional text\n      var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));\n      otherCursor.style.display = \"\";\n      otherCursor.style.left = pos.other.left + \"px\";\n      otherCursor.style.top = pos.other.top + \"px\";\n      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\n    }\n  }\n\n  // Draws the given range as a highlighted selection\n  function drawSelectionRange(cm, range, output) {\n    var display = cm.display, doc = cm.doc;\n    var fragment = document.createDocumentFragment();\n    var padding = paddingH(cm.display), leftSide = padding.left, rightSide = display.lineSpace.offsetWidth - padding.right;\n\n    function add(left, top, width, bottom) {\n      if (top < 0) top = 0;\n      top = Math.round(top);\n      bottom = Math.round(bottom);\n      fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", \"position: absolute; left: \" + left +\n                               \"px; top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) +\n                               \"px; height: \" + (bottom - top) + \"px\"));\n    }\n\n    function drawForLine(line, fromArg, toArg) {\n      var lineObj = getLine(doc, line);\n      var lineLen = lineObj.text.length;\n      var start, end;\n      function coords(ch, bias) {\n        return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias);\n      }\n\n      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {\n        var leftPos = coords(from, \"left\"), rightPos, left, right;\n        if (from == to) {\n          rightPos = leftPos;\n          left = right = leftPos.left;\n        } else {\n          rightPos = coords(to - 1, \"right\");\n          if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\n          left = leftPos.left;\n          right = rightPos.right;\n        }\n        if (fromArg == null && from == 0) left = leftSide;\n        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\n          add(left, leftPos.top, null, leftPos.bottom);\n          left = leftSide;\n          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);\n        }\n        if (toArg == null && to == lineLen) right = rightSide;\n        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\n          start = leftPos;\n        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\n          end = rightPos;\n        if (left < leftSide + 1) left = leftSide;\n        add(left, rightPos.top, right - left, rightPos.bottom);\n      });\n      return {start: start, end: end};\n    }\n\n    var sFrom = range.from(), sTo = range.to();\n    if (sFrom.line == sTo.line) {\n      drawForLine(sFrom.line, sFrom.ch, sTo.ch);\n    } else {\n      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\n      var singleVLine = visualLine(fromLine) == visualLine(toLine);\n      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\n      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\n      if (singleVLine) {\n        if (leftEnd.top < rightStart.top - 2) {\n          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\n          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\n        } else {\n          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\n        }\n      }\n      if (leftEnd.bottom < rightStart.top)\n        add(leftSide, leftEnd.bottom, null, rightStart.top);\n    }\n\n    output.appendChild(fragment);\n  }\n\n  // Cursor-blinking\n  function restartBlink(cm) {\n    if (!cm.state.focused) return;\n    var display = cm.display;\n    clearInterval(display.blinker);\n    var on = true;\n    display.cursorDiv.style.visibility = \"\";\n    if (cm.options.cursorBlinkRate > 0)\n      display.blinker = setInterval(function() {\n        display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\";\n      }, cm.options.cursorBlinkRate);\n    else if (cm.options.cursorBlinkRate < 0)\n      display.cursorDiv.style.visibility = \"hidden\";\n  }\n\n  // HIGHLIGHT WORKER\n\n  function startWorker(cm, time) {\n    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)\n      cm.state.highlight.set(time, bind(highlightWorker, cm));\n  }\n\n  function highlightWorker(cm) {\n    var doc = cm.doc;\n    if (doc.frontier < doc.first) doc.frontier = doc.first;\n    if (doc.frontier >= cm.display.viewTo) return;\n    var end = +new Date + cm.options.workTime;\n    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\n    var changedLines = [];\n\n    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {\n      if (doc.frontier >= cm.display.viewFrom) { // Visible\n        var oldStyles = line.styles;\n        var highlighted = highlightLine(cm, line, state, true);\n        line.styles = highlighted.styles;\n        var oldCls = line.styleClasses, newCls = highlighted.classes;\n        if (newCls) line.styleClasses = newCls;\n        else if (oldCls) line.styleClasses = null;\n        var ischange = !oldStyles || oldStyles.length != line.styles.length ||\n          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\n        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];\n        if (ischange) changedLines.push(doc.frontier);\n        line.stateAfter = copyState(doc.mode, state);\n      } else {\n        processLine(cm, line.text, state);\n        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\n      }\n      ++doc.frontier;\n      if (+new Date > end) {\n        startWorker(cm, cm.options.workDelay);\n        return true;\n      }\n    });\n    if (changedLines.length) runInOp(cm, function() {\n      for (var i = 0; i < changedLines.length; i++)\n        regLineChange(cm, changedLines[i], \"text\");\n    });\n  }\n\n  // Finds the line to start with when starting a parse. Tries to\n  // find a line with a stateAfter, so that it can start with a\n  // valid state. If that fails, it returns the line with the\n  // smallest indentation, which tends to need the least context to\n  // parse correctly.\n  function findStartLine(cm, n, precise) {\n    var minindent, minline, doc = cm.doc;\n    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\n    for (var search = n; search > lim; --search) {\n      if (search <= doc.first) return doc.first;\n      var line = getLine(doc, search - 1);\n      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;\n      var indented = countColumn(line.text, null, cm.options.tabSize);\n      if (minline == null || minindent > indented) {\n        minline = search - 1;\n        minindent = indented;\n      }\n    }\n    return minline;\n  }\n\n  function getStateBefore(cm, n, precise) {\n    var doc = cm.doc, display = cm.display;\n    if (!doc.mode.startState) return true;\n    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\n    if (!state) state = startState(doc.mode);\n    else state = copyState(doc.mode, state);\n    doc.iter(pos, n, function(line) {\n      processLine(cm, line.text, state);\n      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;\n      line.stateAfter = save ? copyState(doc.mode, state) : null;\n      ++pos;\n    });\n    if (precise) doc.frontier = pos;\n    return state;\n  }\n\n  // POSITION MEASUREMENT\n\n  function paddingTop(display) {return display.lineSpace.offsetTop;}\n  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}\n  function paddingH(display) {\n    if (display.cachedPaddingH) return display.cachedPaddingH;\n    var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\"));\n    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\n    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\n    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;\n    return data;\n  }\n\n  // Ensure the lineView.wrapping.heights array is populated. This is\n  // an array of bottom offsets for the lines that make up a drawn\n  // line. When lineWrapping is on, there might be more than one\n  // height.\n  function ensureLineHeights(cm, lineView, rect) {\n    var wrapping = cm.options.lineWrapping;\n    var curWidth = wrapping && cm.display.scroller.clientWidth;\n    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\n      var heights = lineView.measure.heights = [];\n      if (wrapping) {\n        lineView.measure.width = curWidth;\n        var rects = lineView.text.firstChild.getClientRects();\n        for (var i = 0; i < rects.length - 1; i++) {\n          var cur = rects[i], next = rects[i + 1];\n          if (Math.abs(cur.bottom - next.bottom) > 2)\n            heights.push((cur.bottom + next.top) / 2 - rect.top);\n        }\n      }\n      heights.push(rect.bottom - rect.top);\n    }\n  }\n\n  // Find a line map (mapping character offsets to text nodes) and a\n  // measurement cache for the given line number. (A line view might\n  // contain multiple lines when collapsed ranges are present.)\n  function mapFromLineView(lineView, line, lineN) {\n    if (lineView.line == line)\n      return {map: lineView.measure.map, cache: lineView.measure.cache};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineView.rest[i] == line)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};\n    for (var i = 0; i < lineView.rest.length; i++)\n      if (lineNo(lineView.rest[i]) > lineN)\n        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};\n  }\n\n  // Render a line into the hidden node display.externalMeasured. Used\n  // when measurement is needed for a line that's not in the viewport.\n  function updateExternalMeasurement(cm, line) {\n    line = visualLine(line);\n    var lineN = lineNo(line);\n    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\n    view.lineN = lineN;\n    var built = view.built = buildLineContent(cm, view);\n    view.text = built.pre;\n    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\n    return view;\n  }\n\n  // Get a {top, bottom, left, right} box (in line-local coordinates)\n  // for a given character.\n  function measureChar(cm, line, ch, bias) {\n    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);\n  }\n\n  // Find a line view that corresponds to the given line number.\n  function findViewForLine(cm, lineN) {\n    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\n      return cm.display.view[findViewIndex(cm, lineN)];\n    var ext = cm.display.externalMeasured;\n    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\n      return ext;\n  }\n\n  // Measurement can be split in two steps, the set-up work that\n  // applies to the whole line, and the measurement of the actual\n  // character. Functions like coordsChar, that need to do a lot of\n  // measurements in a row, can thus ensure that the set-up work is\n  // only done once.\n  function prepareMeasureForLine(cm, line) {\n    var lineN = lineNo(line);\n    var view = findViewForLine(cm, lineN);\n    if (view && !view.text)\n      view = null;\n    else if (view && view.changes)\n      updateLineForChanges(cm, view, lineN, getDimensions(cm));\n    if (!view)\n      view = updateExternalMeasurement(cm, line);\n\n    var info = mapFromLineView(view, line, lineN);\n    return {\n      line: line, view: view, rect: null,\n      map: info.map, cache: info.cache, before: info.before,\n      hasHeights: false\n    };\n  }\n\n  // Given a prepared measurement object, measures the position of an\n  // actual character (or fetches it from the cache).\n  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\n    if (prepared.before) ch = -1;\n    var key = ch + (bias || \"\"), found;\n    if (prepared.cache.hasOwnProperty(key)) {\n      found = prepared.cache[key];\n    } else {\n      if (!prepared.rect)\n        prepared.rect = prepared.view.text.getBoundingClientRect();\n      if (!prepared.hasHeights) {\n        ensureLineHeights(cm, prepared.view, prepared.rect);\n        prepared.hasHeights = true;\n      }\n      found = measureCharInner(cm, prepared, ch, bias);\n      if (!found.bogus) prepared.cache[key] = found;\n    }\n    return {left: found.left, right: found.right,\n            top: varHeight ? found.rtop : found.top,\n            bottom: varHeight ? found.rbottom : found.bottom};\n  }\n\n  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\n\n  function measureCharInner(cm, prepared, ch, bias) {\n    var map = prepared.map;\n\n    var node, start, end, collapse;\n    // First, search the line map for the text node corresponding to,\n    // or closest to, the target character.\n    for (var i = 0; i < map.length; i += 3) {\n      var mStart = map[i], mEnd = map[i + 1];\n      if (ch < mStart) {\n        start = 0; end = 1;\n        collapse = \"left\";\n      } else if (ch < mEnd) {\n        start = ch - mStart;\n        end = start + 1;\n      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {\n        end = mEnd - mStart;\n        start = end - 1;\n        if (ch >= mEnd) collapse = \"right\";\n      }\n      if (start != null) {\n        node = map[i + 2];\n        if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))\n          collapse = bias;\n        if (bias == \"left\" && start == 0)\n          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {\n            node = map[(i -= 3) + 2];\n            collapse = \"left\";\n          }\n        if (bias == \"right\" && start == mEnd - mStart)\n          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {\n            node = map[(i += 3) + 2];\n            collapse = \"right\";\n          }\n        break;\n      }\n    }\n\n    var rect;\n    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\n      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned\n        while (start && isExtendingChar(prepared.line.text.charAt(mStart + start))) --start;\n        while (mStart + end < mEnd && isExtendingChar(prepared.line.text.charAt(mStart + end))) ++end;\n        if (ie && ie_version < 9 && start == 0 && end == mEnd - mStart) {\n          rect = node.parentNode.getBoundingClientRect();\n        } else if (ie && cm.options.lineWrapping) {\n          var rects = range(node, start, end).getClientRects();\n          if (rects.length)\n            rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n          else\n            rect = nullRect;\n        } else {\n          rect = range(node, start, end).getBoundingClientRect() || nullRect;\n        }\n        if (rect.left || rect.right || start == 0) break;\n        end = start;\n        start = start - 1;\n        collapse = \"right\";\n      }\n      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);\n    } else { // If it is a widget, simply get the box for the whole widget.\n      if (start > 0) collapse = bias = \"right\";\n      var rects;\n      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\n        rect = rects[bias == \"right\" ? rects.length - 1 : 0];\n      else\n        rect = node.getBoundingClientRect();\n    }\n    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\n      var rSpan = node.parentNode.getClientRects()[0];\n      if (rSpan)\n        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};\n      else\n        rect = nullRect;\n    }\n\n    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\n    var mid = (rtop + rbot) / 2;\n    var heights = prepared.view.measure.heights;\n    for (var i = 0; i < heights.length - 1; i++)\n      if (mid < heights[i]) break;\n    var top = i ? heights[i - 1] : 0, bot = heights[i];\n    var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,\n                  right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,\n                  top: top, bottom: bot};\n    if (!rect.left && !rect.right) result.bogus = true;\n    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\n\n    return result;\n  }\n\n  // Work around problem with bounding client rects on ranges being\n  // returned incorrectly when zoomed on IE10 and below.\n  function maybeUpdateRectForZooming(measure, rect) {\n    if (!window.screen || screen.logicalXDPI == null ||\n        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\n      return rect;\n    var scaleX = screen.logicalXDPI / screen.deviceXDPI;\n    var scaleY = screen.logicalYDPI / screen.deviceYDPI;\n    return {left: rect.left * scaleX, right: rect.right * scaleX,\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY};\n  }\n\n  function clearLineMeasurementCacheFor(lineView) {\n    if (lineView.measure) {\n      lineView.measure.cache = {};\n      lineView.measure.heights = null;\n      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)\n        lineView.measure.caches[i] = {};\n    }\n  }\n\n  function clearLineMeasurementCache(cm) {\n    cm.display.externalMeasure = null;\n    removeChildren(cm.display.lineMeasure);\n    for (var i = 0; i < cm.display.view.length; i++)\n      clearLineMeasurementCacheFor(cm.display.view[i]);\n  }\n\n  function clearCaches(cm) {\n    clearLineMeasurementCache(cm);\n    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\n    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;\n    cm.display.lineNumChars = null;\n  }\n\n  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }\n  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }\n\n  // Converts a {top, bottom, left, right} box from line-local\n  // coordinates into another coordinate system. Context may be one of\n  // \"line\", \"div\" (display.lineDiv), \"local\"/null (editor), or \"page\".\n  function intoCoordSystem(cm, lineObj, rect, context) {\n    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {\n      var size = widgetHeight(lineObj.widgets[i]);\n      rect.top += size; rect.bottom += size;\n    }\n    if (context == \"line\") return rect;\n    if (!context) context = \"local\";\n    var yOff = heightAtLine(lineObj);\n    if (context == \"local\") yOff += paddingTop(cm.display);\n    else yOff -= cm.display.viewOffset;\n    if (context == \"page\" || context == \"window\") {\n      var lOff = cm.display.lineSpace.getBoundingClientRect();\n      yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\n      var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\n      rect.left += xOff; rect.right += xOff;\n    }\n    rect.top += yOff; rect.bottom += yOff;\n    return rect;\n  }\n\n  // Coverts a box from \"div\" coords to another coordinate system.\n  // Context may be \"window\", \"page\", \"div\", or \"local\"/null.\n  function fromCoordSystem(cm, coords, context) {\n    if (context == \"div\") return coords;\n    var left = coords.left, top = coords.top;\n    // First move into \"page\" coordinate system\n    if (context == \"page\") {\n      left -= pageScrollX();\n      top -= pageScrollY();\n    } else if (context == \"local\" || !context) {\n      var localBox = cm.display.sizer.getBoundingClientRect();\n      left += localBox.left;\n      top += localBox.top;\n    }\n\n    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\n    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};\n  }\n\n  function charCoords(cm, pos, context, lineObj, bias) {\n    if (!lineObj) lineObj = getLine(cm.doc, pos.line);\n    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);\n  }\n\n  // Returns a box for a given cursor position, which may have an\n  // 'other' property containing the position of the secondary cursor\n  // on a bidi boundary.\n  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\n    lineObj = lineObj || getLine(cm.doc, pos.line);\n    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);\n    function get(ch, right) {\n      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);\n      if (right) m.left = m.right; else m.right = m.left;\n      return intoCoordSystem(cm, lineObj, m, context);\n    }\n    function getBidi(ch, partPos) {\n      var part = order[partPos], right = part.level % 2;\n      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {\n        part = order[--partPos];\n        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);\n        right = true;\n      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {\n        part = order[++partPos];\n        ch = bidiLeft(part) - part.level % 2;\n        right = false;\n      }\n      if (right && ch == part.to && ch > part.from) return get(ch - 1);\n      return get(ch, right);\n    }\n    var order = getOrder(lineObj), ch = pos.ch;\n    if (!order) return get(ch);\n    var partPos = getBidiPartAt(order, ch);\n    var val = getBidi(ch, partPos);\n    if (bidiOther != null) val.other = getBidi(ch, bidiOther);\n    return val;\n  }\n\n  // Used to cheaply estimate the coordinates for a position. Used for\n  // intermediate scroll updates.\n  function estimateCoords(cm, pos) {\n    var left = 0, pos = clipPos(cm.doc, pos);\n    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;\n    var lineObj = getLine(cm.doc, pos.line);\n    var top = heightAtLine(lineObj) + paddingTop(cm.display);\n    return {left: left, right: left, top: top, bottom: top + lineObj.height};\n  }\n\n  // Positions returned by coordsChar contain some extra information.\n  // xRel is the relative x position of the input coordinates compared\n  // to the found position (so xRel > 0 means the coordinates are to\n  // the right of the character position, for example). When outside\n  // is true, that means the coordinates lie outside the line's\n  // vertical range.\n  function PosWithInfo(line, ch, outside, xRel) {\n    var pos = Pos(line, ch);\n    pos.xRel = xRel;\n    if (outside) pos.outside = true;\n    return pos;\n  }\n\n  // Compute the character position closest to the given coordinates.\n  // Input must be lineSpace-local (\"div\" coordinate system).\n  function coordsChar(cm, x, y) {\n    var doc = cm.doc;\n    y += cm.display.viewOffset;\n    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);\n    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\n    if (lineN > last)\n      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);\n    if (x < 0) x = 0;\n\n    var lineObj = getLine(doc, lineN);\n    for (;;) {\n      var found = coordsCharInner(cm, lineObj, lineN, x, y);\n      var merged = collapsedSpanAtEnd(lineObj);\n      var mergedPos = merged && merged.find(0, true);\n      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\n        lineN = lineNo(lineObj = mergedPos.to.line);\n      else\n        return found;\n    }\n  }\n\n  function coordsCharInner(cm, lineObj, lineNo, x, y) {\n    var innerOff = y - heightAtLine(lineObj);\n    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;\n    var preparedMeasure = prepareMeasureForLine(cm, lineObj);\n\n    function getX(ch) {\n      var sp = cursorCoords(cm, Pos(lineNo, ch), \"line\", lineObj, preparedMeasure);\n      wrongLine = true;\n      if (innerOff > sp.bottom) return sp.left - adjust;\n      else if (innerOff < sp.top) return sp.left + adjust;\n      else wrongLine = false;\n      return sp.left;\n    }\n\n    var bidi = getOrder(lineObj), dist = lineObj.text.length;\n    var from = lineLeft(lineObj), to = lineRight(lineObj);\n    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;\n\n    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);\n    // Do a binary search between these bounds.\n    for (;;) {\n      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {\n        var ch = x < fromX || x - fromX <= toX - x ? from : to;\n        var xDiff = x - (ch == from ? fromX : toX);\n        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;\n        var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,\n                              xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);\n        return pos;\n      }\n      var step = Math.ceil(dist / 2), middle = from + step;\n      if (bidi) {\n        middle = from;\n        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);\n      }\n      var middleX = getX(middle);\n      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}\n      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}\n    }\n  }\n\n  var measureText;\n  // Compute the default text height.\n  function textHeight(display) {\n    if (display.cachedTextHeight != null) return display.cachedTextHeight;\n    if (measureText == null) {\n      measureText = elt(\"pre\");\n      // Measure a bunch of lines, for browsers that compute\n      // fractional heights.\n      for (var i = 0; i < 49; ++i) {\n        measureText.appendChild(document.createTextNode(\"x\"));\n        measureText.appendChild(elt(\"br\"));\n      }\n      measureText.appendChild(document.createTextNode(\"x\"));\n    }\n    removeChildrenAndAdd(display.measure, measureText);\n    var height = measureText.offsetHeight / 50;\n    if (height > 3) display.cachedTextHeight = height;\n    removeChildren(display.measure);\n    return height || 1;\n  }\n\n  // Compute the default character width.\n  function charWidth(display) {\n    if (display.cachedCharWidth != null) return display.cachedCharWidth;\n    var anchor = elt(\"span\", \"xxxxxxxxxx\");\n    var pre = elt(\"pre\", [anchor]);\n    removeChildrenAndAdd(display.measure, pre);\n    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\n    if (width > 2) display.cachedCharWidth = width;\n    return width || 10;\n  }\n\n  // OPERATIONS\n\n  // Operations are used to wrap a series of changes to the editor\n  // state in such a way that each change won't have to update the\n  // cursor and display (which would be awkward, slow, and\n  // error-prone). Instead, display updates are batched and then all\n  // combined and executed at once.\n\n  var operationGroup = null;\n\n  var nextOpId = 0;\n  // Start a new operation.\n  function startOperation(cm) {\n    cm.curOp = {\n      cm: cm,\n      viewChanged: false,      // Flag that indicates that lines might need to be redrawn\n      startHeight: cm.doc.height, // Used to detect need to update scrollbar\n      forceUpdate: false,      // Used to force a redraw\n      updateInput: null,       // Whether to reset the input textarea\n      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\n      changeObjs: null,        // Accumulated changes, for firing change events\n      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\n      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\n      selectionChanged: false, // Whether the selection needs to be redrawn\n      updateMaxLine: false,    // Set when the widest line needs to be determined anew\n      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\n      scrollToPos: null,       // Used to scroll to a specific position\n      id: ++nextOpId           // Unique ID\n    };\n    if (operationGroup) {\n      operationGroup.ops.push(cm.curOp);\n    } else {\n      cm.curOp.ownsGroup = operationGroup = {\n        ops: [cm.curOp],\n        delayedCallbacks: []\n      };\n    }\n  }\n\n  function fireCallbacksForOps(group) {\n    // Calls delayed callbacks and cursorActivity handlers until no\n    // new ones appear\n    var callbacks = group.delayedCallbacks, i = 0;\n    do {\n      for (; i < callbacks.length; i++)\n        callbacks[i]();\n      for (var j = 0; j < group.ops.length; j++) {\n        var op = group.ops[j];\n        if (op.cursorActivityHandlers)\n          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\n            op.cursorActivityHandlers[op.cursorActivityCalled++](op.cm);\n      }\n    } while (i < callbacks.length);\n  }\n\n  // Finish an operation, updating the display and signalling delayed events\n  function endOperation(cm) {\n    var op = cm.curOp, group = op.ownsGroup;\n    if (!group) return;\n\n    try { fireCallbacksForOps(group); }\n    finally {\n      operationGroup = null;\n      for (var i = 0; i < group.ops.length; i++)\n        group.ops[i].cm.curOp = null;\n      endOperations(group);\n    }\n  }\n\n  // The DOM updates done when an operation finishes are batched so\n  // that the minimum number of relayouts are required.\n  function endOperations(group) {\n    var ops = group.ops;\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W1(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_R2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)\n      endOperation_W2(ops[i]);\n    for (var i = 0; i < ops.length; i++) // Read DOM\n      endOperation_finish(ops[i]);\n  }\n\n  function endOperation_R1(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updateMaxLine) findMaxLine(cm);\n\n    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\n      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\n                         op.scrollToPos.to.line >= display.viewTo) ||\n      display.maxLineChanged && cm.options.lineWrapping;\n    op.update = op.mustUpdate &&\n      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\n  }\n\n  function endOperation_W1(op) {\n    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\n  }\n\n  function endOperation_R2(op) {\n    var cm = op.cm, display = cm.display;\n    if (op.updatedDisplay) updateHeightsInViewport(cm);\n\n    op.barMeasure = measureForScrollbars(cm);\n\n    // If the max line changed since it was last measured, measure it,\n    // and ensure the document's width matches it.\n    // updateDisplay_W2 will use these properties to do the actual resizing\n    if (display.maxLineChanged && !cm.options.lineWrapping) {\n      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\n      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo +\n                                  scrollerCutOff - display.scroller.clientWidth);\n    }\n\n    if (op.updatedDisplay || op.selectionChanged)\n      op.newSelectionNodes = drawSelection(cm);\n  }\n\n  function endOperation_W2(op) {\n    var cm = op.cm;\n\n    if (op.adjustWidthTo != null) {\n      cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";\n      if (op.maxScrollLeft < cm.doc.scrollLeft)\n        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);\n      cm.display.maxLineChanged = false;\n    }\n\n    if (op.newSelectionNodes)\n      showSelection(cm, op.newSelectionNodes);\n    if (op.updatedDisplay)\n      setDocumentHeight(cm, op.barMeasure);\n    if (op.updatedDisplay || op.startHeight != cm.doc.height)\n      updateScrollbars(cm, op.barMeasure);\n\n    if (op.selectionChanged) restartBlink(cm);\n\n    if (cm.state.focused && op.updateInput)\n      resetInput(cm, op.typing);\n  }\n\n  function endOperation_finish(op) {\n    var cm = op.cm, display = cm.display, doc = cm.doc;\n\n    if (op.adjustWidthTo != null && Math.abs(op.barMeasure.scrollWidth - cm.display.scroller.scrollWidth) > 1)\n      updateScrollbars(cm);\n\n    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);\n\n    // Abort mouse wheel delta measurement, when scrolling explicitly\n    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\n      display.wheelStartX = display.wheelStartY = null;\n\n    // Propagate the scroll position to the actual DOM scroller\n    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {\n      var top = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));\n      display.scroller.scrollTop = display.scrollbarV.scrollTop = doc.scrollTop = top;\n    }\n    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {\n      var left = Math.max(0, Math.min(display.scroller.scrollWidth - display.scroller.clientWidth, op.scrollLeft));\n      display.scroller.scrollLeft = display.scrollbarH.scrollLeft = doc.scrollLeft = left;\n      alignHorizontally(cm);\n    }\n    // If we need to scroll a specific position into view, do so.\n    if (op.scrollToPos) {\n      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\n                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\n      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);\n    }\n\n    // Fire events for markers that are hidden/unidden by editing or\n    // undoing\n    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\n    if (hidden) for (var i = 0; i < hidden.length; ++i)\n      if (!hidden[i].lines.length) signal(hidden[i], \"hide\");\n    if (unhidden) for (var i = 0; i < unhidden.length; ++i)\n      if (unhidden[i].lines.length) signal(unhidden[i], \"unhide\");\n\n    if (display.wrapper.offsetHeight)\n      doc.scrollTop = cm.display.scroller.scrollTop;\n\n    // Apply workaround for two webkit bugs\n    if (op.updatedDisplay && webkit) {\n      if (cm.options.lineWrapping)\n        checkForWebkitWidthBug(cm, op.barMeasure); // (Issue #2420)\n      if (op.barMeasure.scrollWidth > op.barMeasure.clientWidth &&\n          op.barMeasure.scrollWidth < op.barMeasure.clientWidth + 1 &&\n          !hScrollbarTakesSpace(cm))\n        updateScrollbars(cm); // (Issue #2562)\n    }\n\n    // Fire change events, and delayed event handlers\n    if (op.changeObjs)\n      signal(cm, \"changes\", cm, op.changeObjs);\n  }\n\n  // Run the given function in an operation\n  function runInOp(cm, f) {\n    if (cm.curOp) return f();\n    startOperation(cm);\n    try { return f(); }\n    finally { endOperation(cm); }\n  }\n  // Wraps a function in an operation. Returns the wrapped function.\n  function operation(cm, f) {\n    return function() {\n      if (cm.curOp) return f.apply(cm, arguments);\n      startOperation(cm);\n      try { return f.apply(cm, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n  // Used to add methods to editor and doc instances, wrapping them in\n  // operations.\n  function methodOp(f) {\n    return function() {\n      if (this.curOp) return f.apply(this, arguments);\n      startOperation(this);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(this); }\n    };\n  }\n  function docMethodOp(f) {\n    return function() {\n      var cm = this.cm;\n      if (!cm || cm.curOp) return f.apply(this, arguments);\n      startOperation(cm);\n      try { return f.apply(this, arguments); }\n      finally { endOperation(cm); }\n    };\n  }\n\n  // VIEW TRACKING\n\n  // These objects are used to represent the visible (currently drawn)\n  // part of the document. A LineView may correspond to multiple\n  // logical lines, if those are connected by collapsed ranges.\n  function LineView(doc, line, lineN) {\n    // The starting line\n    this.line = line;\n    // Continuing lines, if any\n    this.rest = visualLineContinued(line);\n    // Number of logical lines in this visual line\n    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\n    this.node = this.text = null;\n    this.hidden = lineIsHidden(doc, line);\n  }\n\n  // Create a range of LineView objects for the given lines.\n  function buildViewArray(cm, from, to) {\n    var array = [], nextPos;\n    for (var pos = from; pos < to; pos = nextPos) {\n      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\n      nextPos = pos + view.size;\n      array.push(view);\n    }\n    return array;\n  }\n\n  // Updates the display.view data structure for a given change to the\n  // document. From and to are in pre-change coordinates. Lendiff is\n  // the amount of lines added or subtracted by the change. This is\n  // used for changes that span multiple lines, or change the way\n  // lines are divided into visual lines. regLineChange (below)\n  // registers single-line changes.\n  function regChange(cm, from, to, lendiff) {\n    if (from == null) from = cm.doc.first;\n    if (to == null) to = cm.doc.first + cm.doc.size;\n    if (!lendiff) lendiff = 0;\n\n    var display = cm.display;\n    if (lendiff && to < display.viewTo &&\n        (display.updateLineNumbers == null || display.updateLineNumbers > from))\n      display.updateLineNumbers = from;\n\n    cm.curOp.viewChanged = true;\n\n    if (from >= display.viewTo) { // Change after\n      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\n        resetView(cm);\n    } else if (to <= display.viewFrom) { // Change before\n      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\n        resetView(cm);\n      } else {\n        display.viewFrom += lendiff;\n        display.viewTo += lendiff;\n      }\n    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\n      resetView(cm);\n    } else if (from <= display.viewFrom) { // Top overlap\n      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cut) {\n        display.view = display.view.slice(cut.index);\n        display.viewFrom = cut.lineN;\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    } else if (to >= display.viewTo) { // Bottom overlap\n      var cut = viewCuttingPoint(cm, from, from, -1);\n      if (cut) {\n        display.view = display.view.slice(0, cut.index);\n        display.viewTo = cut.lineN;\n      } else {\n        resetView(cm);\n      }\n    } else { // Gap in the middle\n      var cutTop = viewCuttingPoint(cm, from, from, -1);\n      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\n      if (cutTop && cutBot) {\n        display.view = display.view.slice(0, cutTop.index)\n          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\n          .concat(display.view.slice(cutBot.index));\n        display.viewTo += lendiff;\n      } else {\n        resetView(cm);\n      }\n    }\n\n    var ext = display.externalMeasured;\n    if (ext) {\n      if (to < ext.lineN)\n        ext.lineN += lendiff;\n      else if (from < ext.lineN + ext.size)\n        display.externalMeasured = null;\n    }\n  }\n\n  // Register a change to a single line. Type must be one of \"text\",\n  // \"gutter\", \"class\", \"widget\"\n  function regLineChange(cm, line, type) {\n    cm.curOp.viewChanged = true;\n    var display = cm.display, ext = cm.display.externalMeasured;\n    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\n      display.externalMeasured = null;\n\n    if (line < display.viewFrom || line >= display.viewTo) return;\n    var lineView = display.view[findViewIndex(cm, line)];\n    if (lineView.node == null) return;\n    var arr = lineView.changes || (lineView.changes = []);\n    if (indexOf(arr, type) == -1) arr.push(type);\n  }\n\n  // Clear the view.\n  function resetView(cm) {\n    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\n    cm.display.view = [];\n    cm.display.viewOffset = 0;\n  }\n\n  // Find the view element corresponding to a given line. Return null\n  // when the line isn't visible.\n  function findViewIndex(cm, n) {\n    if (n >= cm.display.viewTo) return null;\n    n -= cm.display.viewFrom;\n    if (n < 0) return null;\n    var view = cm.display.view;\n    for (var i = 0; i < view.length; i++) {\n      n -= view[i].size;\n      if (n < 0) return i;\n    }\n  }\n\n  function viewCuttingPoint(cm, oldN, newN, dir) {\n    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\n    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\n      return {index: index, lineN: newN};\n    for (var i = 0, n = cm.display.viewFrom; i < index; i++)\n      n += view[i].size;\n    if (n != oldN) {\n      if (dir > 0) {\n        if (index == view.length - 1) return null;\n        diff = (n + view[index].size) - oldN;\n        index++;\n      } else {\n        diff = n - oldN;\n      }\n      oldN += diff; newN += diff;\n    }\n    while (visualLineNo(cm.doc, newN) != newN) {\n      if (index == (dir < 0 ? 0 : view.length - 1)) return null;\n      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\n      index += dir;\n    }\n    return {index: index, lineN: newN};\n  }\n\n  // Force the view to cover a given range, adding empty view element\n  // or clipping off existing ones as needed.\n  function adjustView(cm, from, to) {\n    var display = cm.display, view = display.view;\n    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\n      display.view = buildViewArray(cm, from, to);\n      display.viewFrom = from;\n    } else {\n      if (display.viewFrom > from)\n        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);\n      else if (display.viewFrom < from)\n        display.view = display.view.slice(findViewIndex(cm, from));\n      display.viewFrom = from;\n      if (display.viewTo < to)\n        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));\n      else if (display.viewTo > to)\n        display.view = display.view.slice(0, findViewIndex(cm, to));\n    }\n    display.viewTo = to;\n  }\n\n  // Count the number of lines in the view whose DOM representation is\n  // out of date (or nonexistent).\n  function countDirtyView(cm) {\n    var view = cm.display.view, dirty = 0;\n    for (var i = 0; i < view.length; i++) {\n      var lineView = view[i];\n      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;\n    }\n    return dirty;\n  }\n\n  // INPUT HANDLING\n\n  // Poll for input changes, using the normal rate of polling. This\n  // runs as long as the editor is focused.\n  function slowPoll(cm) {\n    if (cm.display.pollingFast) return;\n    cm.display.poll.set(cm.options.pollInterval, function() {\n      readInput(cm);\n      if (cm.state.focused) slowPoll(cm);\n    });\n  }\n\n  // When an event has just come in that is likely to add or change\n  // something in the input textarea, we poll faster, to ensure that\n  // the change appears on the screen quickly.\n  function fastPoll(cm) {\n    var missed = false;\n    cm.display.pollingFast = true;\n    function p() {\n      var changed = readInput(cm);\n      if (!changed && !missed) {missed = true; cm.display.poll.set(60, p);}\n      else {cm.display.pollingFast = false; slowPoll(cm);}\n    }\n    cm.display.poll.set(20, p);\n  }\n\n  // This will be set to an array of strings when copying, so that,\n  // when pasting, we know what kind of selections the copied text\n  // was made out of.\n  var lastCopied = null;\n\n  // Read input from the textarea, and update the document to match.\n  // When something is selected, it is present in the textarea, and\n  // selected (unless it is huge, in which case a placeholder is\n  // used). When nothing is selected, the cursor sits after previously\n  // seen text (can be empty), which is stored in prevInput (we must\n  // not reset the textarea when typing, because that breaks IME).\n  function readInput(cm) {\n    var input = cm.display.input, prevInput = cm.display.prevInput, doc = cm.doc;\n    // Since this is called a *lot*, try to bail out as cheaply as\n    // possible when it is clear that nothing happened. hasSelection\n    // will be the case when there is a lot of text in the textarea,\n    // in which case reading its value would be expensive.\n    if (!cm.state.focused || (hasSelection(input) && !prevInput) || isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)\n      return false;\n    // See paste handler for more on the fakedLastChar kludge\n    if (cm.state.pasteIncoming && cm.state.fakedLastChar) {\n      input.value = input.value.substring(0, input.value.length - 1);\n      cm.state.fakedLastChar = false;\n    }\n    var text = input.value;\n    // If nothing changed, bail.\n    if (text == prevInput && !cm.somethingSelected()) return false;\n    // Work around nonsensical selection resetting in IE9/10, and\n    // inexplicable appearance of private area unicode characters on\n    // some key combos in Mac (#2689).\n    if (ie && ie_version >= 9 && cm.display.inputHasSelection === text ||\n        mac && /[\\uf700-\\uf7ff]/.test(text)) {\n      resetInput(cm);\n      return false;\n    }\n\n    var withOp = !cm.curOp;\n    if (withOp) startOperation(cm);\n    cm.display.shift = false;\n\n    if (text.charCodeAt(0) == 0x200b && doc.sel == cm.display.selForContextMenu && !prevInput)\n      prevInput = \"\\u200b\";\n    // Find the part of the input that is actually new\n    var same = 0, l = Math.min(prevInput.length, text.length);\n    while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;\n    var inserted = text.slice(same), textLines = splitLines(inserted);\n\n    // When pasing N lines into N selections, insert one line per selection\n    var multiPaste = null;\n    if (cm.state.pasteIncoming && doc.sel.ranges.length > 1) {\n      if (lastCopied && lastCopied.join(\"\\n\") == inserted)\n        multiPaste = doc.sel.ranges.length % lastCopied.length == 0 && map(lastCopied, splitLines);\n      else if (textLines.length == doc.sel.ranges.length)\n        multiPaste = map(textLines, function(l) { return [l]; });\n    }\n\n    // Normal behavior is to insert the new text into every selection\n    for (var i = doc.sel.ranges.length - 1; i >= 0; i--) {\n      var range = doc.sel.ranges[i];\n      var from = range.from(), to = range.to();\n      // Handle deletion\n      if (same < prevInput.length)\n        from = Pos(from.line, from.ch - (prevInput.length - same));\n      // Handle overwrite\n      else if (cm.state.overwrite && range.empty() && !cm.state.pasteIncoming)\n        to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));\n      var updateInput = cm.curOp.updateInput;\n      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,\n                         origin: cm.state.pasteIncoming ? \"paste\" : cm.state.cutIncoming ? \"cut\" : \"+input\"};\n      makeChange(cm.doc, changeEvent);\n      signalLater(cm, \"inputRead\", cm, changeEvent);\n      // When an 'electric' character is inserted, immediately trigger a reindent\n      if (inserted && !cm.state.pasteIncoming && cm.options.electricChars &&\n          cm.options.smartIndent && range.head.ch < 100 &&\n          (!i || doc.sel.ranges[i - 1].head.line != range.head.line)) {\n        var mode = cm.getModeAt(range.head);\n        var end = changeEnd(changeEvent);\n        if (mode.electricChars) {\n          for (var j = 0; j < mode.electricChars.length; j++)\n            if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\n              indentLine(cm, end.line, \"smart\");\n              break;\n            }\n        } else if (mode.electricInput) {\n          if (mode.electricInput.test(getLine(doc, end.line).text.slice(0, end.ch)))\n            indentLine(cm, end.line, \"smart\");\n        }\n      }\n    }\n    ensureCursorVisible(cm);\n    cm.curOp.updateInput = updateInput;\n    cm.curOp.typing = true;\n\n    // Don't leave long text in the textarea, since it makes further polling slow\n    if (text.length > 1000 || text.indexOf(\"\\n\") > -1) input.value = cm.display.prevInput = \"\";\n    else cm.display.prevInput = text;\n    if (withOp) endOperation(cm);\n    cm.state.pasteIncoming = cm.state.cutIncoming = false;\n    return true;\n  }\n\n  // Reset the input to correspond to the selection (or to be empty,\n  // when not typing and nothing is selected)\n  function resetInput(cm, typing) {\n    var minimal, selected, doc = cm.doc;\n    if (cm.somethingSelected()) {\n      cm.display.prevInput = \"\";\n      var range = doc.sel.primary();\n      minimal = hasCopyEvent &&\n        (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);\n      var content = minimal ? \"-\" : selected || cm.getSelection();\n      cm.display.input.value = content;\n      if (cm.state.focused) selectInput(cm.display.input);\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = content;\n    } else if (!typing) {\n      cm.display.prevInput = cm.display.input.value = \"\";\n      if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    }\n    cm.display.inaccurateSelection = minimal;\n  }\n\n  function focusInput(cm) {\n    if (cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != cm.display.input))\n      cm.display.input.focus();\n  }\n\n  function ensureFocus(cm) {\n    if (!cm.state.focused) { focusInput(cm); onFocus(cm); }\n  }\n\n  function isReadOnly(cm) {\n    return cm.options.readOnly || cm.doc.cantEdit;\n  }\n\n  // EVENT HANDLERS\n\n  // Attach the necessary event handlers when initializing the editor\n  function registerEventHandlers(cm) {\n    var d = cm.display;\n    on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\n    // Older IE's will not fire a second mousedown for a double click\n    if (ie && ie_version < 11)\n      on(d.scroller, \"dblclick\", operation(cm, function(e) {\n        if (signalDOMEvent(cm, e)) return;\n        var pos = posFromMouse(cm, e);\n        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;\n        e_preventDefault(e);\n        var word = cm.findWordAt(pos);\n        extendSelection(cm.doc, word.anchor, word.head);\n      }));\n    else\n      on(d.scroller, \"dblclick\", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });\n    // Prevent normal selection in the editor (we handle our own)\n    on(d.lineSpace, \"selectstart\", function(e) {\n      if (!eventInWidget(d, e)) e_preventDefault(e);\n    });\n    // Some browsers fire contextmenu *after* opening the menu, at\n    // which point we can't mess with it anymore. Context menu is\n    // handled in onMouseDown for these browsers.\n    if (!captureRightClick) on(d.scroller, \"contextmenu\", function(e) {onContextMenu(cm, e);});\n\n    // Sync scrolling between fake scrollbars and real scrollable\n    // area, ensure viewport is updated when scrolling.\n    on(d.scroller, \"scroll\", function() {\n      if (d.scroller.clientHeight) {\n        setScrollTop(cm, d.scroller.scrollTop);\n        setScrollLeft(cm, d.scroller.scrollLeft, true);\n        signal(cm, \"scroll\", cm);\n      }\n    });\n    on(d.scrollbarV, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollTop(cm, d.scrollbarV.scrollTop);\n    });\n    on(d.scrollbarH, \"scroll\", function() {\n      if (d.scroller.clientHeight) setScrollLeft(cm, d.scrollbarH.scrollLeft);\n    });\n\n    // Listen to wheel events in order to try and update the viewport on time.\n    on(d.scroller, \"mousewheel\", function(e){onScrollWheel(cm, e);});\n    on(d.scroller, \"DOMMouseScroll\", function(e){onScrollWheel(cm, e);});\n\n    // Prevent clicks in the scrollbars from killing focus\n    function reFocus() { if (cm.state.focused) setTimeout(bind(focusInput, cm), 0); }\n    on(d.scrollbarH, \"mousedown\", reFocus);\n    on(d.scrollbarV, \"mousedown\", reFocus);\n    // Prevent wrapper from ever scrolling\n    on(d.wrapper, \"scroll\", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\n\n    on(d.input, \"keyup\", function(e) { onKeyUp.call(cm, e); });\n    on(d.input, \"input\", function() {\n      if (ie && ie_version >= 9 && cm.display.inputHasSelection) cm.display.inputHasSelection = null;\n      fastPoll(cm);\n    });\n    on(d.input, \"keydown\", operation(cm, onKeyDown));\n    on(d.input, \"keypress\", operation(cm, onKeyPress));\n    on(d.input, \"focus\", bind(onFocus, cm));\n    on(d.input, \"blur\", bind(onBlur, cm));\n\n    function drag_(e) {\n      if (!signalDOMEvent(cm, e)) e_stop(e);\n    }\n    if (cm.options.dragDrop) {\n      on(d.scroller, \"dragstart\", function(e){onDragStart(cm, e);});\n      on(d.scroller, \"dragenter\", drag_);\n      on(d.scroller, \"dragover\", drag_);\n      on(d.scroller, \"drop\", operation(cm, onDrop));\n    }\n    on(d.scroller, \"paste\", function(e) {\n      if (eventInWidget(d, e)) return;\n      cm.state.pasteIncoming = true;\n      focusInput(cm);\n      fastPoll(cm);\n    });\n    on(d.input, \"paste\", function() {\n      // Workaround for webkit bug https://bugs.webkit.org/show_bug.cgi?id=90206\n      // Add a char to the end of textarea before paste occur so that\n      // selection doesn't span to the end of textarea.\n      if (webkit && !cm.state.fakedLastChar && !(new Date - cm.state.lastMiddleDown < 200)) {\n        var start = d.input.selectionStart, end = d.input.selectionEnd;\n        d.input.value += \"$\";\n        // The selection end needs to be set before the start, otherwise there\n        // can be an intermediate non-empty selection between the two, which\n        // can override the middle-click paste buffer on linux and cause the\n        // wrong thing to get pasted.\n        d.input.selectionEnd = end;\n        d.input.selectionStart = start;\n        cm.state.fakedLastChar = true;\n      }\n      cm.state.pasteIncoming = true;\n      fastPoll(cm);\n    });\n\n    function prepareCopyCut(e) {\n      if (cm.somethingSelected()) {\n        lastCopied = cm.getSelections();\n        if (d.inaccurateSelection) {\n          d.prevInput = \"\";\n          d.inaccurateSelection = false;\n          d.input.value = lastCopied.join(\"\\n\");\n          selectInput(d.input);\n        }\n      } else {\n        var text = [], ranges = [];\n        for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\n          var line = cm.doc.sel.ranges[i].head.line;\n          var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\n          ranges.push(lineRange);\n          text.push(cm.getRange(lineRange.anchor, lineRange.head));\n        }\n        if (e.type == \"cut\") {\n          cm.setSelections(ranges, null, sel_dontScroll);\n        } else {\n          d.prevInput = \"\";\n          d.input.value = text.join(\"\\n\");\n          selectInput(d.input);\n        }\n        lastCopied = text;\n      }\n      if (e.type == \"cut\") cm.state.cutIncoming = true;\n    }\n    on(d.input, \"cut\", prepareCopyCut);\n    on(d.input, \"copy\", prepareCopyCut);\n\n    // Needed to handle Tab key in KHTML\n    if (khtml) on(d.sizer, \"mouseup\", function() {\n      if (activeElt() == d.input) d.input.blur();\n      focusInput(cm);\n    });\n  }\n\n  // Called when the window resizes\n  function onResize(cm) {\n    var d = cm.display;\n    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)\n      return;\n    // Might be a text scaling operation, clear size caches.\n    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n    cm.setSize();\n  }\n\n  // MOUSE EVENTS\n\n  // Return true when the given mouse event happened in a widget\n  function eventInWidget(display, e) {\n    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\n      if (!n || n.ignoreEvents || n.parentNode == display.sizer && n != display.mover) return true;\n    }\n  }\n\n  // Given a mouse event, find the corresponding position. If liberal\n  // is false, it checks whether a gutter or scrollbar was clicked,\n  // and returns null if it was. forRect is used by rectangular\n  // selections, and tries to estimate a character position even for\n  // coordinates beyond the right of the text.\n  function posFromMouse(cm, e, liberal, forRect) {\n    var display = cm.display;\n    if (!liberal) {\n      var target = e_target(e);\n      if (target == display.scrollbarH || target == display.scrollbarV ||\n          target == display.scrollbarFiller || target == display.gutterFiller) return null;\n    }\n    var x, y, space = display.lineSpace.getBoundingClientRect();\n    // Fails unpredictably on IE[67] when mouse is dragged around quickly.\n    try { x = e.clientX - space.left; y = e.clientY - space.top; }\n    catch (e) { return null; }\n    var coords = coordsChar(cm, x, y), line;\n    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\n      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\n      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\n    }\n    return coords;\n  }\n\n  // A mouse down can be a single click, double click, triple click,\n  // start of selection drag, start of text drag, new cursor\n  // (ctrl-click), rectangle drag (alt-drag), or xwin\n  // middle-click-paste. Or it might be a click on something we should\n  // not interfere with, such as a scrollbar or widget.\n  function onMouseDown(e) {\n    if (signalDOMEvent(this, e)) return;\n    var cm = this, display = cm.display;\n    display.shift = e.shiftKey;\n\n    if (eventInWidget(display, e)) {\n      if (!webkit) {\n        // Briefly turn off draggability, to allow widgets to do\n        // normal dragging things.\n        display.scroller.draggable = false;\n        setTimeout(function(){display.scroller.draggable = true;}, 100);\n      }\n      return;\n    }\n    if (clickInGutter(cm, e)) return;\n    var start = posFromMouse(cm, e);\n    window.focus();\n\n    switch (e_button(e)) {\n    case 1:\n      if (start)\n        leftButtonDown(cm, e, start);\n      else if (e_target(e) == display.scroller)\n        e_preventDefault(e);\n      break;\n    case 2:\n      if (webkit) cm.state.lastMiddleDown = +new Date;\n      if (start) extendSelection(cm.doc, start);\n      setTimeout(bind(focusInput, cm), 20);\n      e_preventDefault(e);\n      break;\n    case 3:\n      if (captureRightClick) onContextMenu(cm, e);\n      break;\n    }\n  }\n\n  var lastClick, lastDoubleClick;\n  function leftButtonDown(cm, e, start) {\n    setTimeout(bind(ensureFocus, cm), 0);\n\n    var now = +new Date, type;\n    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {\n      type = \"triple\";\n    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {\n      type = \"double\";\n      lastDoubleClick = {time: now, pos: start};\n    } else {\n      type = \"single\";\n      lastClick = {time: now, pos: start};\n    }\n\n    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey;\n    if (cm.options.dragDrop && dragAndDrop && !isReadOnly(cm) &&\n        type == \"single\" && sel.contains(start) > -1 && sel.somethingSelected())\n      leftButtonStartDrag(cm, e, start, modifier);\n    else\n      leftButtonSelect(cm, e, start, type, modifier);\n  }\n\n  // Start a text drag. When it ends, see if any dragging actually\n  // happen, and treat as a click if it didn't.\n  function leftButtonStartDrag(cm, e, start, modifier) {\n    var display = cm.display;\n    var dragEnd = operation(cm, function(e2) {\n      if (webkit) display.scroller.draggable = false;\n      cm.state.draggingText = false;\n      off(document, \"mouseup\", dragEnd);\n      off(display.scroller, \"drop\", dragEnd);\n      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {\n        e_preventDefault(e2);\n        if (!modifier)\n          extendSelection(cm.doc, start);\n        focusInput(cm);\n        // Work around unexplainable focus problem in IE9 (#2127)\n        if (ie && ie_version == 9)\n          setTimeout(function() {document.body.focus(); focusInput(cm);}, 20);\n      }\n    });\n    // Let the drag handler handle this.\n    if (webkit) display.scroller.draggable = true;\n    cm.state.draggingText = dragEnd;\n    // IE's approach to draggable\n    if (display.scroller.dragDrop) display.scroller.dragDrop();\n    on(document, \"mouseup\", dragEnd);\n    on(display.scroller, \"drop\", dragEnd);\n  }\n\n  // Normal selection, as opposed to text dragging.\n  function leftButtonSelect(cm, e, start, type, addNew) {\n    var display = cm.display, doc = cm.doc;\n    e_preventDefault(e);\n\n    var ourRange, ourIndex, startSel = doc.sel;\n    if (addNew && !e.shiftKey) {\n      ourIndex = doc.sel.contains(start);\n      if (ourIndex > -1)\n        ourRange = doc.sel.ranges[ourIndex];\n      else\n        ourRange = new Range(start, start);\n    } else {\n      ourRange = doc.sel.primary();\n    }\n\n    if (e.altKey) {\n      type = \"rect\";\n      if (!addNew) ourRange = new Range(start, start);\n      start = posFromMouse(cm, e, true, true);\n      ourIndex = -1;\n    } else if (type == \"double\") {\n      var word = cm.findWordAt(start);\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, word.anchor, word.head);\n      else\n        ourRange = word;\n    } else if (type == \"triple\") {\n      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));\n      if (cm.display.shift || doc.extend)\n        ourRange = extendRange(doc, ourRange, line.anchor, line.head);\n      else\n        ourRange = line;\n    } else {\n      ourRange = extendRange(doc, ourRange, start);\n    }\n\n    if (!addNew) {\n      ourIndex = 0;\n      setSelection(doc, new Selection([ourRange], 0), sel_mouse);\n      startSel = doc.sel;\n    } else if (ourIndex > -1) {\n      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\n    } else {\n      ourIndex = doc.sel.ranges.length;\n      setSelection(doc, normalizeSelection(doc.sel.ranges.concat([ourRange]), ourIndex),\n                   {scroll: false, origin: \"*mouse\"});\n    }\n\n    var lastPos = start;\n    function extendTo(pos) {\n      if (cmp(lastPos, pos) == 0) return;\n      lastPos = pos;\n\n      if (type == \"rect\") {\n        var ranges = [], tabSize = cm.options.tabSize;\n        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\n        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\n        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\n        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\n             line <= end; line++) {\n          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\n          if (left == right)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));\n          else if (text.length > leftPos)\n            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));\n        }\n        if (!ranges.length) ranges.push(new Range(start, start));\n        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\n                     {origin: \"*mouse\", scroll: false});\n        cm.scrollIntoView(pos);\n      } else {\n        var oldRange = ourRange;\n        var anchor = oldRange.anchor, head = pos;\n        if (type != \"single\") {\n          if (type == \"double\")\n            var range = cm.findWordAt(pos);\n          else\n            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));\n          if (cmp(range.anchor, anchor) > 0) {\n            head = range.head;\n            anchor = minPos(oldRange.from(), range.anchor);\n          } else {\n            head = range.anchor;\n            anchor = maxPos(oldRange.to(), range.head);\n          }\n        }\n        var ranges = startSel.ranges.slice(0);\n        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);\n        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);\n      }\n    }\n\n    var editorSize = display.wrapper.getBoundingClientRect();\n    // Used to ensure timeout re-tries don't fire when another extend\n    // happened in the meantime (clearTimeout isn't reliable -- at\n    // least on Chrome, the timeouts still happen even when cleared,\n    // if the clear happens after their scheduled firing time).\n    var counter = 0;\n\n    function extend(e) {\n      var curCount = ++counter;\n      var cur = posFromMouse(cm, e, true, type == \"rect\");\n      if (!cur) return;\n      if (cmp(cur, lastPos) != 0) {\n        ensureFocus(cm);\n        extendTo(cur);\n        var visible = visibleLines(display, doc);\n        if (cur.line >= visible.to || cur.line < visible.from)\n          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);\n      } else {\n        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\n        if (outside) setTimeout(operation(cm, function() {\n          if (counter != curCount) return;\n          display.scroller.scrollTop += outside;\n          extend(e);\n        }), 50);\n      }\n    }\n\n    function done(e) {\n      counter = Infinity;\n      e_preventDefault(e);\n      focusInput(cm);\n      off(document, \"mousemove\", move);\n      off(document, \"mouseup\", up);\n      doc.history.lastSelOrigin = null;\n    }\n\n    var move = operation(cm, function(e) {\n      if (!e_button(e)) done(e);\n      else extend(e);\n    });\n    var up = operation(cm, done);\n    on(document, \"mousemove\", move);\n    on(document, \"mouseup\", up);\n  }\n\n  // Determines whether an event happened in the gutter, and fires the\n  // handlers for the corresponding event.\n  function gutterEvent(cm, e, type, prevent, signalfn) {\n    try { var mX = e.clientX, mY = e.clientY; }\n    catch(e) { return false; }\n    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;\n    if (prevent) e_preventDefault(e);\n\n    var display = cm.display;\n    var lineBox = display.lineDiv.getBoundingClientRect();\n\n    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);\n    mY -= lineBox.top - display.viewOffset;\n\n    for (var i = 0; i < cm.options.gutters.length; ++i) {\n      var g = display.gutters.childNodes[i];\n      if (g && g.getBoundingClientRect().right >= mX) {\n        var line = lineAtHeight(cm.doc, mY);\n        var gutter = cm.options.gutters[i];\n        signalfn(cm, type, cm, line, gutter, e);\n        return e_defaultPrevented(e);\n      }\n    }\n  }\n\n  function clickInGutter(cm, e) {\n    return gutterEvent(cm, e, \"gutterClick\", true, signalLater);\n  }\n\n  // Kludge to work around strange IE behavior where it'll sometimes\n  // re-fire a series of drag-related events right after the drop (#1551)\n  var lastDrop = 0;\n\n  function onDrop(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\n      return;\n    e_preventDefault(e);\n    if (ie) lastDrop = +new Date;\n    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\n    if (!pos || isReadOnly(cm)) return;\n    // Might be a file drop, in which case we simply extract the text\n    // and insert it.\n    if (files && files.length && window.FileReader && window.File) {\n      var n = files.length, text = Array(n), read = 0;\n      var loadFile = function(file, i) {\n        var reader = new FileReader;\n        reader.onload = operation(cm, function() {\n          text[i] = reader.result;\n          if (++read == n) {\n            pos = clipPos(cm.doc, pos);\n            var change = {from: pos, to: pos, text: splitLines(text.join(\"\\n\")), origin: \"paste\"};\n            makeChange(cm.doc, change);\n            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\n          }\n        });\n        reader.readAsText(file);\n      };\n      for (var i = 0; i < n; ++i) loadFile(files[i], i);\n    } else { // Normal drop\n      // Don't do a replace if the drop happened inside of the selected text.\n      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\n        cm.state.draggingText(e);\n        // Ensure the editor is re-focused\n        setTimeout(bind(focusInput, cm), 20);\n        return;\n      }\n      try {\n        var text = e.dataTransfer.getData(\"Text\");\n        if (text) {\n          if (cm.state.draggingText && !(mac ? e.metaKey : e.ctrlKey))\n            var selected = cm.listSelections();\n          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\n          if (selected) for (var i = 0; i < selected.length; ++i)\n            replaceRange(cm.doc, \"\", selected[i].anchor, selected[i].head, \"drag\");\n          cm.replaceSelection(text, \"around\", \"paste\");\n          focusInput(cm);\n        }\n      }\n      catch(e){}\n    }\n  }\n\n  function onDragStart(cm, e) {\n    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }\n    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;\n\n    e.dataTransfer.setData(\"Text\", cm.getSelection());\n\n    // Use dummy image instead of default browsers image.\n    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\n    if (e.dataTransfer.setDragImage && !safari) {\n      var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\n      img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n      if (presto) {\n        img.width = img.height = 1;\n        cm.display.wrapper.appendChild(img);\n        // Force a relayout, or Opera won't use our image for some obscure reason\n        img._top = img.offsetTop;\n      }\n      e.dataTransfer.setDragImage(img, 0, 0);\n      if (presto) img.parentNode.removeChild(img);\n    }\n  }\n\n  // SCROLL EVENTS\n\n  // Sync the scrollable area and scrollbars, ensure the viewport\n  // covers the visible area.\n  function setScrollTop(cm, val) {\n    if (Math.abs(cm.doc.scrollTop - val) < 2) return;\n    cm.doc.scrollTop = val;\n    if (!gecko) updateDisplaySimple(cm, {top: val});\n    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;\n    if (cm.display.scrollbarV.scrollTop != val) cm.display.scrollbarV.scrollTop = val;\n    if (gecko) updateDisplaySimple(cm);\n    startWorker(cm, 100);\n  }\n  // Sync scroller and scrollbar, ensure the gutter elements are\n  // aligned.\n  function setScrollLeft(cm, val, isScroller) {\n    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;\n    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\n    cm.doc.scrollLeft = val;\n    alignHorizontally(cm);\n    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;\n    if (cm.display.scrollbarH.scrollLeft != val) cm.display.scrollbarH.scrollLeft = val;\n  }\n\n  // Since the delta values reported on mouse wheel events are\n  // unstandardized between browsers and even browser versions, and\n  // generally horribly unpredictable, this code starts by measuring\n  // the scroll effect that the first few mouse wheel events have,\n  // and, from that, detects the way it can convert deltas to pixel\n  // offsets afterwards.\n  //\n  // The reason we want to know the amount a wheel event will scroll\n  // is that it gives us a chance to update the display before the\n  // actual scrolling happens, reducing flickering.\n\n  var wheelSamples = 0, wheelPixelsPerUnit = null;\n  // Fill in a browser-detected starting value on browsers where we\n  // know one. These don't have to be accurate -- the result of them\n  // being wrong would just be a slight flicker on the first wheel\n  // scroll (if it is large enough).\n  if (ie) wheelPixelsPerUnit = -.53;\n  else if (gecko) wheelPixelsPerUnit = 15;\n  else if (chrome) wheelPixelsPerUnit = -.7;\n  else if (safari) wheelPixelsPerUnit = -1/3;\n\n  function onScrollWheel(cm, e) {\n    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\n    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;\n    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;\n    else if (dy == null) dy = e.wheelDelta;\n\n    var display = cm.display, scroll = display.scroller;\n    // Quit if there's nothing to scroll here\n    if (!(dx && scroll.scrollWidth > scroll.clientWidth ||\n          dy && scroll.scrollHeight > scroll.clientHeight)) return;\n\n    // Webkit browsers on OS X abort momentum scrolls when the target\n    // of the scroll event is removed from the scrollable element.\n    // This hack (see related code in patchDisplay) makes sure the\n    // element is kept around.\n    if (dy && mac && webkit) {\n      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\n        for (var i = 0; i < view.length; i++) {\n          if (view[i].node == cur) {\n            cm.display.currentWheelTarget = cur;\n            break outer;\n          }\n        }\n      }\n    }\n\n    // On some browsers, horizontal scrolling will cause redraws to\n    // happen before the gutter has been realigned, causing it to\n    // wriggle around in a most unseemly way. When we have an\n    // estimated pixels/delta value, we just handle horizontal\n    // scrolling entirely here. It'll be slightly off from native, but\n    // better than glitching out.\n    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\n      if (dy)\n        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));\n      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));\n      e_preventDefault(e);\n      display.wheelStartX = null; // Abort measurement, if in progress\n      return;\n    }\n\n    // 'Project' the visible viewport to cover the area that is being\n    // scrolled into view (if we know enough to estimate it).\n    if (dy && wheelPixelsPerUnit != null) {\n      var pixels = dy * wheelPixelsPerUnit;\n      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\n      if (pixels < 0) top = Math.max(0, top + pixels - 50);\n      else bot = Math.min(cm.doc.height, bot + pixels + 50);\n      updateDisplaySimple(cm, {top: top, bottom: bot});\n    }\n\n    if (wheelSamples < 20) {\n      if (display.wheelStartX == null) {\n        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\n        display.wheelDX = dx; display.wheelDY = dy;\n        setTimeout(function() {\n          if (display.wheelStartX == null) return;\n          var movedX = scroll.scrollLeft - display.wheelStartX;\n          var movedY = scroll.scrollTop - display.wheelStartY;\n          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\n            (movedX && display.wheelDX && movedX / display.wheelDX);\n          display.wheelStartX = display.wheelStartY = null;\n          if (!sample) return;\n          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\n          ++wheelSamples;\n        }, 200);\n      } else {\n        display.wheelDX += dx; display.wheelDY += dy;\n      }\n    }\n  }\n\n  // KEY EVENTS\n\n  // Run a handler that was bound to a key.\n  function doHandleBinding(cm, bound, dropShift) {\n    if (typeof bound == \"string\") {\n      bound = commands[bound];\n      if (!bound) return false;\n    }\n    // Ensure previous input has been read, so that the handler sees a\n    // consistent view of the document\n    if (cm.display.pollingFast && readInput(cm)) cm.display.pollingFast = false;\n    var prevShift = cm.display.shift, done = false;\n    try {\n      if (isReadOnly(cm)) cm.state.suppressEdits = true;\n      if (dropShift) cm.display.shift = false;\n      done = bound(cm) != Pass;\n    } finally {\n      cm.display.shift = prevShift;\n      cm.state.suppressEdits = false;\n    }\n    return done;\n  }\n\n  function lookupKeyForEditor(cm, name, handle) {\n    for (var i = 0; i < cm.state.keyMaps.length; i++) {\n      var result = lookupKey(name, cm.state.keyMaps[i], handle);\n      if (result) return result;\n    }\n    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle))\n      || lookupKey(name, cm.options.keyMap, handle);\n  }\n\n  var stopSeq = new Delayed;\n  function dispatchKey(cm, name, e, handle) {\n    var seq = cm.state.keySeq;\n    if (seq) {\n      if (isModifierKey(name)) return \"handled\";\n      stopSeq.set(50, function() {\n        if (cm.state.keySeq == seq) {\n          cm.state.keySeq = null;\n          resetInput(cm);\n        }\n      });\n      name = seq + \" \" + name;\n    }\n    var result = lookupKeyForEditor(cm, name, handle);\n\n    if (result == \"multi\")\n      cm.state.keySeq = name;\n    if (result == \"handled\")\n      signalLater(cm, \"keyHandled\", cm, name, e);\n\n    if (result == \"handled\" || result == \"multi\") {\n      e_preventDefault(e);\n      restartBlink(cm);\n    }\n\n    if (seq && !result && /\\'$/.test(name)) {\n      e_preventDefault(e);\n      return true;\n    }\n    return !!result;\n  }\n\n  // Handle a key from the keydown event.\n  function handleKeyBinding(cm, e) {\n    var name = keyName(e, true);\n    if (!name) return false;\n\n    if (e.shiftKey && !cm.state.keySeq) {\n      // First try to resolve full name (including 'Shift-'). Failing\n      // that, see if there is a cursor-motion command (starting with\n      // 'go') bound to the keyname without 'Shift-'.\n      return dispatchKey(cm, \"Shift-\" + name, e, function(b) {return doHandleBinding(cm, b, true);})\n          || dispatchKey(cm, name, e, function(b) {\n               if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\n                 return doHandleBinding(cm, b);\n             });\n    } else {\n      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });\n    }\n  }\n\n  // Handle a key from the keypress event\n  function handleCharBinding(cm, e, ch) {\n    return dispatchKey(cm, \"'\" + ch + \"'\", e,\n                       function(b) { return doHandleBinding(cm, b, true); });\n  }\n\n  var lastStoppedKey = null;\n  function onKeyDown(e) {\n    var cm = this;\n    ensureFocus(cm);\n    if (signalDOMEvent(cm, e)) return;\n    // IE does strange things with escape.\n    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;\n    var code = e.keyCode;\n    cm.display.shift = code == 16 || e.shiftKey;\n    var handled = handleKeyBinding(cm, e);\n    if (presto) {\n      lastStoppedKey = handled ? code : null;\n      // Opera has no cut event... we try to at least catch the key combo\n      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\n        cm.replaceSelection(\"\", null, \"cut\");\n    }\n\n    // Turn mouse into crosshair when Alt is held on Mac.\n    if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\n      showCrossHair(cm);\n  }\n\n  function showCrossHair(cm) {\n    var lineDiv = cm.display.lineDiv;\n    addClass(lineDiv, \"CodeMirror-crosshair\");\n\n    function up(e) {\n      if (e.keyCode == 18 || !e.altKey) {\n        rmClass(lineDiv, \"CodeMirror-crosshair\");\n        off(document, \"keyup\", up);\n        off(document, \"mouseover\", up);\n      }\n    }\n    on(document, \"keyup\", up);\n    on(document, \"mouseover\", up);\n  }\n\n  function onKeyUp(e) {\n    if (e.keyCode == 16) this.doc.sel.shift = false;\n    signalDOMEvent(this, e);\n  }\n\n  function onKeyPress(e) {\n    var cm = this;\n    if (signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;\n    var keyCode = e.keyCode, charCode = e.charCode;\n    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}\n    if (((presto && (!e.which || e.which < 10)) || khtml) && handleKeyBinding(cm, e)) return;\n    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\n    if (handleCharBinding(cm, e, ch)) return;\n    if (ie && ie_version >= 9) cm.display.inputHasSelection = null;\n    fastPoll(cm);\n  }\n\n  // FOCUS/BLUR EVENTS\n\n  function onFocus(cm) {\n    if (cm.options.readOnly == \"nocursor\") return;\n    if (!cm.state.focused) {\n      signal(cm, \"focus\", cm);\n      cm.state.focused = true;\n      addClass(cm.display.wrapper, \"CodeMirror-focused\");\n      // The prevInput test prevents this from firing when a context\n      // menu is closed (since the resetInput would kill the\n      // select-all detection hack)\n      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n        resetInput(cm);\n        if (webkit) setTimeout(bind(resetInput, cm, true), 0); // Issue #1730\n      }\n    }\n    slowPoll(cm);\n    restartBlink(cm);\n  }\n  function onBlur(cm) {\n    if (cm.state.focused) {\n      signal(cm, \"blur\", cm);\n      cm.state.focused = false;\n      rmClass(cm.display.wrapper, \"CodeMirror-focused\");\n    }\n    clearInterval(cm.display.blinker);\n    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);\n  }\n\n  // CONTEXT MENU HANDLING\n\n  // To make the context menu work, we need to briefly unhide the\n  // textarea (making it as unobtrusive as possible) to let the\n  // right-click take effect on it.\n  function onContextMenu(cm, e) {\n    if (signalDOMEvent(cm, e, \"contextmenu\")) return;\n    var display = cm.display;\n    if (eventInWidget(display, e) || contextMenuInGutter(cm, e)) return;\n\n    var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\n    if (!pos || presto) return; // Opera is difficult.\n\n    // Reset the current text selection only if the click is done outside of the selection\n    // and 'resetSelectionOnContextMenu' option is true.\n    var reset = cm.options.resetSelectionOnContextMenu;\n    if (reset && cm.doc.sel.contains(pos) == -1)\n      operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);\n\n    var oldCSS = display.input.style.cssText;\n    display.inputDiv.style.position = \"absolute\";\n    display.input.style.cssText = \"position: fixed; width: 30px; height: 30px; top: \" + (e.clientY - 5) +\n      \"px; left: \" + (e.clientX - 5) + \"px; z-index: 1000; background: \" +\n      (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") +\n      \"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";\n    if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)\n    focusInput(cm);\n    if (webkit) window.scrollTo(null, oldScrollY);\n    resetInput(cm);\n    // Adds \"Select all\" to context menu in FF\n    if (!cm.somethingSelected()) display.input.value = display.prevInput = \" \";\n    display.selForContextMenu = cm.doc.sel;\n    clearTimeout(display.detectingSelectAll);\n\n    // Select-all will be greyed out if there's nothing to select, so\n    // this adds a zero-width space so that we can later check whether\n    // it got selected.\n    function prepareSelectAllHack() {\n      if (display.input.selectionStart != null) {\n        var selected = cm.somethingSelected();\n        var extval = display.input.value = \"\\u200b\" + (selected ? display.input.value : \"\");\n        display.prevInput = selected ? \"\" : \"\\u200b\";\n        display.input.selectionStart = 1; display.input.selectionEnd = extval.length;\n        // Re-set this, in case some other handler touched the\n        // selection in the meantime.\n        display.selForContextMenu = cm.doc.sel;\n      }\n    }\n    function rehide() {\n      display.inputDiv.style.position = \"relative\";\n      display.input.style.cssText = oldCSS;\n      if (ie && ie_version < 9) display.scrollbarV.scrollTop = display.scroller.scrollTop = scrollPos;\n      slowPoll(cm);\n\n      // Try to detect the user choosing select-all\n      if (display.input.selectionStart != null) {\n        if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();\n        var i = 0, poll = function() {\n          if (display.selForContextMenu == cm.doc.sel && display.input.selectionStart == 0)\n            operation(cm, commands.selectAll)(cm);\n          else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);\n          else resetInput(cm);\n        };\n        display.detectingSelectAll = setTimeout(poll, 200);\n      }\n    }\n\n    if (ie && ie_version >= 9) prepareSelectAllHack();\n    if (captureRightClick) {\n      e_stop(e);\n      var mouseup = function() {\n        off(window, \"mouseup\", mouseup);\n        setTimeout(rehide, 20);\n      };\n      on(window, \"mouseup\", mouseup);\n    } else {\n      setTimeout(rehide, 50);\n    }\n  }\n\n  function contextMenuInGutter(cm, e) {\n    if (!hasHandler(cm, \"gutterContextMenu\")) return false;\n    return gutterEvent(cm, e, \"gutterContextMenu\", false, signal);\n  }\n\n  // UPDATING\n\n  // Compute the position of the end of a change (its 'to' property\n  // refers to the pre-change end).\n  var changeEnd = CodeMirror.changeEnd = function(change) {\n    if (!change.text) return change.to;\n    return Pos(change.from.line + change.text.length - 1,\n               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));\n  };\n\n  // Adjust a position to refer to the post-change position of the\n  // same text, or the end of the change if the change covers it.\n  function adjustForChange(pos, change) {\n    if (cmp(pos, change.from) < 0) return pos;\n    if (cmp(pos, change.to) <= 0) return changeEnd(change);\n\n    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\n    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;\n    return Pos(line, ch);\n  }\n\n  function computeSelAfterChange(doc, change) {\n    var out = [];\n    for (var i = 0; i < doc.sel.ranges.length; i++) {\n      var range = doc.sel.ranges[i];\n      out.push(new Range(adjustForChange(range.anchor, change),\n                         adjustForChange(range.head, change)));\n    }\n    return normalizeSelection(out, doc.sel.primIndex);\n  }\n\n  function offsetPos(pos, old, nw) {\n    if (pos.line == old.line)\n      return Pos(nw.line, pos.ch - old.ch + nw.ch);\n    else\n      return Pos(nw.line + (pos.line - old.line), pos.ch);\n  }\n\n  // Used by replaceSelections to allow moving the selection to the\n  // start or around the replaced test. Hint may be \"start\" or \"around\".\n  function computeReplacedSel(doc, changes, hint) {\n    var out = [];\n    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\n    for (var i = 0; i < changes.length; i++) {\n      var change = changes[i];\n      var from = offsetPos(change.from, oldPrev, newPrev);\n      var to = offsetPos(changeEnd(change), oldPrev, newPrev);\n      oldPrev = change.to;\n      newPrev = to;\n      if (hint == \"around\") {\n        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\n        out[i] = new Range(inv ? to : from, inv ? from : to);\n      } else {\n        out[i] = new Range(from, from);\n      }\n    }\n    return new Selection(out, doc.sel.primIndex);\n  }\n\n  // Allow \"beforeChange\" event handlers to influence a change\n  function filterChange(doc, change, update) {\n    var obj = {\n      canceled: false,\n      from: change.from,\n      to: change.to,\n      text: change.text,\n      origin: change.origin,\n      cancel: function() { this.canceled = true; }\n    };\n    if (update) obj.update = function(from, to, text, origin) {\n      if (from) this.from = clipPos(doc, from);\n      if (to) this.to = clipPos(doc, to);\n      if (text) this.text = text;\n      if (origin !== undefined) this.origin = origin;\n    };\n    signal(doc, \"beforeChange\", doc, obj);\n    if (doc.cm) signal(doc.cm, \"beforeChange\", doc.cm, obj);\n\n    if (obj.canceled) return null;\n    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};\n  }\n\n  // Apply a change to a document, and add it to the document's\n  // history, and propagating it to all linked documents.\n  function makeChange(doc, change, ignoreReadOnly) {\n    if (doc.cm) {\n      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);\n      if (doc.cm.state.suppressEdits) return;\n    }\n\n    if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\n      change = filterChange(doc, change, true);\n      if (!change) return;\n    }\n\n    // Possibly split or suppress the update based on the presence\n    // of read-only spans in its range.\n    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n    if (split) {\n      for (var i = split.length - 1; i >= 0; --i)\n        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text});\n    } else {\n      makeChangeInner(doc, change);\n    }\n  }\n\n  function makeChangeInner(doc, change) {\n    if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) return;\n    var selAfter = computeSelAfterChange(doc, change);\n    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n\n    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n    var rebased = [];\n\n    linkedDocs(doc, function(doc, sharedHist) {\n      if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n        rebaseHist(doc.history, change);\n        rebased.push(doc.history);\n      }\n      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\n    });\n  }\n\n  // Revert a change stored in a document's history.\n  function makeChangeFromHistory(doc, type, allowSelectionOnly) {\n    if (doc.cm && doc.cm.state.suppressEdits) return;\n\n    var hist = doc.history, event, selAfter = doc.sel;\n    var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;\n\n    // Verify that there is a useable event (so that ctrl-z won't\n    // needlessly clear selection events)\n    for (var i = 0; i < source.length; i++) {\n      event = source[i];\n      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\n        break;\n    }\n    if (i == source.length) return;\n    hist.lastOrigin = hist.lastSelOrigin = null;\n\n    for (;;) {\n      event = source.pop();\n      if (event.ranges) {\n        pushSelectionToHistory(event, dest);\n        if (allowSelectionOnly && !event.equals(doc.sel)) {\n          setSelection(doc, event, {clearRedo: false});\n          return;\n        }\n        selAfter = event;\n      }\n      else break;\n    }\n\n    // Build up a reverse change object to add to the opposite history\n    // stack (redo when undoing, and vice versa).\n    var antiChanges = [];\n    pushSelectionToHistory(selAfter, dest);\n    dest.push({changes: antiChanges, generation: hist.generation});\n    hist.generation = event.generation || ++hist.maxGeneration;\n\n    var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\n\n    for (var i = event.changes.length - 1; i >= 0; --i) {\n      var change = event.changes[i];\n      change.origin = type;\n      if (filter && !filterChange(doc, change, false)) {\n        source.length = 0;\n        return;\n      }\n\n      antiChanges.push(historyChangeFromChange(doc, change));\n\n      var after = i ? computeSelAfterChange(doc, change) : lst(source);\n      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\n      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});\n      var rebased = [];\n\n      // Propagate to the linked documents\n      linkedDocs(doc, function(doc, sharedHist) {\n        if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n          rebaseHist(doc.history, change);\n          rebased.push(doc.history);\n        }\n        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\n      });\n    }\n  }\n\n  // Sub-views need their line numbers shifted when text is added\n  // above or below them in the parent document.\n  function shiftDoc(doc, distance) {\n    if (distance == 0) return;\n    doc.first += distance;\n    doc.sel = new Selection(map(doc.sel.ranges, function(range) {\n      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),\n                       Pos(range.head.line + distance, range.head.ch));\n    }), doc.sel.primIndex);\n    if (doc.cm) {\n      regChange(doc.cm, doc.first, doc.first - distance, distance);\n      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\n        regLineChange(doc.cm, l, \"gutter\");\n    }\n  }\n\n  // More lower-level change function, handling only a single document\n  // (not linked ones).\n  function makeChangeSingleDoc(doc, change, selAfter, spans) {\n    if (doc.cm && !doc.cm.curOp)\n      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);\n\n    if (change.to.line < doc.first) {\n      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\n      return;\n    }\n    if (change.from.line > doc.lastLine()) return;\n\n    // Clip the change to the size of this doc\n    if (change.from.line < doc.first) {\n      var shift = change.text.length - 1 - (doc.first - change.from.line);\n      shiftDoc(doc, shift);\n      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\n                text: [lst(change.text)], origin: change.origin};\n    }\n    var last = doc.lastLine();\n    if (change.to.line > last) {\n      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\n                text: [change.text[0]], origin: change.origin};\n    }\n\n    change.removed = getBetween(doc, change.from, change.to);\n\n    if (!selAfter) selAfter = computeSelAfterChange(doc, change);\n    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);\n    else updateDoc(doc, change, spans);\n    setSelectionNoUndo(doc, selAfter, sel_dontScroll);\n  }\n\n  // Handle the interaction of a change to a document with the editor\n  // that this document is part of.\n  function makeChangeSingleDocInEditor(cm, change, spans) {\n    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\n\n    var recomputeMaxLength = false, checkWidthStart = from.line;\n    if (!cm.options.lineWrapping) {\n      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\n      doc.iter(checkWidthStart, to.line + 1, function(line) {\n        if (line == display.maxLine) {\n          recomputeMaxLength = true;\n          return true;\n        }\n      });\n    }\n\n    if (doc.sel.contains(change.from, change.to) > -1)\n      signalCursorActivity(cm);\n\n    updateDoc(doc, change, spans, estimateHeight(cm));\n\n    if (!cm.options.lineWrapping) {\n      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {\n        var len = lineLength(line);\n        if (len > display.maxLineLength) {\n          display.maxLine = line;\n          display.maxLineLength = len;\n          display.maxLineChanged = true;\n          recomputeMaxLength = false;\n        }\n      });\n      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;\n    }\n\n    // Adjust frontier, schedule worker\n    doc.frontier = Math.min(doc.frontier, from.line);\n    startWorker(cm, 400);\n\n    var lendiff = change.text.length - (to.line - from.line) - 1;\n    // Remember that these lines changed, for updating the display\n    if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\n      regLineChange(cm, from.line, \"text\");\n    else\n      regChange(cm, from.line, to.line + 1, lendiff);\n\n    var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");\n    if (changeHandler || changesHandler) {\n      var obj = {\n        from: from, to: to,\n        text: change.text,\n        removed: change.removed,\n        origin: change.origin\n      };\n      if (changeHandler) signalLater(cm, \"change\", cm, obj);\n      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);\n    }\n    cm.display.selForContextMenu = null;\n  }\n\n  function replaceRange(doc, code, from, to, origin) {\n    if (!to) to = from;\n    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\n    if (typeof code == \"string\") code = splitLines(code);\n    makeChange(doc, {from: from, to: to, text: code, origin: origin});\n  }\n\n  // SCROLLING THINGS INTO VIEW\n\n  // If an editor sits on the top or bottom of the window, partially\n  // scrolled out of view, this ensures that the cursor is visible.\n  function maybeScrollWindow(cm, coords) {\n    if (signalDOMEvent(cm, \"scrollCursorIntoView\")) return;\n\n    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\n    if (coords.top + box.top < 0) doScroll = true;\n    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;\n    if (doScroll != null && !phantom) {\n      var scrollNode = elt(\"div\", \"\\u200b\", null, \"position: absolute; top: \" +\n                           (coords.top - display.viewOffset - paddingTop(cm.display)) + \"px; height: \" +\n                           (coords.bottom - coords.top + scrollerCutOff) + \"px; left: \" +\n                           coords.left + \"px; width: 2px;\");\n      cm.display.lineSpace.appendChild(scrollNode);\n      scrollNode.scrollIntoView(doScroll);\n      cm.display.lineSpace.removeChild(scrollNode);\n    }\n  }\n\n  // Scroll a given position into view (immediately), verifying that\n  // it actually became visible (as line heights are accurately\n  // measured, the position of something may 'drift' during drawing).\n  function scrollPosIntoView(cm, pos, end, margin) {\n    if (margin == null) margin = 0;\n    for (var limit = 0; limit < 5; limit++) {\n      var changed = false, coords = cursorCoords(cm, pos);\n      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\n      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),\n                                         Math.min(coords.top, endCoords.top) - margin,\n                                         Math.max(coords.left, endCoords.left),\n                                         Math.max(coords.bottom, endCoords.bottom) + margin);\n      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\n      if (scrollPos.scrollTop != null) {\n        setScrollTop(cm, scrollPos.scrollTop);\n        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;\n      }\n      if (scrollPos.scrollLeft != null) {\n        setScrollLeft(cm, scrollPos.scrollLeft);\n        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;\n      }\n      if (!changed) return coords;\n    }\n  }\n\n  // Scroll a given set of coordinates into view (immediately).\n  function scrollIntoView(cm, x1, y1, x2, y2) {\n    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);\n    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);\n    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);\n  }\n\n  // Calculate a new scroll position needed to scroll the given\n  // rectangle into view. Returns an object with scrollTop and\n  // scrollLeft properties. When these are undefined, the\n  // vertical/horizontal position does not need to be adjusted.\n  function calculateScrollPos(cm, x1, y1, x2, y2) {\n    var display = cm.display, snapMargin = textHeight(cm.display);\n    if (y1 < 0) y1 = 0;\n    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\n    var screen = display.scroller.clientHeight - scrollerCutOff, result = {};\n    if (y2 - y1 > screen) y2 = y1 + screen;\n    var docBottom = cm.doc.height + paddingVert(display);\n    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;\n    if (y1 < screentop) {\n      result.scrollTop = atTop ? 0 : y1;\n    } else if (y2 > screentop + screen) {\n      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);\n      if (newTop != screentop) result.scrollTop = newTop;\n    }\n\n    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\n    var screenw = display.scroller.clientWidth - scrollerCutOff - display.gutters.offsetWidth;\n    var tooWide = x2 - x1 > screenw;\n    if (tooWide) x2 = x1 + screenw;\n    if (x1 < 10)\n      result.scrollLeft = 0;\n    else if (x1 < screenleft)\n      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));\n    else if (x2 > screenw + screenleft - 3)\n      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;\n\n    return result;\n  }\n\n  // Store a relative adjustment to the scroll position in the current\n  // operation (to be applied when the operation finishes).\n  function addToScrollPos(cm, left, top) {\n    if (left != null || top != null) resolveScrollToPos(cm);\n    if (left != null)\n      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;\n    if (top != null)\n      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\n  }\n\n  // Make sure that at the end of the operation the current cursor is\n  // shown.\n  function ensureCursorVisible(cm) {\n    resolveScrollToPos(cm);\n    var cur = cm.getCursor(), from = cur, to = cur;\n    if (!cm.options.lineWrapping) {\n      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;\n      to = Pos(cur.line, cur.ch + 1);\n    }\n    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};\n  }\n\n  // When an operation has its scrollToPos property set, and another\n  // scroll action is applied before the end of the operation, this\n  // 'simulates' scrolling that position into view in a cheap way, so\n  // that the effect of intermediate scroll commands is not ignored.\n  function resolveScrollToPos(cm) {\n    var range = cm.curOp.scrollToPos;\n    if (range) {\n      cm.curOp.scrollToPos = null;\n      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);\n      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),\n                                    Math.min(from.top, to.top) - range.margin,\n                                    Math.max(from.right, to.right),\n                                    Math.max(from.bottom, to.bottom) + range.margin);\n      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n    }\n  }\n\n  // API UTILITIES\n\n  // Indent the given line. The how parameter can be \"smart\",\n  // \"add\"/null, \"subtract\", or \"prev\". When aggressive is false\n  // (typically set to true for forced single-line indents), empty\n  // lines are not indented, and places where the mode returns Pass\n  // are left alone.\n  function indentLine(cm, n, how, aggressive) {\n    var doc = cm.doc, state;\n    if (how == null) how = \"add\";\n    if (how == \"smart\") {\n      // Fall back to \"prev\" when the mode doesn't have an indentation\n      // method.\n      if (!doc.mode.indent) how = \"prev\";\n      else state = getStateBefore(cm, n);\n    }\n\n    var tabSize = cm.options.tabSize;\n    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\n    if (line.stateAfter) line.stateAfter = null;\n    var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\n    if (!aggressive && !/\\S/.test(line.text)) {\n      indentation = 0;\n      how = \"not\";\n    } else if (how == \"smart\") {\n      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\n      if (indentation == Pass || indentation > 150) {\n        if (!aggressive) return;\n        how = \"prev\";\n      }\n    }\n    if (how == \"prev\") {\n      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);\n      else indentation = 0;\n    } else if (how == \"add\") {\n      indentation = curSpace + cm.options.indentUnit;\n    } else if (how == \"subtract\") {\n      indentation = curSpace - cm.options.indentUnit;\n    } else if (typeof how == \"number\") {\n      indentation = curSpace + how;\n    }\n    indentation = Math.max(0, indentation);\n\n    var indentString = \"\", pos = 0;\n    if (cm.options.indentWithTabs)\n      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";}\n    if (pos < indentation) indentString += spaceStr(indentation - pos);\n\n    if (indentString != curSpaceString) {\n      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\n    } else {\n      // Ensure that, if the cursor was in the whitespace at the start\n      // of the line, it is moved to the end of that space.\n      for (var i = 0; i < doc.sel.ranges.length; i++) {\n        var range = doc.sel.ranges[i];\n        if (range.head.line == n && range.head.ch < curSpaceString.length) {\n          var pos = Pos(n, curSpaceString.length);\n          replaceOneSelection(doc, i, new Range(pos, pos));\n          break;\n        }\n      }\n    }\n    line.stateAfter = null;\n  }\n\n  // Utility for applying a change to a line by handle or number,\n  // returning the number and optionally registering the line as\n  // changed.\n  function changeLine(doc, handle, changeType, op) {\n    var no = handle, line = handle;\n    if (typeof handle == \"number\") line = getLine(doc, clipLine(doc, handle));\n    else no = lineNo(handle);\n    if (no == null) return null;\n    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);\n    return line;\n  }\n\n  // Helper for deleting text near the selection(s), used to implement\n  // backspace, delete, and similar functionality.\n  function deleteNearSelection(cm, compute) {\n    var ranges = cm.doc.sel.ranges, kill = [];\n    // Build up a set of ranges to kill first, merging overlapping\n    // ranges.\n    for (var i = 0; i < ranges.length; i++) {\n      var toKill = compute(ranges[i]);\n      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\n        var replaced = kill.pop();\n        if (cmp(replaced.from, toKill.from) < 0) {\n          toKill.from = replaced.from;\n          break;\n        }\n      }\n      kill.push(toKill);\n    }\n    // Next, remove those actual ranges.\n    runInOp(cm, function() {\n      for (var i = kill.length - 1; i >= 0; i--)\n        replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\");\n      ensureCursorVisible(cm);\n    });\n  }\n\n  // Used for horizontal relative motion. Dir is -1 or 1 (left or\n  // right), unit can be \"char\", \"column\" (like char, but doesn't\n  // cross line boundaries), \"word\" (across next word), or \"group\" (to\n  // the start of next group of word or non-word-non-whitespace\n  // chars). The visually param controls whether, in right-to-left\n  // text, direction 1 means to move towards the next index in the\n  // string, or towards the character to the right of the current\n  // position. The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosH(doc, pos, dir, unit, visually) {\n    var line = pos.line, ch = pos.ch, origDir = dir;\n    var lineObj = getLine(doc, line);\n    var possible = true;\n    function findNextLine() {\n      var l = line + dir;\n      if (l < doc.first || l >= doc.first + doc.size) return (possible = false);\n      line = l;\n      return lineObj = getLine(doc, l);\n    }\n    function moveOnce(boundToLine) {\n      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);\n      if (next == null) {\n        if (!boundToLine && findNextLine()) {\n          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);\n          else ch = dir < 0 ? lineObj.text.length : 0;\n        } else return (possible = false);\n      } else ch = next;\n      return true;\n    }\n\n    if (unit == \"char\") moveOnce();\n    else if (unit == \"column\") moveOnce(true);\n    else if (unit == \"word\" || unit == \"group\") {\n      var sawType = null, group = unit == \"group\";\n      var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");\n      for (var first = true;; first = false) {\n        if (dir < 0 && !moveOnce(!first)) break;\n        var cur = lineObj.text.charAt(ch) || \"\\n\";\n        var type = isWordChar(cur, helper) ? \"w\"\n          : group && cur == \"\\n\" ? \"n\"\n          : !group || /\\s/.test(cur) ? null\n          : \"p\";\n        if (group && !first && !type) type = \"s\";\n        if (sawType && sawType != type) {\n          if (dir < 0) {dir = 1; moveOnce();}\n          break;\n        }\n\n        if (type) sawType = type;\n        if (dir > 0 && !moveOnce(!first)) break;\n      }\n    }\n    var result = skipAtomic(doc, Pos(line, ch), origDir, true);\n    if (!possible) result.hitSide = true;\n    return result;\n  }\n\n  // For relative vertical movement. Dir may be -1 or 1. Unit can be\n  // \"page\" or \"line\". The resulting position will have a hitSide=true\n  // property if it reached the end of the document.\n  function findPosV(cm, pos, dir, unit) {\n    var doc = cm.doc, x = pos.left, y;\n    if (unit == \"page\") {\n      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\n      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));\n    } else if (unit == \"line\") {\n      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\n    }\n    for (;;) {\n      var target = coordsChar(cm, x, y);\n      if (!target.outside) break;\n      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }\n      y += dir * 5;\n    }\n    return target;\n  }\n\n  // EDITOR METHODS\n\n  // The publicly visible API. Note that methodOp(f) means\n  // 'wrap f in an operation, performed on its `this` parameter'.\n\n  // This is not the complete set of editor methods. Most of the\n  // methods defined on the Doc type are also injected into\n  // CodeMirror.prototype, for backwards compatibility and\n  // convenience.\n\n  CodeMirror.prototype = {\n    constructor: CodeMirror,\n    focus: function(){window.focus(); focusInput(this); fastPoll(this);},\n\n    setOption: function(option, value) {\n      var options = this.options, old = options[option];\n      if (options[option] == value && option != \"mode\") return;\n      options[option] = value;\n      if (optionHandlers.hasOwnProperty(option))\n        operation(this, optionHandlers[option])(this, value, old);\n    },\n\n    getOption: function(option) {return this.options[option];},\n    getDoc: function() {return this.doc;},\n\n    addKeyMap: function(map, bottom) {\n      this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map));\n    },\n    removeKeyMap: function(map) {\n      var maps = this.state.keyMaps;\n      for (var i = 0; i < maps.length; ++i)\n        if (maps[i] == map || maps[i].name == map) {\n          maps.splice(i, 1);\n          return true;\n        }\n    },\n\n    addOverlay: methodOp(function(spec, options) {\n      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\n      if (mode.startState) throw new Error(\"Overlays may not be stateful.\");\n      this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});\n      this.state.modeGen++;\n      regChange(this);\n    }),\n    removeOverlay: methodOp(function(spec) {\n      var overlays = this.state.overlays;\n      for (var i = 0; i < overlays.length; ++i) {\n        var cur = overlays[i].modeSpec;\n        if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\n          overlays.splice(i, 1);\n          this.state.modeGen++;\n          regChange(this);\n          return;\n        }\n      }\n    }),\n\n    indentLine: methodOp(function(n, dir, aggressive) {\n      if (typeof dir != \"string\" && typeof dir != \"number\") {\n        if (dir == null) dir = this.options.smartIndent ? \"smart\" : \"prev\";\n        else dir = dir ? \"add\" : \"subtract\";\n      }\n      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);\n    }),\n    indentSelection: methodOp(function(how) {\n      var ranges = this.doc.sel.ranges, end = -1;\n      for (var i = 0; i < ranges.length; i++) {\n        var range = ranges[i];\n        if (!range.empty()) {\n          var from = range.from(), to = range.to();\n          var start = Math.max(end, from.line);\n          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\n          for (var j = start; j < end; ++j)\n            indentLine(this, j, how);\n          var newRanges = this.doc.sel.ranges;\n          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\n            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);\n        } else if (range.head.line > end) {\n          indentLine(this, range.head.line, how, true);\n          end = range.head.line;\n          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);\n        }\n      }\n    }),\n\n    // Fetch the parser token for a given character. Useful for hacks\n    // that want to inspect the mode state (say, for completion).\n    getTokenAt: function(pos, precise) {\n      return takeToken(this, pos, precise);\n    },\n\n    getLineTokens: function(line, precise) {\n      return takeToken(this, Pos(line), precise, true);\n    },\n\n    getTokenTypeAt: function(pos) {\n      pos = clipPos(this.doc, pos);\n      var styles = getLineStyles(this, getLine(this.doc, pos.line));\n      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\n      var type;\n      if (ch == 0) type = styles[2];\n      else for (;;) {\n        var mid = (before + after) >> 1;\n        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;\n        else if (styles[mid * 2 + 1] < ch) before = mid + 1;\n        else { type = styles[mid * 2 + 2]; break; }\n      }\n      var cut = type ? type.indexOf(\"cm-overlay \") : -1;\n      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);\n    },\n\n    getModeAt: function(pos) {\n      var mode = this.doc.mode;\n      if (!mode.innerMode) return mode;\n      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;\n    },\n\n    getHelper: function(pos, type) {\n      return this.getHelpers(pos, type)[0];\n    },\n\n    getHelpers: function(pos, type) {\n      var found = [];\n      if (!helpers.hasOwnProperty(type)) return helpers;\n      var help = helpers[type], mode = this.getModeAt(pos);\n      if (typeof mode[type] == \"string\") {\n        if (help[mode[type]]) found.push(help[mode[type]]);\n      } else if (mode[type]) {\n        for (var i = 0; i < mode[type].length; i++) {\n          var val = help[mode[type][i]];\n          if (val) found.push(val);\n        }\n      } else if (mode.helperType && help[mode.helperType]) {\n        found.push(help[mode.helperType]);\n      } else if (help[mode.name]) {\n        found.push(help[mode.name]);\n      }\n      for (var i = 0; i < help._global.length; i++) {\n        var cur = help._global[i];\n        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\n          found.push(cur.val);\n      }\n      return found;\n    },\n\n    getStateAfter: function(line, precise) {\n      var doc = this.doc;\n      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\n      return getStateBefore(this, line + 1, precise);\n    },\n\n    cursorCoords: function(start, mode) {\n      var pos, range = this.doc.sel.primary();\n      if (start == null) pos = range.head;\n      else if (typeof start == \"object\") pos = clipPos(this.doc, start);\n      else pos = start ? range.from() : range.to();\n      return cursorCoords(this, pos, mode || \"page\");\n    },\n\n    charCoords: function(pos, mode) {\n      return charCoords(this, clipPos(this.doc, pos), mode || \"page\");\n    },\n\n    coordsChar: function(coords, mode) {\n      coords = fromCoordSystem(this, coords, mode || \"page\");\n      return coordsChar(this, coords.left, coords.top);\n    },\n\n    lineAtHeight: function(height, mode) {\n      height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\n      return lineAtHeight(this.doc, height + this.display.viewOffset);\n    },\n    heightAtLine: function(line, mode) {\n      var end = false, last = this.doc.first + this.doc.size - 1;\n      if (line < this.doc.first) line = this.doc.first;\n      else if (line > last) { line = last; end = true; }\n      var lineObj = getLine(this.doc, line);\n      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\").top +\n        (end ? this.doc.height - heightAtLine(lineObj) : 0);\n    },\n\n    defaultTextHeight: function() { return textHeight(this.display); },\n    defaultCharWidth: function() { return charWidth(this.display); },\n\n    setGutterMarker: methodOp(function(line, gutterID, value) {\n      return changeLine(this.doc, line, \"gutter\", function(line) {\n        var markers = line.gutterMarkers || (line.gutterMarkers = {});\n        markers[gutterID] = value;\n        if (!value && isEmpty(markers)) line.gutterMarkers = null;\n        return true;\n      });\n    }),\n\n    clearGutter: methodOp(function(gutterID) {\n      var cm = this, doc = cm.doc, i = doc.first;\n      doc.iter(function(line) {\n        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\n          line.gutterMarkers[gutterID] = null;\n          regLineChange(cm, i, \"gutter\");\n          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;\n        }\n        ++i;\n      });\n    }),\n\n    addLineWidget: methodOp(function(handle, node, options) {\n      return addLineWidget(this, handle, node, options);\n    }),\n\n    removeLineWidget: function(widget) { widget.clear(); },\n\n    lineInfo: function(line) {\n      if (typeof line == \"number\") {\n        if (!isLine(this.doc, line)) return null;\n        var n = line;\n        line = getLine(this.doc, line);\n        if (!line) return null;\n      } else {\n        var n = lineNo(line);\n        if (n == null) return null;\n      }\n      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\n              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\n              widgets: line.widgets};\n    },\n\n    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},\n\n    addWidget: function(pos, node, scroll, vert, horiz) {\n      var display = this.display;\n      pos = cursorCoords(this, clipPos(this.doc, pos));\n      var top = pos.bottom, left = pos.left;\n      node.style.position = \"absolute\";\n      display.sizer.appendChild(node);\n      if (vert == \"over\") {\n        top = pos.top;\n      } else if (vert == \"above\" || vert == \"near\") {\n        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\n        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\n        // Default to positioning above (if specified and possible); otherwise default to positioning below\n        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\n          top = pos.top - node.offsetHeight;\n        else if (pos.bottom + node.offsetHeight <= vspace)\n          top = pos.bottom;\n        if (left + node.offsetWidth > hspace)\n          left = hspace - node.offsetWidth;\n      }\n      node.style.top = top + \"px\";\n      node.style.left = node.style.right = \"\";\n      if (horiz == \"right\") {\n        left = display.sizer.clientWidth - node.offsetWidth;\n        node.style.right = \"0px\";\n      } else {\n        if (horiz == \"left\") left = 0;\n        else if (horiz == \"middle\") left = (display.sizer.clientWidth - node.offsetWidth) / 2;\n        node.style.left = left + \"px\";\n      }\n      if (scroll)\n        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);\n    },\n\n    triggerOnKeyDown: methodOp(onKeyDown),\n    triggerOnKeyPress: methodOp(onKeyPress),\n    triggerOnKeyUp: onKeyUp,\n\n    execCommand: function(cmd) {\n      if (commands.hasOwnProperty(cmd))\n        return commands[cmd](this);\n    },\n\n    findPosH: function(from, amount, unit, visually) {\n      var dir = 1;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        cur = findPosH(this.doc, cur, dir, unit, visually);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveH: methodOp(function(dir, unit) {\n      var cm = this;\n      cm.extendSelectionsBy(function(range) {\n        if (cm.display.shift || cm.doc.extend || range.empty())\n          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);\n        else\n          return dir < 0 ? range.from() : range.to();\n      }, sel_move);\n    }),\n\n    deleteH: methodOp(function(dir, unit) {\n      var sel = this.doc.sel, doc = this.doc;\n      if (sel.somethingSelected())\n        doc.replaceSelection(\"\", null, \"+delete\");\n      else\n        deleteNearSelection(this, function(range) {\n          var other = findPosH(doc, range.head, dir, unit, false);\n          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};\n        });\n    }),\n\n    findPosV: function(from, amount, unit, goalColumn) {\n      var dir = 1, x = goalColumn;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {\n        var coords = cursorCoords(this, cur, \"div\");\n        if (x == null) x = coords.left;\n        else coords.left = x;\n        cur = findPosV(this, coords, dir, unit);\n        if (cur.hitSide) break;\n      }\n      return cur;\n    },\n\n    moveV: methodOp(function(dir, unit) {\n      var cm = this, doc = this.doc, goals = [];\n      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();\n      doc.extendSelectionsBy(function(range) {\n        if (collapse)\n          return dir < 0 ? range.from() : range.to();\n        var headPos = cursorCoords(cm, range.head, \"div\");\n        if (range.goalColumn != null) headPos.left = range.goalColumn;\n        goals.push(headPos.left);\n        var pos = findPosV(cm, headPos, dir, unit);\n        if (unit == \"page\" && range == doc.sel.primary())\n          addToScrollPos(cm, null, charCoords(cm, pos, \"div\").top - headPos.top);\n        return pos;\n      }, sel_move);\n      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)\n        doc.sel.ranges[i].goalColumn = goals[i];\n    }),\n\n    // Find the word at the given position (as returned by coordsChar).\n    findWordAt: function(pos) {\n      var doc = this.doc, line = getLine(doc, pos.line).text;\n      var start = pos.ch, end = pos.ch;\n      if (line) {\n        var helper = this.getHelper(pos, \"wordChars\");\n        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;\n        var startChar = line.charAt(start);\n        var check = isWordChar(startChar, helper)\n          ? function(ch) { return isWordChar(ch, helper); }\n          : /\\s/.test(startChar) ? function(ch) {return /\\s/.test(ch);}\n          : function(ch) {return !/\\s/.test(ch) && !isWordChar(ch);};\n        while (start > 0 && check(line.charAt(start - 1))) --start;\n        while (end < line.length && check(line.charAt(end))) ++end;\n      }\n      return new Range(Pos(pos.line, start), Pos(pos.line, end));\n    },\n\n    toggleOverwrite: function(value) {\n      if (value != null && value == this.state.overwrite) return;\n      if (this.state.overwrite = !this.state.overwrite)\n        addClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n      else\n        rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\");\n\n      signal(this, \"overwriteToggle\", this, this.state.overwrite);\n    },\n    hasFocus: function() { return activeElt() == this.display.input; },\n\n    scrollTo: methodOp(function(x, y) {\n      if (x != null || y != null) resolveScrollToPos(this);\n      if (x != null) this.curOp.scrollLeft = x;\n      if (y != null) this.curOp.scrollTop = y;\n    }),\n    getScrollInfo: function() {\n      var scroller = this.display.scroller, co = scrollerCutOff;\n      return {left: scroller.scrollLeft, top: scroller.scrollTop,\n              height: scroller.scrollHeight - co, width: scroller.scrollWidth - co,\n              clientHeight: scroller.clientHeight - co, clientWidth: scroller.clientWidth - co};\n    },\n\n    scrollIntoView: methodOp(function(range, margin) {\n      if (range == null) {\n        range = {from: this.doc.sel.primary().head, to: null};\n        if (margin == null) margin = this.options.cursorScrollMargin;\n      } else if (typeof range == \"number\") {\n        range = {from: Pos(range, 0), to: null};\n      } else if (range.from == null) {\n        range = {from: range, to: null};\n      }\n      if (!range.to) range.to = range.from;\n      range.margin = margin || 0;\n\n      if (range.from.line != null) {\n        resolveScrollToPos(this);\n        this.curOp.scrollToPos = range;\n      } else {\n        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),\n                                      Math.min(range.from.top, range.to.top) - range.margin,\n                                      Math.max(range.from.right, range.to.right),\n                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);\n        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);\n      }\n    }),\n\n    setSize: methodOp(function(width, height) {\n      var cm = this;\n      function interpret(val) {\n        return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val;\n      }\n      if (width != null) cm.display.wrapper.style.width = interpret(width);\n      if (height != null) cm.display.wrapper.style.height = interpret(height);\n      if (cm.options.lineWrapping) clearLineMeasurementCache(this);\n      var lineNo = cm.display.viewFrom;\n      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {\n        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)\n          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, \"widget\"); break; }\n        ++lineNo;\n      });\n      cm.curOp.forceUpdate = true;\n      signal(cm, \"refresh\", this);\n    }),\n\n    operation: function(f){return runInOp(this, f);},\n\n    refresh: methodOp(function() {\n      var oldHeight = this.display.cachedTextHeight;\n      regChange(this);\n      this.curOp.forceUpdate = true;\n      clearCaches(this);\n      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);\n      updateGutterSpace(this);\n      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\n        estimateLineHeights(this);\n      signal(this, \"refresh\", this);\n    }),\n\n    swapDoc: methodOp(function(doc) {\n      var old = this.doc;\n      old.cm = null;\n      attachDoc(this, doc);\n      clearCaches(this);\n      resetInput(this);\n      this.scrollTo(doc.scrollLeft, doc.scrollTop);\n      this.curOp.forceScroll = true;\n      signalLater(this, \"swapDoc\", this, old);\n      return old;\n    }),\n\n    getInputField: function(){return this.display.input;},\n    getWrapperElement: function(){return this.display.wrapper;},\n    getScrollerElement: function(){return this.display.scroller;},\n    getGutterElement: function(){return this.display.gutters;}\n  };\n  eventMixin(CodeMirror);\n\n  // OPTION DEFAULTS\n\n  // The default configuration options.\n  var defaults = CodeMirror.defaults = {};\n  // Functions to run when options are changed.\n  var optionHandlers = CodeMirror.optionHandlers = {};\n\n  function option(name, deflt, handle, notOnInit) {\n    CodeMirror.defaults[name] = deflt;\n    if (handle) optionHandlers[name] =\n      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;\n  }\n\n  // Passed to option handlers when there is no old value.\n  var Init = CodeMirror.Init = {toString: function(){return \"CodeMirror.Init\";}};\n\n  // These two are, on init, called from the constructor because they\n  // have to be initialized before the editor can start at all.\n  option(\"value\", \"\", function(cm, val) {\n    cm.setValue(val);\n  }, true);\n  option(\"mode\", null, function(cm, val) {\n    cm.doc.modeOption = val;\n    loadMode(cm);\n  }, true);\n\n  option(\"indentUnit\", 2, loadMode, true);\n  option(\"indentWithTabs\", false);\n  option(\"smartIndent\", true);\n  option(\"tabSize\", 4, function(cm) {\n    resetModeState(cm);\n    clearCaches(cm);\n    regChange(cm);\n  }, true);\n  option(\"specialChars\", /[\\t\\u0000-\\u0019\\u00ad\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function(cm, val) {\n    cm.options.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\n    cm.refresh();\n  }, true);\n  option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);\n  option(\"electricChars\", true);\n  option(\"rtlMoveVisually\", !windows);\n  option(\"wholeLineUpdateBefore\", true);\n\n  option(\"theme\", \"default\", function(cm) {\n    themeChanged(cm);\n    guttersChanged(cm);\n  }, true);\n  option(\"keyMap\", \"default\", function(cm, val, old) {\n    var next = getKeyMap(val);\n    var prev = old != CodeMirror.Init && getKeyMap(old);\n    if (prev && prev.detach) prev.detach(cm, next);\n    if (next.attach) next.attach(cm, prev || null);\n  });\n  option(\"extraKeys\", null);\n\n  option(\"lineWrapping\", false, wrappingChanged, true);\n  option(\"gutters\", [], function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"fixedGutter\", true, function(cm, val) {\n    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\n    cm.refresh();\n  }, true);\n  option(\"coverGutterNextToScrollbar\", false, updateScrollbars, true);\n  option(\"lineNumbers\", false, function(cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"firstLineNumber\", 1, guttersChanged, true);\n  option(\"lineNumberFormatter\", function(integer) {return integer;}, guttersChanged, true);\n  option(\"showCursorWhenSelecting\", false, updateSelection, true);\n\n  option(\"resetSelectionOnContextMenu\", true);\n\n  option(\"readOnly\", false, function(cm, val) {\n    if (val == \"nocursor\") {\n      onBlur(cm);\n      cm.display.input.blur();\n      cm.display.disabled = true;\n    } else {\n      cm.display.disabled = false;\n      if (!val) resetInput(cm);\n    }\n  });\n  option(\"disableInput\", false, function(cm, val) {if (!val) resetInput(cm);}, true);\n  option(\"dragDrop\", true);\n\n  option(\"cursorBlinkRate\", 530);\n  option(\"cursorScrollMargin\", 0);\n  option(\"cursorHeight\", 1, updateSelection, true);\n  option(\"singleCursorHeightPerLine\", true, updateSelection, true);\n  option(\"workTime\", 100);\n  option(\"workDelay\", 100);\n  option(\"flattenSpans\", true, resetModeState, true);\n  option(\"addModeClass\", false, resetModeState, true);\n  option(\"pollInterval\", 100);\n  option(\"undoDepth\", 200, function(cm, val){cm.doc.history.undoDepth = val;});\n  option(\"historyEventDelay\", 1250);\n  option(\"viewportMargin\", 10, function(cm){cm.refresh();}, true);\n  option(\"maxHighlightLength\", 10000, resetModeState, true);\n  option(\"moveInputWithCursor\", true, function(cm, val) {\n    if (!val) cm.display.inputDiv.style.top = cm.display.inputDiv.style.left = 0;\n  });\n\n  option(\"tabindex\", null, function(cm, val) {\n    cm.display.input.tabIndex = val || \"\";\n  });\n  option(\"autofocus\", null);\n\n  // MODE DEFINITION AND QUERYING\n\n  // Known modes, by name and by MIME\n  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};\n\n  // Extra arguments are stored as the mode's dependencies, which is\n  // used by (legacy) mechanisms like loadmode.js to automatically\n  // load a mode. (Preferred mechanism is the require/define calls.)\n  CodeMirror.defineMode = function(name, mode) {\n    if (!CodeMirror.defaults.mode && name != \"null\") CodeMirror.defaults.mode = name;\n    if (arguments.length > 2)\n      mode.dependencies = Array.prototype.slice.call(arguments, 2);\n    modes[name] = mode;\n  };\n\n  CodeMirror.defineMIME = function(mime, spec) {\n    mimeModes[mime] = spec;\n  };\n\n  // Given a MIME type, a {name, ...options} config object, or a name\n  // string, return a mode config object.\n  CodeMirror.resolveMode = function(spec) {\n    if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\n      spec = mimeModes[spec];\n    } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\n      var found = mimeModes[spec.name];\n      if (typeof found == \"string\") found = {name: found};\n      spec = createObj(found, spec);\n      spec.name = found.name;\n    } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\n      return CodeMirror.resolveMode(\"application/xml\");\n    }\n    if (typeof spec == \"string\") return {name: spec};\n    else return spec || {name: \"null\"};\n  };\n\n  // Given a mode spec (anything that resolveMode accepts), find and\n  // initialize an actual mode object.\n  CodeMirror.getMode = function(options, spec) {\n    var spec = CodeMirror.resolveMode(spec);\n    var mfactory = modes[spec.name];\n    if (!mfactory) return CodeMirror.getMode(options, \"text/plain\");\n    var modeObj = mfactory(options, spec);\n    if (modeExtensions.hasOwnProperty(spec.name)) {\n      var exts = modeExtensions[spec.name];\n      for (var prop in exts) {\n        if (!exts.hasOwnProperty(prop)) continue;\n        if (modeObj.hasOwnProperty(prop)) modeObj[\"_\" + prop] = modeObj[prop];\n        modeObj[prop] = exts[prop];\n      }\n    }\n    modeObj.name = spec.name;\n    if (spec.helperType) modeObj.helperType = spec.helperType;\n    if (spec.modeProps) for (var prop in spec.modeProps)\n      modeObj[prop] = spec.modeProps[prop];\n\n    return modeObj;\n  };\n\n  // Minimal default mode.\n  CodeMirror.defineMode(\"null\", function() {\n    return {token: function(stream) {stream.skipToEnd();}};\n  });\n  CodeMirror.defineMIME(\"text/plain\", \"null\");\n\n  // This can be used to attach properties to mode objects from\n  // outside the actual mode definition.\n  var modeExtensions = CodeMirror.modeExtensions = {};\n  CodeMirror.extendMode = function(mode, properties) {\n    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\n    copyObj(properties, exts);\n  };\n\n  // EXTENSIONS\n\n  CodeMirror.defineExtension = function(name, func) {\n    CodeMirror.prototype[name] = func;\n  };\n  CodeMirror.defineDocExtension = function(name, func) {\n    Doc.prototype[name] = func;\n  };\n  CodeMirror.defineOption = option;\n\n  var initHooks = [];\n  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};\n\n  var helpers = CodeMirror.helpers = {};\n  CodeMirror.registerHelper = function(type, name, value) {\n    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};\n    helpers[type][name] = value;\n  };\n  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\n    CodeMirror.registerHelper(type, name, value);\n    helpers[type]._global.push({pred: predicate, val: value});\n  };\n\n  // MODE STATE HANDLING\n\n  // Utility functions for working with state. Exported because nested\n  // modes need to do this for their inner modes.\n\n  var copyState = CodeMirror.copyState = function(mode, state) {\n    if (state === true) return state;\n    if (mode.copyState) return mode.copyState(state);\n    var nstate = {};\n    for (var n in state) {\n      var val = state[n];\n      if (val instanceof Array) val = val.concat([]);\n      nstate[n] = val;\n    }\n    return nstate;\n  };\n\n  var startState = CodeMirror.startState = function(mode, a1, a2) {\n    return mode.startState ? mode.startState(a1, a2) : true;\n  };\n\n  // Given a mode and a state (for that mode), find the inner mode and\n  // state at the position that the state refers to.\n  CodeMirror.innerMode = function(mode, state) {\n    while (mode.innerMode) {\n      var info = mode.innerMode(state);\n      if (!info || info.mode == mode) break;\n      state = info.state;\n      mode = info.mode;\n    }\n    return info || {mode: mode, state: state};\n  };\n\n  // STANDARD COMMANDS\n\n  // Commands are parameter-less actions that can be performed on an\n  // editor, mostly used for keybindings.\n  var commands = CodeMirror.commands = {\n    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},\n    singleSelection: function(cm) {\n      cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll);\n    },\n    killLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        if (range.empty()) {\n          var len = getLine(cm.doc, range.head.line).text.length;\n          if (range.head.ch == len && range.head.line < cm.lastLine())\n            return {from: range.head, to: Pos(range.head.line + 1, 0)};\n          else\n            return {from: range.head, to: Pos(range.head.line, len)};\n        } else {\n          return {from: range.from(), to: range.to()};\n        }\n      });\n    },\n    deleteLine: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0),\n                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};\n      });\n    },\n    delLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        return {from: Pos(range.from().line, 0), to: range.from()};\n      });\n    },\n    delWrappedLineLeft: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");\n        return {from: leftPos, to: range.from()};\n      });\n    },\n    delWrappedLineRight: function(cm) {\n      deleteNearSelection(cm, function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n        return {from: range.from(), to: rightPos };\n      });\n    },\n    undo: function(cm) {cm.undo();},\n    redo: function(cm) {cm.redo();},\n    undoSelection: function(cm) {cm.undoSelection();},\n    redoSelection: function(cm) {cm.redoSelection();},\n    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},\n    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},\n    goLineStart: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },\n                            {origin: \"+move\", bias: 1});\n    },\n    goLineStartSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        return lineStartSmart(cm, range.head);\n      }, {origin: \"+move\", bias: 1});\n    },\n    goLineEnd: function(cm) {\n      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },\n                            {origin: \"+move\", bias: -1});\n    },\n    goLineRight: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeft: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        return cm.coordsChar({left: 0, top: top}, \"div\");\n      }, sel_move);\n    },\n    goLineLeftSmart: function(cm) {\n      cm.extendSelectionsBy(function(range) {\n        var top = cm.charCoords(range.head, \"div\").top + 5;\n        var pos = cm.coordsChar({left: 0, top: top}, \"div\");\n        if (pos.ch < cm.getLine(pos.line).search(/\\S/)) return lineStartSmart(cm, range.head);\n        return pos;\n      }, sel_move);\n    },\n    goLineUp: function(cm) {cm.moveV(-1, \"line\");},\n    goLineDown: function(cm) {cm.moveV(1, \"line\");},\n    goPageUp: function(cm) {cm.moveV(-1, \"page\");},\n    goPageDown: function(cm) {cm.moveV(1, \"page\");},\n    goCharLeft: function(cm) {cm.moveH(-1, \"char\");},\n    goCharRight: function(cm) {cm.moveH(1, \"char\");},\n    goColumnLeft: function(cm) {cm.moveH(-1, \"column\");},\n    goColumnRight: function(cm) {cm.moveH(1, \"column\");},\n    goWordLeft: function(cm) {cm.moveH(-1, \"word\");},\n    goGroupRight: function(cm) {cm.moveH(1, \"group\");},\n    goGroupLeft: function(cm) {cm.moveH(-1, \"group\");},\n    goWordRight: function(cm) {cm.moveH(1, \"word\");},\n    delCharBefore: function(cm) {cm.deleteH(-1, \"char\");},\n    delCharAfter: function(cm) {cm.deleteH(1, \"char\");},\n    delWordBefore: function(cm) {cm.deleteH(-1, \"word\");},\n    delWordAfter: function(cm) {cm.deleteH(1, \"word\");},\n    delGroupBefore: function(cm) {cm.deleteH(-1, \"group\");},\n    delGroupAfter: function(cm) {cm.deleteH(1, \"group\");},\n    indentAuto: function(cm) {cm.indentSelection(\"smart\");},\n    indentMore: function(cm) {cm.indentSelection(\"add\");},\n    indentLess: function(cm) {cm.indentSelection(\"subtract\");},\n    insertTab: function(cm) {cm.replaceSelection(\"\\t\");},\n    insertSoftTab: function(cm) {\n      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\n      for (var i = 0; i < ranges.length; i++) {\n        var pos = ranges[i].from();\n        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\n        spaces.push(new Array(tabSize - col % tabSize + 1).join(\" \"));\n      }\n      cm.replaceSelections(spaces);\n    },\n    defaultTab: function(cm) {\n      if (cm.somethingSelected()) cm.indentSelection(\"add\");\n      else cm.execCommand(\"insertTab\");\n    },\n    transposeChars: function(cm) {\n      runInOp(cm, function() {\n        var ranges = cm.listSelections(), newSel = [];\n        for (var i = 0; i < ranges.length; i++) {\n          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\n          if (line) {\n            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);\n            if (cur.ch > 0) {\n              cur = new Pos(cur.line, cur.ch + 1);\n              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\n                              Pos(cur.line, cur.ch - 2), cur, \"+transpose\");\n            } else if (cur.line > cm.doc.first) {\n              var prev = getLine(cm.doc, cur.line - 1).text;\n              if (prev)\n                cm.replaceRange(line.charAt(0) + \"\\n\" + prev.charAt(prev.length - 1),\n                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), \"+transpose\");\n            }\n          }\n          newSel.push(new Range(cur, cur));\n        }\n        cm.setSelections(newSel);\n      });\n    },\n    newlineAndIndent: function(cm) {\n      runInOp(cm, function() {\n        var len = cm.listSelections().length;\n        for (var i = 0; i < len; i++) {\n          var range = cm.listSelections()[i];\n          cm.replaceRange(\"\\n\", range.anchor, range.head, \"+input\");\n          cm.indentLine(range.from().line + 1, null, true);\n          ensureCursorVisible(cm);\n        }\n      });\n    },\n    toggleOverwrite: function(cm) {cm.toggleOverwrite();}\n  };\n\n\n  // STANDARD KEYMAPS\n\n  var keyMap = CodeMirror.keyMap = {};\n\n  keyMap.basic = {\n    \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\n    \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\n    \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\n    \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\n    \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",\n    \"Esc\": \"singleSelection\"\n  };\n  // Note that the save and find-related commands aren't defined by\n  // default. User code or addons can define them. Unknown commands\n  // are simply ignored.\n  keyMap.pcDefault = {\n    \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\n    \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",\n    \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\n    \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\n    \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\n    \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\n    \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",\n    fallthrough: \"basic\"\n  };\n  // Very basic readline/emacs-style bindings, which are standard on Mac.\n  keyMap.emacsy = {\n    \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\n    \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\n    \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\n    \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\"\n  };\n  keyMap.macDefault = {\n    \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\n    \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\n    \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",\n    \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\n    \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\n    \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",\n    \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",\n    fallthrough: [\"basic\", \"emacsy\"]\n  };\n  keyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\n\n  // KEYMAP DISPATCH\n\n  function normalizeKeyName(name) {\n    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];\n    var alt, ctrl, shift, cmd;\n    for (var i = 0; i < parts.length - 1; i++) {\n      var mod = parts[i];\n      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;\n      else if (/^a(lt)?$/i.test(mod)) alt = true;\n      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;\n      else if (/^s(hift)$/i.test(mod)) shift = true;\n      else throw new Error(\"Unrecognized modifier name: \" + mod);\n    }\n    if (alt) name = \"Alt-\" + name;\n    if (ctrl) name = \"Ctrl-\" + name;\n    if (cmd) name = \"Cmd-\" + name;\n    if (shift) name = \"Shift-\" + name;\n    return name;\n  }\n\n  // This is a kludge to keep keymaps mostly working as raw objects\n  // (backwards compatibility) while at the same time support features\n  // like normalization and multi-stroke key bindings. It compiles a\n  // new normalized keymap, and then updates the old object to reflect\n  // this.\n  CodeMirror.normalizeKeyMap = function(keymap) {\n    var copy = {};\n    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {\n      var value = keymap[keyname];\n      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;\n      if (value == \"...\") { delete keymap[keyname]; continue; }\n\n      var keys = map(keyname.split(\" \"), normalizeKeyName);\n      for (var i = 0; i < keys.length; i++) {\n        var val, name;\n        if (i == keys.length - 1) {\n          name = keyname;\n          val = value;\n        } else {\n          name = keys.slice(0, i + 1).join(\" \");\n          val = \"...\";\n        }\n        var prev = copy[name];\n        if (!prev) copy[name] = val;\n        else if (prev != val) throw new Error(\"Inconsistent bindings for \" + name);\n      }\n      delete keymap[keyname];\n    }\n    for (var prop in copy) keymap[prop] = copy[prop];\n    return keymap;\n  };\n\n  var lookupKey = CodeMirror.lookupKey = function(key, map, handle) {\n    map = getKeyMap(map);\n    var found = map.call ? map.call(key) : map[key];\n    if (found === false) return \"nothing\";\n    if (found === \"...\") return \"multi\";\n    if (found != null && handle(found)) return \"handled\";\n\n    if (map.fallthrough) {\n      if (Object.prototype.toString.call(map.fallthrough) != \"[object Array]\")\n        return lookupKey(key, map.fallthrough, handle);\n      for (var i = 0; i < map.fallthrough.length; i++) {\n        var result = lookupKey(key, map.fallthrough[i], handle);\n        if (result) return result;\n      }\n    }\n  };\n\n  // Modifier key presses don't count as 'real' key presses for the\n  // purpose of keymap fallthrough.\n  var isModifierKey = CodeMirror.isModifierKey = function(value) {\n    var name = typeof value == \"string\" ? value : keyNames[value.keyCode];\n    return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\";\n  };\n\n  // Look up the name of a key as indicated by an event object.\n  var keyName = CodeMirror.keyName = function(event, noShift) {\n    if (presto && event.keyCode == 34 && event[\"char\"]) return false;\n    var base = keyNames[event.keyCode], name = base;\n    if (name == null || event.altGraphKey) return false;\n    if (event.altKey && base != \"Alt\") name = \"Alt-\" + name;\n    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") name = \"Ctrl-\" + name;\n    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Cmd\") name = \"Cmd-\" + name;\n    if (!noShift && event.shiftKey && base != \"Shift\") name = \"Shift-\" + name;\n    return name;\n  };\n\n  function getKeyMap(val) {\n    return typeof val == \"string\" ? keyMap[val] : val;\n  }\n\n  // FROMTEXTAREA\n\n  CodeMirror.fromTextArea = function(textarea, options) {\n    if (!options) options = {};\n    options.value = textarea.value;\n    if (!options.tabindex && textarea.tabindex)\n      options.tabindex = textarea.tabindex;\n    if (!options.placeholder && textarea.placeholder)\n      options.placeholder = textarea.placeholder;\n    // Set autofocus to true if this textarea is focused, or if it has\n    // autofocus and no other element is focused.\n    if (options.autofocus == null) {\n      var hasFocus = activeElt();\n      options.autofocus = hasFocus == textarea ||\n        textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\n    }\n\n    function save() {textarea.value = cm.getValue();}\n    if (textarea.form) {\n      on(textarea.form, \"submit\", save);\n      // Deplorable hack to make the submit method do the right thing.\n      if (!options.leaveSubmitMethodAlone) {\n        var form = textarea.form, realSubmit = form.submit;\n        try {\n          var wrappedSubmit = form.submit = function() {\n            save();\n            form.submit = realSubmit;\n            form.submit();\n            form.submit = wrappedSubmit;\n          };\n        } catch(e) {}\n      }\n    }\n\n    textarea.style.display = \"none\";\n    var cm = CodeMirror(function(node) {\n      textarea.parentNode.insertBefore(node, textarea.nextSibling);\n    }, options);\n    cm.save = save;\n    cm.getTextArea = function() { return textarea; };\n    cm.toTextArea = function() {\n      cm.toTextArea = isNaN; // Prevent this from being ran twice\n      save();\n      textarea.parentNode.removeChild(cm.getWrapperElement());\n      textarea.style.display = \"\";\n      if (textarea.form) {\n        off(textarea.form, \"submit\", save);\n        if (typeof textarea.form.submit == \"function\")\n          textarea.form.submit = realSubmit;\n      }\n    };\n    return cm;\n  };\n\n  // STRING STREAM\n\n  // Fed to the mode parsers, provides helper functions to make\n  // parsers more succinct.\n\n  var StringStream = CodeMirror.StringStream = function(string, tabSize) {\n    this.pos = this.start = 0;\n    this.string = string;\n    this.tabSize = tabSize || 8;\n    this.lastColumnPos = this.lastColumnValue = 0;\n    this.lineStart = 0;\n  };\n\n  StringStream.prototype = {\n    eol: function() {return this.pos >= this.string.length;},\n    sol: function() {return this.pos == this.lineStart;},\n    peek: function() {return this.string.charAt(this.pos) || undefined;},\n    next: function() {\n      if (this.pos < this.string.length)\n        return this.string.charAt(this.pos++);\n    },\n    eat: function(match) {\n      var ch = this.string.charAt(this.pos);\n      if (typeof match == \"string\") var ok = ch == match;\n      else var ok = ch && (match.test ? match.test(ch) : match(ch));\n      if (ok) {++this.pos; return ch;}\n    },\n    eatWhile: function(match) {\n      var start = this.pos;\n      while (this.eat(match)){}\n      return this.pos > start;\n    },\n    eatSpace: function() {\n      var start = this.pos;\n      while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;\n      return this.pos > start;\n    },\n    skipToEnd: function() {this.pos = this.string.length;},\n    skipTo: function(ch) {\n      var found = this.string.indexOf(ch, this.pos);\n      if (found > -1) {this.pos = found; return true;}\n    },\n    backUp: function(n) {this.pos -= n;},\n    column: function() {\n      if (this.lastColumnPos < this.start) {\n        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n        this.lastColumnPos = this.start;\n      }\n      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    indentation: function() {\n      return countColumn(this.string, null, this.tabSize) -\n        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);\n    },\n    match: function(pattern, consume, caseInsensitive) {\n      if (typeof pattern == \"string\") {\n        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};\n        var substr = this.string.substr(this.pos, pattern.length);\n        if (cased(substr) == cased(pattern)) {\n          if (consume !== false) this.pos += pattern.length;\n          return true;\n        }\n      } else {\n        var match = this.string.slice(this.pos).match(pattern);\n        if (match && match.index > 0) return null;\n        if (match && consume !== false) this.pos += match[0].length;\n        return match;\n      }\n    },\n    current: function(){return this.string.slice(this.start, this.pos);},\n    hideFirstChars: function(n, inner) {\n      this.lineStart += n;\n      try { return inner(); }\n      finally { this.lineStart -= n; }\n    }\n  };\n\n  // TEXTMARKERS\n\n  // Created with markText and setBookmark methods. A TextMarker is a\n  // handle that can be used to clear or find a marked position in the\n  // document. Line objects hold arrays (markedSpans) containing\n  // {from, to, marker} object pointing to such marker objects, and\n  // indicating that such a marker is present on that line. Multiple\n  // lines may point to the same marker when it spans across lines.\n  // The spans will have null for their from/to properties when the\n  // marker continues beyond the start/end of the line. Markers have\n  // links back to the lines they currently touch.\n\n  var TextMarker = CodeMirror.TextMarker = function(doc, type) {\n    this.lines = [];\n    this.type = type;\n    this.doc = doc;\n  };\n  eventMixin(TextMarker);\n\n  // Clear the marker.\n  TextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    var cm = this.doc.cm, withOp = cm && !cm.curOp;\n    if (withOp) startOperation(cm);\n    if (hasHandler(this, \"clear\")) {\n      var found = this.find();\n      if (found) signalLater(this, \"clear\", found.from, found.to);\n    }\n    var min = null, max = null;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), \"text\");\n      else if (cm) {\n        if (span.to != null) max = lineNo(line);\n        if (span.from != null) min = lineNo(line);\n      }\n      line.markedSpans = removeMarkedSpan(line.markedSpans, span);\n      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\n        updateLineHeight(line, textHeight(cm.display));\n    }\n    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {\n      var visual = visualLine(this.lines[i]), len = lineLength(visual);\n      if (len > cm.display.maxLineLength) {\n        cm.display.maxLine = visual;\n        cm.display.maxLineLength = len;\n        cm.display.maxLineChanged = true;\n      }\n    }\n\n    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);\n    this.lines.length = 0;\n    this.explicitlyCleared = true;\n    if (this.atomic && this.doc.cantEdit) {\n      this.doc.cantEdit = false;\n      if (cm) reCheckSelection(cm.doc);\n    }\n    if (cm) signalLater(cm, \"markerCleared\", cm, this);\n    if (withOp) endOperation(cm);\n    if (this.parent) this.parent.clear();\n  };\n\n  // Find the position of the marker in the document. Returns a {from,\n  // to} object by default. Side can be passed to get a specific side\n  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\n  // Pos objects returned contain a line object, rather than a line\n  // number (used to prevent looking up the same line twice).\n  TextMarker.prototype.find = function(side, lineObj) {\n    if (side == null && this.type == \"bookmark\") side = 1;\n    var from, to;\n    for (var i = 0; i < this.lines.length; ++i) {\n      var line = this.lines[i];\n      var span = getMarkedSpanFor(line.markedSpans, this);\n      if (span.from != null) {\n        from = Pos(lineObj ? line : lineNo(line), span.from);\n        if (side == -1) return from;\n      }\n      if (span.to != null) {\n        to = Pos(lineObj ? line : lineNo(line), span.to);\n        if (side == 1) return to;\n      }\n    }\n    return from && {from: from, to: to};\n  };\n\n  // Signals that the marker's widget changed, and surrounding layout\n  // should be recomputed.\n  TextMarker.prototype.changed = function() {\n    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\n    if (!pos || !cm) return;\n    runInOp(cm, function() {\n      var line = pos.line, lineN = lineNo(pos.line);\n      var view = findViewForLine(cm, lineN);\n      if (view) {\n        clearLineMeasurementCacheFor(view);\n        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\n      }\n      cm.curOp.updateMaxLine = true;\n      if (!lineIsHidden(widget.doc, line) && widget.height != null) {\n        var oldHeight = widget.height;\n        widget.height = null;\n        var dHeight = widgetHeight(widget) - oldHeight;\n        if (dHeight)\n          updateLineHeight(line, line.height + dHeight);\n      }\n    });\n  };\n\n  TextMarker.prototype.attachLine = function(line) {\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\n        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);\n    }\n    this.lines.push(line);\n  };\n  TextMarker.prototype.detachLine = function(line) {\n    this.lines.splice(indexOf(this.lines, line), 1);\n    if (!this.lines.length && this.doc.cm) {\n      var op = this.doc.cm.curOp;\n      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\n    }\n  };\n\n  // Collapsed markers have unique ids, in order to be able to order\n  // them, which is needed for uniquely determining an outer marker\n  // when they overlap (they may nest, but not partially overlap).\n  var nextMarkerId = 0;\n\n  // Create a marker, wire it up to the right lines, and\n  function markText(doc, from, to, options, type) {\n    // Shared markers (across linked documents) are handled separately\n    // (markTextShared will call out to this again, once per\n    // document).\n    if (options && options.shared) return markTextShared(doc, from, to, options, type);\n    // Ensure we are in an operation.\n    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);\n\n    var marker = new TextMarker(doc, type), diff = cmp(from, to);\n    if (options) copyObj(options, marker, false);\n    // Don't connect empty markers unless clearWhenEmpty is false\n    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\n      return marker;\n    if (marker.replacedWith) {\n      // Showing up as a widget implies collapsed (widget replaces text)\n      marker.collapsed = true;\n      marker.widgetNode = elt(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\n      if (!options.handleMouseEvents) marker.widgetNode.ignoreEvents = true;\n      if (options.insertLeft) marker.widgetNode.insertLeft = true;\n    }\n    if (marker.collapsed) {\n      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\n          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\n        throw new Error(\"Inserting collapsed marker partially overlapping an existing one\");\n      sawCollapsedSpans = true;\n    }\n\n    if (marker.addToHistory)\n      addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN);\n\n    var curLine = from.line, cm = doc.cm, updateMaxLine;\n    doc.iter(curLine, to.line + 1, function(line) {\n      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\n        updateMaxLine = true;\n      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);\n      addMarkedSpan(line, new MarkedSpan(marker,\n                                         curLine == from.line ? from.ch : null,\n                                         curLine == to.line ? to.ch : null));\n      ++curLine;\n    });\n    // lineIsHidden depends on the presence of the spans, so needs a second pass\n    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {\n      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);\n    });\n\n    if (marker.clearOnEnter) on(marker, \"beforeCursorEnter\", function() { marker.clear(); });\n\n    if (marker.readOnly) {\n      sawReadOnlySpans = true;\n      if (doc.history.done.length || doc.history.undone.length)\n        doc.clearHistory();\n    }\n    if (marker.collapsed) {\n      marker.id = ++nextMarkerId;\n      marker.atomic = true;\n    }\n    if (cm) {\n      // Sync editor state\n      if (updateMaxLine) cm.curOp.updateMaxLine = true;\n      if (marker.collapsed)\n        regChange(cm, from.line, to.line + 1);\n      else if (marker.className || marker.title || marker.startStyle || marker.endStyle)\n        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, \"text\");\n      if (marker.atomic) reCheckSelection(cm.doc);\n      signalLater(cm, \"markerAdded\", cm, marker);\n    }\n    return marker;\n  }\n\n  // SHARED TEXTMARKERS\n\n  // A shared marker spans multiple linked documents. It is\n  // implemented as a meta-marker-object controlling multiple normal\n  // markers.\n  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {\n    this.markers = markers;\n    this.primary = primary;\n    for (var i = 0; i < markers.length; ++i)\n      markers[i].parent = this;\n  };\n  eventMixin(SharedTextMarker);\n\n  SharedTextMarker.prototype.clear = function() {\n    if (this.explicitlyCleared) return;\n    this.explicitlyCleared = true;\n    for (var i = 0; i < this.markers.length; ++i)\n      this.markers[i].clear();\n    signalLater(this, \"clear\");\n  };\n  SharedTextMarker.prototype.find = function(side, lineObj) {\n    return this.primary.find(side, lineObj);\n  };\n\n  function markTextShared(doc, from, to, options, type) {\n    options = copyObj(options);\n    options.shared = false;\n    var markers = [markText(doc, from, to, options, type)], primary = markers[0];\n    var widget = options.widgetNode;\n    linkedDocs(doc, function(doc) {\n      if (widget) options.widgetNode = widget.cloneNode(true);\n      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\n      for (var i = 0; i < doc.linked.length; ++i)\n        if (doc.linked[i].isParent) return;\n      primary = lst(markers);\n    });\n    return new SharedTextMarker(markers, primary);\n  }\n\n  function findSharedMarkers(doc) {\n    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),\n                         function(m) { return m.parent; });\n  }\n\n  function copySharedMarkers(doc, markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], pos = marker.find();\n      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\n      if (cmp(mFrom, mTo)) {\n        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\n        marker.markers.push(subMark);\n        subMark.parent = marker;\n      }\n    }\n  }\n\n  function detachSharedMarkers(markers) {\n    for (var i = 0; i < markers.length; i++) {\n      var marker = markers[i], linked = [marker.primary.doc];;\n      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });\n      for (var j = 0; j < marker.markers.length; j++) {\n        var subMarker = marker.markers[j];\n        if (indexOf(linked, subMarker.doc) == -1) {\n          subMarker.parent = null;\n          marker.markers.splice(j--, 1);\n        }\n      }\n    }\n  }\n\n  // TEXTMARKER SPANS\n\n  function MarkedSpan(marker, from, to) {\n    this.marker = marker;\n    this.from = from; this.to = to;\n  }\n\n  // Search an array of spans for a span matching the given marker.\n  function getMarkedSpanFor(spans, marker) {\n    if (spans) for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.marker == marker) return span;\n    }\n  }\n  // Remove a span from an array, returning undefined if no spans are\n  // left (we don't store arrays for lines without spans).\n  function removeMarkedSpan(spans, span) {\n    for (var r, i = 0; i < spans.length; ++i)\n      if (spans[i] != span) (r || (r = [])).push(spans[i]);\n    return r;\n  }\n  // Add a span to a line.\n  function addMarkedSpan(line, span) {\n    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\n    span.marker.attachLine(line);\n  }\n\n  // Used for the algorithm that adjusts markers for a change in the\n  // document. These functions cut an array of spans at a given\n  // character position, returning an array of remaining chunks (or\n  // undefined if nothing remains).\n  function markedSpansBefore(old, startCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\n      if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {\n        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\n      }\n    }\n    return nw;\n  }\n  function markedSpansAfter(old, endCh, isInsert) {\n    if (old) for (var i = 0, nw; i < old.length; ++i) {\n      var span = old[i], marker = span.marker;\n      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\n      if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {\n        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);\n        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\n                                              span.to == null ? null : span.to - endCh));\n      }\n    }\n    return nw;\n  }\n\n  // Given a change object, compute the new set of marker spans that\n  // cover the line in which the change took place. Removes spans\n  // entirely within the change, reconnects spans belonging to the\n  // same marker that appear on both sides of the change, and cuts off\n  // spans partially within the change. Returns an array of span\n  // arrays with one element for each line in (after) the change.\n  function stretchSpansOverChange(doc, change) {\n    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\n    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\n    if (!oldFirst && !oldLast) return null;\n\n    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\n    // Get the spans that 'stick out' on both sides\n    var first = markedSpansBefore(oldFirst, startCh, isInsert);\n    var last = markedSpansAfter(oldLast, endCh, isInsert);\n\n    // Next, merge those two ends\n    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\n    if (first) {\n      // Fix up .to properties of first\n      for (var i = 0; i < first.length; ++i) {\n        var span = first[i];\n        if (span.to == null) {\n          var found = getMarkedSpanFor(last, span.marker);\n          if (!found) span.to = startCh;\n          else if (sameLine) span.to = found.to == null ? null : found.to + offset;\n        }\n      }\n    }\n    if (last) {\n      // Fix up .from in last (or move them into first in case of sameLine)\n      for (var i = 0; i < last.length; ++i) {\n        var span = last[i];\n        if (span.to != null) span.to += offset;\n        if (span.from == null) {\n          var found = getMarkedSpanFor(first, span.marker);\n          if (!found) {\n            span.from = offset;\n            if (sameLine) (first || (first = [])).push(span);\n          }\n        } else {\n          span.from += offset;\n          if (sameLine) (first || (first = [])).push(span);\n        }\n      }\n    }\n    // Make sure we didn't create any zero-length spans\n    if (first) first = clearEmptySpans(first);\n    if (last && last != first) last = clearEmptySpans(last);\n\n    var newMarkers = [first];\n    if (!sameLine) {\n      // Fill gap with whole-line-spans\n      var gap = change.text.length - 2, gapMarkers;\n      if (gap > 0 && first)\n        for (var i = 0; i < first.length; ++i)\n          if (first[i].to == null)\n            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));\n      for (var i = 0; i < gap; ++i)\n        newMarkers.push(gapMarkers);\n      newMarkers.push(last);\n    }\n    return newMarkers;\n  }\n\n  // Remove spans that are empty and don't have a clearWhenEmpty\n  // option of false.\n  function clearEmptySpans(spans) {\n    for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\n        spans.splice(i--, 1);\n    }\n    if (!spans.length) return null;\n    return spans;\n  }\n\n  // Used for un/re-doing changes from the history. Combines the\n  // result of computing the existing spans with the set of spans that\n  // existed in the history (so that deleting around a span and then\n  // undoing brings back the span).\n  function mergeOldSpans(doc, change) {\n    var old = getOldSpans(doc, change);\n    var stretched = stretchSpansOverChange(doc, change);\n    if (!old) return stretched;\n    if (!stretched) return old;\n\n    for (var i = 0; i < old.length; ++i) {\n      var oldCur = old[i], stretchCur = stretched[i];\n      if (oldCur && stretchCur) {\n        spans: for (var j = 0; j < stretchCur.length; ++j) {\n          var span = stretchCur[j];\n          for (var k = 0; k < oldCur.length; ++k)\n            if (oldCur[k].marker == span.marker) continue spans;\n          oldCur.push(span);\n        }\n      } else if (stretchCur) {\n        old[i] = stretchCur;\n      }\n    }\n    return old;\n  }\n\n  // Used to 'clip' out readOnly ranges when making a change.\n  function removeReadOnlyRanges(doc, from, to) {\n    var markers = null;\n    doc.iter(from.line, to.line + 1, function(line) {\n      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {\n        var mark = line.markedSpans[i].marker;\n        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\n          (markers || (markers = [])).push(mark);\n      }\n    });\n    if (!markers) return null;\n    var parts = [{from: from, to: to}];\n    for (var i = 0; i < markers.length; ++i) {\n      var mk = markers[i], m = mk.find(0);\n      for (var j = 0; j < parts.length; ++j) {\n        var p = parts[j];\n        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;\n        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\n        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\n          newParts.push({from: p.from, to: m.from});\n        if (dto > 0 || !mk.inclusiveRight && !dto)\n          newParts.push({from: m.to, to: p.to});\n        parts.splice.apply(parts, newParts);\n        j += newParts.length - 1;\n      }\n    }\n    return parts;\n  }\n\n  // Connect or disconnect spans from a line.\n  function detachMarkedSpans(line) {\n    var spans = line.markedSpans;\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.detachLine(line);\n    line.markedSpans = null;\n  }\n  function attachMarkedSpans(line, spans) {\n    if (!spans) return;\n    for (var i = 0; i < spans.length; ++i)\n      spans[i].marker.attachLine(line);\n    line.markedSpans = spans;\n  }\n\n  // Helpers used when computing which overlapping collapsed span\n  // counts as the larger one.\n  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }\n  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }\n\n  // Returns a number indicating which of two overlapping collapsed\n  // spans is larger (and thus includes the other). Falls back to\n  // comparing ids when the spans cover exactly the same range.\n  function compareCollapsedMarkers(a, b) {\n    var lenDiff = a.lines.length - b.lines.length;\n    if (lenDiff != 0) return lenDiff;\n    var aPos = a.find(), bPos = b.find();\n    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\n    if (fromCmp) return -fromCmp;\n    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\n    if (toCmp) return toCmp;\n    return b.id - a.id;\n  }\n\n  // Find out whether a line ends or starts in a collapsed span. If\n  // so, return the marker for that span.\n  function collapsedSpanAtSide(line, start) {\n    var sps = sawCollapsedSpans && line.markedSpans, found;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\n          (!found || compareCollapsedMarkers(found, sp.marker) < 0))\n        found = sp.marker;\n    }\n    return found;\n  }\n  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }\n  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }\n\n  // Test whether there exists a collapsed span that partially\n  // overlaps (covers the start or end, but not both) of a new span.\n  // Such overlap is not allowed.\n  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {\n    var line = getLine(doc, lineNo);\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var i = 0; i < sps.length; ++i) {\n      var sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      var found = sp.marker.find(0);\n      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\n      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\n      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;\n      if (fromCmp <= 0 && (cmp(found.to, from) > 0 || (sp.marker.inclusiveRight && marker.inclusiveLeft)) ||\n          fromCmp >= 0 && (cmp(found.from, to) < 0 || (sp.marker.inclusiveLeft && marker.inclusiveRight)))\n        return true;\n    }\n  }\n\n  // A visual line is a line as drawn on the screen. Folding, for\n  // example, can cause multiple logical lines to appear on the same\n  // visual line. This finds the start of the visual line that the\n  // given line is part of (usually that is the line itself).\n  function visualLine(line) {\n    var merged;\n    while (merged = collapsedSpanAtStart(line))\n      line = merged.find(-1, true).line;\n    return line;\n  }\n\n  // Returns an array of logical lines that continue the visual line\n  // started by the argument, or undefined if there are no such lines.\n  function visualLineContinued(line) {\n    var merged, lines;\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      (lines || (lines = [])).push(line);\n    }\n    return lines;\n  }\n\n  // Get the line number of the start of the visual line that the\n  // given line number is part of.\n  function visualLineNo(doc, lineN) {\n    var line = getLine(doc, lineN), vis = visualLine(line);\n    if (line == vis) return lineN;\n    return lineNo(vis);\n  }\n  // Get the line number of the start of the next visual line after\n  // the given line.\n  function visualLineEndNo(doc, lineN) {\n    if (lineN > doc.lastLine()) return lineN;\n    var line = getLine(doc, lineN), merged;\n    if (!lineIsHidden(doc, line)) return lineN;\n    while (merged = collapsedSpanAtEnd(line))\n      line = merged.find(1, true).line;\n    return lineNo(line) + 1;\n  }\n\n  // Compute whether a line is hidden. Lines count as hidden when they\n  // are part of a visual line that starts with another line, or when\n  // they are entirely covered by collapsed, non-widget span.\n  function lineIsHidden(doc, line) {\n    var sps = sawCollapsedSpans && line.markedSpans;\n    if (sps) for (var sp, i = 0; i < sps.length; ++i) {\n      sp = sps[i];\n      if (!sp.marker.collapsed) continue;\n      if (sp.from == null) return true;\n      if (sp.marker.widgetNode) continue;\n      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\n        return true;\n    }\n  }\n  function lineIsHiddenInner(doc, line, span) {\n    if (span.to == null) {\n      var end = span.marker.find(1, true);\n      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));\n    }\n    if (span.marker.inclusiveRight && span.to == line.text.length)\n      return true;\n    for (var sp, i = 0; i < line.markedSpans.length; ++i) {\n      sp = line.markedSpans[i];\n      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\n          (sp.to == null || sp.to != span.from) &&\n          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\n          lineIsHiddenInner(doc, line, sp)) return true;\n    }\n  }\n\n  // LINE WIDGETS\n\n  // Line widgets are block elements displayed above or below a line.\n\n  var LineWidget = CodeMirror.LineWidget = function(cm, node, options) {\n    if (options) for (var opt in options) if (options.hasOwnProperty(opt))\n      this[opt] = options[opt];\n    this.cm = cm;\n    this.node = node;\n  };\n  eventMixin(LineWidget);\n\n  function adjustScrollWhenAboveVisible(cm, line, diff) {\n    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\n      addToScrollPos(cm, null, diff);\n  }\n\n  LineWidget.prototype.clear = function() {\n    var cm = this.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\n    if (no == null || !ws) return;\n    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);\n    if (!ws.length) line.widgets = null;\n    var height = widgetHeight(this);\n    runInOp(cm, function() {\n      adjustScrollWhenAboveVisible(cm, line, -height);\n      regLineChange(cm, no, \"widget\");\n      updateLineHeight(line, Math.max(0, line.height - height));\n    });\n  };\n  LineWidget.prototype.changed = function() {\n    var oldH = this.height, cm = this.cm, line = this.line;\n    this.height = null;\n    var diff = widgetHeight(this) - oldH;\n    if (!diff) return;\n    runInOp(cm, function() {\n      cm.curOp.forceUpdate = true;\n      adjustScrollWhenAboveVisible(cm, line, diff);\n      updateLineHeight(line, line.height + diff);\n    });\n  };\n\n  function widgetHeight(widget) {\n    if (widget.height != null) return widget.height;\n    if (!contains(document.body, widget.node)) {\n      var parentStyle = \"position: relative;\";\n      if (widget.coverGutter)\n        parentStyle += \"margin-left: -\" + widget.cm.getGutterElement().offsetWidth + \"px;\";\n      removeChildrenAndAdd(widget.cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));\n    }\n    return widget.height = widget.node.offsetHeight;\n  }\n\n  function addLineWidget(cm, handle, node, options) {\n    var widget = new LineWidget(cm, node, options);\n    if (widget.noHScroll) cm.display.alignWidgets = true;\n    changeLine(cm.doc, handle, \"widget\", function(line) {\n      var widgets = line.widgets || (line.widgets = []);\n      if (widget.insertAt == null) widgets.push(widget);\n      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);\n      widget.line = line;\n      if (!lineIsHidden(cm.doc, line)) {\n        var aboveVisible = heightAtLine(line) < cm.doc.scrollTop;\n        updateLineHeight(line, line.height + widgetHeight(widget));\n        if (aboveVisible) addToScrollPos(cm, null, widget.height);\n        cm.curOp.forceUpdate = true;\n      }\n      return true;\n    });\n    return widget;\n  }\n\n  // LINE DATA STRUCTURE\n\n  // Line objects. These hold state related to a line, including\n  // highlighting info (the styles array).\n  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {\n    this.text = text;\n    attachMarkedSpans(this, markedSpans);\n    this.height = estimateHeight ? estimateHeight(this) : 1;\n  };\n  eventMixin(Line);\n  Line.prototype.lineNo = function() { return lineNo(this); };\n\n  // Change the content (text, markers) of a line. Automatically\n  // invalidates cached information and tries to re-estimate the\n  // line's height.\n  function updateLine(line, text, markedSpans, estimateHeight) {\n    line.text = text;\n    if (line.stateAfter) line.stateAfter = null;\n    if (line.styles) line.styles = null;\n    if (line.order != null) line.order = null;\n    detachMarkedSpans(line);\n    attachMarkedSpans(line, markedSpans);\n    var estHeight = estimateHeight ? estimateHeight(line) : 1;\n    if (estHeight != line.height) updateLineHeight(line, estHeight);\n  }\n\n  // Detach a line from the document tree and its markers.\n  function cleanUpLine(line) {\n    line.parent = null;\n    detachMarkedSpans(line);\n  }\n\n  function extractLineClasses(type, output) {\n    if (type) for (;;) {\n      var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\n      if (!lineClass) break;\n      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\n      var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\n      if (output[prop] == null)\n        output[prop] = lineClass[2];\n      else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(output[prop]))\n        output[prop] += \" \" + lineClass[2];\n    }\n    return type;\n  }\n\n  function callBlankLine(mode, state) {\n    if (mode.blankLine) return mode.blankLine(state);\n    if (!mode.innerMode) return;\n    var inner = CodeMirror.innerMode(mode, state);\n    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);\n  }\n\n  function readToken(mode, stream, state, inner) {\n    for (var i = 0; i < 10; i++) {\n      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;\n      var style = mode.token(stream, state);\n      if (stream.pos > stream.start) return style;\n    }\n    throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\");\n  }\n\n  // Utility for getTokenAt and getLineTokens\n  function takeToken(cm, pos, precise, asArray) {\n    function getObj(copy) {\n      return {start: stream.start, end: stream.pos,\n              string: stream.current(),\n              type: style || null,\n              state: copy ? copyState(doc.mode, state) : state};\n    }\n\n    var doc = cm.doc, mode = doc.mode, style;\n    pos = clipPos(doc, pos);\n    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);\n    var stream = new StringStream(line.text, cm.options.tabSize), tokens;\n    if (asArray) tokens = [];\n    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\n      stream.start = stream.pos;\n      style = readToken(mode, stream, state);\n      if (asArray) tokens.push(getObj(true));\n    }\n    return asArray ? tokens : getObj();\n  }\n\n  // Run the given mode's parser over a line, calling f for each token.\n  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {\n    var flattenSpans = mode.flattenSpans;\n    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;\n    var curStart = 0, curStyle = null;\n    var stream = new StringStream(text, cm.options.tabSize), style;\n    var inner = cm.options.addModeClass && [null];\n    if (text == \"\") extractLineClasses(callBlankLine(mode, state), lineClasses);\n    while (!stream.eol()) {\n      if (stream.pos > cm.options.maxHighlightLength) {\n        flattenSpans = false;\n        if (forceToEnd) processLine(cm, text, state, stream.pos);\n        stream.pos = text.length;\n        style = null;\n      } else {\n        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);\n      }\n      if (inner) {\n        var mName = inner[0].name;\n        if (mName) style = \"m-\" + (style ? mName + \" \" + style : mName);\n      }\n      if (!flattenSpans || curStyle != style) {\n        if (curStart < stream.start) f(stream.start, curStyle);\n        curStart = stream.start; curStyle = style;\n      }\n      stream.start = stream.pos;\n    }\n    while (curStart < stream.pos) {\n      // Webkit seems to refuse to render text nodes longer than 57444 characters\n      var pos = Math.min(stream.pos, curStart + 50000);\n      f(pos, curStyle);\n      curStart = pos;\n    }\n  }\n\n  // Compute a style array (an array starting with a mode generation\n  // -- for invalidation -- followed by pairs of end positions and\n  // style strings), which is used to highlight the tokens on the\n  // line.\n  function highlightLine(cm, line, state, forceToEnd) {\n    // A styles array always starts with a number identifying the\n    // mode/overlays that it is based on (for easy invalidation).\n    var st = [cm.state.modeGen], lineClasses = {};\n    // Compute the base array of styles\n    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {\n      st.push(end, style);\n    }, lineClasses, forceToEnd);\n\n    // Run overlays, adjust style array.\n    for (var o = 0; o < cm.state.overlays.length; ++o) {\n      var overlay = cm.state.overlays[o], i = 1, at = 0;\n      runMode(cm, line.text, overlay.mode, true, function(end, style) {\n        var start = i;\n        // Ensure there's a token end at the current position, and that i points at it\n        while (at < end) {\n          var i_end = st[i];\n          if (i_end > end)\n            st.splice(i, 1, end, st[i+1], i_end);\n          i += 2;\n          at = Math.min(end, i_end);\n        }\n        if (!style) return;\n        if (overlay.opaque) {\n          st.splice(start, i - start, end, \"cm-overlay \" + style);\n          i = start + 2;\n        } else {\n          for (; start < i; start += 2) {\n            var cur = st[start+1];\n            st[start+1] = (cur ? cur + \" \" : \"\") + \"cm-overlay \" + style;\n          }\n        }\n      }, lineClasses);\n    }\n\n    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};\n  }\n\n  function getLineStyles(cm, line, updateFrontier) {\n    if (!line.styles || line.styles[0] != cm.state.modeGen) {\n      var result = highlightLine(cm, line, line.stateAfter = getStateBefore(cm, lineNo(line)));\n      line.styles = result.styles;\n      if (result.classes) line.styleClasses = result.classes;\n      else if (line.styleClasses) line.styleClasses = null;\n      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;\n    }\n    return line.styles;\n  }\n\n  // Lightweight form of highlight -- proceed over this line and\n  // update state, but don't save a style array. Used for lines that\n  // aren't currently visible.\n  function processLine(cm, text, state, startAt) {\n    var mode = cm.doc.mode;\n    var stream = new StringStream(text, cm.options.tabSize);\n    stream.start = stream.pos = startAt || 0;\n    if (text == \"\") callBlankLine(mode, state);\n    while (!stream.eol() && stream.pos <= cm.options.maxHighlightLength) {\n      readToken(mode, stream, state);\n      stream.start = stream.pos;\n    }\n  }\n\n  // Convert a style as returned by a mode (either null, or a string\n  // containing one or more styles) to a CSS style. This is cached,\n  // and also looks for line-wide styles.\n  var styleToClassCache = {}, styleToClassCacheWithMode = {};\n  function interpretTokenStyle(style, options) {\n    if (!style || /^\\s*$/.test(style)) return null;\n    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\n    return cache[style] ||\n      (cache[style] = style.replace(/\\S+/g, \"cm-$&\"));\n  }\n\n  // Render the DOM representation of the text of a line. Also builds\n  // up a 'line map', which points at the DOM nodes that represent\n  // specific stretches of text, and is used by the measuring code.\n  // The returned object contains the DOM node, this map, and\n  // information about line-wide styles that were set by the mode.\n  function buildLineContent(cm, lineView) {\n    // The padding-right forces the element to have a 'border', which\n    // is needed on Webkit to be able to get line-level bounding\n    // rectangles for it (in measureChar).\n    var content = elt(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);\n    var builder = {pre: elt(\"pre\", [content]), content: content, col: 0, pos: 0, cm: cm};\n    lineView.measure = {};\n\n    // Iterate over the logical lines that make up this visual line.\n    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\n      var line = i ? lineView.rest[i - 1] : lineView.line, order;\n      builder.pos = 0;\n      builder.addToken = buildToken;\n      // Optionally wire in some hacks into the token-rendering\n      // algorithm, to deal with browser quirks.\n      if ((ie || webkit) && cm.getOption(\"lineWrapping\"))\n        builder.addToken = buildTokenSplitSpaces(builder.addToken);\n      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))\n        builder.addToken = buildTokenBadBidi(builder.addToken, order);\n      builder.map = [];\n      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\n      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\n      if (line.styleClasses) {\n        if (line.styleClasses.bgClass)\n          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\");\n        if (line.styleClasses.textClass)\n          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\");\n      }\n\n      // Ensure at least a single node is present, for measuring.\n      if (builder.map.length == 0)\n        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));\n\n      // Store the map and a cache object for the current logical line\n      if (i == 0) {\n        lineView.measure.map = builder.map;\n        lineView.measure.cache = {};\n      } else {\n        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);\n        (lineView.measure.caches || (lineView.measure.caches = [])).push({});\n      }\n    }\n\n    // See issue #2901\n    if (webkit && /\\bcm-tab\\b/.test(builder.content.lastChild.className))\n      builder.content.className = \"cm-tab-wrap-hack\";\n\n    signal(cm, \"renderLine\", cm, lineView.line, builder.pre);\n    if (builder.pre.className)\n      builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\");\n\n    return builder;\n  }\n\n  function defaultSpecialCharPlaceholder(ch) {\n    var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\n    token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\n    return token;\n  }\n\n  // Build up the DOM representation for a single token, and add it to\n  // the line map. Takes care to render special characters separately.\n  function buildToken(builder, text, style, startStyle, endStyle, title) {\n    if (!text) return;\n    var special = builder.cm.options.specialChars, mustWrap = false;\n    if (!special.test(text)) {\n      builder.col += text.length;\n      var content = document.createTextNode(text);\n      builder.map.push(builder.pos, builder.pos + text.length, content);\n      if (ie && ie_version < 9) mustWrap = true;\n      builder.pos += text.length;\n    } else {\n      var content = document.createDocumentFragment(), pos = 0;\n      while (true) {\n        special.lastIndex = pos;\n        var m = special.exec(text);\n        var skipped = m ? m.index - pos : text.length - pos;\n        if (skipped) {\n          var txt = document.createTextNode(text.slice(pos, pos + skipped));\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.map.push(builder.pos, builder.pos + skipped, txt);\n          builder.col += skipped;\n          builder.pos += skipped;\n        }\n        if (!m) break;\n        pos += skipped + 1;\n        if (m[0] == \"\\t\") {\n          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\n          var txt = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\n          builder.col += tabWidth;\n        } else {\n          var txt = builder.cm.options.specialCharPlaceholder(m[0]);\n          if (ie && ie_version < 9) content.appendChild(elt(\"span\", [txt]));\n          else content.appendChild(txt);\n          builder.col += 1;\n        }\n        builder.map.push(builder.pos, builder.pos + 1, txt);\n        builder.pos++;\n      }\n    }\n    if (style || startStyle || endStyle || mustWrap) {\n      var fullStyle = style || \"\";\n      if (startStyle) fullStyle += startStyle;\n      if (endStyle) fullStyle += endStyle;\n      var token = elt(\"span\", [content], fullStyle);\n      if (title) token.title = title;\n      return builder.content.appendChild(token);\n    }\n    builder.content.appendChild(content);\n  }\n\n  function buildTokenSplitSpaces(inner) {\n    function split(old) {\n      var out = \" \";\n      for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? \" \" : \"\\u00a0\";\n      out += \" \";\n      return out;\n    }\n    return function(builder, text, style, startStyle, endStyle, title) {\n      inner(builder, text.replace(/ {3,}/g, split), style, startStyle, endStyle, title);\n    };\n  }\n\n  // Work around nonsense dimensions being reported for stretches of\n  // right-to-left text.\n  function buildTokenBadBidi(inner, order) {\n    return function(builder, text, style, startStyle, endStyle, title) {\n      style = style ? style + \" cm-force-border\" : \"cm-force-border\";\n      var start = builder.pos, end = start + text.length;\n      for (;;) {\n        // Find the part that overlaps with the start of this text\n        for (var i = 0; i < order.length; i++) {\n          var part = order[i];\n          if (part.to > start && part.from <= start) break;\n        }\n        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title);\n        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title);\n        startStyle = null;\n        text = text.slice(part.to - start);\n        start = part.to;\n      }\n    };\n  }\n\n  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\n    var widget = !ignoreWidget && marker.widgetNode;\n    if (widget) {\n      builder.map.push(builder.pos, builder.pos + size, widget);\n      builder.content.appendChild(widget);\n    }\n    builder.pos += size;\n  }\n\n  // Outputs a number of spans to make up a line, taking highlighting\n  // and marked text into account.\n  function insertLineContent(line, builder, styles) {\n    var spans = line.markedSpans, allText = line.text, at = 0;\n    if (!spans) {\n      for (var i = 1; i < styles.length; i+=2)\n        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));\n      return;\n    }\n\n    var len = allText.length, pos = 0, i = 1, text = \"\", style;\n    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\n    for (;;) {\n      if (nextChange == pos) { // Update current marker set\n        spanStyle = spanEndStyle = spanStartStyle = title = \"\";\n        collapsed = null; nextChange = Infinity;\n        var foundBookmarks = [];\n        for (var j = 0; j < spans.length; ++j) {\n          var sp = spans[j], m = sp.marker;\n          if (sp.from <= pos && (sp.to == null || sp.to > pos)) {\n            if (sp.to != null && nextChange > sp.to) { nextChange = sp.to; spanEndStyle = \"\"; }\n            if (m.className) spanStyle += \" \" + m.className;\n            if (m.startStyle && sp.from == pos) spanStartStyle += \" \" + m.startStyle;\n            if (m.endStyle && sp.to == nextChange) spanEndStyle += \" \" + m.endStyle;\n            if (m.title && !title) title = m.title;\n            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\n              collapsed = sp;\n          } else if (sp.from > pos && nextChange > sp.from) {\n            nextChange = sp.from;\n          }\n          if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) foundBookmarks.push(m);\n        }\n        if (collapsed && (collapsed.from || 0) == pos) {\n          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\n                             collapsed.marker, collapsed.from == null);\n          if (collapsed.to == null) return;\n        }\n        if (!collapsed && foundBookmarks.length) for (var j = 0; j < foundBookmarks.length; ++j)\n          buildCollapsedSpan(builder, 0, foundBookmarks[j]);\n      }\n      if (pos >= len) break;\n\n      var upto = Math.min(len, nextChange);\n      while (true) {\n        if (text) {\n          var end = pos + text.length;\n          if (!collapsed) {\n            var tokenText = end > upto ? text.slice(0, upto - pos) : text;\n            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\n                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title);\n          }\n          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}\n          pos = end;\n          spanStartStyle = \"\";\n        }\n        text = allText.slice(at, at = styles[i++]);\n        style = interpretTokenStyle(styles[i++], builder.cm.options);\n      }\n    }\n  }\n\n  // DOCUMENT DATA STRUCTURE\n\n  // By default, updates that start and end at the beginning of a line\n  // are treated specially, in order to make the association of line\n  // widgets and marker elements with the text behave more intuitive.\n  function isWholeLineUpdate(doc, change) {\n    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&\n      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);\n  }\n\n  // Perform a change on the document data structure.\n  function updateDoc(doc, change, markedSpans, estimateHeight) {\n    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}\n    function update(line, text, spans) {\n      updateLine(line, text, spans, estimateHeight);\n      signalLater(line, \"change\", line, change);\n    }\n\n    var from = change.from, to = change.to, text = change.text;\n    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\n    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\n\n    // Adjust the line structure\n    if (isWholeLineUpdate(doc, change)) {\n      // This is a whole-line replace. Treated specially to make\n      // sure line objects move the way they are supposed to.\n      for (var i = 0, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      update(lastLine, lastLine.text, lastSpans);\n      if (nlines) doc.remove(from.line, nlines);\n      if (added.length) doc.insert(from.line, added);\n    } else if (firstLine == lastLine) {\n      if (text.length == 1) {\n        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\n      } else {\n        for (var added = [], i = 1; i < text.length - 1; ++i)\n          added.push(new Line(text[i], spansFor(i), estimateHeight));\n        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));\n        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n        doc.insert(from.line + 1, added);\n      }\n    } else if (text.length == 1) {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\n      doc.remove(from.line + 1, nlines);\n    } else {\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\n      for (var i = 1, added = []; i < text.length - 1; ++i)\n        added.push(new Line(text[i], spansFor(i), estimateHeight));\n      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);\n      doc.insert(from.line + 1, added);\n    }\n\n    signalLater(doc, \"change\", doc, change);\n  }\n\n  // The document is represented as a BTree consisting of leaves, with\n  // chunk of lines in them, and branches, with up to ten leaves or\n  // other branch nodes below them. The top node is always a branch\n  // node, and is the document object itself (meaning it has\n  // additional methods and properties).\n  //\n  // All nodes have parent links. The tree is used both to go from\n  // line numbers to line objects, and to go from objects to numbers.\n  // It also indexes by height, and is used to convert between height\n  // and line object, and to find the total height of the document.\n  //\n  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\n\n  function LeafChunk(lines) {\n    this.lines = lines;\n    this.parent = null;\n    for (var i = 0, height = 0; i < lines.length; ++i) {\n      lines[i].parent = this;\n      height += lines[i].height;\n    }\n    this.height = height;\n  }\n\n  LeafChunk.prototype = {\n    chunkSize: function() { return this.lines.length; },\n    // Remove the n lines at offset 'at'.\n    removeInner: function(at, n) {\n      for (var i = at, e = at + n; i < e; ++i) {\n        var line = this.lines[i];\n        this.height -= line.height;\n        cleanUpLine(line);\n        signalLater(line, \"delete\");\n      }\n      this.lines.splice(at, n);\n    },\n    // Helper used to collapse a small branch into a single leaf.\n    collapse: function(lines) {\n      lines.push.apply(lines, this.lines);\n    },\n    // Insert the given array of lines at offset 'at', count them as\n    // having the given height.\n    insertInner: function(at, lines, height) {\n      this.height += height;\n      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\n      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;\n    },\n    // Used to iterate over a part of the tree.\n    iterN: function(at, n, op) {\n      for (var e = at + n; at < e; ++at)\n        if (op(this.lines[at])) return true;\n    }\n  };\n\n  function BranchChunk(children) {\n    this.children = children;\n    var size = 0, height = 0;\n    for (var i = 0; i < children.length; ++i) {\n      var ch = children[i];\n      size += ch.chunkSize(); height += ch.height;\n      ch.parent = this;\n    }\n    this.size = size;\n    this.height = height;\n    this.parent = null;\n  }\n\n  BranchChunk.prototype = {\n    chunkSize: function() { return this.size; },\n    removeInner: function(at, n) {\n      this.size -= n;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var rm = Math.min(n, sz - at), oldHeight = child.height;\n          child.removeInner(at, rm);\n          this.height -= oldHeight - child.height;\n          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\n          if ((n -= rm) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n      // If the result is smaller than 25 lines, ensure that it is a\n      // single leaf node.\n      if (this.size - n < 25 &&\n          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\n        var lines = [];\n        this.collapse(lines);\n        this.children = [new LeafChunk(lines)];\n        this.children[0].parent = this;\n      }\n    },\n    collapse: function(lines) {\n      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);\n    },\n    insertInner: function(at, lines, height) {\n      this.size += lines.length;\n      this.height += height;\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at <= sz) {\n          child.insertInner(at, lines, height);\n          if (child.lines && child.lines.length > 50) {\n            while (child.lines.length > 50) {\n              var spilled = child.lines.splice(child.lines.length - 25, 25);\n              var newleaf = new LeafChunk(spilled);\n              child.height -= newleaf.height;\n              this.children.splice(i + 1, 0, newleaf);\n              newleaf.parent = this;\n            }\n            this.maybeSpill();\n          }\n          break;\n        }\n        at -= sz;\n      }\n    },\n    // When a node has grown, check whether it should be split.\n    maybeSpill: function() {\n      if (this.children.length <= 10) return;\n      var me = this;\n      do {\n        var spilled = me.children.splice(me.children.length - 5, 5);\n        var sibling = new BranchChunk(spilled);\n        if (!me.parent) { // Become the parent node\n          var copy = new BranchChunk(me.children);\n          copy.parent = me;\n          me.children = [copy, sibling];\n          me = copy;\n        } else {\n          me.size -= sibling.size;\n          me.height -= sibling.height;\n          var myIndex = indexOf(me.parent.children, me);\n          me.parent.children.splice(myIndex + 1, 0, sibling);\n        }\n        sibling.parent = me.parent;\n      } while (me.children.length > 10);\n      me.parent.maybeSpill();\n    },\n    iterN: function(at, n, op) {\n      for (var i = 0; i < this.children.length; ++i) {\n        var child = this.children[i], sz = child.chunkSize();\n        if (at < sz) {\n          var used = Math.min(n, sz - at);\n          if (child.iterN(at, used, op)) return true;\n          if ((n -= used) == 0) break;\n          at = 0;\n        } else at -= sz;\n      }\n    }\n  };\n\n  var nextDocId = 0;\n  var Doc = CodeMirror.Doc = function(text, mode, firstLine) {\n    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine);\n    if (firstLine == null) firstLine = 0;\n\n    BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\n    this.first = firstLine;\n    this.scrollTop = this.scrollLeft = 0;\n    this.cantEdit = false;\n    this.cleanGeneration = 1;\n    this.frontier = firstLine;\n    var start = Pos(firstLine, 0);\n    this.sel = simpleSelection(start);\n    this.history = new History(null);\n    this.id = ++nextDocId;\n    this.modeOption = mode;\n\n    if (typeof text == \"string\") text = splitLines(text);\n    updateDoc(this, {from: start, to: start, text: text});\n    setSelection(this, simpleSelection(start), sel_dontScroll);\n  };\n\n  Doc.prototype = createObj(BranchChunk.prototype, {\n    constructor: Doc,\n    // Iterate over the document. Supports two forms -- with only one\n    // argument, it calls that for each line in the document. With\n    // three, it iterates over the range given by the first two (with\n    // the second being non-inclusive).\n    iter: function(from, to, op) {\n      if (op) this.iterN(from - this.first, to - from, op);\n      else this.iterN(this.first, this.first + this.size, from);\n    },\n\n    // Non-public interface for adding and removing lines.\n    insert: function(at, lines) {\n      var height = 0;\n      for (var i = 0; i < lines.length; ++i) height += lines[i].height;\n      this.insertInner(at - this.first, lines, height);\n    },\n    remove: function(at, n) { this.removeInner(at - this.first, n); },\n\n    // From here, the methods are part of the public interface. Most\n    // are also available from CodeMirror (editor) instances.\n\n    getValue: function(lineSep) {\n      var lines = getLines(this, this.first, this.first + this.size);\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n    setValue: docMethodOp(function(code) {\n      var top = Pos(this.first, 0), last = this.first + this.size - 1;\n      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\n                        text: splitLines(code), origin: \"setValue\"}, true);\n      setSelection(this, simpleSelection(top));\n    }),\n    replaceRange: function(code, from, to, origin) {\n      from = clipPos(this, from);\n      to = to ? clipPos(this, to) : from;\n      replaceRange(this, code, from, to, origin);\n    },\n    getRange: function(from, to, lineSep) {\n      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n      if (lineSep === false) return lines;\n      return lines.join(lineSep || \"\\n\");\n    },\n\n    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},\n\n    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},\n    getLineNumber: function(line) {return lineNo(line);},\n\n    getLineHandleVisualStart: function(line) {\n      if (typeof line == \"number\") line = getLine(this, line);\n      return visualLine(line);\n    },\n\n    lineCount: function() {return this.size;},\n    firstLine: function() {return this.first;},\n    lastLine: function() {return this.first + this.size - 1;},\n\n    clipPos: function(pos) {return clipPos(this, pos);},\n\n    getCursor: function(start) {\n      var range = this.sel.primary(), pos;\n      if (start == null || start == \"head\") pos = range.head;\n      else if (start == \"anchor\") pos = range.anchor;\n      else if (start == \"end\" || start == \"to\" || start === false) pos = range.to();\n      else pos = range.from();\n      return pos;\n    },\n    listSelections: function() { return this.sel.ranges; },\n    somethingSelected: function() {return this.sel.somethingSelected();},\n\n    setCursor: docMethodOp(function(line, ch, options) {\n      setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);\n    }),\n    setSelection: docMethodOp(function(anchor, head, options) {\n      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\n    }),\n    extendSelection: docMethodOp(function(head, other, options) {\n      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\n    }),\n    extendSelections: docMethodOp(function(heads, options) {\n      extendSelections(this, clipPosArray(this, heads, options));\n    }),\n    extendSelectionsBy: docMethodOp(function(f, options) {\n      extendSelections(this, map(this.sel.ranges, f), options);\n    }),\n    setSelections: docMethodOp(function(ranges, primary, options) {\n      if (!ranges.length) return;\n      for (var i = 0, out = []; i < ranges.length; i++)\n        out[i] = new Range(clipPos(this, ranges[i].anchor),\n                           clipPos(this, ranges[i].head));\n      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);\n      setSelection(this, normalizeSelection(out, primary), options);\n    }),\n    addSelection: docMethodOp(function(anchor, head, options) {\n      var ranges = this.sel.ranges.slice(0);\n      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\n      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);\n    }),\n\n    getSelection: function(lineSep) {\n      var ranges = this.sel.ranges, lines;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        lines = lines ? lines.concat(sel) : sel;\n      }\n      if (lineSep === false) return lines;\n      else return lines.join(lineSep || \"\\n\");\n    },\n    getSelections: function(lineSep) {\n      var parts = [], ranges = this.sel.ranges;\n      for (var i = 0; i < ranges.length; i++) {\n        var sel = getBetween(this, ranges[i].from(), ranges[i].to());\n        if (lineSep !== false) sel = sel.join(lineSep || \"\\n\");\n        parts[i] = sel;\n      }\n      return parts;\n    },\n    replaceSelection: function(code, collapse, origin) {\n      var dup = [];\n      for (var i = 0; i < this.sel.ranges.length; i++)\n        dup[i] = code;\n      this.replaceSelections(dup, collapse, origin || \"+input\");\n    },\n    replaceSelections: docMethodOp(function(code, collapse, origin) {\n      var changes = [], sel = this.sel;\n      for (var i = 0; i < sel.ranges.length; i++) {\n        var range = sel.ranges[i];\n        changes[i] = {from: range.from(), to: range.to(), text: splitLines(code[i]), origin: origin};\n      }\n      var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);\n      for (var i = changes.length - 1; i >= 0; i--)\n        makeChange(this, changes[i]);\n      if (newSel) setSelectionReplaceHistory(this, newSel);\n      else if (this.cm) ensureCursorVisible(this.cm);\n    }),\n    undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),\n    redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),\n    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),\n    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),\n\n    setExtending: function(val) {this.extend = val;},\n    getExtending: function() {return this.extend;},\n\n    historySize: function() {\n      var hist = this.history, done = 0, undone = 0;\n      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;\n      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;\n      return {undo: done, redo: undone};\n    },\n    clearHistory: function() {this.history = new History(this.history.maxGeneration);},\n\n    markClean: function() {\n      this.cleanGeneration = this.changeGeneration(true);\n    },\n    changeGeneration: function(forceSplit) {\n      if (forceSplit)\n        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;\n      return this.history.generation;\n    },\n    isClean: function (gen) {\n      return this.history.generation == (gen || this.cleanGeneration);\n    },\n\n    getHistory: function() {\n      return {done: copyHistoryArray(this.history.done),\n              undone: copyHistoryArray(this.history.undone)};\n    },\n    setHistory: function(histData) {\n      var hist = this.history = new History(this.history.maxGeneration);\n      hist.done = copyHistoryArray(histData.done.slice(0), null, true);\n      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\n    },\n\n    addLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        if (!line[prop]) line[prop] = cls;\n        else if (classTest(cls).test(line[prop])) return false;\n        else line[prop] += \" \" + cls;\n        return true;\n      });\n    }),\n    removeLineClass: docMethodOp(function(handle, where, cls) {\n      return changeLine(this, handle, \"class\", function(line) {\n        var prop = where == \"text\" ? \"textClass\"\n                 : where == \"background\" ? \"bgClass\"\n                 : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n        var cur = line[prop];\n        if (!cur) return false;\n        else if (cls == null) line[prop] = null;\n        else {\n          var found = cur.match(classTest(cls));\n          if (!found) return false;\n          var end = found.index + found[0].length;\n          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\n        }\n        return true;\n      });\n    }),\n\n    markText: function(from, to, options) {\n      return markText(this, clipPos(this, from), clipPos(this, to), options, \"range\");\n    },\n    setBookmark: function(pos, options) {\n      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\n                      insertLeft: options && options.insertLeft,\n                      clearWhenEmpty: false, shared: options && options.shared};\n      pos = clipPos(this, pos);\n      return markText(this, pos, pos, realOpts, \"bookmark\");\n    },\n    findMarksAt: function(pos) {\n      pos = clipPos(this, pos);\n      var markers = [], spans = getLine(this, pos.line).markedSpans;\n      if (spans) for (var i = 0; i < spans.length; ++i) {\n        var span = spans[i];\n        if ((span.from == null || span.from <= pos.ch) &&\n            (span.to == null || span.to >= pos.ch))\n          markers.push(span.marker.parent || span.marker);\n      }\n      return markers;\n    },\n    findMarks: function(from, to, filter) {\n      from = clipPos(this, from); to = clipPos(this, to);\n      var found = [], lineNo = from.line;\n      this.iter(from.line, to.line + 1, function(line) {\n        var spans = line.markedSpans;\n        if (spans) for (var i = 0; i < spans.length; i++) {\n          var span = spans[i];\n          if (!(lineNo == from.line && from.ch > span.to ||\n                span.from == null && lineNo != from.line||\n                lineNo == to.line && span.from > to.ch) &&\n              (!filter || filter(span.marker)))\n            found.push(span.marker.parent || span.marker);\n        }\n        ++lineNo;\n      });\n      return found;\n    },\n    getAllMarks: function() {\n      var markers = [];\n      this.iter(function(line) {\n        var sps = line.markedSpans;\n        if (sps) for (var i = 0; i < sps.length; ++i)\n          if (sps[i].from != null) markers.push(sps[i].marker);\n      });\n      return markers;\n    },\n\n    posFromIndex: function(off) {\n      var ch, lineNo = this.first;\n      this.iter(function(line) {\n        var sz = line.text.length + 1;\n        if (sz > off) { ch = off; return true; }\n        off -= sz;\n        ++lineNo;\n      });\n      return clipPos(this, Pos(lineNo, ch));\n    },\n    indexFromPos: function (coords) {\n      coords = clipPos(this, coords);\n      var index = coords.ch;\n      if (coords.line < this.first || coords.ch < 0) return 0;\n      this.iter(this.first, coords.line, function (line) {\n        index += line.text.length + 1;\n      });\n      return index;\n    },\n\n    copy: function(copyHistory) {\n      var doc = new Doc(getLines(this, this.first, this.first + this.size), this.modeOption, this.first);\n      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\n      doc.sel = this.sel;\n      doc.extend = false;\n      if (copyHistory) {\n        doc.history.undoDepth = this.history.undoDepth;\n        doc.setHistory(this.getHistory());\n      }\n      return doc;\n    },\n\n    linkedDoc: function(options) {\n      if (!options) options = {};\n      var from = this.first, to = this.first + this.size;\n      if (options.from != null && options.from > from) from = options.from;\n      if (options.to != null && options.to < to) to = options.to;\n      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from);\n      if (options.sharedHist) copy.history = this.history;\n      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\n      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\n      copySharedMarkers(copy, findSharedMarkers(this));\n      return copy;\n    },\n    unlinkDoc: function(other) {\n      if (other instanceof CodeMirror) other = other.doc;\n      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {\n        var link = this.linked[i];\n        if (link.doc != other) continue;\n        this.linked.splice(i, 1);\n        other.unlinkDoc(this);\n        detachSharedMarkers(findSharedMarkers(this));\n        break;\n      }\n      // If the histories were shared, split them again\n      if (other.history == this.history) {\n        var splitIds = [other.id];\n        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);\n        other.history = new History(null);\n        other.history.done = copyHistoryArray(this.history.done, splitIds);\n        other.history.undone = copyHistoryArray(this.history.undone, splitIds);\n      }\n    },\n    iterLinkedDocs: function(f) {linkedDocs(this, f);},\n\n    getMode: function() {return this.mode;},\n    getEditor: function() {return this.cm;}\n  });\n\n  // Public alias.\n  Doc.prototype.eachLine = Doc.prototype.iter;\n\n  // Set up methods on CodeMirror's prototype to redirect to the editor's document.\n  var dontDelegate = \"iter insert remove copy getEditor\".split(\" \");\n  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\n    CodeMirror.prototype[prop] = (function(method) {\n      return function() {return method.apply(this.doc, arguments);};\n    })(Doc.prototype[prop]);\n\n  eventMixin(Doc);\n\n  // Call f for all linked documents.\n  function linkedDocs(doc, f, sharedHistOnly) {\n    function propagate(doc, skip, sharedHist) {\n      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {\n        var rel = doc.linked[i];\n        if (rel.doc == skip) continue;\n        var shared = sharedHist && rel.sharedHist;\n        if (sharedHistOnly && !shared) continue;\n        f(rel.doc, shared);\n        propagate(rel.doc, doc, shared);\n      }\n    }\n    propagate(doc, null, true);\n  }\n\n  // Attach a document to an editor.\n  function attachDoc(cm, doc) {\n    if (doc.cm) throw new Error(\"This document is already in use.\");\n    cm.doc = doc;\n    doc.cm = cm;\n    estimateLineHeights(cm);\n    loadMode(cm);\n    if (!cm.options.lineWrapping) findMaxLine(cm);\n    cm.options.mode = doc.modeOption;\n    regChange(cm);\n  }\n\n  // LINE UTILITIES\n\n  // Find the line object corresponding to the given line number.\n  function getLine(doc, n) {\n    n -= doc.first;\n    if (n < 0 || n >= doc.size) throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\");\n    for (var chunk = doc; !chunk.lines;) {\n      for (var i = 0;; ++i) {\n        var child = chunk.children[i], sz = child.chunkSize();\n        if (n < sz) { chunk = child; break; }\n        n -= sz;\n      }\n    }\n    return chunk.lines[n];\n  }\n\n  // Get the part of a document between two positions, as an array of\n  // strings.\n  function getBetween(doc, start, end) {\n    var out = [], n = start.line;\n    doc.iter(start.line, end.line + 1, function(line) {\n      var text = line.text;\n      if (n == end.line) text = text.slice(0, end.ch);\n      if (n == start.line) text = text.slice(start.ch);\n      out.push(text);\n      ++n;\n    });\n    return out;\n  }\n  // Get the lines between from and to, as array of strings.\n  function getLines(doc, from, to) {\n    var out = [];\n    doc.iter(from, to, function(line) { out.push(line.text); });\n    return out;\n  }\n\n  // Update the height of a line, propagating the height change\n  // upwards to parent nodes.\n  function updateLineHeight(line, height) {\n    var diff = height - line.height;\n    if (diff) for (var n = line; n; n = n.parent) n.height += diff;\n  }\n\n  // Given a line object, find its line number by walking up through\n  // its parent links.\n  function lineNo(line) {\n    if (line.parent == null) return null;\n    var cur = line.parent, no = indexOf(cur.lines, line);\n    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\n      for (var i = 0;; ++i) {\n        if (chunk.children[i] == cur) break;\n        no += chunk.children[i].chunkSize();\n      }\n    }\n    return no + cur.first;\n  }\n\n  // Find the line at the given vertical position, using the height\n  // information in the document tree.\n  function lineAtHeight(chunk, h) {\n    var n = chunk.first;\n    outer: do {\n      for (var i = 0; i < chunk.children.length; ++i) {\n        var child = chunk.children[i], ch = child.height;\n        if (h < ch) { chunk = child; continue outer; }\n        h -= ch;\n        n += child.chunkSize();\n      }\n      return n;\n    } while (!chunk.lines);\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i], lh = line.height;\n      if (h < lh) break;\n      h -= lh;\n    }\n    return n + i;\n  }\n\n\n  // Find the height above the given line.\n  function heightAtLine(lineObj) {\n    lineObj = visualLine(lineObj);\n\n    var h = 0, chunk = lineObj.parent;\n    for (var i = 0; i < chunk.lines.length; ++i) {\n      var line = chunk.lines[i];\n      if (line == lineObj) break;\n      else h += line.height;\n    }\n    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\n      for (var i = 0; i < p.children.length; ++i) {\n        var cur = p.children[i];\n        if (cur == chunk) break;\n        else h += cur.height;\n      }\n    }\n    return h;\n  }\n\n  // Get the bidi ordering for the given line (and cache it). Returns\n  // false for lines that are fully left-to-right, and an array of\n  // BidiSpan objects otherwise.\n  function getOrder(line) {\n    var order = line.order;\n    if (order == null) order = line.order = bidiOrdering(line.text);\n    return order;\n  }\n\n  // HISTORY\n\n  function History(startGen) {\n    // Arrays of change events and selections. Doing something adds an\n    // event to done and clears undo. Undoing moves events from done\n    // to undone, redoing moves them in the other direction.\n    this.done = []; this.undone = [];\n    this.undoDepth = Infinity;\n    // Used to track when changes can be merged into a single undo\n    // event\n    this.lastModTime = this.lastSelTime = 0;\n    this.lastOp = this.lastSelOp = null;\n    this.lastOrigin = this.lastSelOrigin = null;\n    // Used by the isClean() method\n    this.generation = this.maxGeneration = startGen || 1;\n  }\n\n  // Create a history change event from an updateDoc-style change\n  // object.\n  function historyChangeFromChange(doc, change) {\n    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\n    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\n    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);\n    return histChange;\n  }\n\n  // Pop all selection events off the end of a history array. Stop at\n  // a change event.\n  function clearSelectionEvents(array) {\n    while (array.length) {\n      var last = lst(array);\n      if (last.ranges) array.pop();\n      else break;\n    }\n  }\n\n  // Find the top change event in the history. Pop off selection\n  // events that are in the way.\n  function lastChangeEvent(hist, force) {\n    if (force) {\n      clearSelectionEvents(hist.done);\n      return lst(hist.done);\n    } else if (hist.done.length && !lst(hist.done).ranges) {\n      return lst(hist.done);\n    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\n      hist.done.pop();\n      return lst(hist.done);\n    }\n  }\n\n  // Register a change in the history. Merges changes that are within\n  // a single operation, ore are close together with an origin that\n  // allows merging (starting with \"+\") into a single event.\n  function addChangeToHistory(doc, change, selAfter, opId) {\n    var hist = doc.history;\n    hist.undone.length = 0;\n    var time = +new Date, cur;\n\n    if ((hist.lastOp == opId ||\n         hist.lastOrigin == change.origin && change.origin &&\n         ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||\n          change.origin.charAt(0) == \"*\")) &&\n        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\n      // Merge this change into the last event\n      var last = lst(cur.changes);\n      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\n        // Optimized case for simple insertion -- don't want to add\n        // new changesets for every character typed\n        last.to = changeEnd(change);\n      } else {\n        // Add new sub-event\n        cur.changes.push(historyChangeFromChange(doc, change));\n      }\n    } else {\n      // Can not be merged, start a new event.\n      var before = lst(hist.done);\n      if (!before || !before.ranges)\n        pushSelectionToHistory(doc.sel, hist.done);\n      cur = {changes: [historyChangeFromChange(doc, change)],\n             generation: hist.generation};\n      hist.done.push(cur);\n      while (hist.done.length > hist.undoDepth) {\n        hist.done.shift();\n        if (!hist.done[0].ranges) hist.done.shift();\n      }\n    }\n    hist.done.push(selAfter);\n    hist.generation = ++hist.maxGeneration;\n    hist.lastModTime = hist.lastSelTime = time;\n    hist.lastOp = hist.lastSelOp = opId;\n    hist.lastOrigin = hist.lastSelOrigin = change.origin;\n\n    if (!last) signal(doc, \"historyAdded\");\n  }\n\n  function selectionEventCanBeMerged(doc, origin, prev, sel) {\n    var ch = origin.charAt(0);\n    return ch == \"*\" ||\n      ch == \"+\" &&\n      prev.ranges.length == sel.ranges.length &&\n      prev.somethingSelected() == sel.somethingSelected() &&\n      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);\n  }\n\n  // Called whenever the selection changes, sets the new selection as\n  // the pending selection in the history, and pushes the old pending\n  // selection into the 'done' array when it was significantly\n  // different (in number of selected ranges, emptiness, or time).\n  function addSelectionToHistory(doc, sel, opId, options) {\n    var hist = doc.history, origin = options && options.origin;\n\n    // A new event is started when the previous origin does not match\n    // the current, or the origins don't allow matching. Origins\n    // starting with * are always merged, those starting with + are\n    // merged when similar and close together in time.\n    if (opId == hist.lastSelOp ||\n        (origin && hist.lastSelOrigin == origin &&\n         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\n          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\n      hist.done[hist.done.length - 1] = sel;\n    else\n      pushSelectionToHistory(sel, hist.done);\n\n    hist.lastSelTime = +new Date;\n    hist.lastSelOrigin = origin;\n    hist.lastSelOp = opId;\n    if (options && options.clearRedo !== false)\n      clearSelectionEvents(hist.undone);\n  }\n\n  function pushSelectionToHistory(sel, dest) {\n    var top = lst(dest);\n    if (!(top && top.ranges && top.equals(sel)))\n      dest.push(sel);\n  }\n\n  // Used to store marked span information in the history.\n  function attachLocalSpans(doc, change, from, to) {\n    var existing = change[\"spans_\" + doc.id], n = 0;\n    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {\n      if (line.markedSpans)\n        (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans;\n      ++n;\n    });\n  }\n\n  // When un/re-doing restores text containing marked spans, those\n  // that have been explicitly cleared should not be restored.\n  function removeClearedSpans(spans) {\n    if (!spans) return null;\n    for (var i = 0, out; i < spans.length; ++i) {\n      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }\n      else if (out) out.push(spans[i]);\n    }\n    return !out ? spans : out.length ? out : null;\n  }\n\n  // Retrieve and filter the old marked spans stored in a change event.\n  function getOldSpans(doc, change) {\n    var found = change[\"spans_\" + doc.id];\n    if (!found) return null;\n    for (var i = 0, nw = []; i < change.text.length; ++i)\n      nw.push(removeClearedSpans(found[i]));\n    return nw;\n  }\n\n  // Used both to provide a JSON-safe object in .getHistory, and, when\n  // detaching a document, to split the history in two\n  function copyHistoryArray(events, newGroup, instantiateSel) {\n    for (var i = 0, copy = []; i < events.length; ++i) {\n      var event = events[i];\n      if (event.ranges) {\n        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\n        continue;\n      }\n      var changes = event.changes, newChanges = [];\n      copy.push({changes: newChanges});\n      for (var j = 0; j < changes.length; ++j) {\n        var change = changes[j], m;\n        newChanges.push({from: change.from, to: change.to, text: change.text});\n        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\\d+)$/)) {\n          if (indexOf(newGroup, Number(m[1])) > -1) {\n            lst(newChanges)[prop] = change[prop];\n            delete change[prop];\n          }\n        }\n      }\n    }\n    return copy;\n  }\n\n  // Rebasing/resetting history to deal with externally-sourced changes\n\n  function rebaseHistSelSingle(pos, from, to, diff) {\n    if (to < pos.line) {\n      pos.line += diff;\n    } else if (from < pos.line) {\n      pos.line = from;\n      pos.ch = 0;\n    }\n  }\n\n  // Tries to rebase an array of history events given a change in the\n  // document. If the change touches the same lines as the event, the\n  // event, and everything 'behind' it, is discarded. If the change is\n  // before the event, the event's positions are updated. Uses a\n  // copy-on-write scheme for the positions, to avoid having to\n  // reallocate them all on every rebase, but also avoid problems with\n  // shared position objects being unsafely updated.\n  function rebaseHistArray(array, from, to, diff) {\n    for (var i = 0; i < array.length; ++i) {\n      var sub = array[i], ok = true;\n      if (sub.ranges) {\n        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\n        for (var j = 0; j < sub.ranges.length; j++) {\n          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\n          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\n        }\n        continue;\n      }\n      for (var j = 0; j < sub.changes.length; ++j) {\n        var cur = sub.changes[j];\n        if (to < cur.from.line) {\n          cur.from = Pos(cur.from.line + diff, cur.from.ch);\n          cur.to = Pos(cur.to.line + diff, cur.to.ch);\n        } else if (from <= cur.to.line) {\n          ok = false;\n          break;\n        }\n      }\n      if (!ok) {\n        array.splice(0, i + 1);\n        i = 0;\n      }\n    }\n  }\n\n  function rebaseHist(hist, change) {\n    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\n    rebaseHistArray(hist.done, from, to, diff);\n    rebaseHistArray(hist.undone, from, to, diff);\n  }\n\n  // EVENT UTILITIES\n\n  // Due to the fact that we still support jurassic IE versions, some\n  // compatibility wrappers are needed.\n\n  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {\n    if (e.preventDefault) e.preventDefault();\n    else e.returnValue = false;\n  };\n  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {\n    if (e.stopPropagation) e.stopPropagation();\n    else e.cancelBubble = true;\n  };\n  function e_defaultPrevented(e) {\n    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;\n  }\n  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};\n\n  function e_target(e) {return e.target || e.srcElement;}\n  function e_button(e) {\n    var b = e.which;\n    if (b == null) {\n      if (e.button & 1) b = 1;\n      else if (e.button & 2) b = 3;\n      else if (e.button & 4) b = 2;\n    }\n    if (mac && e.ctrlKey && b == 1) b = 3;\n    return b;\n  }\n\n  // EVENT HANDLING\n\n  // Lightweight event framework. on/off also work on DOM nodes,\n  // registering native DOM handlers.\n\n  var on = CodeMirror.on = function(emitter, type, f) {\n    if (emitter.addEventListener)\n      emitter.addEventListener(type, f, false);\n    else if (emitter.attachEvent)\n      emitter.attachEvent(\"on\" + type, f);\n    else {\n      var map = emitter._handlers || (emitter._handlers = {});\n      var arr = map[type] || (map[type] = []);\n      arr.push(f);\n    }\n  };\n\n  var off = CodeMirror.off = function(emitter, type, f) {\n    if (emitter.removeEventListener)\n      emitter.removeEventListener(type, f, false);\n    else if (emitter.detachEvent)\n      emitter.detachEvent(\"on\" + type, f);\n    else {\n      var arr = emitter._handlers && emitter._handlers[type];\n      if (!arr) return;\n      for (var i = 0; i < arr.length; ++i)\n        if (arr[i] == f) { arr.splice(i, 1); break; }\n    }\n  };\n\n  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2);\n    for (var i = 0; i < arr.length; ++i) arr[i].apply(null, args);\n  };\n\n  var orphanDelayedCallbacks = null;\n\n  // Often, we want to signal events at a point where we are in the\n  // middle of some work, but don't want the handler to start calling\n  // other methods on the editor, which might be in an inconsistent\n  // state or simply not expect any other events to happen.\n  // signalLater looks whether there are any handlers, and schedules\n  // them to be executed when the last operation ends, or, if no\n  // operation is active, when a timeout fires.\n  function signalLater(emitter, type /*, values...*/) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    if (!arr) return;\n    var args = Array.prototype.slice.call(arguments, 2), list;\n    if (operationGroup) {\n      list = operationGroup.delayedCallbacks;\n    } else if (orphanDelayedCallbacks) {\n      list = orphanDelayedCallbacks;\n    } else {\n      list = orphanDelayedCallbacks = [];\n      setTimeout(fireOrphanDelayed, 0);\n    }\n    function bnd(f) {return function(){f.apply(null, args);};};\n    for (var i = 0; i < arr.length; ++i)\n      list.push(bnd(arr[i]));\n  }\n\n  function fireOrphanDelayed() {\n    var delayed = orphanDelayedCallbacks;\n    orphanDelayedCallbacks = null;\n    for (var i = 0; i < delayed.length; ++i) delayed[i]();\n  }\n\n  // The DOM events that CodeMirror handles can be overridden by\n  // registering a (non-DOM) handler on the editor for the event name,\n  // and preventDefault-ing the event in that handler.\n  function signalDOMEvent(cm, e, override) {\n    if (typeof e == \"string\")\n      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};\n    signal(cm, override || e.type, cm, e);\n    return e_defaultPrevented(e) || e.codemirrorIgnore;\n  }\n\n  function signalCursorActivity(cm) {\n    var arr = cm._handlers && cm._handlers.cursorActivity;\n    if (!arr) return;\n    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\n    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)\n      set.push(arr[i]);\n  }\n\n  function hasHandler(emitter, type) {\n    var arr = emitter._handlers && emitter._handlers[type];\n    return arr && arr.length > 0;\n  }\n\n  // Add on and off methods to a constructor's prototype, to make\n  // registering events on such objects more convenient.\n  function eventMixin(ctor) {\n    ctor.prototype.on = function(type, f) {on(this, type, f);};\n    ctor.prototype.off = function(type, f) {off(this, type, f);};\n  }\n\n  // MISC UTILITIES\n\n  // Number of pixels added to scroller and sizer to hide scrollbar\n  var scrollerCutOff = 30;\n\n  // Returned or thrown by various protocols to signal 'I'm not\n  // handling this'.\n  var Pass = CodeMirror.Pass = {toString: function(){return \"CodeMirror.Pass\";}};\n\n  // Reused option objects for setSelection & friends\n  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: \"*mouse\"}, sel_move = {origin: \"+move\"};\n\n  function Delayed() {this.id = null;}\n  Delayed.prototype.set = function(ms, f) {\n    clearTimeout(this.id);\n    this.id = setTimeout(f, ms);\n  };\n\n  // Counts the column offset in a string, taking tabs into account.\n  // Used mostly to find indentation.\n  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {\n    if (end == null) {\n      end = string.search(/[^\\s\\u00a0]/);\n      if (end == -1) end = string.length;\n    }\n    for (var i = startIndex || 0, n = startValue || 0;;) {\n      var nextTab = string.indexOf(\"\\t\", i);\n      if (nextTab < 0 || nextTab >= end)\n        return n + (end - i);\n      n += nextTab - i;\n      n += tabSize - (n % tabSize);\n      i = nextTab + 1;\n    }\n  };\n\n  // The inverse of countColumn -- find the offset that corresponds to\n  // a particular column.\n  function findColumn(string, goal, tabSize) {\n    for (var pos = 0, col = 0;;) {\n      var nextTab = string.indexOf(\"\\t\", pos);\n      if (nextTab == -1) nextTab = string.length;\n      var skipped = nextTab - pos;\n      if (nextTab == string.length || col + skipped >= goal)\n        return pos + Math.min(skipped, goal - col);\n      col += nextTab - pos;\n      col += tabSize - (col % tabSize);\n      pos = nextTab + 1;\n      if (col >= goal) return pos;\n    }\n  }\n\n  var spaceStrs = [\"\"];\n  function spaceStr(n) {\n    while (spaceStrs.length <= n)\n      spaceStrs.push(lst(spaceStrs) + \" \");\n    return spaceStrs[n];\n  }\n\n  function lst(arr) { return arr[arr.length-1]; }\n\n  var selectInput = function(node) { node.select(); };\n  if (ios) // Mobile Safari apparently has a bug where select() is broken.\n    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };\n  else if (ie) // Suppress mysterious IE10 errors\n    selectInput = function(node) { try { node.select(); } catch(_e) {} };\n\n  function indexOf(array, elt) {\n    for (var i = 0; i < array.length; ++i)\n      if (array[i] == elt) return i;\n    return -1;\n  }\n  if ([].indexOf) indexOf = function(array, elt) { return array.indexOf(elt); };\n  function map(array, f) {\n    var out = [];\n    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);\n    return out;\n  }\n  if ([].map) map = function(array, f) { return array.map(f); };\n\n  function createObj(base, props) {\n    var inst;\n    if (Object.create) {\n      inst = Object.create(base);\n    } else {\n      var ctor = function() {};\n      ctor.prototype = base;\n      inst = new ctor();\n    }\n    if (props) copyObj(props, inst);\n    return inst;\n  };\n\n  function copyObj(obj, target, overwrite) {\n    if (!target) target = {};\n    for (var prop in obj)\n      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\n        target[prop] = obj[prop];\n    return target;\n  }\n\n  function bind(f) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    return function(){return f.apply(null, args);};\n  }\n\n  var nonASCIISingleCaseWordChar = /[\\u00df\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\n  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {\n    return /\\w/.test(ch) || ch > \"\\x80\" &&\n      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));\n  };\n  function isWordChar(ch, helper) {\n    if (!helper) return isWordCharBasic(ch);\n    if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) return true;\n    return helper.test(ch);\n  }\n\n  function isEmpty(obj) {\n    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;\n    return true;\n  }\n\n  // Extending unicode characters. A series of a non-extending char +\n  // any number of extending chars is treated as a single unit as far\n  // as editing and measuring is concerned. This is not fully correct,\n  // since some scripts/fonts/browsers also treat other configurations\n  // of code points as a group.\n  var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\n  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }\n\n  // DOM UTILITIES\n\n  function elt(tag, content, className, style) {\n    var e = document.createElement(tag);\n    if (className) e.className = className;\n    if (style) e.style.cssText = style;\n    if (typeof content == \"string\") e.appendChild(document.createTextNode(content));\n    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\n    return e;\n  }\n\n  var range;\n  if (document.createRange) range = function(node, start, end) {\n    var r = document.createRange();\n    r.setEnd(node, end);\n    r.setStart(node, start);\n    return r;\n  };\n  else range = function(node, start, end) {\n    var r = document.body.createTextRange();\n    try { r.moveToElementText(node.parentNode); }\n    catch(e) { return r; }\n    r.collapse(true);\n    r.moveEnd(\"character\", end);\n    r.moveStart(\"character\", start);\n    return r;\n  };\n\n  function removeChildren(e) {\n    for (var count = e.childNodes.length; count > 0; --count)\n      e.removeChild(e.firstChild);\n    return e;\n  }\n\n  function removeChildrenAndAdd(parent, e) {\n    return removeChildren(parent).appendChild(e);\n  }\n\n  function contains(parent, child) {\n    if (parent.contains)\n      return parent.contains(child);\n    while (child = child.parentNode)\n      if (child == parent) return true;\n  }\n\n  function activeElt() { return document.activeElement; }\n  // Older versions of IE throws unspecified error when touching\n  // document.activeElement in some cases (during loading, in iframe)\n  if (ie && ie_version < 11) activeElt = function() {\n    try { return document.activeElement; }\n    catch(e) { return document.body; }\n  };\n\n  function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\"); }\n  var rmClass = CodeMirror.rmClass = function(node, cls) {\n    var current = node.className;\n    var match = classTest(cls).exec(current);\n    if (match) {\n      var after = current.slice(match.index + match[0].length);\n      node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");\n    }\n  };\n  var addClass = CodeMirror.addClass = function(node, cls) {\n    var current = node.className;\n    if (!classTest(cls).test(current)) node.className += (current ? \" \" : \"\") + cls;\n  };\n  function joinClasses(a, b) {\n    var as = a.split(\" \");\n    for (var i = 0; i < as.length; i++)\n      if (as[i] && !classTest(as[i]).test(b)) b += \" \" + as[i];\n    return b;\n  }\n\n  // WINDOW-WIDE EVENTS\n\n  // These must be handled carefully, because naively registering a\n  // handler for each editor will cause the editors to never be\n  // garbage collected.\n\n  function forEachCodeMirror(f) {\n    if (!document.body.getElementsByClassName) return;\n    var byClass = document.body.getElementsByClassName(\"CodeMirror\");\n    for (var i = 0; i < byClass.length; i++) {\n      var cm = byClass[i].CodeMirror;\n      if (cm) f(cm);\n    }\n  }\n\n  var globalsRegistered = false;\n  function ensureGlobalHandlers() {\n    if (globalsRegistered) return;\n    registerGlobalHandlers();\n    globalsRegistered = true;\n  }\n  function registerGlobalHandlers() {\n    // When the window resizes, we need to refresh active editors.\n    var resizeTimer;\n    on(window, \"resize\", function() {\n      if (resizeTimer == null) resizeTimer = setTimeout(function() {\n        resizeTimer = null;\n        knownScrollbarWidth = null;\n        forEachCodeMirror(onResize);\n      }, 100);\n    });\n    // When the window loses focus, we want to show the editor as blurred\n    on(window, \"blur\", function() {\n      forEachCodeMirror(onBlur);\n    });\n  }\n\n  // FEATURE DETECTION\n\n  // Detect drag-and-drop\n  var dragAndDrop = function() {\n    // There is *some* kind of drag-and-drop support in IE6-8, but I\n    // couldn't get it to work yet.\n    if (ie && ie_version < 9) return false;\n    var div = elt('div');\n    return \"draggable\" in div || \"dragDrop\" in div;\n  }();\n\n  var knownScrollbarWidth;\n  function scrollbarWidth(measure) {\n    if (knownScrollbarWidth != null) return knownScrollbarWidth;\n    var test = elt(\"div\", null, null, \"width: 50px; height: 50px; overflow-x: scroll\");\n    removeChildrenAndAdd(measure, test);\n    if (test.offsetWidth)\n      knownScrollbarWidth = test.offsetHeight - test.clientHeight;\n    return knownScrollbarWidth || 0;\n  }\n\n  var zwspSupported;\n  function zeroWidthElement(measure) {\n    if (zwspSupported == null) {\n      var test = elt(\"span\", \"\\u200b\");\n      removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\n      if (measure.firstChild.offsetHeight != 0)\n        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);\n    }\n    if (zwspSupported) return elt(\"span\", \"\\u200b\");\n    else return elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\n  }\n\n  // Feature-detect IE's crummy client rect reporting for bidi text\n  var badBidiRects;\n  function hasBadBidiRects(measure) {\n    if (badBidiRects != null) return badBidiRects;\n    var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));\n    var r0 = range(txt, 0, 1).getBoundingClientRect();\n    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)\n    var r1 = range(txt, 1, 2).getBoundingClientRect();\n    return badBidiRects = (r1.right - r0.right < 3);\n  }\n\n  // See if \"\".split is the broken IE version, if so, provide an\n  // alternative way to split lines.\n  var splitLines = CodeMirror.splitLines = \"\\n\\nb\".split(/\\n/).length != 3 ? function(string) {\n    var pos = 0, result = [], l = string.length;\n    while (pos <= l) {\n      var nl = string.indexOf(\"\\n\", pos);\n      if (nl == -1) nl = string.length;\n      var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\n      var rt = line.indexOf(\"\\r\");\n      if (rt != -1) {\n        result.push(line.slice(0, rt));\n        pos += rt + 1;\n      } else {\n        result.push(line);\n        pos = nl + 1;\n      }\n    }\n    return result;\n  } : function(string){return string.split(/\\r\\n?|\\n/);};\n\n  var hasSelection = window.getSelection ? function(te) {\n    try { return te.selectionStart != te.selectionEnd; }\n    catch(e) { return false; }\n  } : function(te) {\n    try {var range = te.ownerDocument.selection.createRange();}\n    catch(e) {}\n    if (!range || range.parentElement() != te) return false;\n    return range.compareEndPoints(\"StartToEnd\", range) != 0;\n  };\n\n  var hasCopyEvent = (function() {\n    var e = elt(\"div\");\n    if (\"oncopy\" in e) return true;\n    e.setAttribute(\"oncopy\", \"return;\");\n    return typeof e.oncopy == \"function\";\n  })();\n\n  var badZoomedRects = null;\n  function hasBadZoomedRects(measure) {\n    if (badZoomedRects != null) return badZoomedRects;\n    var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));\n    var normal = node.getBoundingClientRect();\n    var fromRange = range(node, 0, 1).getBoundingClientRect();\n    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;\n  }\n\n  // KEY NAMES\n\n  var keyNames = {3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\n                  19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\n                  36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\n                  46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\", 107: \"=\", 109: \"-\", 127: \"Delete\",\n                  173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\n                  221: \"]\", 222: \"'\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",\n                  63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"};\n  CodeMirror.keyNames = keyNames;\n  (function() {\n    // Number keys\n    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);\n    // Alphabetic keys\n    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);\n    // Function keys\n    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = \"F\" + i;\n  })();\n\n  // BIDI HELPERS\n\n  function iterateBidiSections(order, from, to, f) {\n    if (!order) return f(from, to, \"ltr\");\n    var found = false;\n    for (var i = 0; i < order.length; ++i) {\n      var part = order[i];\n      if (part.from < to && part.to > from || from == to && part.to == from) {\n        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\n        found = true;\n      }\n    }\n    if (!found) f(from, to, \"ltr\");\n  }\n\n  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }\n  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }\n\n  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }\n  function lineRight(line) {\n    var order = getOrder(line);\n    if (!order) return line.text.length;\n    return bidiRight(lst(order));\n  }\n\n  function lineStart(cm, lineN) {\n    var line = getLine(cm.doc, lineN);\n    var visual = visualLine(line);\n    if (visual != line) lineN = lineNo(visual);\n    var order = getOrder(visual);\n    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);\n    return Pos(lineN, ch);\n  }\n  function lineEnd(cm, lineN) {\n    var merged, line = getLine(cm.doc, lineN);\n    while (merged = collapsedSpanAtEnd(line)) {\n      line = merged.find(1, true).line;\n      lineN = null;\n    }\n    var order = getOrder(line);\n    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);\n    return Pos(lineN == null ? lineNo(line) : lineN, ch);\n  }\n  function lineStartSmart(cm, pos) {\n    var start = lineStart(cm, pos.line);\n    var line = getLine(cm.doc, start.line);\n    var order = getOrder(line);\n    if (!order || order[0].level == 0) {\n      var firstNonWS = Math.max(0, line.text.search(/\\S/));\n      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\n      return Pos(start.line, inWS ? 0 : firstNonWS);\n    }\n    return start;\n  }\n\n  function compareBidiLevel(order, a, b) {\n    var linedir = order[0].level;\n    if (a == linedir) return true;\n    if (b == linedir) return false;\n    return a < b;\n  }\n  var bidiOther;\n  function getBidiPartAt(order, pos) {\n    bidiOther = null;\n    for (var i = 0, found; i < order.length; ++i) {\n      var cur = order[i];\n      if (cur.from < pos && cur.to > pos) return i;\n      if ((cur.from == pos || cur.to == pos)) {\n        if (found == null) {\n          found = i;\n        } else if (compareBidiLevel(order, cur.level, order[found].level)) {\n          if (cur.from != cur.to) bidiOther = found;\n          return i;\n        } else {\n          if (cur.from != cur.to) bidiOther = i;\n          return found;\n        }\n      }\n    }\n    return found;\n  }\n\n  function moveInLine(line, pos, dir, byUnit) {\n    if (!byUnit) return pos + dir;\n    do pos += dir;\n    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));\n    return pos;\n  }\n\n  // This is needed in order to move 'visually' through bi-directional\n  // text -- i.e., pressing left should make the cursor go left, even\n  // when in RTL text. The tricky part is the 'jumps', where RTL and\n  // LTR text touch each other. This often requires the cursor offset\n  // to move more than one unit, in order to visually move one unit.\n  function moveVisually(line, start, dir, byUnit) {\n    var bidi = getOrder(line);\n    if (!bidi) return moveLogically(line, start, dir, byUnit);\n    var pos = getBidiPartAt(bidi, start), part = bidi[pos];\n    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);\n\n    for (;;) {\n      if (target > part.from && target < part.to) return target;\n      if (target == part.from || target == part.to) {\n        if (getBidiPartAt(bidi, target) == pos) return target;\n        part = bidi[pos += dir];\n        return (dir > 0) == part.level % 2 ? part.to : part.from;\n      } else {\n        part = bidi[pos += dir];\n        if (!part) return null;\n        if ((dir > 0) == part.level % 2)\n          target = moveInLine(line, part.to, -1, byUnit);\n        else\n          target = moveInLine(line, part.from, 1, byUnit);\n      }\n    }\n  }\n\n  function moveLogically(line, start, dir, byUnit) {\n    var target = start + dir;\n    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;\n    return target < 0 || target > line.text.length ? null : target;\n  }\n\n  // Bidirectional ordering algorithm\n  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\n  // that this (partially) implements.\n\n  // One-char codes used for character types:\n  // L (L):   Left-to-Right\n  // R (R):   Right-to-Left\n  // r (AL):  Right-to-Left Arabic\n  // 1 (EN):  European Number\n  // + (ES):  European Number Separator\n  // % (ET):  European Number Terminator\n  // n (AN):  Arabic Number\n  // , (CS):  Common Number Separator\n  // m (NSM): Non-Spacing Mark\n  // b (BN):  Boundary Neutral\n  // s (B):   Paragraph Separator\n  // t (S):   Segment Separator\n  // w (WS):  Whitespace\n  // N (ON):  Other Neutrals\n\n  // Returns null if characters are ordered as they appear\n  // (left-to-right), or an array of sections ({from, to, level}\n  // objects) in the order in which they occur visually.\n  var bidiOrdering = (function() {\n    // Character types for codepoints 0 to 0xff\n    var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";\n    // Character types for codepoints 0x600 to 0x6ff\n    var arabicTypes = \"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm\";\n    function charType(code) {\n      if (code <= 0xf7) return lowTypes.charAt(code);\n      else if (0x590 <= code && code <= 0x5f4) return \"R\";\n      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);\n      else if (0x6ee <= code && code <= 0x8ac) return \"r\";\n      else if (0x2000 <= code && code <= 0x200b) return \"w\";\n      else if (code == 0x200c) return \"b\";\n      else return \"L\";\n    }\n\n    var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\n    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\n    // Browsers seem to always treat the boundaries of block elements as being L.\n    var outerType = \"L\";\n\n    function BidiSpan(level, from, to) {\n      this.level = level;\n      this.from = from; this.to = to;\n    }\n\n    return function(str) {\n      if (!bidiRE.test(str)) return false;\n      var len = str.length, types = [];\n      for (var i = 0, type; i < len; ++i)\n        types.push(type = charType(str.charCodeAt(i)));\n\n      // W1. Examine each non-spacing mark (NSM) in the level run, and\n      // change the type of the NSM to the type of the previous\n      // character. If the NSM is at the start of the level run, it will\n      // get the type of sor.\n      for (var i = 0, prev = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"m\") types[i] = prev;\n        else prev = type;\n      }\n\n      // W2. Search backwards from each instance of a European number\n      // until the first strong type (R, L, AL, or sor) is found. If an\n      // AL is found, change the type of the European number to Arabic\n      // number.\n      // W3. Change all ALs to R.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (type == \"1\" && cur == \"r\") types[i] = \"n\";\n        else if (isStrong.test(type)) { cur = type; if (type == \"r\") types[i] = \"R\"; }\n      }\n\n      // W4. A single European separator between two European numbers\n      // changes to a European number. A single common separator between\n      // two numbers of the same type changes to that type.\n      for (var i = 1, prev = types[0]; i < len - 1; ++i) {\n        var type = types[i];\n        if (type == \"+\" && prev == \"1\" && types[i+1] == \"1\") types[i] = \"1\";\n        else if (type == \",\" && prev == types[i+1] &&\n                 (prev == \"1\" || prev == \"n\")) types[i] = prev;\n        prev = type;\n      }\n\n      // W5. A sequence of European terminators adjacent to European\n      // numbers changes to all European numbers.\n      // W6. Otherwise, separators and terminators change to Other\n      // Neutral.\n      for (var i = 0; i < len; ++i) {\n        var type = types[i];\n        if (type == \",\") types[i] = \"N\";\n        else if (type == \"%\") {\n          for (var end = i + 1; end < len && types[end] == \"%\"; ++end) {}\n          var replace = (i && types[i-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // W7. Search backwards from each instance of a European number\n      // until the first strong type (R, L, or sor) is found. If an L is\n      // found, then change the type of the European number to L.\n      for (var i = 0, cur = outerType; i < len; ++i) {\n        var type = types[i];\n        if (cur == \"L\" && type == \"1\") types[i] = \"L\";\n        else if (isStrong.test(type)) cur = type;\n      }\n\n      // N1. A sequence of neutrals takes the direction of the\n      // surrounding strong text if the text on both sides has the same\n      // direction. European and Arabic numbers act as if they were R in\n      // terms of their influence on neutrals. Start-of-level-run (sor)\n      // and end-of-level-run (eor) are used at level run boundaries.\n      // N2. Any remaining neutrals take the embedding direction.\n      for (var i = 0; i < len; ++i) {\n        if (isNeutral.test(types[i])) {\n          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}\n          var before = (i ? types[i-1] : outerType) == \"L\";\n          var after = (end < len ? types[end] : outerType) == \"L\";\n          var replace = before || after ? \"L\" : \"R\";\n          for (var j = i; j < end; ++j) types[j] = replace;\n          i = end - 1;\n        }\n      }\n\n      // Here we depart from the documented algorithm, in order to avoid\n      // building up an actual levels array. Since there are only three\n      // levels (0, 1, 2) in an implementation that doesn't take\n      // explicit embedding into account, we can build up the order on\n      // the fly, without following the level-based algorithm.\n      var order = [], m;\n      for (var i = 0; i < len;) {\n        if (countsAsLeft.test(types[i])) {\n          var start = i;\n          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}\n          order.push(new BidiSpan(0, start, i));\n        } else {\n          var pos = i, at = order.length;\n          for (++i; i < len && types[i] != \"L\"; ++i) {}\n          for (var j = pos; j < i;) {\n            if (countsAsNum.test(types[j])) {\n              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));\n              var nstart = j;\n              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}\n              order.splice(at, 0, new BidiSpan(2, nstart, j));\n              pos = j;\n            } else ++j;\n          }\n          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));\n        }\n      }\n      if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\n        order[0].from = m[0].length;\n        order.unshift(new BidiSpan(0, 0, m[0].length));\n      }\n      if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\n        lst(order).to -= m[0].length;\n        order.push(new BidiSpan(0, len - m[0].length, len));\n      }\n      if (order[0].level != lst(order).level)\n        order.push(new BidiSpan(order[0].level, len, len));\n\n      return order;\n    };\n  })();\n\n  // THE END\n\n  CodeMirror.version = \"4.8.0\";\n\n  return CodeMirror;\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  var ie_lt8 = /MSIE \\d/.test(navigator.userAgent) &&\n    (document.documentMode == null || document.documentMode < 8);\n\n  var Pos = CodeMirror.Pos;\n\n  var matching = {\"(\": \")>\", \")\": \"(<\", \"[\": \"]>\", \"]\": \"[<\", \"{\": \"}>\", \"}\": \"{<\"};\n\n  function findMatchingBracket(cm, where, strict, config) {\n    var line = cm.getLineHandle(where.line), pos = where.ch - 1;\n    var match = (pos >= 0 && matching[line.text.charAt(pos)]) || matching[line.text.charAt(++pos)];\n    if (!match) return null;\n    var dir = match.charAt(1) == \">\" ? 1 : -1;\n    if (strict && (dir > 0) != (pos == where.ch)) return null;\n    var style = cm.getTokenTypeAt(Pos(where.line, pos + 1));\n\n    var found = scanForBracket(cm, Pos(where.line, pos + (dir > 0 ? 1 : 0)), dir, style || null, config);\n    if (found == null) return null;\n    return {from: Pos(where.line, pos), to: found && found.pos,\n            match: found && found.ch == match.charAt(0), forward: dir > 0};\n  }\n\n  // bracketRegex is used to specify which type of bracket to scan\n  // should be a regexp, e.g. /[[\\]]/\n  //\n  // Note: If \"where\" is on an open bracket, then this bracket is ignored.\n  //\n  // Returns false when no bracket was found, null when it reached\n  // maxScanLines and gave up\n  function scanForBracket(cm, where, dir, style, config) {\n    var maxScanLen = (config && config.maxScanLineLength) || 10000;\n    var maxScanLines = (config && config.maxScanLines) || 1000;\n\n    var stack = [];\n    var re = config && config.bracketRegex ? config.bracketRegex : /[(){}[\\]]/;\n    var lineEnd = dir > 0 ? Math.min(where.line + maxScanLines, cm.lastLine() + 1)\n                          : Math.max(cm.firstLine() - 1, where.line - maxScanLines);\n    for (var lineNo = where.line; lineNo != lineEnd; lineNo += dir) {\n      var line = cm.getLine(lineNo);\n      if (!line) continue;\n      var pos = dir > 0 ? 0 : line.length - 1, end = dir > 0 ? line.length : -1;\n      if (line.length > maxScanLen) continue;\n      if (lineNo == where.line) pos = where.ch - (dir < 0 ? 1 : 0);\n      for (; pos != end; pos += dir) {\n        var ch = line.charAt(pos);\n        if (re.test(ch) && (style === undefined || cm.getTokenTypeAt(Pos(lineNo, pos + 1)) == style)) {\n          var match = matching[ch];\n          if ((match.charAt(1) == \">\") == (dir > 0)) stack.push(ch);\n          else if (!stack.length) return {pos: Pos(lineNo, pos), ch: ch};\n          else stack.pop();\n        }\n      }\n    }\n    return lineNo - dir == (dir > 0 ? cm.lastLine() : cm.firstLine()) ? false : null;\n  }\n\n  function matchBrackets(cm, autoclear, config) {\n    // Disable brace matching in long lines, since it'll cause hugely slow updates\n    var maxHighlightLen = cm.state.matchBrackets.maxHighlightLineLength || 1000;\n    var marks = [], ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      var match = ranges[i].empty() && findMatchingBracket(cm, ranges[i].head, false, config);\n      if (match && cm.getLine(match.from.line).length <= maxHighlightLen) {\n        var style = match.match ? \"CodeMirror-matchingbracket\" : \"CodeMirror-nonmatchingbracket\";\n        marks.push(cm.markText(match.from, Pos(match.from.line, match.from.ch + 1), {className: style}));\n        if (match.to && cm.getLine(match.to.line).length <= maxHighlightLen)\n          marks.push(cm.markText(match.to, Pos(match.to.line, match.to.ch + 1), {className: style}));\n      }\n    }\n\n    if (marks.length) {\n      // Kludge to work around the IE bug from issue #1193, where text\n      // input stops going to the textare whever this fires.\n      if (ie_lt8 && cm.state.focused) cm.display.input.focus();\n\n      var clear = function() {\n        cm.operation(function() {\n          for (var i = 0; i < marks.length; i++) marks[i].clear();\n        });\n      };\n      if (autoclear) setTimeout(clear, 800);\n      else return clear;\n    }\n  }\n\n  var currentlyHighlighted = null;\n  function doMatchBrackets(cm) {\n    cm.operation(function() {\n      if (currentlyHighlighted) {currentlyHighlighted(); currentlyHighlighted = null;}\n      currentlyHighlighted = matchBrackets(cm, false, cm.state.matchBrackets);\n    });\n  }\n\n  CodeMirror.defineOption(\"matchBrackets\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init)\n      cm.off(\"cursorActivity\", doMatchBrackets);\n    if (val) {\n      cm.state.matchBrackets = typeof val == \"object\" ? val : {};\n      cm.on(\"cursorActivity\", doMatchBrackets);\n    }\n  });\n\n  CodeMirror.defineExtension(\"matchBrackets\", function() {matchBrackets(this, true);});\n  CodeMirror.defineExtension(\"findMatchingBracket\", function(pos, strict, config){\n    return findMatchingBracket(this, pos, strict, config);\n  });\n  CodeMirror.defineExtension(\"scanForBracket\", function(pos, dir, style, config){\n    return scanForBracket(this, pos, dir, style, config);\n  });\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  function doFold(cm, pos, options, force) {\n    if (options && options.call) {\n      var finder = options;\n      options = null;\n    } else {\n      var finder = getOption(cm, options, \"rangeFinder\");\n    }\n    if (typeof pos == \"number\") pos = CodeMirror.Pos(pos, 0);\n    var minSize = getOption(cm, options, \"minFoldSize\");\n\n    function getRange(allowFolded) {\n      var range = finder(cm, pos);\n      if (!range || range.to.line - range.from.line < minSize) return null;\n      var marks = cm.findMarksAt(range.from);\n      for (var i = 0; i < marks.length; ++i) {\n        if (marks[i].__isFold && force !== \"fold\") {\n          if (!allowFolded) return null;\n          range.cleared = true;\n          marks[i].clear();\n        }\n      }\n      return range;\n    }\n\n    var range = getRange(true);\n    if (getOption(cm, options, \"scanUp\")) while (!range && pos.line > cm.firstLine()) {\n      pos = CodeMirror.Pos(pos.line - 1, 0);\n      range = getRange(false);\n    }\n    if (!range || range.cleared || force === \"unfold\") return;\n\n    var myWidget = makeWidget(cm, options);\n    CodeMirror.on(myWidget, \"mousedown\", function(e) {\n      myRange.clear();\n      CodeMirror.e_preventDefault(e);\n    });\n    var myRange = cm.markText(range.from, range.to, {\n      replacedWith: myWidget,\n      clearOnEnter: true,\n      __isFold: true\n    });\n    myRange.on(\"clear\", function(from, to) {\n      CodeMirror.signal(cm, \"unfold\", cm, from, to);\n    });\n    CodeMirror.signal(cm, \"fold\", cm, range.from, range.to);\n  }\n\n  function makeWidget(cm, options) {\n    var widget = getOption(cm, options, \"widget\");\n    if (typeof widget == \"string\") {\n      var text = document.createTextNode(widget);\n      widget = document.createElement(\"span\");\n      widget.appendChild(text);\n      widget.className = \"CodeMirror-foldmarker\";\n    }\n    return widget;\n  }\n\n  // Clumsy backwards-compatible interface\n  CodeMirror.newFoldFunction = function(rangeFinder, widget) {\n    return function(cm, pos) { doFold(cm, pos, {rangeFinder: rangeFinder, widget: widget}); };\n  };\n\n  // New-style interface\n  CodeMirror.defineExtension(\"foldCode\", function(pos, options, force) {\n    doFold(this, pos, options, force);\n  });\n\n  CodeMirror.defineExtension(\"isFolded\", function(pos) {\n    var marks = this.findMarksAt(pos);\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold) return true;\n  });\n\n  CodeMirror.commands.toggleFold = function(cm) {\n    cm.foldCode(cm.getCursor());\n  };\n  CodeMirror.commands.fold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"fold\");\n  };\n  CodeMirror.commands.unfold = function(cm) {\n    cm.foldCode(cm.getCursor(), null, \"unfold\");\n  };\n  CodeMirror.commands.foldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"fold\");\n    });\n  };\n  CodeMirror.commands.unfoldAll = function(cm) {\n    cm.operation(function() {\n      for (var i = cm.firstLine(), e = cm.lastLine(); i <= e; i++)\n        cm.foldCode(CodeMirror.Pos(i, 0), null, \"unfold\");\n    });\n  };\n\n  CodeMirror.registerHelper(\"fold\", \"combine\", function() {\n    var funcs = Array.prototype.slice.call(arguments, 0);\n    return function(cm, start) {\n      for (var i = 0; i < funcs.length; ++i) {\n        var found = funcs[i](cm, start);\n        if (found) return found;\n      }\n    };\n  });\n\n  CodeMirror.registerHelper(\"fold\", \"auto\", function(cm, start) {\n    var helpers = cm.getHelpers(start, \"fold\");\n    for (var i = 0; i < helpers.length; i++) {\n      var cur = helpers[i](cm, start);\n      if (cur) return cur;\n    }\n  });\n\n  var defaultOptions = {\n    rangeFinder: CodeMirror.fold.auto,\n    widget: \"\\u2194\",\n    minFoldSize: 0,\n    scanUp: false\n  };\n\n  CodeMirror.defineOption(\"foldOptions\", null);\n\n  function getOption(cm, options, name) {\n    if (options && options[name] !== undefined)\n      return options[name];\n    var editorOptions = cm.options.foldOptions;\n    if (editorOptions && editorOptions[name] !== undefined)\n      return editorOptions[name];\n    return defaultOptions[name];\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./foldcode\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./foldcode\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineOption(\"foldGutter\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.clearGutter(cm.state.foldGutter.options.gutter);\n      cm.state.foldGutter = null;\n      cm.off(\"gutterClick\", onGutterClick);\n      cm.off(\"change\", onChange);\n      cm.off(\"viewportChange\", onViewportChange);\n      cm.off(\"fold\", onFold);\n      cm.off(\"unfold\", onFold);\n      cm.off(\"swapDoc\", updateInViewport);\n    }\n    if (val) {\n      cm.state.foldGutter = new State(parseOptions(val));\n      updateInViewport(cm);\n      cm.on(\"gutterClick\", onGutterClick);\n      cm.on(\"change\", onChange);\n      cm.on(\"viewportChange\", onViewportChange);\n      cm.on(\"fold\", onFold);\n      cm.on(\"unfold\", onFold);\n      cm.on(\"swapDoc\", updateInViewport);\n    }\n  });\n\n  var Pos = CodeMirror.Pos;\n\n  function State(options) {\n    this.options = options;\n    this.from = this.to = 0;\n  }\n\n  function parseOptions(opts) {\n    if (opts === true) opts = {};\n    if (opts.gutter == null) opts.gutter = \"CodeMirror-foldgutter\";\n    if (opts.indicatorOpen == null) opts.indicatorOpen = \"CodeMirror-foldgutter-open\";\n    if (opts.indicatorFolded == null) opts.indicatorFolded = \"CodeMirror-foldgutter-folded\";\n    return opts;\n  }\n\n  function isFolded(cm, line) {\n    var marks = cm.findMarksAt(Pos(line));\n    for (var i = 0; i < marks.length; ++i)\n      if (marks[i].__isFold && marks[i].find().from.line == line) return true;\n  }\n\n  function marker(spec) {\n    if (typeof spec == \"string\") {\n      var elt = document.createElement(\"div\");\n      elt.className = spec + \" CodeMirror-guttermarker-subtle\";\n      return elt;\n    } else {\n      return spec.cloneNode(true);\n    }\n  }\n\n  function updateFoldInfo(cm, from, to) {\n    var opts = cm.state.foldGutter.options, cur = from;\n    cm.eachLine(from, to, function(line) {\n      var mark = null;\n      if (isFolded(cm, cur)) {\n        mark = marker(opts.indicatorFolded);\n      } else {\n        var pos = Pos(cur, 0), func = opts.rangeFinder || CodeMirror.fold.auto;\n        var range = func && func(cm, pos);\n        if (range && range.from.line + 1 < range.to.line)\n          mark = marker(opts.indicatorOpen);\n      }\n      cm.setGutterMarker(line, opts.gutter, mark);\n      ++cur;\n    });\n  }\n\n  function updateInViewport(cm) {\n    var vp = cm.getViewport(), state = cm.state.foldGutter;\n    if (!state) return;\n    cm.operation(function() {\n      updateFoldInfo(cm, vp.from, vp.to);\n    });\n    state.from = vp.from; state.to = vp.to;\n  }\n\n  function onGutterClick(cm, line, gutter) {\n    var opts = cm.state.foldGutter.options;\n    if (gutter != opts.gutter) return;\n    cm.foldCode(Pos(line, 0), opts.rangeFinder);\n  }\n\n  function onChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    state.from = state.to = 0;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() { updateInViewport(cm); }, opts.foldOnChangeTimeSpan || 600);\n  }\n\n  function onViewportChange(cm) {\n    var state = cm.state.foldGutter, opts = cm.state.foldGutter.options;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() {\n      var vp = cm.getViewport();\n      if (state.from == state.to || vp.from - state.to > 20 || state.from - vp.to > 20) {\n        updateInViewport(cm);\n      } else {\n        cm.operation(function() {\n          if (vp.from < state.from) {\n            updateFoldInfo(cm, vp.from, state.from);\n            state.from = vp.from;\n          }\n          if (vp.to > state.to) {\n            updateFoldInfo(cm, state.to, vp.to);\n            state.to = vp.to;\n          }\n        });\n      }\n    }, opts.updateViewportTimeSpan || 400);\n  }\n\n  function onFold(cm, from) {\n    var state = cm.state.foldGutter, line = from.line;\n    if (line >= state.from && line < state.to)\n      updateFoldInfo(cm, line, line + 1);\n  }\n});\n\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n\"use strict\";\n\nCodeMirror.registerHelper(\"fold\", \"brace\", function(cm, start) {\n  var line = start.line, lineText = cm.getLine(line);\n  var startCh, tokenType;\n\n  function findOpening(openCh) {\n    for (var at = start.ch, pass = 0;;) {\n      var found = at <= 0 ? -1 : lineText.lastIndexOf(openCh, at - 1);\n      if (found == -1) {\n        if (pass == 1) break;\n        pass = 1;\n        at = lineText.length;\n        continue;\n      }\n      if (pass == 1 && found < start.ch) break;\n      tokenType = cm.getTokenTypeAt(CodeMirror.Pos(line, found + 1));\n      if (!/^(comment|string)/.test(tokenType)) return found + 1;\n      at = found - 1;\n    }\n  }\n\n  var startToken = \"{\", endToken = \"}\", startCh = findOpening(\"{\");\n  if (startCh == null) {\n    startToken = \"[\", endToken = \"]\";\n    startCh = findOpening(\"[\");\n  }\n\n  if (startCh == null) return;\n  var count = 1, lastLine = cm.lastLine(), end, endCh;\n  outer: for (var i = line; i <= lastLine; ++i) {\n    var text = cm.getLine(i), pos = i == line ? startCh : 0;\n    for (;;) {\n      var nextOpen = text.indexOf(startToken, pos), nextClose = text.indexOf(endToken, pos);\n      if (nextOpen < 0) nextOpen = text.length;\n      if (nextClose < 0) nextClose = text.length;\n      pos = Math.min(nextOpen, nextClose);\n      if (pos == text.length) break;\n      if (cm.getTokenTypeAt(CodeMirror.Pos(i, pos + 1)) == tokenType) {\n        if (pos == nextOpen) ++count;\n        else if (!--count) { end = i; endCh = pos; break outer; }\n      }\n      ++pos;\n    }\n  }\n  if (end == null || line == end && endCh == startCh) return;\n  return {from: CodeMirror.Pos(line, startCh),\n          to: CodeMirror.Pos(end, endCh)};\n});\n\nCodeMirror.registerHelper(\"fold\", \"import\", function(cm, start) {\n  function hasImport(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type != \"keyword\" || start.string != \"import\") return null;\n    // Now find closing semicolon, return its position\n    for (var i = line, e = Math.min(cm.lastLine(), line + 10); i <= e; ++i) {\n      var text = cm.getLine(i), semi = text.indexOf(\";\");\n      if (semi != -1) return {startCh: start.end, end: CodeMirror.Pos(i, semi)};\n    }\n  }\n\n  var start = start.line, has = hasImport(start), prev;\n  if (!has || hasImport(start - 1) || ((prev = hasImport(start - 2)) && prev.end.line == start - 1))\n    return null;\n  for (var end = has.end;;) {\n    var next = hasImport(end.line + 1);\n    if (next == null) break;\n    end = next.end;\n  }\n  return {from: cm.clipPos(CodeMirror.Pos(start, has.startCh + 1)), to: end};\n});\n\nCodeMirror.registerHelper(\"fold\", \"include\", function(cm, start) {\n  function hasInclude(line) {\n    if (line < cm.firstLine() || line > cm.lastLine()) return null;\n    var start = cm.getTokenAt(CodeMirror.Pos(line, 1));\n    if (!/\\S/.test(start.string)) start = cm.getTokenAt(CodeMirror.Pos(line, start.end + 1));\n    if (start.type == \"meta\" && start.string.slice(0, 8) == \"#include\") return start.start + 8;\n  }\n\n  var start = start.line, has = hasInclude(start);\n  if (has == null || hasInclude(start - 1) != null) return null;\n  for (var end = start;;) {\n    var next = hasInclude(end + 1);\n    if (next == null) break;\n    ++end;\n  }\n  return {from: CodeMirror.Pos(start, has + 1),\n          to: cm.clipPos(CodeMirror.Pos(end))};\n});\n\n});\n\n// Spectrum Colorpicker v1.7.0\n// https://github.com/bgrins/spectrum\n// Author: Brian Grinstead\n// License: MIT\n\n(function (factory) {\n    \"use strict\";\n\n    if (typeof define === 'function' && define.amd) { // AMD\n        define(['jquery'], factory);\n    }\n    else if (typeof exports == \"object\" && typeof module == \"object\") { // CommonJS\n        module.exports = factory;\n    }\n    else { // Browser\n        factory(jQuery);\n    }\n})(function($, undefined) {\n    \"use strict\";\n\n    var defaultOpts = {\n\n        // Callbacks\n        beforeShow: noop,\n        move: noop,\n        change: noop,\n        show: noop,\n        hide: noop,\n\n        // Options\n        color: false,\n        flat: false,\n        showInput: false,\n        allowEmpty: false,\n        showButtons: true,\n        clickoutFiresChange: true,\n        showInitial: false,\n        showPalette: false,\n        showPaletteOnly: false,\n        hideAfterPaletteSelect: false,\n        togglePaletteOnly: false,\n        showSelectionPalette: true,\n        localStorageKey: false,\n        appendTo: \"body\",\n        maxSelectionSize: 7,\n        cancelText: \"cancel\",\n        chooseText: \"choose\",\n        togglePaletteMoreText: \"more\",\n        togglePaletteLessText: \"less\",\n        clearText: \"Clear Color Selection\",\n        noColorSelectedText: \"No Color Selected\",\n        preferredFormat: false,\n        className: \"\", // Deprecated - use containerClassName and replacerClassName instead.\n        containerClassName: \"\",\n        replacerClassName: \"\",\n        showAlpha: false,\n        theme: \"sp-light\",\n        palette: [[\"#ffffff\", \"#000000\", \"#ff0000\", \"#ff8000\", \"#ffff00\", \"#008000\", \"#0000ff\", \"#4b0082\", \"#9400d3\"]],\n        selectionPalette: [],\n        disabled: false,\n        offset: null\n    },\n    spectrums = [],\n    IE = !!/msie/i.exec( window.navigator.userAgent ),\n    rgbaSupport = (function() {\n        function contains( str, substr ) {\n            return !!~('' + str).indexOf(substr);\n        }\n\n        var elem = document.createElement('div');\n        var style = elem.style;\n        style.cssText = 'background-color:rgba(0,0,0,.5)';\n        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');\n    })(),\n    replaceInput = [\n        \"<div class='sp-replacer'>\",\n            \"<div class='sp-preview'><div class='sp-preview-inner'></div></div>\",\n            \"<div class='sp-dd'>&#9660;</div>\",\n        \"</div>\"\n    ].join(''),\n    markup = (function () {\n\n        // IE does not support gradients with multiple stops, so we need to simulate\n        //  that for the rainbow slider with 8 divs that each have a single gradient\n        var gradientFix = \"\";\n        if (IE) {\n            for (var i = 1; i <= 6; i++) {\n                gradientFix += \"<div class='sp-\" + i + \"'></div>\";\n            }\n        }\n\n        return [\n            \"<div class='sp-container sp-hidden'>\",\n                \"<div class='sp-palette-container'>\",\n                    \"<div class='sp-palette sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-palette-button-container sp-cf'>\",\n                        \"<button type='button' class='sp-palette-toggle'></button>\",\n                    \"</div>\",\n                \"</div>\",\n                \"<div class='sp-picker-container'>\",\n                    \"<div class='sp-top sp-cf'>\",\n                        \"<div class='sp-fill'></div>\",\n                        \"<div class='sp-top-inner'>\",\n                            \"<div class='sp-color'>\",\n                                \"<div class='sp-sat'>\",\n                                    \"<div class='sp-val'>\",\n                                        \"<div class='sp-dragger'></div>\",\n                                    \"</div>\",\n                                \"</div>\",\n                            \"</div>\",\n                            \"<div class='sp-clear sp-clear-display'>\",\n                            \"</div>\",\n                            \"<div class='sp-hue'>\",\n                                \"<div class='sp-slider'></div>\",\n                                gradientFix,\n                            \"</div>\",\n                        \"</div>\",\n                        \"<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>\",\n                    \"</div>\",\n                    \"<div class='sp-input-container sp-cf'>\",\n                        \"<input class='sp-input' type='text' spellcheck='false'  />\",\n                    \"</div>\",\n                    \"<div class='sp-initial sp-thumb sp-cf'></div>\",\n                    \"<div class='sp-button-container sp-cf'>\",\n                        \"<a class='sp-cancel' href='#'></a>\",\n                        \"<button type='button' class='sp-choose'></button>\",\n                    \"</div>\",\n                \"</div>\",\n            \"</div>\"\n        ].join(\"\");\n    })();\n\n    function paletteTemplate (p, color, className, opts) {\n        var html = [];\n        for (var i = 0; i < p.length; i++) {\n            var current = p[i];\n            if(current) {\n                var tiny = tinycolor(current);\n                var c = tiny.toHsl().l < 0.5 ? \"sp-thumb-el sp-thumb-dark\" : \"sp-thumb-el sp-thumb-light\";\n                c += (tinycolor.equals(color, current)) ? \" sp-thumb-active\" : \"\";\n                var formattedString = tiny.toString(opts.preferredFormat || \"rgb\");\n                var swatchStyle = rgbaSupport ? (\"background-color:\" + tiny.toRgbString()) : \"filter:\" + tiny.toFilter();\n                html.push('<span title=\"' + formattedString + '\" data-color=\"' + tiny.toRgbString() + '\" class=\"' + c + '\"><span class=\"sp-thumb-inner\" style=\"' + swatchStyle + ';\" /></span>');\n            } else {\n                var cls = 'sp-clear-display';\n                html.push($('<div />')\n                    .append($('<span data-color=\"\" style=\"background-color:transparent;\" class=\"' + cls + '\"></span>')\n                        .attr('title', opts.noColorSelectedText)\n                    )\n                    .html()\n                );\n            }\n        }\n        return \"<div class='sp-cf \" + className + \"'>\" + html.join('') + \"</div>\";\n    }\n\n    function hideAll() {\n        for (var i = 0; i < spectrums.length; i++) {\n            if (spectrums[i]) {\n                spectrums[i].hide();\n            }\n        }\n    }\n\n    function instanceOptions(o, callbackContext) {\n        var opts = $.extend({}, defaultOpts, o);\n        opts.callbacks = {\n            'move': bind(opts.move, callbackContext),\n            'change': bind(opts.change, callbackContext),\n            'show': bind(opts.show, callbackContext),\n            'hide': bind(opts.hide, callbackContext),\n            'beforeShow': bind(opts.beforeShow, callbackContext)\n        };\n\n        return opts;\n    }\n\n    function spectrum(element, o) {\n\n        var opts = instanceOptions(o, element),\n            flat = opts.flat,\n            showSelectionPalette = opts.showSelectionPalette,\n            localStorageKey = opts.localStorageKey,\n            theme = opts.theme,\n            callbacks = opts.callbacks,\n            resize = throttle(reflow, 10),\n            visible = false,\n            isDragging = false,\n            dragWidth = 0,\n            dragHeight = 0,\n            dragHelperHeight = 0,\n            slideHeight = 0,\n            slideWidth = 0,\n            alphaWidth = 0,\n            alphaSlideHelperWidth = 0,\n            slideHelperHeight = 0,\n            currentHue = 0,\n            currentSaturation = 0,\n            currentValue = 0,\n            currentAlpha = 1,\n            palette = [],\n            paletteArray = [],\n            paletteLookup = {},\n            selectionPalette = opts.selectionPalette.slice(0),\n            maxSelectionSize = opts.maxSelectionSize,\n            draggingClass = \"sp-dragging\",\n            shiftMovementDirection = null;\n\n        var doc = element.ownerDocument,\n            body = doc.body,\n            boundElement = $(element),\n            disabled = false,\n            container = $(markup, doc).addClass(theme),\n            pickerContainer = container.find(\".sp-picker-container\"),\n            dragger = container.find(\".sp-color\"),\n            dragHelper = container.find(\".sp-dragger\"),\n            slider = container.find(\".sp-hue\"),\n            slideHelper = container.find(\".sp-slider\"),\n            alphaSliderInner = container.find(\".sp-alpha-inner\"),\n            alphaSlider = container.find(\".sp-alpha\"),\n            alphaSlideHelper = container.find(\".sp-alpha-handle\"),\n            textInput = container.find(\".sp-input\"),\n            paletteContainer = container.find(\".sp-palette\"),\n            initialColorContainer = container.find(\".sp-initial\"),\n            cancelButton = container.find(\".sp-cancel\"),\n            clearButton = container.find(\".sp-clear\"),\n            chooseButton = container.find(\".sp-choose\"),\n            toggleButton = container.find(\".sp-palette-toggle\"),\n            isInput = boundElement.is(\"input\"),\n            isInputTypeColor = isInput && boundElement.attr(\"type\") === \"color\" && inputTypeColorSupport(),\n            shouldReplace = isInput && !flat,\n            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),\n            offsetElement = (shouldReplace) ? replacer : boundElement,\n            previewElement = replacer.find(\".sp-preview-inner\"),\n            initialColor = opts.color || (isInput && boundElement.val()),\n            colorOnShow = false,\n            preferredFormat = opts.preferredFormat,\n            currentPreferredFormat = preferredFormat,\n            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,\n            isEmpty = !initialColor,\n            allowEmpty = opts.allowEmpty && !isInputTypeColor;\n\n        function applyOptions() {\n\n            if (opts.showPaletteOnly) {\n                opts.showPalette = true;\n            }\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n\n            if (opts.palette) {\n                palette = opts.palette.slice(0);\n                paletteArray = $.isArray(palette[0]) ? palette : [palette];\n                paletteLookup = {};\n                for (var i = 0; i < paletteArray.length; i++) {\n                    for (var j = 0; j < paletteArray[i].length; j++) {\n                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();\n                        paletteLookup[rgb] = true;\n                    }\n                }\n            }\n\n            container.toggleClass(\"sp-flat\", flat);\n            container.toggleClass(\"sp-input-disabled\", !opts.showInput);\n            container.toggleClass(\"sp-alpha-enabled\", opts.showAlpha);\n            container.toggleClass(\"sp-clear-enabled\", allowEmpty);\n            container.toggleClass(\"sp-buttons-disabled\", !opts.showButtons);\n            container.toggleClass(\"sp-palette-buttons-disabled\", !opts.togglePaletteOnly);\n            container.toggleClass(\"sp-palette-disabled\", !opts.showPalette);\n            container.toggleClass(\"sp-palette-only\", opts.showPaletteOnly);\n            container.toggleClass(\"sp-initial-disabled\", !opts.showInitial);\n            container.addClass(opts.className).addClass(opts.containerClassName);\n\n            reflow();\n        }\n\n        function initialize() {\n\n            if (IE) {\n                container.find(\"*:not(input)\").attr(\"unselectable\", \"on\");\n            }\n\n            applyOptions();\n\n            if (shouldReplace) {\n                boundElement.after(replacer).hide();\n            }\n\n            if (!allowEmpty) {\n                clearButton.hide();\n            }\n\n            if (flat) {\n                boundElement.after(container).hide();\n            }\n            else {\n\n                var appendTo = opts.appendTo === \"parent\" ? boundElement.parent() : $(opts.appendTo);\n                if (appendTo.length !== 1) {\n                    appendTo = $(\"body\");\n                }\n\n                appendTo.append(container);\n            }\n\n            updateSelectionPaletteFromStorage();\n\n            offsetElement.bind(\"click.spectrum touchstart.spectrum\", function (e) {\n                if (!disabled) {\n                    toggle();\n                }\n\n                e.stopPropagation();\n\n                if (!$(e.target).is(\"input\")) {\n                    e.preventDefault();\n                }\n            });\n\n            if(boundElement.is(\":disabled\") || (opts.disabled === true)) {\n                disable();\n            }\n\n            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.\n            container.click(stopPropagation);\n\n            // Handle user typed input\n            textInput.change(setFromTextInput);\n            textInput.bind(\"paste\", function () {\n                setTimeout(setFromTextInput, 1);\n            });\n            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });\n\n            cancelButton.text(opts.cancelText);\n            cancelButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                revert();\n                hide();\n            });\n\n            clearButton.attr(\"title\", opts.clearText);\n            clearButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                isEmpty = true;\n                move();\n\n                if(flat) {\n                    //for the flat style, this is a change event\n                    updateOriginalInput(true);\n                }\n            });\n\n            chooseButton.text(opts.chooseText);\n            chooseButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                if (IE && textInput.is(\":focus\")) {\n                    textInput.trigger('change');\n                }\n\n                if (isValid()) {\n                    updateOriginalInput(true);\n                    hide();\n                }\n            });\n\n            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);\n            toggleButton.bind(\"click.spectrum\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n\n                opts.showPaletteOnly = !opts.showPaletteOnly;\n\n                // To make sure the Picker area is drawn on the right, next to the\n                // Palette area (and not below the palette), first move the Palette\n                // to the left to make space for the picker, plus 5px extra.\n                // The 'applyOptions' function puts the whole container back into place\n                // and takes care of the button-text and the sp-palette-only CSS class.\n                if (!opts.showPaletteOnly && !flat) {\n                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));\n                }\n                applyOptions();\n            });\n\n            draggable(alphaSlider, function (dragX, dragY, e) {\n                currentAlpha = (dragX / alphaWidth);\n                isEmpty = false;\n                if (e.shiftKey) {\n                    currentAlpha = Math.round(currentAlpha * 10) / 10;\n                }\n\n                move();\n            }, dragStart, dragStop);\n\n            draggable(slider, function (dragX, dragY) {\n                currentHue = parseFloat(dragY / slideHeight);\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n                move();\n            }, dragStart, dragStop);\n\n            draggable(dragger, function (dragX, dragY, e) {\n\n                // shift+drag should snap the movement to either the x or y axis.\n                if (!e.shiftKey) {\n                    shiftMovementDirection = null;\n                }\n                else if (!shiftMovementDirection) {\n                    var oldDragX = currentSaturation * dragWidth;\n                    var oldDragY = dragHeight - (currentValue * dragHeight);\n                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);\n\n                    shiftMovementDirection = furtherFromX ? \"x\" : \"y\";\n                }\n\n                var setSaturation = !shiftMovementDirection || shiftMovementDirection === \"x\";\n                var setValue = !shiftMovementDirection || shiftMovementDirection === \"y\";\n\n                if (setSaturation) {\n                    currentSaturation = parseFloat(dragX / dragWidth);\n                }\n                if (setValue) {\n                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);\n                }\n\n                isEmpty = false;\n                if (!opts.showAlpha) {\n                    currentAlpha = 1;\n                }\n\n                move();\n\n            }, dragStart, dragStop);\n\n            if (!!initialColor) {\n                set(initialColor);\n\n                // In case color was black - update the preview UI and set the format\n                // since the set function will not run (default color is black).\n                updateUI();\n                currentPreferredFormat = preferredFormat || tinycolor(initialColor).format;\n\n                addColorToSelectionPalette(initialColor);\n            }\n            else {\n                updateUI();\n            }\n\n            if (flat) {\n                show();\n            }\n\n            function paletteElementClick(e) {\n                if (e.data && e.data.ignore) {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                }\n                else {\n                    set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\n                    move();\n                    updateOriginalInput(true);\n                    if (opts.hideAfterPaletteSelect) {\n                      hide();\n                    }\n                }\n\n                return false;\n            }\n\n            var paletteEvent = IE ? \"mousedown.spectrum\" : \"click.spectrum touchstart.spectrum\";\n            paletteContainer.delegate(\".sp-thumb-el\", paletteEvent, paletteElementClick);\n            initialColorContainer.delegate(\".sp-thumb-el:nth-child(1)\", paletteEvent, { ignore: true }, paletteElementClick);\n        }\n\n        function updateSelectionPaletteFromStorage() {\n\n            if (localStorageKey && window.localStorage) {\n\n                // Migrate old palettes over to new format.  May want to remove this eventually.\n                try {\n                    var oldPalette = window.localStorage[localStorageKey].split(\",#\");\n                    if (oldPalette.length > 1) {\n                        delete window.localStorage[localStorageKey];\n                        $.each(oldPalette, function(i, c) {\n                             addColorToSelectionPalette(c);\n                        });\n                    }\n                }\n                catch(e) { }\n\n                try {\n                    selectionPalette = window.localStorage[localStorageKey].split(\";\");\n                }\n                catch (e) { }\n            }\n        }\n\n        function addColorToSelectionPalette(color) {\n            if (showSelectionPalette) {\n                var rgb = tinycolor(color).toRgbString();\n                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {\n                    selectionPalette.push(rgb);\n                    while(selectionPalette.length > maxSelectionSize) {\n                        selectionPalette.shift();\n                    }\n                }\n\n                if (localStorageKey && window.localStorage) {\n                    try {\n                        window.localStorage[localStorageKey] = selectionPalette.join(\";\");\n                    }\n                    catch(e) { }\n                }\n            }\n        }\n\n        function getUniqueSelectionPalette() {\n            var unique = [];\n            if (opts.showPalette) {\n                for (var i = 0; i < selectionPalette.length; i++) {\n                    var rgb = tinycolor(selectionPalette[i]).toRgbString();\n\n                    if (!paletteLookup[rgb]) {\n                        unique.push(selectionPalette[i]);\n                    }\n                }\n            }\n\n            return unique.reverse().slice(0, opts.maxSelectionSize);\n        }\n\n        function drawPalette() {\n\n            var currentColor = get();\n\n            var html = $.map(paletteArray, function (palette, i) {\n                return paletteTemplate(palette, currentColor, \"sp-palette-row sp-palette-row-\" + i, opts);\n            });\n\n            updateSelectionPaletteFromStorage();\n\n            if (selectionPalette) {\n                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, \"sp-palette-row sp-palette-row-selection\", opts));\n            }\n\n            paletteContainer.html(html.join(\"\"));\n        }\n\n        function drawInitial() {\n            if (opts.showInitial) {\n                var initial = colorOnShow;\n                var current = get();\n                initialColorContainer.html(paletteTemplate([initial, current], current, \"sp-palette-row-initial\", opts));\n            }\n        }\n\n        function dragStart() {\n            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {\n                reflow();\n            }\n            isDragging = true;\n            container.addClass(draggingClass);\n            shiftMovementDirection = null;\n            boundElement.trigger('dragstart.spectrum', [ get() ]);\n        }\n\n        function dragStop() {\n            isDragging = false;\n            container.removeClass(draggingClass);\n            boundElement.trigger('dragstop.spectrum', [ get() ]);\n        }\n\n        function setFromTextInput() {\n\n            var value = textInput.val();\n\n            if ((value === null || value === \"\") && allowEmpty) {\n                set(null);\n                updateOriginalInput(true);\n            }\n            else {\n                var tiny = tinycolor(value);\n                if (tiny.isValid()) {\n                    set(tiny);\n                    updateOriginalInput(true);\n                }\n                else {\n                    textInput.addClass(\"sp-validation-error\");\n                }\n            }\n        }\n\n        function toggle() {\n            if (visible) {\n                hide();\n            }\n            else {\n                show();\n            }\n        }\n\n        function show() {\n            var event = $.Event('beforeShow.spectrum');\n\n            if (visible) {\n                reflow();\n                return;\n            }\n\n            boundElement.trigger(event, [ get() ]);\n\n            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {\n                return;\n            }\n\n            hideAll();\n            visible = true;\n\n            $(doc).bind(\"keydown.spectrum\", onkeydown);\n            $(doc).bind(\"click.spectrum\", clickout);\n            $(window).bind(\"resize.spectrum\", resize);\n            replacer.addClass(\"sp-active\");\n            container.removeClass(\"sp-hidden\");\n\n            reflow();\n            updateUI();\n\n            colorOnShow = get();\n\n            drawInitial();\n            callbacks.show(colorOnShow);\n            boundElement.trigger('show.spectrum', [ colorOnShow ]);\n        }\n\n        function onkeydown(e) {\n            // Close on ESC\n            if (e.keyCode === 27) {\n                hide();\n            }\n        }\n\n        function clickout(e) {\n            // Return on right click.\n            if (e.button == 2) { return; }\n\n            // If a drag event was happening during the mouseup, don't hide\n            // on click.\n            if (isDragging) { return; }\n\n            if (clickoutFiresChange) {\n                updateOriginalInput(true);\n            }\n            else {\n                revert();\n            }\n            hide();\n        }\n\n        function hide() {\n            // Return if hiding is unnecessary\n            if (!visible || flat) { return; }\n            visible = false;\n\n            $(doc).unbind(\"keydown.spectrum\", onkeydown);\n            $(doc).unbind(\"click.spectrum\", clickout);\n            $(window).unbind(\"resize.spectrum\", resize);\n\n            replacer.removeClass(\"sp-active\");\n            container.addClass(\"sp-hidden\");\n\n            callbacks.hide(get());\n            boundElement.trigger('hide.spectrum', [ get() ]);\n        }\n\n        function revert() {\n            set(colorOnShow, true);\n        }\n\n        function set(color, ignoreFormatChange) {\n            if (tinycolor.equals(color, get())) {\n                // Update UI just in case a validation error needs\n                // to be cleared.\n                updateUI();\n                return;\n            }\n\n            var newColor, newHsv;\n            if (!color && allowEmpty) {\n                isEmpty = true;\n            } else {\n                isEmpty = false;\n                newColor = tinycolor(color);\n                newHsv = newColor.toHsv();\n\n                currentHue = (newHsv.h % 360) / 360;\n                currentSaturation = newHsv.s;\n                currentValue = newHsv.v;\n                currentAlpha = newHsv.a;\n            }\n            updateUI();\n\n            if (newColor && newColor.isValid() && !ignoreFormatChange) {\n                currentPreferredFormat = preferredFormat || newColor.getFormat();\n            }\n        }\n\n        function get(opts) {\n            opts = opts || { };\n\n            if (allowEmpty && isEmpty) {\n                return null;\n            }\n\n            return tinycolor.fromRatio({\n                h: currentHue,\n                s: currentSaturation,\n                v: currentValue,\n                a: Math.round(currentAlpha * 100) / 100\n            }, { format: opts.format || currentPreferredFormat });\n        }\n\n        function isValid() {\n            return !textInput.hasClass(\"sp-validation-error\");\n        }\n\n        function move() {\n            updateUI();\n\n            callbacks.move(get());\n            boundElement.trigger('move.spectrum', [ get() ]);\n        }\n\n        function updateUI() {\n\n            textInput.removeClass(\"sp-validation-error\");\n\n            updateHelperLocations();\n\n            // Update dragger background color (gradients take care of saturation and value).\n            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });\n            dragger.css(\"background-color\", flatColor.toHexString());\n\n            // Get a format that alpha will be included in (hex and names ignore alpha)\n            var format = currentPreferredFormat;\n            if (currentAlpha < 1 && !(currentAlpha === 0 && format === \"name\")) {\n                if (format === \"hex\" || format === \"hex3\" || format === \"hex6\" || format === \"name\") {\n                    format = \"rgb\";\n                }\n            }\n\n            var realColor = get({ format: format }),\n                displayColor = '';\n\n             //reset background info for preview element\n            previewElement.removeClass(\"sp-clear-display\");\n            previewElement.css('background-color', 'transparent');\n\n            if (!realColor && allowEmpty) {\n                // Update the replaced elements background with icon indicating no color selection\n                previewElement.addClass(\"sp-clear-display\");\n            }\n            else {\n                var realHex = realColor.toHexString(),\n                    realRgb = realColor.toRgbString();\n\n                // Update the replaced elements background color (with actual selected color)\n                if (rgbaSupport || realColor.alpha === 1) {\n                    previewElement.css(\"background-color\", realRgb);\n                }\n                else {\n                    previewElement.css(\"background-color\", \"transparent\");\n                    previewElement.css(\"filter\", realColor.toFilter());\n                }\n\n                if (opts.showAlpha) {\n                    var rgb = realColor.toRgb();\n                    rgb.a = 0;\n                    var realAlpha = tinycolor(rgb).toRgbString();\n                    var gradient = \"linear-gradient(left, \" + realAlpha + \", \" + realHex + \")\";\n\n                    if (IE) {\n                        alphaSliderInner.css(\"filter\", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));\n                    }\n                    else {\n                        alphaSliderInner.css(\"background\", \"-webkit-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-moz-\" + gradient);\n                        alphaSliderInner.css(\"background\", \"-ms-\" + gradient);\n                        // Use current syntax gradient on unprefixed property.\n                        alphaSliderInner.css(\"background\",\n                            \"linear-gradient(to right, \" + realAlpha + \", \" + realHex + \")\");\n                    }\n                }\n\n                displayColor = realColor.toString(format);\n            }\n\n            // Update the text entry input as it changes happen\n            if (opts.showInput) {\n                textInput.val(displayColor);\n            }\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            drawInitial();\n        }\n\n        function updateHelperLocations() {\n            var s = currentSaturation;\n            var v = currentValue;\n\n            if(allowEmpty && isEmpty) {\n                //if selected color is empty, hide the helpers\n                alphaSlideHelper.hide();\n                slideHelper.hide();\n                dragHelper.hide();\n            }\n            else {\n                //make sure helpers are visible\n                alphaSlideHelper.show();\n                slideHelper.show();\n                dragHelper.show();\n\n                // Where to show the little circle in that displays your current selected color\n                var dragX = s * dragWidth;\n                var dragY = dragHeight - (v * dragHeight);\n                dragX = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)\n                );\n                dragY = Math.max(\n                    -dragHelperHeight,\n                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)\n                );\n                dragHelper.css({\n                    \"top\": dragY + \"px\",\n                    \"left\": dragX + \"px\"\n                });\n\n                var alphaX = currentAlpha * alphaWidth;\n                alphaSlideHelper.css({\n                    \"left\": (alphaX - (alphaSlideHelperWidth / 2)) + \"px\"\n                });\n\n                // Where to show the bar that displays your current selected hue\n                var slideY = (currentHue) * slideHeight;\n                slideHelper.css({\n                    \"top\": (slideY - slideHelperHeight) + \"px\"\n                });\n            }\n        }\n\n        function updateOriginalInput(fireCallback) {\n            var color = get(),\n                displayColor = '',\n                hasChanged = !tinycolor.equals(color, colorOnShow);\n\n            if (color) {\n                displayColor = color.toString(currentPreferredFormat);\n                // Update the selection palette with the current color\n                addColorToSelectionPalette(color);\n            }\n\n            if (isInput) {\n                boundElement.val(displayColor);\n            }\n\n            if (fireCallback && hasChanged) {\n                callbacks.change(color);\n                boundElement.trigger('change', [ color ]);\n            }\n        }\n\n        function reflow() {\n            dragWidth = dragger.width();\n            dragHeight = dragger.height();\n            dragHelperHeight = dragHelper.height();\n            slideWidth = slider.width();\n            slideHeight = slider.height();\n            slideHelperHeight = slideHelper.height();\n            alphaWidth = alphaSlider.width();\n            alphaSlideHelperWidth = alphaSlideHelper.width();\n\n            if (!flat) {\n                container.css(\"position\", \"absolute\");\n                if (opts.offset) {\n                    container.offset(opts.offset);\n                } else {\n                    container.offset(getOffset(container, offsetElement));\n                }\n            }\n\n            updateHelperLocations();\n\n            if (opts.showPalette) {\n                drawPalette();\n            }\n\n            boundElement.trigger('reflow.spectrum');\n        }\n\n        function destroy() {\n            boundElement.show();\n            offsetElement.unbind(\"click.spectrum touchstart.spectrum\");\n            container.remove();\n            replacer.remove();\n            spectrums[spect.id] = null;\n        }\n\n        function option(optionName, optionValue) {\n            if (optionName === undefined) {\n                return $.extend({}, opts);\n            }\n            if (optionValue === undefined) {\n                return opts[optionName];\n            }\n\n            opts[optionName] = optionValue;\n            applyOptions();\n        }\n\n        function enable() {\n            disabled = false;\n            boundElement.attr(\"disabled\", false);\n            offsetElement.removeClass(\"sp-disabled\");\n        }\n\n        function disable() {\n            hide();\n            disabled = true;\n            boundElement.attr(\"disabled\", true);\n            offsetElement.addClass(\"sp-disabled\");\n        }\n\n        function setOffset(coord) {\n            opts.offset = coord;\n            reflow();\n        }\n\n        initialize();\n\n        var spect = {\n            show: show,\n            hide: hide,\n            toggle: toggle,\n            reflow: reflow,\n            option: option,\n            enable: enable,\n            disable: disable,\n            offset: setOffset,\n            set: function (c) {\n                set(c);\n                updateOriginalInput();\n            },\n            get: get,\n            destroy: destroy,\n            container: container\n        };\n\n        spect.id = spectrums.push(spect) - 1;\n\n        return spect;\n    }\n\n    /**\n    * checkOffset - get the offset below/above and left/right element depending on screen position\n    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js\n    */\n    function getOffset(picker, input) {\n        var extraY = 0;\n        var dpWidth = picker.outerWidth();\n        var dpHeight = picker.outerHeight();\n        var inputHeight = input.outerHeight();\n        var doc = picker[0].ownerDocument;\n        var docElem = doc.documentElement;\n        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();\n        var viewHeight = docElem.clientHeight + $(doc).scrollTop();\n        var offset = input.offset();\n        offset.top += inputHeight;\n\n        offset.left -=\n            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?\n            Math.abs(offset.left + dpWidth - viewWidth) : 0);\n\n        offset.top -=\n            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?\n            Math.abs(dpHeight + inputHeight - extraY) : extraY));\n\n        return offset;\n    }\n\n    /**\n    * noop - do nothing\n    */\n    function noop() {\n\n    }\n\n    /**\n    * stopPropagation - makes the code only doing this a little easier to read in line\n    */\n    function stopPropagation(e) {\n        e.stopPropagation();\n    }\n\n    /**\n    * Create a function bound to a given object\n    * Thanks to underscore.js\n    */\n    function bind(func, obj) {\n        var slice = Array.prototype.slice;\n        var args = slice.call(arguments, 2);\n        return function () {\n            return func.apply(obj, args.concat(slice.call(arguments)));\n        };\n    }\n\n    /**\n    * Lightweight drag helper.  Handles containment within the element, so that\n    * when dragging, the x is within [0,element.width] and y is within [0,element.height]\n    */\n    function draggable(element, onmove, onstart, onstop) {\n        onmove = onmove || function () { };\n        onstart = onstart || function () { };\n        onstop = onstop || function () { };\n        var doc = document;\n        var dragging = false;\n        var offset = {};\n        var maxHeight = 0;\n        var maxWidth = 0;\n        var hasTouch = ('ontouchstart' in window);\n\n        var duringDragEvents = {};\n        duringDragEvents[\"selectstart\"] = prevent;\n        duringDragEvents[\"dragstart\"] = prevent;\n        duringDragEvents[\"touchmove mousemove\"] = move;\n        duringDragEvents[\"touchend mouseup\"] = stop;\n\n        function prevent(e) {\n            if (e.stopPropagation) {\n                e.stopPropagation();\n            }\n            if (e.preventDefault) {\n                e.preventDefault();\n            }\n            e.returnValue = false;\n        }\n\n        function move(e) {\n            if (dragging) {\n                // Mouseup happened outside of window\n                if (IE && doc.documentMode < 9 && !e.button) {\n                    return stop();\n                }\n\n                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];\n                var pageX = t0 && t0.pageX || e.pageX;\n                var pageY = t0 && t0.pageY || e.pageY;\n\n                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));\n                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));\n\n                if (hasTouch) {\n                    // Stop scrolling in iOS\n                    prevent(e);\n                }\n\n                onmove.apply(element, [dragX, dragY, e]);\n            }\n        }\n\n        function start(e) {\n            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);\n\n            if (!rightclick && !dragging) {\n                if (onstart.apply(element, arguments) !== false) {\n                    dragging = true;\n                    maxHeight = $(element).height();\n                    maxWidth = $(element).width();\n                    offset = $(element).offset();\n\n                    $(doc).bind(duringDragEvents);\n                    $(doc.body).addClass(\"sp-dragging\");\n\n                    move(e);\n\n                    prevent(e);\n                }\n            }\n        }\n\n        function stop() {\n            if (dragging) {\n                $(doc).unbind(duringDragEvents);\n                $(doc.body).removeClass(\"sp-dragging\");\n\n                // Wait a tick before notifying observers to allow the click event\n                // to fire in Chrome.\n                setTimeout(function() {\n                    onstop.apply(element, arguments);\n                }, 0);\n            }\n            dragging = false;\n        }\n\n        $(element).bind(\"touchstart mousedown\", start);\n    }\n\n    function throttle(func, wait, debounce) {\n        var timeout;\n        return function () {\n            var context = this, args = arguments;\n            var throttler = function () {\n                timeout = null;\n                func.apply(context, args);\n            };\n            if (debounce) clearTimeout(timeout);\n            if (debounce || !timeout) timeout = setTimeout(throttler, wait);\n        };\n    }\n\n    function inputTypeColorSupport() {\n        return $.fn.spectrum.inputTypeColorSupport();\n    }\n\n    /**\n    * Define a jQuery plugin\n    */\n    var dataID = \"spectrum.id\";\n    $.fn.spectrum = function (opts, extra) {\n\n        if (typeof opts == \"string\") {\n\n            var returnValue = this;\n            var args = Array.prototype.slice.call( arguments, 1 );\n\n            this.each(function () {\n                var spect = spectrums[$(this).data(dataID)];\n                if (spect) {\n                    var method = spect[opts];\n                    if (!method) {\n                        throw new Error( \"Spectrum: no such method: '\" + opts + \"'\" );\n                    }\n\n                    if (opts == \"get\") {\n                        returnValue = spect.get();\n                    }\n                    else if (opts == \"container\") {\n                        returnValue = spect.container;\n                    }\n                    else if (opts == \"option\") {\n                        returnValue = spect.option.apply(spect, args);\n                    }\n                    else if (opts == \"destroy\") {\n                        spect.destroy();\n                        $(this).removeData(dataID);\n                    }\n                    else {\n                        method.apply(spect, args);\n                    }\n                }\n            });\n\n            return returnValue;\n        }\n\n        // Initializing a new instance of spectrum\n        return this.spectrum(\"destroy\").each(function () {\n            var options = $.extend({}, opts, $(this).data());\n            var spect = spectrum(this, options);\n            $(this).data(dataID, spect.id);\n        });\n    };\n\n    $.fn.spectrum.load = true;\n    $.fn.spectrum.loadOpts = {};\n    $.fn.spectrum.draggable = draggable;\n    $.fn.spectrum.defaults = defaultOpts;\n    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {\n        if (typeof inputTypeColorSupport._cachedResult === \"undefined\") {\n            var colorInput = $(\"<input type='color' value='!' />\")[0];\n            inputTypeColorSupport._cachedResult = colorInput.type === \"color\" && colorInput.value !== \"!\";\n        }\n        return inputTypeColorSupport._cachedResult;\n    };\n\n    $.spectrum = { };\n    $.spectrum.localization = { };\n    $.spectrum.palettes = { };\n\n    $.fn.spectrum.processNativeColorInputs = function () {\n        var colorInputs = $(\"input[type=color]\");\n        if (colorInputs.length && !inputTypeColorSupport()) {\n            colorInputs.spectrum({\n                preferredFormat: \"hex6\"\n            });\n        }\n    };\n\n    // TinyColor v1.1.2\n    // https://github.com/bgrins/TinyColor\n    // Brian Grinstead, MIT License\n\n    (function() {\n\n    var trimLeft = /^[\\s,#]+/,\n        trimRight = /\\s+$/,\n        tinyCounter = 0,\n        math = Math,\n        mathRound = math.round,\n        mathMin = math.min,\n        mathMax = math.max,\n        mathRandom = math.random;\n\n    var tinycolor = function(color, opts) {\n\n        color = (color) ? color : '';\n        opts = opts || { };\n\n        // If input is already a tinycolor, return itself\n        if (color instanceof tinycolor) {\n           return color;\n        }\n        // If we are called as a function, call using new instead\n        if (!(this instanceof tinycolor)) {\n            return new tinycolor(color, opts);\n        }\n\n        var rgb = inputToRGB(color);\n        this._originalInput = color,\n        this._r = rgb.r,\n        this._g = rgb.g,\n        this._b = rgb.b,\n        this._a = rgb.a,\n        this._roundA = mathRound(100*this._a) / 100,\n        this._format = opts.format || rgb.format;\n        this._gradientType = opts.gradientType;\n\n        // Don't let the range of [0,255] come back in [0,1].\n        // Potentially lose a little bit of precision here, but will fix issues where\n        // .5 gets interpreted as half of the total, instead of half of 1\n        // If it was supposed to be 128, this was already taken care of by `inputToRgb`\n        if (this._r < 1) { this._r = mathRound(this._r); }\n        if (this._g < 1) { this._g = mathRound(this._g); }\n        if (this._b < 1) { this._b = mathRound(this._b); }\n\n        this._ok = rgb.ok;\n        this._tc_id = tinyCounter++;\n    };\n\n    tinycolor.prototype = {\n        isDark: function() {\n            return this.getBrightness() < 128;\n        },\n        isLight: function() {\n            return !this.isDark();\n        },\n        isValid: function() {\n            return this._ok;\n        },\n        getOriginalInput: function() {\n          return this._originalInput;\n        },\n        getFormat: function() {\n            return this._format;\n        },\n        getAlpha: function() {\n            return this._a;\n        },\n        getBrightness: function() {\n            var rgb = this.toRgb();\n            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\n        },\n        setAlpha: function(value) {\n            this._a = boundAlpha(value);\n            this._roundA = mathRound(100*this._a) / 100;\n            return this;\n        },\n        toHsv: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };\n        },\n        toHsvString: function() {\n            var hsv = rgbToHsv(this._r, this._g, this._b);\n            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);\n            return (this._a == 1) ?\n              \"hsv(\"  + h + \", \" + s + \"%, \" + v + \"%)\" :\n              \"hsva(\" + h + \", \" + s + \"%, \" + v + \"%, \"+ this._roundA + \")\";\n        },\n        toHsl: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };\n        },\n        toHslString: function() {\n            var hsl = rgbToHsl(this._r, this._g, this._b);\n            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);\n            return (this._a == 1) ?\n              \"hsl(\"  + h + \", \" + s + \"%, \" + l + \"%)\" :\n              \"hsla(\" + h + \", \" + s + \"%, \" + l + \"%, \"+ this._roundA + \")\";\n        },\n        toHex: function(allow3Char) {\n            return rgbToHex(this._r, this._g, this._b, allow3Char);\n        },\n        toHexString: function(allow3Char) {\n            return '#' + this.toHex(allow3Char);\n        },\n        toHex8: function() {\n            return rgbaToHex(this._r, this._g, this._b, this._a);\n        },\n        toHex8String: function() {\n            return '#' + this.toHex8();\n        },\n        toRgb: function() {\n            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };\n        },\n        toRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \")\" :\n              \"rgba(\" + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \", \" + this._roundA + \")\";\n        },\n        toPercentageRgb: function() {\n            return { r: mathRound(bound01(this._r, 255) * 100) + \"%\", g: mathRound(bound01(this._g, 255) * 100) + \"%\", b: mathRound(bound01(this._b, 255) * 100) + \"%\", a: this._a };\n        },\n        toPercentageRgbString: function() {\n            return (this._a == 1) ?\n              \"rgb(\"  + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%)\" :\n              \"rgba(\" + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%, \" + this._roundA + \")\";\n        },\n        toName: function() {\n            if (this._a === 0) {\n                return \"transparent\";\n            }\n\n            if (this._a < 1) {\n                return false;\n            }\n\n            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;\n        },\n        toFilter: function(secondColor) {\n            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);\n            var secondHex8String = hex8String;\n            var gradientType = this._gradientType ? \"GradientType = 1, \" : \"\";\n\n            if (secondColor) {\n                var s = tinycolor(secondColor);\n                secondHex8String = s.toHex8String();\n            }\n\n            return \"progid:DXImageTransform.Microsoft.gradient(\"+gradientType+\"startColorstr=\"+hex8String+\",endColorstr=\"+secondHex8String+\")\";\n        },\n        toString: function(format) {\n            var formatSet = !!format;\n            format = format || this._format;\n\n            var formattedString = false;\n            var hasAlpha = this._a < 1 && this._a >= 0;\n            var needsAlphaFormat = !formatSet && hasAlpha && (format === \"hex\" || format === \"hex6\" || format === \"hex3\" || format === \"name\");\n\n            if (needsAlphaFormat) {\n                // Special case for \"transparent\", all other non-alpha formats\n                // will return rgba when there is transparency.\n                if (format === \"name\" && this._a === 0) {\n                    return this.toName();\n                }\n                return this.toRgbString();\n            }\n            if (format === \"rgb\") {\n                formattedString = this.toRgbString();\n            }\n            if (format === \"prgb\") {\n                formattedString = this.toPercentageRgbString();\n            }\n            if (format === \"hex\" || format === \"hex6\") {\n                formattedString = this.toHexString();\n            }\n            if (format === \"hex3\") {\n                formattedString = this.toHexString(true);\n            }\n            if (format === \"hex8\") {\n                formattedString = this.toHex8String();\n            }\n            if (format === \"name\") {\n                formattedString = this.toName();\n            }\n            if (format === \"hsl\") {\n                formattedString = this.toHslString();\n            }\n            if (format === \"hsv\") {\n                formattedString = this.toHsvString();\n            }\n\n            return formattedString || this.toHexString();\n        },\n\n        _applyModification: function(fn, args) {\n            var color = fn.apply(null, [this].concat([].slice.call(args)));\n            this._r = color._r;\n            this._g = color._g;\n            this._b = color._b;\n            this.setAlpha(color._a);\n            return this;\n        },\n        lighten: function() {\n            return this._applyModification(lighten, arguments);\n        },\n        brighten: function() {\n            return this._applyModification(brighten, arguments);\n        },\n        darken: function() {\n            return this._applyModification(darken, arguments);\n        },\n        desaturate: function() {\n            return this._applyModification(desaturate, arguments);\n        },\n        saturate: function() {\n            return this._applyModification(saturate, arguments);\n        },\n        greyscale: function() {\n            return this._applyModification(greyscale, arguments);\n        },\n        spin: function() {\n            return this._applyModification(spin, arguments);\n        },\n\n        _applyCombination: function(fn, args) {\n            return fn.apply(null, [this].concat([].slice.call(args)));\n        },\n        analogous: function() {\n            return this._applyCombination(analogous, arguments);\n        },\n        complement: function() {\n            return this._applyCombination(complement, arguments);\n        },\n        monochromatic: function() {\n            return this._applyCombination(monochromatic, arguments);\n        },\n        splitcomplement: function() {\n            return this._applyCombination(splitcomplement, arguments);\n        },\n        triad: function() {\n            return this._applyCombination(triad, arguments);\n        },\n        tetrad: function() {\n            return this._applyCombination(tetrad, arguments);\n        }\n    };\n\n    // If input is an object, force 1 into \"1.0\" to handle ratios properly\n    // String input requires \"1.0\" as input, so 1 will be treated as 1\n    tinycolor.fromRatio = function(color, opts) {\n        if (typeof color == \"object\") {\n            var newColor = {};\n            for (var i in color) {\n                if (color.hasOwnProperty(i)) {\n                    if (i === \"a\") {\n                        newColor[i] = color[i];\n                    }\n                    else {\n                        newColor[i] = convertToPercentage(color[i]);\n                    }\n                }\n            }\n            color = newColor;\n        }\n\n        return tinycolor(color, opts);\n    };\n\n    // Given a string or object, convert that input to RGB\n    // Possible string inputs:\n    //\n    //     \"red\"\n    //     \"#f00\" or \"f00\"\n    //     \"#ff0000\" or \"ff0000\"\n    //     \"#ff000000\" or \"ff000000\"\n    //     \"rgb 255 0 0\" or \"rgb (255, 0, 0)\"\n    //     \"rgb 1.0 0 0\" or \"rgb (1, 0, 0)\"\n    //     \"rgba (255, 0, 0, 1)\" or \"rgba 255, 0, 0, 1\"\n    //     \"rgba (1.0, 0, 0, 1)\" or \"rgba 1.0, 0, 0, 1\"\n    //     \"hsl(0, 100%, 50%)\" or \"hsl 0 100% 50%\"\n    //     \"hsla(0, 100%, 50%, 1)\" or \"hsla 0 100% 50%, 1\"\n    //     \"hsv(0, 100%, 100%)\" or \"hsv 0 100% 100%\"\n    //\n    function inputToRGB(color) {\n\n        var rgb = { r: 0, g: 0, b: 0 };\n        var a = 1;\n        var ok = false;\n        var format = false;\n\n        if (typeof color == \"string\") {\n            color = stringInputToObject(color);\n        }\n\n        if (typeof color == \"object\") {\n            if (color.hasOwnProperty(\"r\") && color.hasOwnProperty(\"g\") && color.hasOwnProperty(\"b\")) {\n                rgb = rgbToRgb(color.r, color.g, color.b);\n                ok = true;\n                format = String(color.r).substr(-1) === \"%\" ? \"prgb\" : \"rgb\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"v\")) {\n                color.s = convertToPercentage(color.s);\n                color.v = convertToPercentage(color.v);\n                rgb = hsvToRgb(color.h, color.s, color.v);\n                ok = true;\n                format = \"hsv\";\n            }\n            else if (color.hasOwnProperty(\"h\") && color.hasOwnProperty(\"s\") && color.hasOwnProperty(\"l\")) {\n                color.s = convertToPercentage(color.s);\n                color.l = convertToPercentage(color.l);\n                rgb = hslToRgb(color.h, color.s, color.l);\n                ok = true;\n                format = \"hsl\";\n            }\n\n            if (color.hasOwnProperty(\"a\")) {\n                a = color.a;\n            }\n        }\n\n        a = boundAlpha(a);\n\n        return {\n            ok: ok,\n            format: color.format || format,\n            r: mathMin(255, mathMax(rgb.r, 0)),\n            g: mathMin(255, mathMax(rgb.g, 0)),\n            b: mathMin(255, mathMax(rgb.b, 0)),\n            a: a\n        };\n    }\n\n\n    // Conversion Functions\n    // --------------------\n\n    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:\n    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>\n\n    // `rgbToRgb`\n    // Handle bounds / percentage checking to conform to CSS color spec\n    // <http://www.w3.org/TR/css3-color/>\n    // *Assumes:* r, g, b in [0, 255] or [0, 1]\n    // *Returns:* { r, g, b } in [0, 255]\n    function rgbToRgb(r, g, b){\n        return {\n            r: bound01(r, 255) * 255,\n            g: bound01(g, 255) * 255,\n            b: bound01(b, 255) * 255\n        };\n    }\n\n    // `rgbToHsl`\n    // Converts an RGB color value to HSL.\n    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]\n    // *Returns:* { h, s, l } in [0,1]\n    function rgbToHsl(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, l = (max + min) / 2;\n\n        if(max == min) {\n            h = s = 0; // achromatic\n        }\n        else {\n            var d = max - min;\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n\n            h /= 6;\n        }\n\n        return { h: h, s: s, l: l };\n    }\n\n    // `hslToRgb`\n    // Converts an HSL color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n    function hslToRgb(h, s, l) {\n        var r, g, b;\n\n        h = bound01(h, 360);\n        s = bound01(s, 100);\n        l = bound01(l, 100);\n\n        function hue2rgb(p, q, t) {\n            if(t < 0) t += 1;\n            if(t > 1) t -= 1;\n            if(t < 1/6) return p + (q - p) * 6 * t;\n            if(t < 1/2) return q;\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        }\n\n        if(s === 0) {\n            r = g = b = l; // achromatic\n        }\n        else {\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n            var p = 2 * l - q;\n            r = hue2rgb(p, q, h + 1/3);\n            g = hue2rgb(p, q, h);\n            b = hue2rgb(p, q, h - 1/3);\n        }\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHsv`\n    // Converts an RGB color value to HSV\n    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]\n    // *Returns:* { h, s, v } in [0,1]\n    function rgbToHsv(r, g, b) {\n\n        r = bound01(r, 255);\n        g = bound01(g, 255);\n        b = bound01(b, 255);\n\n        var max = mathMax(r, g, b), min = mathMin(r, g, b);\n        var h, s, v = max;\n\n        var d = max - min;\n        s = max === 0 ? 0 : d / max;\n\n        if(max == min) {\n            h = 0; // achromatic\n        }\n        else {\n            switch(max) {\n                case r: h = (g - b) / d + (g < b ? 6 : 0); break;\n                case g: h = (b - r) / d + 2; break;\n                case b: h = (r - g) / d + 4; break;\n            }\n            h /= 6;\n        }\n        return { h: h, s: s, v: v };\n    }\n\n    // `hsvToRgb`\n    // Converts an HSV color value to RGB.\n    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]\n    // *Returns:* { r, g, b } in the set [0, 255]\n     function hsvToRgb(h, s, v) {\n\n        h = bound01(h, 360) * 6;\n        s = bound01(s, 100);\n        v = bound01(v, 100);\n\n        var i = math.floor(h),\n            f = h - i,\n            p = v * (1 - s),\n            q = v * (1 - f * s),\n            t = v * (1 - (1 - f) * s),\n            mod = i % 6,\n            r = [v, q, p, p, t, v][mod],\n            g = [t, v, v, q, p, p][mod],\n            b = [p, p, t, v, v, q][mod];\n\n        return { r: r * 255, g: g * 255, b: b * 255 };\n    }\n\n    // `rgbToHex`\n    // Converts an RGB color to hex\n    // Assumes r, g, and b are contained in the set [0, 255]\n    // Returns a 3 or 6 character hex\n    function rgbToHex(r, g, b, allow3Char) {\n\n        var hex = [\n            pad2(mathRound(r).toString(16)),\n            pad2(mathRound(g).toString(16)),\n            pad2(mathRound(b).toString(16))\n        ];\n\n        // Return a 3 character hex if possible\n        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {\n            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);\n        }\n\n        return hex.join(\"\");\n    }\n        // `rgbaToHex`\n        // Converts an RGBA color plus alpha transparency to hex\n        // Assumes r, g, b and a are contained in the set [0, 255]\n        // Returns an 8 character hex\n        function rgbaToHex(r, g, b, a) {\n\n            var hex = [\n                pad2(convertDecimalToHex(a)),\n                pad2(mathRound(r).toString(16)),\n                pad2(mathRound(g).toString(16)),\n                pad2(mathRound(b).toString(16))\n            ];\n\n            return hex.join(\"\");\n        }\n\n    // `equals`\n    // Can be called with any tinycolor input\n    tinycolor.equals = function (color1, color2) {\n        if (!color1 || !color2) { return false; }\n        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();\n    };\n    tinycolor.random = function() {\n        return tinycolor.fromRatio({\n            r: mathRandom(),\n            g: mathRandom(),\n            b: mathRandom()\n        });\n    };\n\n\n    // Modification Functions\n    // ----------------------\n    // Thanks to less.js for some of the basics here\n    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>\n\n    function desaturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s -= amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function saturate(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.s += amount / 100;\n        hsl.s = clamp01(hsl.s);\n        return tinycolor(hsl);\n    }\n\n    function greyscale(color) {\n        return tinycolor(color).desaturate(100);\n    }\n\n    function lighten (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l += amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    function brighten(color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var rgb = tinycolor(color).toRgb();\n        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));\n        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));\n        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));\n        return tinycolor(rgb);\n    }\n\n    function darken (color, amount) {\n        amount = (amount === 0) ? 0 : (amount || 10);\n        var hsl = tinycolor(color).toHsl();\n        hsl.l -= amount / 100;\n        hsl.l = clamp01(hsl.l);\n        return tinycolor(hsl);\n    }\n\n    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.\n    // Values outside of this range will be wrapped into this range.\n    function spin(color, amount) {\n        var hsl = tinycolor(color).toHsl();\n        var hue = (mathRound(hsl.h) + amount) % 360;\n        hsl.h = hue < 0 ? 360 + hue : hue;\n        return tinycolor(hsl);\n    }\n\n    // Combination Functions\n    // ---------------------\n    // Thanks to jQuery xColor for some of the ideas behind these\n    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>\n\n    function complement(color) {\n        var hsl = tinycolor(color).toHsl();\n        hsl.h = (hsl.h + 180) % 360;\n        return tinycolor(hsl);\n    }\n\n    function triad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function tetrad(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),\n            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })\n        ];\n    }\n\n    function splitcomplement(color) {\n        var hsl = tinycolor(color).toHsl();\n        var h = hsl.h;\n        return [\n            tinycolor(color),\n            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),\n            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})\n        ];\n    }\n\n    function analogous(color, results, slices) {\n        results = results || 6;\n        slices = slices || 30;\n\n        var hsl = tinycolor(color).toHsl();\n        var part = 360 / slices;\n        var ret = [tinycolor(color)];\n\n        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {\n            hsl.h = (hsl.h + part) % 360;\n            ret.push(tinycolor(hsl));\n        }\n        return ret;\n    }\n\n    function monochromatic(color, results) {\n        results = results || 6;\n        var hsv = tinycolor(color).toHsv();\n        var h = hsv.h, s = hsv.s, v = hsv.v;\n        var ret = [];\n        var modification = 1 / results;\n\n        while (results--) {\n            ret.push(tinycolor({ h: h, s: s, v: v}));\n            v = (v + modification) % 1;\n        }\n\n        return ret;\n    }\n\n    // Utility Functions\n    // ---------------------\n\n    tinycolor.mix = function(color1, color2, amount) {\n        amount = (amount === 0) ? 0 : (amount || 50);\n\n        var rgb1 = tinycolor(color1).toRgb();\n        var rgb2 = tinycolor(color2).toRgb();\n\n        var p = amount / 100;\n        var w = p * 2 - 1;\n        var a = rgb2.a - rgb1.a;\n\n        var w1;\n\n        if (w * a == -1) {\n            w1 = w;\n        } else {\n            w1 = (w + a) / (1 + w * a);\n        }\n\n        w1 = (w1 + 1) / 2;\n\n        var w2 = 1 - w1;\n\n        var rgba = {\n            r: rgb2.r * w1 + rgb1.r * w2,\n            g: rgb2.g * w1 + rgb1.g * w2,\n            b: rgb2.b * w1 + rgb1.b * w2,\n            a: rgb2.a * p  + rgb1.a * (1 - p)\n        };\n\n        return tinycolor(rgba);\n    };\n\n\n    // Readability Functions\n    // ---------------------\n    // <http://www.w3.org/TR/AERT#color-contrast>\n\n    // `readability`\n    // Analyze the 2 colors and returns an object with the following properties:\n    //    `brightness`: difference in brightness between the two colors\n    //    `color`: difference in color/hue between the two colors\n    tinycolor.readability = function(color1, color2) {\n        var c1 = tinycolor(color1);\n        var c2 = tinycolor(color2);\n        var rgb1 = c1.toRgb();\n        var rgb2 = c2.toRgb();\n        var brightnessA = c1.getBrightness();\n        var brightnessB = c2.getBrightness();\n        var colorDiff = (\n            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +\n            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +\n            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)\n        );\n\n        return {\n            brightness: Math.abs(brightnessA - brightnessB),\n            color: colorDiff\n        };\n    };\n\n    // `readable`\n    // http://www.w3.org/TR/AERT#color-contrast\n    // Ensure that foreground and background color combinations provide sufficient contrast.\n    // *Example*\n    //    tinycolor.isReadable(\"#000\", \"#111\") => false\n    tinycolor.isReadable = function(color1, color2) {\n        var readability = tinycolor.readability(color1, color2);\n        return readability.brightness > 125 && readability.color > 500;\n    };\n\n    // `mostReadable`\n    // Given a base color and a list of possible foreground or background\n    // colors for that base, returns the most readable color.\n    // *Example*\n    //    tinycolor.mostReadable(\"#123\", [\"#fff\", \"#000\"]) => \"#000\"\n    tinycolor.mostReadable = function(baseColor, colorList) {\n        var bestColor = null;\n        var bestScore = 0;\n        var bestIsReadable = false;\n        for (var i=0; i < colorList.length; i++) {\n\n            // We normalize both around the \"acceptable\" breaking point,\n            // but rank brightness constrast higher than hue.\n\n            var readability = tinycolor.readability(baseColor, colorList[i]);\n            var readable = readability.brightness > 125 && readability.color > 500;\n            var score = 3 * (readability.brightness / 125) + (readability.color / 500);\n\n            if ((readable && ! bestIsReadable) ||\n                (readable && bestIsReadable && score > bestScore) ||\n                ((! readable) && (! bestIsReadable) && score > bestScore)) {\n                bestIsReadable = readable;\n                bestScore = score;\n                bestColor = tinycolor(colorList[i]);\n            }\n        }\n        return bestColor;\n    };\n\n\n    // Big List of Colors\n    // ------------------\n    // <http://www.w3.org/TR/css3-color/#svg-color>\n    var names = tinycolor.names = {\n        aliceblue: \"f0f8ff\",\n        antiquewhite: \"faebd7\",\n        aqua: \"0ff\",\n        aquamarine: \"7fffd4\",\n        azure: \"f0ffff\",\n        beige: \"f5f5dc\",\n        bisque: \"ffe4c4\",\n        black: \"000\",\n        blanchedalmond: \"ffebcd\",\n        blue: \"00f\",\n        blueviolet: \"8a2be2\",\n        brown: \"a52a2a\",\n        burlywood: \"deb887\",\n        burntsienna: \"ea7e5d\",\n        cadetblue: \"5f9ea0\",\n        chartreuse: \"7fff00\",\n        chocolate: \"d2691e\",\n        coral: \"ff7f50\",\n        cornflowerblue: \"6495ed\",\n        cornsilk: \"fff8dc\",\n        crimson: \"dc143c\",\n        cyan: \"0ff\",\n        darkblue: \"00008b\",\n        darkcyan: \"008b8b\",\n        darkgoldenrod: \"b8860b\",\n        darkgray: \"a9a9a9\",\n        darkgreen: \"006400\",\n        darkgrey: \"a9a9a9\",\n        darkkhaki: \"bdb76b\",\n        darkmagenta: \"8b008b\",\n        darkolivegreen: \"556b2f\",\n        darkorange: \"ff8c00\",\n        darkorchid: \"9932cc\",\n        darkred: \"8b0000\",\n        darksalmon: \"e9967a\",\n        darkseagreen: \"8fbc8f\",\n        darkslateblue: \"483d8b\",\n        darkslategray: \"2f4f4f\",\n        darkslategrey: \"2f4f4f\",\n        darkturquoise: \"00ced1\",\n        darkviolet: \"9400d3\",\n        deeppink: \"ff1493\",\n        deepskyblue: \"00bfff\",\n        dimgray: \"696969\",\n        dimgrey: \"696969\",\n        dodgerblue: \"1e90ff\",\n        firebrick: \"b22222\",\n        floralwhite: \"fffaf0\",\n        forestgreen: \"228b22\",\n        fuchsia: \"f0f\",\n        gainsboro: \"dcdcdc\",\n        ghostwhite: \"f8f8ff\",\n        gold: \"ffd700\",\n        goldenrod: \"daa520\",\n        gray: \"808080\",\n        green: \"008000\",\n        greenyellow: \"adff2f\",\n        grey: \"808080\",\n        honeydew: \"f0fff0\",\n        hotpink: \"ff69b4\",\n        indianred: \"cd5c5c\",\n        indigo: \"4b0082\",\n        ivory: \"fffff0\",\n        khaki: \"f0e68c\",\n        lavender: \"e6e6fa\",\n        lavenderblush: \"fff0f5\",\n        lawngreen: \"7cfc00\",\n        lemonchiffon: \"fffacd\",\n        lightblue: \"add8e6\",\n        lightcoral: \"f08080\",\n        lightcyan: \"e0ffff\",\n        lightgoldenrodyellow: \"fafad2\",\n        lightgray: \"d3d3d3\",\n        lightgreen: \"90ee90\",\n        lightgrey: \"d3d3d3\",\n        lightpink: \"ffb6c1\",\n        lightsalmon: \"ffa07a\",\n        lightseagreen: \"20b2aa\",\n        lightskyblue: \"87cefa\",\n        lightslategray: \"789\",\n        lightslategrey: \"789\",\n        lightsteelblue: \"b0c4de\",\n        lightyellow: \"ffffe0\",\n        lime: \"0f0\",\n        limegreen: \"32cd32\",\n        linen: \"faf0e6\",\n        magenta: \"f0f\",\n        maroon: \"800000\",\n        mediumaquamarine: \"66cdaa\",\n        mediumblue: \"0000cd\",\n        mediumorchid: \"ba55d3\",\n        mediumpurple: \"9370db\",\n        mediumseagreen: \"3cb371\",\n        mediumslateblue: \"7b68ee\",\n        mediumspringgreen: \"00fa9a\",\n        mediumturquoise: \"48d1cc\",\n        mediumvioletred: \"c71585\",\n        midnightblue: \"191970\",\n        mintcream: \"f5fffa\",\n        mistyrose: \"ffe4e1\",\n        moccasin: \"ffe4b5\",\n        navajowhite: \"ffdead\",\n        navy: \"000080\",\n        oldlace: \"fdf5e6\",\n        olive: \"808000\",\n        olivedrab: \"6b8e23\",\n        orange: \"ffa500\",\n        orangered: \"ff4500\",\n        orchid: \"da70d6\",\n        palegoldenrod: \"eee8aa\",\n        palegreen: \"98fb98\",\n        paleturquoise: \"afeeee\",\n        palevioletred: \"db7093\",\n        papayawhip: \"ffefd5\",\n        peachpuff: \"ffdab9\",\n        peru: \"cd853f\",\n        pink: \"ffc0cb\",\n        plum: \"dda0dd\",\n        powderblue: \"b0e0e6\",\n        purple: \"800080\",\n        rebeccapurple: \"663399\",\n        red: \"f00\",\n        rosybrown: \"bc8f8f\",\n        royalblue: \"4169e1\",\n        saddlebrown: \"8b4513\",\n        salmon: \"fa8072\",\n        sandybrown: \"f4a460\",\n        seagreen: \"2e8b57\",\n        seashell: \"fff5ee\",\n        sienna: \"a0522d\",\n        silver: \"c0c0c0\",\n        skyblue: \"87ceeb\",\n        slateblue: \"6a5acd\",\n        slategray: \"708090\",\n        slategrey: \"708090\",\n        snow: \"fffafa\",\n        springgreen: \"00ff7f\",\n        steelblue: \"4682b4\",\n        tan: \"d2b48c\",\n        teal: \"008080\",\n        thistle: \"d8bfd8\",\n        tomato: \"ff6347\",\n        turquoise: \"40e0d0\",\n        violet: \"ee82ee\",\n        wheat: \"f5deb3\",\n        white: \"fff\",\n        whitesmoke: \"f5f5f5\",\n        yellow: \"ff0\",\n        yellowgreen: \"9acd32\"\n    };\n\n    // Make it easy to access colors via `hexNames[hex]`\n    var hexNames = tinycolor.hexNames = flip(names);\n\n\n    // Utilities\n    // ---------\n\n    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`\n    function flip(o) {\n        var flipped = { };\n        for (var i in o) {\n            if (o.hasOwnProperty(i)) {\n                flipped[o[i]] = i;\n            }\n        }\n        return flipped;\n    }\n\n    // Return a valid alpha value [0,1] with all invalid values being set to 1\n    function boundAlpha(a) {\n        a = parseFloat(a);\n\n        if (isNaN(a) || a < 0 || a > 1) {\n            a = 1;\n        }\n\n        return a;\n    }\n\n    // Take input from [0, n] and return it as [0, 1]\n    function bound01(n, max) {\n        if (isOnePointZero(n)) { n = \"100%\"; }\n\n        var processPercent = isPercentage(n);\n        n = mathMin(max, mathMax(0, parseFloat(n)));\n\n        // Automatically convert percentage into number\n        if (processPercent) {\n            n = parseInt(n * max, 10) / 100;\n        }\n\n        // Handle floating point rounding errors\n        if ((math.abs(n - max) < 0.000001)) {\n            return 1;\n        }\n\n        // Convert into [0, 1] range if it isn't already\n        return (n % max) / parseFloat(max);\n    }\n\n    // Force a number between 0 and 1\n    function clamp01(val) {\n        return mathMin(1, mathMax(0, val));\n    }\n\n    // Parse a base-16 hex value into a base-10 integer\n    function parseIntFromHex(val) {\n        return parseInt(val, 16);\n    }\n\n    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1\n    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>\n    function isOnePointZero(n) {\n        return typeof n == \"string\" && n.indexOf('.') != -1 && parseFloat(n) === 1;\n    }\n\n    // Check to see if string passed in is a percentage\n    function isPercentage(n) {\n        return typeof n === \"string\" && n.indexOf('%') != -1;\n    }\n\n    // Force a hex value to have 2 characters\n    function pad2(c) {\n        return c.length == 1 ? '0' + c : '' + c;\n    }\n\n    // Replace a decimal with it's percentage value\n    function convertToPercentage(n) {\n        if (n <= 1) {\n            n = (n * 100) + \"%\";\n        }\n\n        return n;\n    }\n\n    // Converts a decimal to a hex value\n    function convertDecimalToHex(d) {\n        return Math.round(parseFloat(d) * 255).toString(16);\n    }\n    // Converts a hex value to a decimal\n    function convertHexToDecimal(h) {\n        return (parseIntFromHex(h) / 255);\n    }\n\n    var matchers = (function() {\n\n        // <http://www.w3.org/TR/css3-values/#integers>\n        var CSS_INTEGER = \"[-\\\\+]?\\\\d+%?\";\n\n        // <http://www.w3.org/TR/css3-values/#number-value>\n        var CSS_NUMBER = \"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\";\n\n        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.\n        var CSS_UNIT = \"(?:\" + CSS_NUMBER + \")|(?:\" + CSS_INTEGER + \")\";\n\n        // Actual matching.\n        // Parentheses and commas are optional, but not required.\n        // Whitespace can take the place of commas or opening paren\n        var PERMISSIVE_MATCH3 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n        var PERMISSIVE_MATCH4 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\n\n        return {\n            rgb: new RegExp(\"rgb\" + PERMISSIVE_MATCH3),\n            rgba: new RegExp(\"rgba\" + PERMISSIVE_MATCH4),\n            hsl: new RegExp(\"hsl\" + PERMISSIVE_MATCH3),\n            hsla: new RegExp(\"hsla\" + PERMISSIVE_MATCH4),\n            hsv: new RegExp(\"hsv\" + PERMISSIVE_MATCH3),\n            hsva: new RegExp(\"hsva\" + PERMISSIVE_MATCH4),\n            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\n            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,\n            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/\n        };\n    })();\n\n    // `stringInputToObject`\n    // Permissive string parsing.  Take in a number of formats, and output an object\n    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`\n    function stringInputToObject(color) {\n\n        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();\n        var named = false;\n        if (names[color]) {\n            color = names[color];\n            named = true;\n        }\n        else if (color == 'transparent') {\n            return { r: 0, g: 0, b: 0, a: 0, format: \"name\" };\n        }\n\n        // Try to match string input using regular expressions.\n        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]\n        // Just return an object and let the conversion functions handle that.\n        // This way the result will be the same whether the tinycolor is initialized with string or object.\n        var match;\n        if ((match = matchers.rgb.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3] };\n        }\n        if ((match = matchers.rgba.exec(color))) {\n            return { r: match[1], g: match[2], b: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsl.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3] };\n        }\n        if ((match = matchers.hsla.exec(color))) {\n            return { h: match[1], s: match[2], l: match[3], a: match[4] };\n        }\n        if ((match = matchers.hsv.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3] };\n        }\n        if ((match = matchers.hsva.exec(color))) {\n            return { h: match[1], s: match[2], v: match[3], a: match[4] };\n        }\n        if ((match = matchers.hex8.exec(color))) {\n            return {\n                a: convertHexToDecimal(match[1]),\n                r: parseIntFromHex(match[2]),\n                g: parseIntFromHex(match[3]),\n                b: parseIntFromHex(match[4]),\n                format: named ? \"name\" : \"hex8\"\n            };\n        }\n        if ((match = matchers.hex6.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1]),\n                g: parseIntFromHex(match[2]),\n                b: parseIntFromHex(match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n        if ((match = matchers.hex3.exec(color))) {\n            return {\n                r: parseIntFromHex(match[1] + '' + match[1]),\n                g: parseIntFromHex(match[2] + '' + match[2]),\n                b: parseIntFromHex(match[3] + '' + match[3]),\n                format: named ? \"name\" : \"hex\"\n            };\n        }\n\n        return false;\n    }\n\n    window.tinycolor = tinycolor;\n    })();\n\n    $(function () {\n        if ($.fn.spectrum.load) {\n            $.fn.spectrum.processNativeColorInputs();\n        }\n    });\n\n});\n\n// Spectrum Colorpicker\n// Swedish (sv) localization\n// https://github.com/bgrins/spectrum\n\n(function ( $ ) {\n\n    var localization = $.spectrum.localization[\"sv\"] = {\n        cancelText: \"Avbryt\",\n        chooseText: \"Välj\"\n    };\n\n    $.extend($.fn.spectrum.defaults, localization);\n\n})( jQuery );\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/select2/select2.html\",\"<style>\\r\\n    .select2 > .select2-choice.ui-select-match {\\r\\n        /* Because of the inclusion of Bootstrap */\\r\\n        height: 29px;\\r\\n    }\\r\\n\\r\\n    .selectize-control > .selectize-dropdown {\\r\\n        top: 36px;\\r\\n    }\\r\\n</style>\\r\\n\\r\\n<div class=\\\"form-group {{form.htmlClass}}\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <ui-select select2-search\\r\\n                   ng-show=\\\"form.key\\\"\\r\\n                   ng-model=\\\"$$value$$\\\"\\r\\n                   ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n                   ng-disabled=\\\"form.readonly\\\"\\r\\n                   sf-changed=\\\"form\\\"\\r\\n                   ref=\\\"form.ref\\\"\\r\\n                   query=\\\"form.query\\\"\\r\\n                   shard=\\\"form.shard\\\"\\r\\n                   depends-on=\\\"form.dependsOn\\\">\\r\\n            <ui-select-match allow-clear=\\\"true\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" placeholder=\\\"Search for {{form.title}}\\\">\\r\\n                {{printSelectedElement($select.selected)}}\\r\\n            </ui-select-match>\\r\\n            <ui-select-choices\\r\\n                    sf-changed=\\\"form\\\"\\r\\n                    ng-model=\\\"$$value$$\\\" refresh=\\\"search($select)\\\" refresh-delay=\\\"0\\\"\\r\\n                    repeat=\\\"selectIdField(item) as item in searchRes\\\">\\r\\n                <div ng-bind-html=\\\"selectDisplayField(item) | highlight: $select.search\\\"></div>\\r\\n                <small>\\r\\n                    <i>&lt;<span ng-bind-html=\\\"selectIdField(item)\\\"></span>&gt;</i>\\r\\n                </small>\\r\\n            </ui-select-choices>\\r\\n        </ui-select>\\r\\n        <span class=\\\"input-group-btn\\\">\\r\\n            <create-update-modal class=\\\"btn btn-primary\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" ng-click=\\\"open()\\\">New {{form.ref}}\\r\\n            </create-update-modal>\\r\\n            <create-update-modal class=\\\"btn btn-warning\\\"\\r\\n                                 ng-model=\\\"$$value$$\\\"\\r\\n                                 sf-changed=\\\"form\\\"\\r\\n                                 ref=\\\"form.ref\\\" type=\\\"edit\\\" ng-show=\\\"$$value$$\\\" ng-click=\\\"open()\\\">Edit\\r\\n            </create-update-modal>\\r\\n            <!--<button class=\\\"btn btn-primary\\\" ng-click=\\\"open()\\\">Create {{form.title}}</button>-->\\r\\n        </span>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"createUpdateModal.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Create a new {{schema.title}}</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <form name=\\\"ngForm\\\" sf-schema=\\\"schema\\\" sf-form=\\\"form\\\" sf-model=\\\"model\\\" ng-submit=\\\"submitForm(ngForm,model)\\\">\\r\\n            <input type=\\\"submit\\\" id=\\\"submit-form-{{schema.title}}\\\" class=\\\"hidden\\\"/></form>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-warning\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <label class=\\\"btn btn-primary\\\" for=\\\"submit-form-{{schema.title}}\\\">Save</label><!--Ñapon del 15, pero fa el submit sense haver de fer coses rares :)-->\\r\\n    </div>\\r\\n</script>\");}]);\nangular.module('schemaForm').directive('select2Search', ['$http', '$routeParams', 'models', 'common', 'selectCache', function ($http, $routeParams, models, common, selectCache) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var modelName = $routeParams.schema;\r\n            var shard = $routeParams.shard;\r\n\r\n            if (!element.select)\r\n                return;\r\n\r\n            var displayField = \"\";\r\n            var idSelect = \"\";\r\n            var userq = scope.$eval(attrs.query);\r\n\r\n            var userShard = scope.$eval(attrs.shard);\r\n            if(userShard) {\r\n                userShard.replace('/this\\./', scope.$eval(attrs.key));\r\n                var actualShard = common.getField(userShard, scope.model);\r\n                if(actualShard){\r\n                    shard = actualShard;\r\n                }\r\n            }\r\n\r\n            var dependsOn = scope.$eval(attrs.dependsOn);\r\n            if (dependsOn) {\r\n                dependsOn = dependsOn.split(\"=\");\r\n            }\r\n\r\n            function getDocumentById(modelId) {\r\n                return function (query, skip) {\r\n                    return models.getModel(scope.$eval(attrs.ref), function (m) {\r\n                        var config = m.config;\r\n                        var elem = \"\";\r\n\r\n                        if (modelId instanceof Object) {\r\n                            elem = modelId[config.id];\r\n                        } else {\r\n                            elem = modelId;\r\n                        }\r\n\r\n                        selectCache.getDocument(scope.$eval(attrs.ref), elem, shard, function (doc) {\r\n                            displayField = config.displayField;\r\n                            idSelect = config.id;\r\n\r\n                            var q = {};\r\n                            q.query = {};\r\n                            var regex = query.search;\r\n                            q.query.$or = [];\r\n\r\n                            var forDisplay = {};\r\n                            forDisplay[displayField] = {$regex: regex, $options: 'i'};\r\n                            q.query.$or.push(forDisplay);\r\n\r\n\r\n                            if (config.id != \"_id\" && m.schema[config.id] && m.schema[config.id].type == \"string\") {\r\n                                var forID = {};\r\n                                forID[idSelect] = {$regex: regex, $options: 'i'};\r\n                                q.query.$or.push(forID);\r\n                            }\r\n\r\n                            if (dependsOn) {\r\n                                if (dependsOn[0] && scope.model[dependsOn[1]]) {\r\n                                    if (!isValidObjectID(scope.model[dependsOn[1]])) {\r\n                                        q.query[dependsOn[0]] = {\r\n                                            $regex: scope.model[dependsOn[1]],\r\n                                            $options: 'i'\r\n                                        };\r\n                                    } else {\r\n                                        q.query[dependsOn[0]] = scope.model[dependsOn[1]];\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            function isValidObjectID(str) {\r\n                                // A valid Object Id must be 24 hex characters\r\n                                return (/^[0-9a-fA-F]{24}$/).test(str);\r\n                            }\r\n\r\n                            q.limit = 20;\r\n                            q.skip = skip;\r\n\r\n                            angular.extend(q, userq || {});\r\n                            selectCache.search(scope.$eval(attrs.ref), q, shard, function (response, count) {\r\n                                if (skip)\r\n                                    scope.searchRes = scope.searchRes.concat(response);\r\n                                else\r\n                                    scope.searchRes = response;\r\n\r\n                                if (doc) {\r\n                                    var present = scope.searchRes.some(function (element) {\r\n                                        return element[config.id] == doc[config.id];\r\n                                    });\r\n\r\n                                    if (!present) {\r\n                                        scope.searchRes.splice(0, 0, doc);\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n\r\n            var elements = getDocumentById(scope.$eval(attrs.ngModel));\r\n\r\n            scope.$watch(function () {\r\n                if (dependsOn) {\r\n                    if (scope.model[dependsOn[1]])\r\n                        return scope.model[dependsOn[1]];\r\n                }\r\n            }, function (newValue) {\r\n                getDocumentById(scope.$eval(attrs.ngModel))({search: ''});\r\n            });\r\n\r\n            scope.disabled = false;\r\n            scope.searchEnabled = true;\r\n            scope.searchRes = [];\r\n            scope.search = elements;\r\n\r\n            scope.printSelectedElement = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f + \" <\" + document[idSelect] + \">\";\r\n                    else {\r\n                        return \"No display field. ID: <\" + document[idSelect] + \">\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectDisplayField = function (document) {\r\n                if (document) {\r\n                    var f = common.getField(displayField, document);\r\n                    if (f && f != \"\" && f.length > 0)\r\n                        return f;\r\n                    else {\r\n                        return \"<empty>\";\r\n                    }\r\n                }\r\n            };\r\n\r\n            scope.selectIdField = function (document) {\r\n                if (document != undefined) {\r\n                    return document[idSelect] || \"No ID\";\r\n                }\r\n            };\r\n\r\n            scope.$on('refreshSelect2' + scope.$eval(attrs.ref), function () {\r\n                console.log(\"REFRESH SELECT2\");\r\n                elements();\r\n            });\r\n\r\n            element.find('ul').bind('scroll', function () {\r\n                var raw = arguments[0].target;\r\n                if (raw.scrollTop + raw.offsetHeight > raw.scrollHeight) {\r\n                    elements(scope.$select, (raw.children[0].children.length - 2));\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n])\r\n;\r\n\r\nvar modalController = function ($scope, $http, $modalInstance, $routeParams, models, configs, modelName, id, dependsOn, common) {\r\n    //Override the functinos for every opened modal (fixes problem with residual variables)\r\n    var fromSchema = $routeParams.schema;\r\n    $routeParams.schema = modelName;\r\n    $routeParams.id = id;\r\n\r\n    //TODO: Maybe we should avoid duplicate code with formController !\r\n    models.getModel(modelName, function (m) {\r\n        var s = m.schema;\r\n        var base = function (doc) {\r\n            $scope.schema = {\r\n                \"type\": \"object\",\r\n                \"title\": modelName,\r\n                \"action\": (doc) ? \"Edit\" : \"New\",\r\n                \"properties\": s\r\n            };\r\n\r\n            var innerForm = common.processForm(m.config.form, false);\r\n\r\n            $scope.form = innerForm;\r\n\r\n            $scope.model = doc || {};\r\n\r\n            if (!doc && models.getShard(fromSchema) && models.getShard(fromSchema).value) {\r\n                $scope.model[models.getShard(fromSchema).key] = models.getShard(fromSchema).value;\r\n            }\r\n\r\n            dependsOn.apply($scope, modelName, $scope.model);\r\n\r\n            $scope.submitForm = function (form, model) {\r\n                // First we broadcast an event so all fields validate themselves\r\n                $scope.$broadcast('schemaFormValidate');\r\n                // Then we check if the form is valid\r\n                if (form.$valid) {\r\n                    if ($scope.schema.action === \"New\") {\r\n                        models.postDocument(modelName, model, function (response) {\r\n                            if (response.status == '201') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    } else {\r\n                        models.putDocument(modelName, id, model, function (response) {\r\n                            if (response.status == '200') {\r\n                                $scope.$broadcast('postedDocument', response.data);\r\n                                $scope.$broadcast('puttedDocument', response.data);\r\n                                $modalInstance.close('saved');\r\n                            }\r\n                        });\r\n                    }\r\n                } else {\r\n                    alert('invalid form');\r\n                }\r\n            }\r\n        };\r\n\r\n        if (id) {\r\n            models.getDocument(modelName, id, function (document) {\r\n                base(document);\r\n            });\r\n        } else {\r\n            base();\r\n        }\r\n    });\r\n\r\n    $scope.cancel = function () {\r\n        $modalInstance.dismiss('cancel');\r\n    };\r\n};\nmodalController.$inject = ['$scope', '$http', '$modalInstance', '$routeParams', 'models', 'configs', 'modelName', 'id', 'dependsOn', 'common'];\r\n\r\nangular.module('schemaForm').directive('createUpdateModal', ['$http', '$routeParams', '$rootScope', '$modal', 'models', function ($http, $routeParams, $rootScope, $modal, models) {\r\n    return {\r\n        restrict: 'E',\r\n        scope: true,\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.open = function () {\r\n                var modalInstance = $modal.open({\r\n                    templateUrl: 'createUpdateModal.html',\r\n                    controller: modalController,\r\n                    size: 'lg',\r\n                    resolve: {\r\n                        modelName: function () {\r\n                            return scope.$eval(attrs.ref);\r\n                        },\r\n                        id: function () {\r\n                            if (attrs.type == \"edit\")\r\n                                return scope.$eval(attrs.ngModel);\r\n                            else\r\n                                return \"\";\r\n                        }\r\n                    }\r\n                });\r\n\r\n                modalInstance.result.then(function () {\r\n                    $rootScope.$broadcast('refreshSelect2' + scope.$eval(attrs.ref));\r\n                }, function () {\r\n                    console.info('Modal dismissed at: ' + new Date());\r\n                });\r\n            };\r\n        }\r\n    }\r\n}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.ref) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'select2';\r\n                    f.query = schema.query;\r\n                    f.ref = schema.ref;\r\n                    f.shard = schema.shard;\r\n                    f.dependsOn = schema.dependsOn;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.object.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'select2',\r\n                'directives/decorators/bootstrap/select2/select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/simpleselect2/simple-select2.html\",\"<div class=\\\"form-group {{form.htmlClass}} schema-form-select\\\"\\n     ng-class=\\\"{\\'has-error\\': form.disableErrorState !== true && hasError(), \\'has-success\\': form.disableSuccessState !== true && hasSuccess(), \\'has-feedback\\': form.feedback !== false}\\\">\\n  <label class=\\\"control-label {{form.labelHtmlClass}}\\\" ng-show=\\\"showTitle()\\\">\\n    {{form.title}}\\n  </label>\\n  <select simple-select\\n\t      ng-model=\\\"$$value$$\\\"\\n          ng-model-options=\\\"form.ngModelOptions\\\"\\n          ng-disabled=\\\"form.readonly\\\"\\n          sf-changed=\\\"form\\\"\\n          class=\\\"form-control {{form.fieldHtmlClass}}\\\"\\n          schema-validate=\\\"form\\\"\\n          map=\\\"form.map\\\"\\n          dynmap=\\\"form.dynMap\\\"\\n          dynenum=\\\"form.dynEnum\\\"\\n          ng-options=\\\"item.value as item.name group by item.group for item in titleMap\\\"\\n          name=\\\"{{form.key.slice(-1)[0]}}\\\">\\n  </select>\\n  <div class=\\\"help-block\\\" sf-message=\\\"form.description\\\"></div>\\n</div>\\n\");}]);\r\nangular.module('schemaForm').directive('simpleSelect', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        require: ['ngModel'],\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.titleMap = [];\r\n\r\n            var map = scope.$eval(attrs.map);\r\n            var dynMap = scope.$eval(attrs.dynmap);\r\n            var dynEnum = scope.$eval(attrs.dynenum);\r\n\r\n            if(dynEnum){\r\n                $http.get(dynEnum).then(function(res){\r\n                    var resultMap = {};\r\n                    angular.forEach(res.data, function(elem){\r\n                        resultMap[elem] = elem;\r\n                    });\r\n                    setMap(resultMap);\r\n                });\r\n            } else if(dynMap){\r\n                $http.get(dynMap).then(function(res){\r\n                   setMap(res.data);\r\n                });\r\n            } else if(map){\r\n                setMap(map);\r\n            }\r\n\r\n            function setMap(map){\r\n                angular.forEach(Object.keys(map), function(key) {\r\n                    var value = map[key];\r\n                    var o = {};\r\n                    o.value = key;\r\n                    if(typeof(value)==\"string\") {\r\n                        o.name = value;\r\n                    } else {\r\n                        o.name = value.name;\r\n                        o.group = value.group;\r\n                    }\r\n                    scope.titleMap.push(o);\r\n                });\r\n            }\r\n        }\r\n    }\r\n}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var select2 = function (name, schema, options) {\r\n                if (schema.map || schema.dynEnum || schema.dynMap) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'simpleselect2';\r\n                    f.map = schema.map;\r\n                    f.dynMap = schema.dynMap;\r\n                    f.dynEnum = schema.dynEnum;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(select2);\r\n            schemaFormProvider.defaults.number.unshift(select2);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'simpleselect2',\r\n                'directives/decorators/bootstrap/simpleselect2/simple-select2.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/datetimepicker/datetimepicker.html\",\"<div class=\\\"form-group schema-form-{{form.type}} {{form.htmlClass}}\\\">\\r\\n    <!--<div ri-date date-picker=\\\"date\\\" view=\\\"minutes\\\" ng-model=\\\"$$value$$\\\"></div>-->\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div ri-date ng-model=\\\"$$value$$\\\">\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelDate\\\" view=\\\"date\\\" max-view=\\\"month\\\" min-view=\\\"date\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <!--<div class=\\\"col-md-6\\\">-->\\r\\n            <!--<div date-picker=\\\"modelHours\\\" view=\\\"hours\\\" max-view=\\\"hours\\\"></div>-->\\r\\n        <!--</div>-->\\r\\n        <input date-time type=\\\"datetime\\\" ng-model=\\\"modelDate\\\" ng-change=\\\"{{updateDate(modelDate)}}\\\" view=\\\"date\\\" max-view=\\\"date\\\" class=\\\"form-control\\\" format=\\\"medium\\\">\\r\\n    </div>\\r\\n</div>\");}]);\nangular.module('schemaForm').directive('riDate', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        require: 'ngModel',\r\n        scope:false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.modelDate = null;\r\n            ngModel.$render = function(){\r\n                if(ngModel.$viewValue){\r\n                    if(!scope.modelDate || (scope.modelDate && scope.modelDate.toString() != ngModel.$viewValue)) {\r\n                        scope.modelDate = new Date(ngModel.$viewValue);\r\n                    }\r\n                    //scope.modelHours = new Date(ngModel.$viewValue);\r\n                }\r\n            };\r\n\r\n            scope.updateDate = function(m){\r\n                ngModel.$setViewValue(m);\r\n\r\n                if(m == \"\" || !m){\r\n                    ngModel.$setViewValue(null);\r\n                }\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'datetimepicker' || schema.format === \"date\")) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'datetimepicker';\r\n                    f.format = schema.dateFormat;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'datetimepicker',\r\n                'directives/decorators/bootstrap/datetimepicker/datetimepicker.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-new-image-view ng-model=\\\"$$value$$\\\" ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$.image\\\">\\r\\n            </div>\\r\\n            <p>{{$$value$$.originalName}}</p>\\r\\n\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-new-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$.image}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\"\\r\\n                   class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a>\\r\\n                <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteImage(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span\\r\\n                        class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkNewImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkNewImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index, model) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        ngModel.$setViewValue(null);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var newImageInjector = function (name, schema, options) {\r\n                if (schema.type === 'image') {\r\n                    var pathArray = options.path.filter(function(e){return e});\r\n                    //pathArray = pathArray.map(function (e) {\r\n                    //    if (e != \"\") {\r\n                    //        return e;\r\n                    //    }\r\n                    //});\r\n                    var path = pathArray.join('.');\r\n\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'image';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            if (!schemaFormProvider.defaults.image)\r\n                schemaFormProvider.defaults.image = [];\r\n            schemaFormProvider.defaults.image.unshift(newImageInjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'image',\r\n                'directives/decorators/bootstrap/new-imageinjector/new-imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/imageinjector/imageinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-image-view ng-src=\\\"{{image}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload image -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change image -->\\r\\n                    <input bk-image-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"image\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"imageExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"imageExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{image}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"imageExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkImageUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if($files && $files.length>0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                                if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                    var file = scope.myFiles[0];\r\n                                    models.getModelConfig(modelName, function (config) {\r\n                                        var fieldName = scope.$eval(attrs.path);\r\n                                        //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                        models.uploadImage(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                            //console.log(data);\r\n                                        });\r\n                                    });\r\n                                }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkImageView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImage = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+Image';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getImageUrl(modelName, id, value, function (url) {\r\n                            scope.image = url;\r\n                            scope.imageExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.image = defaultImage;\r\n                        scope.imageExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download image from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteImage = function (index) {\r\n                    models.deleteImage(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"Image deleted\");\r\n                        scope.image = defaultImage;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var imageinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'image') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'imageinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(imageinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'imageinjector',\r\n                'directives/decorators/bootstrap/imageinjector/imageinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/fileinjector/fileinjector.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css\\\">\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n\\r\\n    <div class=\\\"input-group\\\">\\r\\n        <div class=\\\"fileinput fileinput-new\\\" data-provides=\\\"fileinput\\\">\\r\\n            <div class=\\\"fileinput-new thumbnail\\\" style=\\\"width: 200px; height: 150px;\\\">\\r\\n                <img bk-file-view ng-src=\\\"{{file}}\\\" filename=\\\"$$value$$\\\">\\r\\n            </div>\\r\\n            {{$$value$$}}\\r\\n            <div class=\\\"fileinput-preview fileinput-exists thumbnail\\\"\\r\\n                 style=\\\"max-width: 200px; max-height: 150px;\\\"></div>\\r\\n            <div>\\r\\n                <span class=\\\"btn btn-default btn-file\\\">\\r\\n                    <span class=\\\"fileinput-new\\\"><span class=\\\"glyphicon glyphicon-cloud-upload\\\"></span></span> <!-- upload file -->\\r\\n                    <span class=\\\"fileinput-exists\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span></span> <!-- change file -->\\r\\n                    <input bk-file-uploader\\r\\n                           type=\\\"file\\\"\\r\\n                           name=\\\"file\\\"\\r\\n                           path=\\\"form.path\\\"\\r\\n                           index=\\\"{{arrayIndex}}\\\"\\r\\n                           ngf-select=\\\"true\\\" ng-model=\\\"myFiles\\\" ngf-change=\\\"fileExists=false; onFileSelect($files)\\\">\\r\\n                </span>\\r\\n                <a href=\\\" #\\\" class=\\\"btn btn-default fileinput-exists\\\" data-dismiss=\\\"fileinput\\\"><span class=\\\"glyphicon glyphicon-remove\\\"></span></a> <!-- discard -->\\r\\n                <a ng-if=\\\"fileExists\\\" download=\\\"{{$$value$$}}\\\" ng-href=\\\"{{file}}\\\" target=\\\"_self\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-cloud-download\\\"></span></a> <!-- download -->\\r\\n                <a ng-if=\\\"fileExists\\\" ng-click=\\\"deleteFile(arrayIndex)\\\" class=\\\"btn btn-default\\\"><span class=\\\"glyphicon glyphicon-trash\\\"></span></a> <!-- delete from server -->\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js\\\"></script>\");}]);\nangular.module('schemaForm')\r\n    .directive('bkFileUploader', ['$http', '$routeParams', '$timeout', 'models', function ($http, $routeParams, $timeout, models) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: true,\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var modelName = $routeParams.schema;\r\n                scope.onFileSelect = function ($files) {\r\n                    if ($files && $files.length > 0) {\r\n                        scope.$on('postedDocument', function (event, args) {\r\n                            if (scope.myFiles && scope.myFiles.length > 0) {\r\n                                var file = scope.myFiles[0];\r\n                                models.getModelConfig(modelName, function (config) {\r\n                                    var fieldName = scope.$eval(attrs.path);\r\n                                    //console.log(modelName, args[config.id], fieldName, scope.$eval(attrs.index), file);\r\n                                    models.uploadFile(modelName, args[config.id], fieldName, scope.arrayIndex, file, function (data) {\r\n                                        //console.log(data);\r\n                                    });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }])\r\n    .directive('bkFileView', ['$routeParams', 'models', function ($routeParams, models) {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs, ngModel) {\r\n                var defaultImageForFile = '//dummyimage.com/200x150/cccccc/ffffff&text=Upload+File';\r\n                var id = $routeParams.id;\r\n                var modelName = $routeParams.schema;\r\n                scope.$watch(attrs.filename, function (value) {\r\n                    if (value) {\r\n                        models.getFileUrl(modelName, id, value, function (url) {\r\n                            scope.file = url;\r\n                            scope.fileExists = true;\r\n                        });\r\n                    } else {\r\n                        scope.file = defaultImageForFile;\r\n                        scope.fileExists = false;\r\n                    }\r\n                });\r\n\r\n                scope.downloadImage = function () {\r\n                    console.log(\"TODO: Download file from model\", modelName, \"and id\", id);\r\n                };\r\n\r\n                scope.deleteFile = function (index) {\r\n                    models.deleteFile(modelName, id, index, scope.$eval(attrs.filename), function () {\r\n                        console.log(\"File deleted\");\r\n                        scope.file = defaultImageForFile;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var fileinjector = function (name, schema, options) {\r\n                if (schema.type === 'string' && schema.format === 'file') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'fileinjector';\r\n                    f.index = 'arrayIndex';\r\n                    f.path = schema.path;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(fileinjector);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'fileinjector',\r\n                'directives/decorators/bootstrap/fileinjector/fileinjector.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/mixed/mixed.html\",\"<link rel=\\\"stylesheet\\\" href=\\\"dist/css/codemirror/theme/monokai.css\\\"/>\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-codemirror ui-codemirror-opts=\\\"editorOptions\\\" ng-model=\\\"$$value$$\\\" ui-codemirror=\\\"{ onLoad : codemirrorLoaded }\\\"></ui-codemirror>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n<script src=\\\"dist/extra/codemirror/javascript.js\\\"></script>\");}]);\nangular.module('schemaForm').directive('uiCodemirror', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            scope.editorOptions = {\r\n                lineNumbers: true,\r\n                //theme: 'monokai',\r\n                mode: 'application/json',\r\n                foldGutter: {\r\n                    rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.brace)\r\n                },\r\n                matchBrackets: true,\r\n                gutters: [\"CodeMirror-foldgutter\"]\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('ui.codemirror', []).constant('uiCodemirrorConfig', {}).directive('uiCodemirror', ['uiCodemirrorConfig', function (uiCodemirrorConfig) {\r\n        return {\r\n            restrict: 'EA',\r\n            require: '?ngModel',\r\n            priority: 1,\r\n            compile: function compile() {\r\n                // Require CodeMirror\r\n                if (angular.isUndefined(window.CodeMirror)) {\r\n                    throw new Error('ui-codemirror need CodeMirror to work... (o rly?)');\r\n                }\r\n                return function postLink(scope, iElement, iAttrs, ngModel) {\r\n                    var options, opts, codeMirror, initialTextValue;\r\n                    initialTextValue = iElement.text();\r\n                    options = uiCodemirrorConfig.codemirror || {};\r\n                    opts = angular.extend({value: initialTextValue}, options, scope.$eval(iAttrs.uiCodemirror), scope.$eval(iAttrs.uiCodemirrorOpts));\r\n                    if (iElement[0].tagName === 'TEXTAREA') {\r\n                        // Might bug but still ...\r\n                        codeMirror = window.CodeMirror.fromTextArea(iElement[0], opts);\r\n                    } else {\r\n                        iElement.html('');\r\n                        codeMirror = new window.CodeMirror(function (cm_el) {\r\n                            iElement.append(cm_el);\r\n                        }, opts);\r\n                    }\r\n                    if (iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts) {\r\n                        var codemirrorDefaultsKeys = Object.keys(window.CodeMirror.defaults);\r\n                        scope.$watch(iAttrs.uiCodemirror || iAttrs.uiCodemirrorOpts, function updateOptions(newValues, oldValue) {\r\n                            if (!angular.isObject(newValues)) {\r\n                                return;\r\n                            }\r\n                            codemirrorDefaultsKeys.forEach(function (key) {\r\n                                if (newValues.hasOwnProperty(key)) {\r\n                                    if (oldValue && newValues[key] === oldValue[key]) {\r\n                                        return;\r\n                                    }\r\n                                    codeMirror.setOption(key, newValues[key]);\r\n                                }\r\n                            });\r\n                        }, true);\r\n                    }\r\n                    if (ngModel) {\r\n                        // CodeMirror expects a string, so make sure it gets one.\r\n                        // This does not change the model.\r\n                        ngModel.$formatters.push(function (value) {\r\n                            if (angular.isUndefined(value) || value === null) {\r\n                                return '';\r\n                            } else if (angular.isObject(value) || angular.isArray(value)) {\r\n                                return JSON.stringify(value);\r\n                            }\r\n                            return value;\r\n                        });\r\n                        // Override the ngModelController $render method, which is what gets called when the model is updated.\r\n                        // This takes care of the synchronizing the codeMirror element with the underlying model, in the case that it is changed by something else.\r\n                        ngModel.$render = function () {\r\n                            //Code mirror expects a string so make sure it gets one\r\n                            //Although the formatter have already done this, it can be possible that another formatter returns undefined (for example the required directive)\r\n                            var safeViewValue = ngModel.$viewValue || '';\r\n                            codeMirror.setValue(safeViewValue);\r\n                        };\r\n                        // Keep the ngModel in sync with changes from CodeMirror\r\n                        codeMirror.on('change', function (instance) {\r\n                            var newValue = instance.getValue();\r\n                            if (newValue !== ngModel.$viewValue) {\r\n                                // Changes to the model from a callback need to be wrapped in $apply or angular will not notice them\r\n                                scope.$apply(function () {\r\n                                    try {\r\n                                        var parsed = JSON.parse(newValue);\r\n                                        ngModel.$setViewValue(parsed);\r\n                                    } catch (e){\r\n                                        //Safe to ignore this :)\r\n                                    }\r\n                                });\r\n                            }\r\n\r\n                            //var totalLines = codeMirror.lineCount();\r\n                            //codeMirror.autoFormatRange({line:0, ch:0}, {line:totalLines});\r\n                        });\r\n                    }\r\n                    // Watch ui-refresh and refresh the directive\r\n                    if (iAttrs.uiRefresh) {\r\n                        scope.$watch(iAttrs.uiRefresh, function (newVal, oldVal) {\r\n                            // Skip the initial watch firing\r\n                            if (newVal !== oldVal) {\r\n                                codeMirror.refresh();\r\n                            }\r\n                        });\r\n                    }\r\n                    // Allow access to the CodeMirror instance through a broadcasted event\r\n                    // eg: $broadcast('CodeMirror', function(cm){...});\r\n                    scope.$on('CodeMirror', function (event, callback) {\r\n                        if (angular.isFunction(callback)) {\r\n                            callback(codeMirror);\r\n                        } else {\r\n                            throw new Error('the CodeMirror event requires a callback function');\r\n                        }\r\n                    });\r\n                    // onLoad callback\r\n                    if (angular.isFunction(opts.onLoad)) {\r\n                        opts.onLoad(codeMirror);\r\n                    }\r\n                };\r\n            }\r\n        };\r\n    }\r\n]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type == 'object' && !schema.ref && !schema.format && schema.mixed) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'mixed';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.object.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'mixed',\r\n                'directives/decorators/bootstrap/mixed/mixed.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/button/button.html\",\"<div class=\\\"form-group\\\">\\r\\n    <button bk-button type=\\\"button\\\" ng-click=\\\"click()\\\" ng-show=\\\"showTitle()\\\" class=\\\"btn\\\">{{form.title}}</button>\\r\\n</div>\");}]);\r\nangular.module('schemaForm').directive('bkButton', ['$http', 'models', function ($http, models) {\r\n\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var form = scope.form;\r\n            scope.click = function () {\r\n                scope.$emit('bkButton', form);\r\n                //if (form.action == 'api') {\r\n                //    if (form.method == 'GET') {\r\n                //        $http.get(form.url + 'dfdfdf').success(function (res) {\r\n                //            console.log(res);\r\n                //        }).error(function (err) {\r\n                //            console.error(err);\r\n                //        });\r\n                //    }\r\n                //} else if (form.action == 'function') {\r\n                //    console.log(scope.form);\r\n                //    window[form.func]();\r\n                //}\r\n            };\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'button')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'button';\r\n                    f.action = schema.action;\r\n                    if (f.action == 'api') {\r\n                        f.method = schema.method;\r\n                        f.url = schema.url;\r\n                        f.params = schema.params;\r\n                    } else if(f.action == 'function'){\r\n                        f.func = schema.func;\r\n                    }\r\n                    f.function = schema.onClick;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'button',\r\n                'directives/decorators/bootstrap/button/button.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/textarea/textarea.html\",\"<div class=\\\"form-group has-feedback\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <textarea class=\\\"form-control\\\"\\n              sf-changed=\\\"form\\\"\\n              placeholder=\\\"{{form.placeholder}}\\\"\\n              ng-disabled=\\\"form.readonly\\\"\\n              ng-model=\\\"$$value$$\\\"\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\n              schema-validate=\\\"form\\\"\\n              rows=\\\"{{form.rows}}\\\"></textarea>\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\n</div>\");}]);\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'textarea')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'textarea';\r\n                    f.rows = schema.rows;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'textarea',\r\n                'directives/decorators/bootstrap/textarea/textarea.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/password/password.html\",\"<div class=\\\"form-group has-feedback {{form.divStyle}}\\\" ng-class=\\\"{\\'has-error\\': hasError(), \\'has-success\\': hasSuccess()}\\\">\\r\\n    <label ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <input type=\\\"password\\\" class=\\\"form-control {{form.style}}\\\"\\r\\n              sf-changed=\\\"form\\\"\\r\\n              placeholder=\\\"{{form.placeholder}}\\\"\\r\\n              ng-disabled=\\\"form.readonly\\\"\\r\\n              ng-model=\\\"$$value$$\\\"\\r\\n              ng-model-options=\\\"form.ngModelOptions\\\"\\r\\n              schema-validate=\\\"form\\\">\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\");}]);\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'string' && (schema.format === 'password')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'password';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.string.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'password',\r\n                'directives/decorators/bootstrap/password/password.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/seconds/seconds.html\",\"<fieldset ng-disabled=\\\"form.readonly\\\" class=\\\"schema-form-fieldset {{form.htmlClass}}\\\">\\n    <legend ng-show=\\\"form.title\\\">{{ form.title }}</legend>\\n\\n    <!--<sf-decorator>-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Minutes</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" class=\\\"form-control\\\" ng-model=\\\"timeMinutes\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n\\n    <!--<sf-decorator class=\\\"ng-scope\\\">-->\\n    <div class=\\\"form-group schema-form-number col-xs-3 has-success has-feedback\\\">\\n        <label>Seconds</label>\\n        <input type=\\\"number\\\" min=\\\"0\\\" max=\\\"59\\\" class=\\\"form-control\\\" ng-model=\\\"timeSeconds\\\"/>\\n            <span ng-if=\\\"form.feedback !== false\\\" class=\\\"form-control-feedback ng-scope glyphicon glyphicon-ok\\\"\\n                  ng-class=\\\"evalInScope(form.feedback) || {\\'glyphicon\\': true, \\'glyphicon-ok\\': hasSuccess(), \\'glyphicon-remove\\': hasError() }\\\"\\n                  aria-hidden=\\\"true\\\"></span>\\n    </div>\\n    <!--</sf-decorator>-->\\n    <div class=\\\"help-block\\\"\\n         ng-show=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"\\n         ng-bind-html=\\\"(hasError() && errorMessage(schemaError())) || form.description\\\"></div>\\n</fieldset>\\n\\n<input bk-seconds ng-model=\\\"$$value$$\\\" type=\\\"hidden\\\"/>\");}]);\r\nangular.module('schemaForm').directive('bkSeconds', ['$http', '$routeParams', 'models', function ($http, $routeParams, models) {\r\n    return {\r\n        restrict: 'AE',\r\n        require: 'ngModel',\r\n        link: function (scope, element, attrs, ngModel) {\r\n            ngModel.$render = function () {\r\n                if (ngModel.$viewValue != undefined) {\r\n                    scope.timeMinutes = Math.floor(ngModel.$viewValue / 60);\r\n                    scope.timeSeconds = ngModel.$viewValue % 60;\r\n                } else{\r\n                    scope.timeMinutes = 0;\r\n                    scope.timeSeconds = 0;\r\n                }\r\n            };\r\n\r\n            scope.$watch(\"timeMinutes\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(newval * 60 + scope.timeSeconds);\r\n            });\r\n\r\n            scope.$watch(\"timeSeconds\", function (newval) {\r\n                if (newval != undefined)\r\n                    ngModel.$setViewValue(scope.timeMinutes * 60 + newval);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var seconds = function (name, schema, options) {\r\n                if (schema.type === 'number' && schema.format === 'time-seconds') {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'seconds';\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(seconds);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'seconds',\r\n                'directives/decorators/bootstrap/seconds/seconds.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/multiselect/multiselect.html\",\"<div class=\\\"form-group schema-form-select {{form.htmlClass}}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <ui-select select-multiple multiple ng-model=\\\"$$value$$\\\" separator=\\\"form.separator\\\" choices=\\\"choices\\\" enum=\\\"form.enum\\\" map=\\\"form.map\\\" lock=\\\"form.locked\\\" url=\\\"form.url\\\" ng-disabled=\\\"disabled\\\">\\r\\n        <ui-select-match placeholder=\\\"{{placeholder}}\\\">{{common.prettifyTitle($item.name)}}</ui-select-match>\\r\\n        <ui-select-choices\\r\\n                group-by=\\\"group\\\"\\r\\n                repeat=\\\"elem.value as elem in availableElems | filter: $select.search\\\"\\r\\n                refresh=\\\"refreshData($select.search)\\\">\\r\\n            {{getTitle(elem)}}\\r\\n        </ui-select-choices>\\r\\n    </ui-select>\\r\\n</div>\");}]);\nangular.module('schemaForm').directive('selectMultiple', ['$http', '$routeParams', 'models', 'common', function ($http, $routeParams, models, common) {\r\n    function convertToMap(elements){\r\n        var map = [];\r\n        angular.forEach(elements, function(val) {\r\n            if(val.name && val.value){\r\n                map.push(val);\r\n            } else if(val.split) { // is a string)\r\n                map.push({name: val, value: val});\r\n            } else{\r\n                console.error(\"Invalid value\", val, \"for multiselect element\")\r\n            }\r\n        });\r\n\r\n        return map;\r\n    }\r\n\r\n    function addStringToMap(val, map){\r\n        var exists = false;\r\n        angular.forEach(map, function(v){\r\n            if(v.value == val){\r\n                exists = true;\r\n            }\r\n        });\r\n\r\n        if(!exists) {\r\n            map.push({name: val, value: val});\r\n        }\r\n\r\n        return map;\r\n    }\r\n\r\n    return {\r\n        restrict: 'AE',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n\r\n            //WAIT TO LOAD :)\r\n            //$('body').delegate('.page-sidebar li > a', 'click',  function (e) {});\r\n\r\n\r\n            scope.common = common;\r\n            scope.grouping = false;\r\n            scope.separator = scope.$eval(attrs.separator);\r\n            scope.url = scope.$eval(attrs.url);\r\n            scope.lock = scope.$eval(attrs.lock);\r\n            scope.availableElems = [];\r\n            scope.placeholder = \"Select\";\r\n            scope.enum = scope.$eval(attrs.enum);\r\n            scope.map = scope.$eval(attrs.map);\r\n\r\n            if(scope.separator){\r\n                scope.group = function(item){\r\n                    return item.name.split(scope.separator)[0];\r\n                };\r\n                scope.grouping = true;\r\n            }\r\n\r\n            scope.getTitle = function(val){\r\n                if(scope.separator){\r\n                    var splitted = val.name.split(scope.separator);\r\n                    splitted.splice(0,1);\r\n                    var value = splitted.join(scope.separator);\r\n                    return common.prettifyTitle(value, scope.separator);\r\n                } else {\r\n                    return common.prettifyTitle(val.name);\r\n                }\r\n            };\r\n\r\n            scope.refreshData = function (item) {\r\n                if(!scope.lock) {\r\n                    if (item) {\r\n                        scope.availableElems = addStringToMap(item, scope.availableElems);\r\n                    }\r\n                }\r\n            };\r\n\r\n            if(scope.url){\r\n                if(common.hasAngularVariable(scope.url)){\r\n                    if ($routeParams.id) {\r\n                        models.getDocument($routeParams.schema, $routeParams.id, function (doc) {\r\n                            var a = common.deAngularizeUrl(doc, scope.url);\r\n                            $http.get(a).then(function (elems) {\r\n                                var d = elems.data;\r\n                                if (d instanceof Array) {\r\n                                    scope.availableElems = convertToMap(d);\r\n                                } else {\r\n                                    console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                                }\r\n                            });\r\n                        });\r\n                    } else {\r\n                        scope.placeholder = \"Cannot resolve variable \" + common.getAngularVariables(scope.url) + \". Please save the document first\";\r\n                        scope.availableElems = convertToMap(scope.$eval(attrs.choices) || []);\r\n                    }\r\n                } else {\r\n                    $http.get(scope.url).then(function (elems) {\r\n                        var d = elems.data;\r\n                        if (d instanceof Array) {\r\n                            scope.availableElems = convertToMap(d);\r\n                        } else {\r\n                            console.error(\"Invalid values for multiselect\", \"values:\", d);\r\n                        }\r\n                    });\r\n                }\r\n\r\n            } else {\r\n                if(scope.map){\r\n                    scope.availableElems = convertToMap(scope.map);\r\n                } else if(scope.enum){\r\n                    scope.availableElems = convertToMap(scope.enum);\r\n                } else {\r\n                    console.error(\"Bad configuration for multiselect\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var multiselect = function (name, schema, options) {\r\n                if (schema.type === 'array' && schema.items.type === 'string' && (schema.items.enum || schema.items.enumUrl || schema.items.map)) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'multiselect';\r\n                    f.map = schema.items.map;\r\n                    f.enum = schema.items.enum;\r\n                    f.path = schema.path;\r\n                    f.separator = schema.items.separator;\r\n                    f.locked = schema.items.limitToOptions || false;\r\n                    f.url = schema.items.enumUrl;\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.array.unshift(multiselect);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'multiselect',\r\n                'directives/decorators/bootstrap/multiselect/multiselect.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/rating/rating.html\",\"<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\n    <rating bk-rating ng-model=\\\"$$value$$\\\" max=\\\"form.maxValue\\\" min=\\\"form.minValue\\\" state-on=\\\"form.iconOn\\\" state-off=\\\"form.iconOff\\\"></rating>\\n</div>\");}]);\r\nangular.module('schemaForm').directive('bkRating', ['$http', '$routeParams', function ($http, $routeParams) {\r\n    return {\r\n        restrict: 'AE',\r\n        link: function (scope, element, attrs, ngModel) {\r\n        }\r\n    }\r\n}]);\r\n\r\nangular.module('schemaForm').config(\r\n    ['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function (schemaFormProvider, schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n            var mixed = function (name, schema, options) {\r\n                if (schema.type === 'number' && (schema.format === 'rating')) {\r\n                    var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n                    f.key = options.path;\r\n                    f.type = 'rating';\r\n\r\n                    if (schema.minValue)\r\n                        f.minValue = schema.minValue;\r\n                    if (schema.maxValue)\r\n                        f.maxValue = schema.maxValue;\r\n                    if (schema.iconOn)\r\n                        f.iconOn = schema.iconOn;\r\n                    if (schema.iconOff)\r\n                        f.iconOff = schema.iconOff;\r\n\r\n                    options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n                    return f;\r\n                }\r\n            };\r\n\r\n            schemaFormProvider.defaults.number.unshift(mixed);\r\n\r\n            //Add to the bootstrap directive\r\n            schemaFormDecoratorsProvider.addMapping(\r\n                'bootstrapDecorator',\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n            schemaFormDecoratorsProvider.createDirective(\r\n                'rating',\r\n                'directives/decorators/bootstrap/rating/rating.html'\r\n            );\r\n        }\r\n    ]);\r\n\nangular.module(\"schemaForm\").run(['$templateCache', function($templateCache) {$templateCache.put(\"directives/decorators/bootstrap/ritinymce/ritinymce.html\",\"<!--<script type=\\\"text/javascript\\\" src=\\\"/admin/tinymce/tinymce.min.js\\\"></script>-->\\r\\n<div class=\\\"form-group\\\" ng-class=\\\"{\\'has-error\\': hasError()}\\\">\\r\\n    <label class=\\\"control-label\\\" ng-show=\\\"showTitle()\\\">{{form.title}}</label>\\r\\n    <textarea\\r\\n            ri-tinymce=\\\"form.tinymceOptions\\\"\\r\\n            ng-model=\\\"$$value$$\\\"\\r\\n            style=\\\"background-color: white\\\"\\r\\n            schema-validate=\\\"form\\\"\\r\\n            ></textarea>\\r\\n    <span class=\\\"help-block\\\">{{ (hasError() && errorMessage(schemaError())) || form.description}}</span>\\r\\n</div>\\r\\n\\r\\n<style>\\r\\n    .modal {\\r\\n        z-index: 15001 !important;\\r\\n    }\\r\\n\\r\\n    .modal-dialog {\\r\\n        z-index: 15001  !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block {\\r\\n        z-index: 15000  !important;\\r\\n    }\\r\\n\\r\\n    .mce-floatpanel {\\r\\n        z-index: 15001  !important;\\r\\n    }\\r\\n\\r\\n    #mce-modal-block .mce-panel {\\r\\n        z-index: 15001  !important;\\r\\n    }\\r\\n\\r\\n    droplet {\\r\\n        display: inline-block;\\r\\n        z-index: 15003;\\r\\n        position: relative;\\r\\n        border-radius: 2px;\\r\\n        width: 100%;\\r\\n        height: 400px;\\r\\n        background-color: rgba(255, 255, 255, .1);\\r\\n        margin-top: -5px;\\r\\n        padding-top: 5px;\\r\\n        transition: box-shadow 0.35s;\\r\\n    }\\r\\n\\r\\n    droplet.event-dragover {\\r\\n        box-shadow: inset 0 0 100px rgba(255, 255, 255, .25), inset 0 0 5px rgba(255, 255, 255, .25);\\r\\n    }\\r\\n\\r\\n    droplet ul.files {\\r\\n        height: 100%;\\r\\n        width: 100%;\\r\\n        overflow-y: auto;\\r\\n        padding: 5px;\\r\\n        list-style-type: none;\\r\\n        transition: all .5s;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li {\\r\\n        width: 100px;\\r\\n        height: 100px;\\r\\n        padding: 1px;\\r\\n        float: left;\\r\\n        position: relative;\\r\\n        margin: 5px;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li img.droplet-preview {\\r\\n        max-width: 96px;\\r\\n        background-size: cover;\\r\\n        background-repeat: no-repeat;\\r\\n        height: 96px;\\r\\n        width: 96px;\\r\\n        background-color: white;\\r\\n        box-shadow: 0 0 10px rgba(0, 0, 0, .25);\\r\\n        border: 1px solid white;\\r\\n        display: block;\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete {\\r\\n        background-color: rgba(0, 0, 0, .25);\\r\\n        width: 50px;\\r\\n        height: 50px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        color: white;\\r\\n        font-size: 25px;\\r\\n        text-shadow: 1px 1px 0 rgba(0, 0, 0, .25);\\r\\n        text-align: center;\\r\\n        cursor: pointer;\\r\\n        line-height: 50px;\\r\\n        position: absolute;\\r\\n        border-radius: 50%;\\r\\n        z-index: 1010;\\r\\n        top: 25px;\\r\\n        left: 25px;\\r\\n        opacity: 0;\\r\\n        transition: all .30s;\\r\\n        transform: scale(0.5);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li:hover div.delete {\\r\\n        opacity: 1;\\r\\n        transform: scale(1);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.delete:hover {\\r\\n        background-color: rgba(0, 0, 0, .45);\\r\\n    }\\r\\n\\r\\n    droplet ul.files li div.size {\\r\\n        background-color: rgba(255, 255, 255, .5);\\r\\n        position: absolute;\\r\\n        bottom: 5px;\\r\\n        right: 5px;\\r\\n        pointer-events: none;\\r\\n        font-size: 9px;\\r\\n        font-family: Lato, Arial, Tahoma, Helvetica, sans-serif;\\r\\n        padding: 1px 4px;\\r\\n    }\\r\\n</style>\\r\\n\\r\\n\\r\\n<!--MODAL FOR VALIDATION-->\\r\\n<script type=\\\"text/ng-template\\\" id=\\\"imgUploader.html\\\">\\r\\n    <div class=\\\"modal-header\\\">\\r\\n        <h3 class=\\\"modal-title\\\">Upload Files</h3>\\r\\n    </div>\\r\\n    <div class=\\\"modal-body\\\">\\r\\n        <droplet ng-model=\\\"dropletint\\\">\\r\\n\\r\\n            <!--<div class=\\\"loading\\\" ng-class=\\\"{ visible: dropletint.isUploading() }\\\">\\r\\n                <svg viewBox=\\\"0 0 400 400\\\">\\r\\n                    <path class=\\\"loading-path\\\" data-progressbar ng-model=\\\"dropletint.progress.percent\\\"\\r\\n                          d=\\\"M 0,1 L 398,1 L 398,234 L 1,234 L 0,1\\\"\\r\\n                          stroke=\\\"#D3B2D1\\\" stroke-width=\\\"1\\\" fill-opacity=\\\"0\\\"\\r\\n                          style=\\\"stroke-dasharray: 392px, 392px;stroke-dashoffset: 392px;\\\"></path>\\r\\n                </svg>\\r\\n            </div>-->\\r\\n\\r\\n            <section ng-show=\\\"dropletint.isUploading()\\\">Upload done. Press Cancel button or ESC key</section>\\r\\n\\r\\n            <ul class=\\\"files\\\">\\r\\n                <li ng-hide=\\\"dropletint.isUploading()\\\" ng-repeat=\\\"filemodel in dropletint.getFiles(dropletint.FILE_TYPES.VALID)\\\">\\r\\n                    <droplet-preview ng-model=\\\"filemodel\\\"></droplet-preview>\\r\\n                    <div class=\\\"delete\\\" ng-click=\\\"filemodel.deleteFile()\\\">&times;</div>\\r\\n                    <div class=\\\"size\\\">{{filemodel.file.size / 1024 / 1024 | number: 1}}MB</div>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </droplet>\\r\\n    </div>\\r\\n    <div class=\\\"modal-footer\\\">\\r\\n        <button class=\\\"btn btn-default\\\" ng-click=\\\"cancel()\\\">Cancel</button>\\r\\n        <button class=\\\"btn btn-primary\\\" ng-click=\\\"dropletint.uploadFiles()\\\" ng-hide=\\\"dropletint.isUploading()\\\">\\r\\n            Upload files\\r\\n        </button>\\r\\n    </div>\\r\\n</script>\\r\\n\");}]);\nangular.module('schemaForm').directive('riTinymce', ['$http', '$window', '$modal', function ($http, $window, $modal) {\r\n    var count = 0;\r\n\r\n    var defaultConf = {\r\n        plugins: \"code image -tinyvision autoresize fullscreen media link paste preview textcolor\",\r\n        toolbar1: \"undo redo | styleselect fontsizeselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | preview | fullscreen | forecolor backcolor\",\r\n        image_advtab: true,\r\n        forced_root_block: 'p',\r\n        width: '100%',\r\n        height: 400,\r\n        autoresize_min_height: 400,\r\n        autoresize_max_height: 800,\r\n        fullscreen_new_window: true,\r\n        skin_url: 'extra/tinymce/skins/lightgray',\r\n        fullscreen_settings: {\r\n            theme_advanced_path_location: \"top\"\r\n        },\r\n        paste_preprocess: function (pl, o) {\r\n            o.content = o.content.replace(/(<b>)/ig, \"<strong>\");\r\n            o.content = o.content.replace(/(<\\/b>)/ig, \"</strong>\");\r\n            o.content = o.content.replace(/(<i>)/ig, \"<em>\");\r\n            o.content = o.content.replace(/(<\\/i>)/ig, \"</em>\");\r\n        },\r\n        //valid_elements: 'p,a[href],span[class],div[class],img[style|class|src|border=0|alt|title|hspace|vspace|width|height|align|onmouseover|onmouseout|name]',\r\n        tinyvision: {\r\n            source: '/gallery',\r\n            upload: function () {\r\n                $modal.open({\r\n                    templateUrl: 'imgUploader.html',\r\n                    controller: 'ModalImgUploaderCtrl',\r\n                    size: 'md'\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    return {\r\n        restrict: 'AC',\r\n        require: 'ngModel',\r\n        scope: false,\r\n        link: function (scope, element, attrs, ngModel) {\r\n            var tinymce;\r\n\r\n            if (!attrs.id) {\r\n                attrs.$set('id', 'ri-tinymce-' + count++);\r\n            } else {\r\n                //do we have real jQuery? or querySelector\r\n                var focus = function () {\r\n                    if (tinymce) {\r\n                    }\r\n                };\r\n                if ($window.jQuery) {\r\n                    jQuery('label[for=' + attrs.id + ']')\r\n                }\r\n            }\r\n\r\n            var destroy = function () {\r\n                if (tinymce) {\r\n                    tinymce.save();\r\n                    tinymce.remove();\r\n                    tinymce = null;\r\n                }\r\n            };\r\n            scope.destroy = destroy;\r\n\r\n            scope.$on('$destroy', destroy);\r\n\r\n            scope.$watch(attrs.ngModel, function (value, old) {\r\n                if (tinymce && angular.isDefined(value)) {\r\n                    var content = tinymce.getContent();\r\n                    if (angular.isString(value) && content !== value) {\r\n                        tinymce.setContent(value);\r\n                    }\r\n                }\r\n            });\r\n\r\n            var init = function (config) {\r\n                config = angular.extend(config || {}, defaultConf, {\r\n                    selector: '#' + attrs.id,\r\n                    setup: function (ed) {\r\n                        tinyMCE.PluginManager.load('tinyvision', '/admin/extra/tinyvision/build/plugin.min.js');\r\n                        tinymce = ed;\r\n                        $window['focus' + attrs.id] = function () {\r\n                            tinymce.execCommand('mceFocus', false, attrs.id);\r\n                        };\r\n\r\n                        var update = function () {\r\n                            var content = ed.getContent();\r\n                            if (ngModel.$viewValue !== content) {\r\n                                ngModel.$setViewValue(content);\r\n\r\n                                //certain things like 'destroy' below triggers update inside a $digest cycle.\r\n                                if (!scope.$root.$$phase) {\r\n                                    scope.$apply();\r\n                                }\r\n                            }\r\n                        };\r\n\r\n                        ed.on('change', update);\r\n                        ed.on('KeyUp', update);\r\n                        ed.on('ExecCommand', update);\r\n                        ed.on('focus', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).addClass('tx-tinymce-active');\r\n                        });\r\n                        ed.on('blur', function (e) {\r\n                            angular.element(e.target.contentAreaContainer).removeClass('tx-tinymce-active');\r\n                        });\r\n                    }\r\n                });\r\n\r\n                tinyMCE.init(config);\r\n            };\r\n\r\n            //If config is set watch it for changes, otherwise just init.\r\n            if (attrs.riTinymce) {\r\n                scope.$watch(attrs.riTinymce, function (c, old) {\r\n                    destroy();\r\n                    if (c) init(c);\r\n                    else init();\r\n                });\r\n            } else {\r\n                init();\r\n            }\r\n        }\r\n    }\r\n}])\r\n    // Please note that $modalInstance represents a modal window (instance) dependency.\r\n    // It is not the same as the $modal service used above.\r\n    .controller('ModalImgUploaderCtrl', ['$scope', '$modalInstance', '$timeout', function ($scope, $modalInstance, $timeout) {\r\n        $scope.success = false;\r\n        $scope.error = false;\r\n        $scope.$on('$dropletReady', function whenDropletReady() {\r\n            $scope.dropletint.allowedExtensions(['png', 'jpg', 'bmp', 'gif']);\r\n            $scope.dropletint.defineHTTPSuccess([200, 201]);\r\n            $scope.dropletint.setRequestUrl('/gallery/insert');\r\n        });\r\n\r\n        $scope.$on('$dropletSuccess', function onDropletSuccess(event, response, files) {\r\n            $modalInstance.close();\r\n        });\r\n\r\n        $scope.cancel = function () {\r\n            $modalInstance.close();\r\n        }\r\n\r\n        $modalInstance.result.finally(function () {\r\n            $('iframe').contents().find('#refresh').trigger('click');\r\n        });\r\n\r\n    }]);\r\n\nangular.module('routeInjector-tinymce', ['schemaForm']).config(\r\n['schemaFormProvider', 'schemaFormDecoratorsProvider', 'sfPathProvider', function(schemaFormProvider,  schemaFormDecoratorsProvider, sfPathProvider) {\r\n\r\n    var wysiwyg = function(name, schema, options) {\r\n    if (schema.type === 'string' && schema.format == 'html') {\r\n      var f = schemaFormProvider.stdFormObj(name, schema, options);\r\n      f.key  = options.path;\r\n      f.type = 'wysiwyg';\r\n      f.tinymceOptions = schema.tinymceOptions;\r\n      options.lookup[sfPathProvider.stringify(options.path)] = f;\r\n      return f;\r\n    }\r\n  };\r\n\r\n    schemaFormProvider.defaults.string.unshift(wysiwyg);\r\n\r\n  //Add to the bootstrap directive\r\n    schemaFormDecoratorsProvider.addMapping('bootstrapDecorator', 'wysiwyg',\r\n    'directives/decorators/bootstrap/ritinymce/ritinymce.html');\r\n    schemaFormDecoratorsProvider.createDirective('wysiwyg',\r\n    'directives/decorators/bootstrap/ritinymce/ritinymce.html');\r\n  }]);\r\n\n(function() {\n  var punchCardTemplate;\n\n  angular.module(\"punchCard\", []);\n\n  punchCardTemplate = \"<div id=\\\"punch-card\\\">\\n    <div class=\\\"punch-card-day\\\" ng-repeat='day in days'>\\n        <div class=\\\"punch-card-day-name\\\">\\n            <div class=\\\"punch-card-day-name-label\\\">{{ day }}</div>\\n        </div>\\n        <div class=\\\"punch-card-hour\\\"\\n             ng-repeat='hour in hours'\\n             ng-init=\\\"n = data[$parent.$index][$index]\\\">\\n            <div class=\\\"punch-card-hour-data size-{{ size(n) }}\\\"></div>\\n            <div class=\\\"punch-card-hour-tooltip\\\" ng-show=\\\"n\\\">\\n                <b>{{ n }}</b> {{ description(n) }}\\n                <div class=\\\"arrow\\\"></div>\\n            </div>\\n            <div class=\\\"punch-card-hour-tick\\\"></div>\\n        </div>\\n    </div>\\n    <div class=\\\"punch-card-hour-name\\\">\\n        <div class=\\\"punch-card-hour-name-label\\\" ng-repeat='hour in hours'>\\n            {{ hour }}\\n        </div>\\n    </div>\\n</div>\";\n\n  angular.module(\"punchCard\").directive(\"punchCard\", ['$compile', function($compile) {\n    return {\n      restrict: \"AE\",\n      scope: {\n        data: \"=\",\n        plural: \"@\",\n        singular: \"@\"\n      },\n      template: punchCardTemplate,\n      link: function($scope, element) {\n        $scope.days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.hours = [\"00\", \"01\", \"02\", \"03\", \"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\", \"21\", \"22\", \"23\"];\n        $scope.description = function(n) {\n          if (n === 1) {\n            return $scope.singular || \"event\";\n          } else {\n            return $scope.plural || \"events\";\n          }\n        };\n        return $scope.$watch(\"data\", function(data) {\n          var flatten, max;\n          flatten = [].concat.apply([], $scope.data);\n          max = flatten.sort(function(a, b) {\n            return a - b;\n          })[flatten.length - 1];\n          $scope.size = function(n) {\n            return Math.floor(100 / max * +n / 10);\n          };\n          element.empty();\n          return element.append($compile(punchCardTemplate)($scope));\n        });\n      }\n    };\n  }]);\n\n}).call(this);\n\n/*globals define, module, require, document*/\n(function (root, factory) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else if (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = factory();\n    } else {\n        root.JsonHuman = factory();\n    }\n}(this, function () {\n    \"use strict\";\n\n    var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n    function makePrefixer(prefix) {\n        return function (name) {\n            return prefix + \"-\" + name;\n        };\n    }\n\n    function isArray(obj) {\n        return toString.call(obj) === '[object Array]';\n    }\n\n    function sn(tagName, className, data) {\n        var result = document.createElement(tagName);\n\n        result.className = className;\n        result.appendChild(document.createTextNode(\"\" + data));\n\n        return result;\n    }\n\n    function scn(tagName, className, child) {\n        var result = document.createElement(tagName),\n            i, len;\n\n        result.className = className;\n\n        if (isArray(child)) {\n            for (i = 0, len = child.length; i < len; i += 1) {\n                result.appendChild(child[i]);\n            }\n        } else {\n            result.appendChild(child);\n        }\n\n        return result;\n    }\n\n    function linkNode(child, href, target){\n        var a = scn(\"a\", HYPERLINK_CLASS_NAME, child);\n        a.setAttribute('href', href);\n        a.setAttribute('target', target);\n        return a;\n    }\n\n    var toString = Object.prototype.toString,\n        prefixer = makePrefixer(\"jh\"),\n        p = prefixer,\n        ARRAY = 2,\n        BOOL = 4,\n        INT = 8,\n        FLOAT = 16,\n        STRING = 32,\n        OBJECT = 64,\n        SPECIAL_OBJECT = 128,\n        FUNCTION = 256,\n        UNK = 1,\n\n        STRING_CLASS_NAME = p(\"type-string\"),\n        STRING_EMPTY_CLASS_NAME = p(\"type-string\") + \" \" + p(\"empty\"),\n\n        BOOL_TRUE_CLASS_NAME = p(\"type-bool-true\"),\n        BOOL_FALSE_CLASS_NAME = p(\"type-bool-false\"),\n        BOOL_IMAGE = p(\"type-bool-image\"),\n        INT_CLASS_NAME = p(\"type-int\") + \" \" + p(\"type-number\"),\n        FLOAT_CLASS_NAME = p(\"type-float\") + \" \" + p(\"type-number\"),\n\n        OBJECT_CLASS_NAME = p(\"type-object\"),\n        OBJ_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"object-key\"),\n        OBJ_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"object-value\"),\n        OBJ_EMPTY_CLASS_NAME = p(\"type-object\") + \" \" + p(\"empty\"),\n\n        FUNCTION_CLASS_NAME = p(\"type-function\"),\n\n        ARRAY_KEY_CLASS_NAME = p(\"key\") + \" \" + p(\"array-key\"),\n        ARRAY_VAL_CLASS_NAME = p(\"value\") + \" \" + p(\"array-value\"),\n        ARRAY_CLASS_NAME = p(\"type-array\"),\n        ARRAY_EMPTY_CLASS_NAME = p(\"type-array\") + \" \" + p(\"empty\"),\n\n        HYPERLINK_CLASS_NAME = p('a'),\n\n        UNKNOWN_CLASS_NAME = p(\"type-unk\");\n\n    function getType(obj) {\n        var type = typeof obj;\n\n        switch (type) {\n        case \"boolean\":\n            return BOOL;\n        case \"string\":\n            return STRING;\n        case \"number\":\n            return (obj % 1 === 0) ? INT : FLOAT;\n        case \"function\":\n            return FUNCTION;\n        default:\n            if (isArray(obj)) {\n                return ARRAY;\n            } else if (obj === Object(obj)) {\n                if (obj.constructor === Object) {\n                    return OBJECT;\n                }\n                return OBJECT | SPECIAL_OBJECT\n            } else {\n                return UNK;\n            }\n        }\n    }\n\n    function _format(data, options, parentKey) {\n\n        var result, container, key, keyNode, valNode, len, childs, tr, value,\n            isEmpty = true,\n            isSpecial = false,\n            accum = [],\n            type = getType(data);\n\n        // Initialized & used only in case of objects & arrays\n        var hyperlinksEnabled, aTarget, hyperlinkKeys ;\n\n        if (type === BOOL) {\n            var boolOpt = options.bool;\n            container = document.createElement('div');\n\n            if (boolOpt.showImage) {\n                var img = document.createElement('img');\n                img.setAttribute('class', BOOL_IMAGE);\n\n                img.setAttribute('src',\n                    '' + (data ? boolOpt.img.true : boolOpt.img.false));\n\n                container.appendChild(img);\n            }\n\n            if (boolOpt.showText) {\n                container.appendChild(data ?\n                    sn(\"span\", BOOL_TRUE_CLASS_NAME, boolOpt.text.true) :\n                    sn(\"span\", BOOL_FALSE_CLASS_NAME, boolOpt.text.false));\n            }\n\n            result = container;\n\n        } else if (type === STRING) {\n            if (data === \"\") {\n                result = sn(\"span\", STRING_EMPTY_CLASS_NAME, \"(Empty Text)\");\n            } else {\n                result = sn(\"span\", STRING_CLASS_NAME, data);\n            }\n        } else if (type === INT) {\n            result = sn(\"span\", INT_CLASS_NAME, data);\n        } else if (type === FLOAT) {\n            result = sn(\"span\", FLOAT_CLASS_NAME, data);\n        } else if (type & OBJECT) {\n            if (type & SPECIAL_OBJECT) {\n                isSpecial = true;\n            }\n            childs = [];\n\n            aTarget =  options.hyperlinks.target;\n            hyperlinkKeys = options.hyperlinks.keys;\n\n            // Is Hyperlink Key\n            hyperlinksEnabled =\n                options.hyperlinks.enable &&\n                hyperlinkKeys &&\n                hyperlinkKeys.length > 0;\n\n            for (key in data) {\n                isEmpty = false;\n\n                value = data[key];\n\n                valNode = _format(value, options, key);\n                keyNode = sn(\"th\", OBJ_KEY_CLASS_NAME, key);\n\n                if( hyperlinksEnabled &&\n                    typeof(value) === 'string' &&\n                    indexOf.call(hyperlinkKeys, key) >= 0){\n\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, linkNode(valNode, value, aTarget));\n                } else {\n                    valNode = scn(\"td\", OBJ_VAL_CLASS_NAME, valNode);\n                }\n\n                tr = document.createElement(\"tr\");\n                tr.appendChild(keyNode);\n                tr.appendChild(valNode);\n\n                childs.push(tr);\n            }\n\n            if (isSpecial) {\n                result = sn('span', STRING_CLASS_NAME, data.toString())\n            } else if (isEmpty) {\n                result = sn(\"span\", OBJ_EMPTY_CLASS_NAME, \"(Empty Object)\");\n            } else {\n                result = scn(\"table\", OBJECT_CLASS_NAME, scn(\"tbody\", '', childs));\n            }\n        } else if (type === FUNCTION) {\n            result = sn(\"span\", FUNCTION_CLASS_NAME, data);\n        } else if (type === ARRAY) {\n            if (data.length > 0) {\n                childs = [];\n                var showArrayIndices = options.showArrayIndex;\n\n                aTarget = options.hyperlinks.target;\n                hyperlinkKeys = options.hyperlinks.keys;\n\n                // Hyperlink of arrays?\n                hyperlinksEnabled = parentKey && options.hyperlinks.enable &&\n                    hyperlinkKeys &&\n                    hyperlinkKeys.length > 0 &&\n                    indexOf.call(hyperlinkKeys, parentKey) >= 0;\n\n                for (key = 0, len = data.length; key < len; key += 1) {\n\n                    keyNode = sn(\"th\", ARRAY_KEY_CLASS_NAME, key);\n                    value = data[key];\n\n                    if (hyperlinksEnabled && typeof(value) === \"string\") {\n                        valNode = _format(value, options, key);\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            linkNode(valNode, value, aTarget));\n                    } else {\n                        valNode = scn(\"td\", ARRAY_VAL_CLASS_NAME,\n                            _format(value, options, key));\n                    }\n\n                    tr = document.createElement(\"tr\");\n\n                    if (showArrayIndices) {\n                        tr.appendChild(keyNode);\n                    }\n                    tr.appendChild(valNode);\n\n                    childs.push(tr);\n                }\n\n                result = scn(\"table\", ARRAY_CLASS_NAME, scn(\"tbody\", '', childs));\n            } else {\n                result = sn(\"span\", ARRAY_EMPTY_CLASS_NAME, \"(Empty List)\");\n            }\n        } else {\n            result = sn(\"span\", UNKNOWN_CLASS_NAME, data);\n        }\n\n        return result;\n    }\n\n    function format(data, options) {\n        options = validateOptions(options || {});\n\n        var result;\n\n        result = _format(data, options);\n        result.className = result.className + \" \" + prefixer(\"root\");\n\n        return result;\n    }\n\n    function validateOptions(options){\n        options = validateArrayIndexOption(options);\n        options = validateHyperlinkOptions(options);\n        options = validateBoolOptions(options);\n\n        // Add any more option validators here\n\n        return options;\n    }\n\n\n    function validateArrayIndexOption(options) {\n        if(options.showArrayIndex === undefined){\n            options.showArrayIndex = true;\n        } else {\n            // Force to boolean just in case\n            options.showArrayIndex = options.showArrayIndex ? true: false;\n        }\n\n        return options;\n    }\n\n    function validateHyperlinkOptions(options){\n        var hyperlinks = {\n            enable : false,\n            keys : null,\n            target : ''\n        };\n\n        if(options.hyperlinks && options.hyperlinks.enable) {\n            hyperlinks.enable = true;\n\n            hyperlinks.keys =  isArray(options.hyperlinks.keys) ? options.hyperlinks.keys : [];\n\n            if(options.hyperlinks.target) {\n                hyperlinks.target = '' + options.hyperlinks.target;\n            } else {\n                hyperlinks.target = '_blank';\n            }\n        }\n\n        options.hyperlinks = hyperlinks;\n\n        return options;\n    }\n\n    function validateBoolOptions(options){\n        if(!options.bool){\n            options.bool = {\n                text:  {\n                    true : \"true\",\n                    false : \"false\"\n                },\n                img : {\n                    true: \"\",\n                    false: \"\"\n                },\n                showImage : false,\n                showText : true\n            };\n        } else {\n            var boolOptions = options.bool;\n\n            // Show text if no option\n            if(!boolOptions.showText && !boolOptions.showImage){\n                boolOptions.showImage  =  false;\n                boolOptions.showText  =  true;\n            }\n\n            if(boolOptions.showText){\n                if(!boolOptions.text){\n                    boolOptions.text = {\n                        true : \"true\",\n                        false : \"false\"\n                    };\n                } else {\n                    var t = boolOptions.text.true, f = boolOptions.text.false;\n\n                    if(getType(t) != STRING || t === ''){\n                        boolOptions.text.true = 'true';\n                    }\n\n                    if(getType(f) != STRING || f === ''){\n                        boolOptions.text.false = 'false';\n                    }\n                }\n            }\n\n            if(boolOptions.showImage){\n                if(!boolOptions.img.true && !boolOptions.img.false){\n                    boolOptions.showImage = false;\n                }\n            }\n        }\n\n        return options;\n    }\n\n    return {\n        format: format\n    };\n}));\n\n(function () {\n    'use strict';\n    angular.module('flash', [])\n        .factory('flash', ['$rootScope', '$timeout', function ($rootScope, $timeout) {\n            var messages = [];\n\n            var reset;\n            var cleanup = function () {\n                $timeout.cancel(reset);\n                reset = $timeout(function () {\n                    messages = [];\n                });\n            };\n\n            var emit = function (event, url, oldUrl) {\n                if (oldUrl && oldUrl.indexOf('/login') != -1) {\n                    messages = [];\n                    $rootScope.$emit('flashMessage', undefined, cleanup);\n                } else {\n                    $rootScope.$emit('flashMessage', messages[0], cleanup);\n                }\n            };\n\n            $rootScope.$on('$locationChangeSuccess', emit);\n\n            var factory = {};\n\n            factory.error = function () {\n                [].unshift.call(arguments, \"error\");\n                process.apply(this, arguments);\n            };\n            factory.success = function () {\n                [].unshift.call(arguments, \"success\");\n                process.apply(this, arguments);\n            };\n\n            factory.warning = function () {\n                [].unshift.call(arguments, \"warning\");\n                process.apply(this, arguments);\n            };\n\n            factory.getMessage = function () {\n                return messages[0];\n            };\n\n            function process() {\n                var length = arguments.length;\n                if (length < 3) {\n                    throw new Error(\"Minimum arguments for Flash is 2 (Title and Body)\");\n                }\n\n                var obj = {\n                    type: arguments[0],\n                    title: arguments[1]\n                };\n                if (length < 4) {\n                    obj.message = arguments[2];\n                } else {\n                    obj.messages = [];\n                    for (var i = 0; i < length - 2; i++) {\n                        obj.messages.push(arguments[2 + i]);\n                    }\n                }\n                emit(messages = [obj]);\n            }\n\n            return factory;\n        }])\n\n        .directive('flashMessage', function () {\n            return {\n                restrict: 'E',\n                template: '<div ng-if=\"type==\\'error\\'\" class=\"alert alert-danger\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'success\\'\" class=\"alert alert-success\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>' +\n\n                '<div ng-if=\"type==\\'warning\\'\" class=\"alert alert-warning\">' +\n                '<span><h3>{{title}}</h3></span>' +\n                '<p ng-if=\"message\" ng-bind-html=\"message\"></p>' +\n                '<li ng-if=\"messages\" ng-repeat=\"m in messages\"><p ng-bind-html=\"m\"></p></li>' +\n                '</div>',\n                controller: ['$scope', '$rootScope', 'flash', function ($scope, $rootScope, flash) {\n                    $rootScope.$on('flashMessage', function (event, data, done) {\n                        processData(data);\n                        done();\n                    });\n                    $scope.getMessage = function () {\n\n                        processData(flash.getMessage());\n                    };\n                    $scope.getMessage();\n\n                    function processData(data) {\n                        if (data) {\n                            $scope.type = data.type;\n                            $scope.title = data.title;\n                            $scope.messages = data.messages;\n                            $scope.message = data.message;\n                            //done();\n                        } else {\n                            $scope.type = undefined;\n                            $scope.title = undefined;\n                            $scope.messages = undefined;\n                            $scope.message = undefined;\n                        }\n                    }\n                }]\n            };\n        });\n})();\n\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * FileAPI Flash shim for old browsers not supporting FormData\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\n(function () {\n  /** @namespace FileAPI.noContentTimeout */\n\n  function patchXHR(fnName, newFn) {\n    window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\n  }\n\n  function redefineProp(xhr, prop, fn) {\n    try {\n      Object.defineProperty(xhr, prop, {get: fn});\n    } catch (e) {/*ignore*/\n    }\n  }\n\n  if (!window.FileAPI) {\n    window.FileAPI = {};\n  }\n\n  FileAPI.shouldLoad = (window.XMLHttpRequest && !window.FormData) || FileAPI.forceLoad;\n  if (FileAPI.shouldLoad) {\n    var initializeUploadListener = function (xhr) {\n      if (!xhr.__listeners) {\n        if (!xhr.upload) xhr.upload = {};\n        xhr.__listeners = [];\n        var origAddEventListener = xhr.upload.addEventListener;\n        xhr.upload.addEventListener = function (t, fn) {\n          xhr.__listeners[t] = fn;\n          if (origAddEventListener) origAddEventListener.apply(this, arguments);\n        };\n      }\n    };\n\n    patchXHR('open', function (orig) {\n      return function (m, url, b) {\n        initializeUploadListener(this);\n        this.__url = url;\n        try {\n          orig.apply(this, [m, url, b]);\n        } catch (e) {\n          if (e.message.indexOf('Access is denied') > -1) {\n            this.__origError = e;\n            orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\n          }\n        }\n      };\n    });\n\n    patchXHR('getResponseHeader', function (orig) {\n      return function (h) {\n        return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\n      };\n    });\n\n    patchXHR('getAllResponseHeaders', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('abort', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('setRequestHeader', function (orig) {\n      return function (header, value) {\n        if (header === '__setXHR_') {\n          initializeUploadListener(this);\n          var val = value(this);\n          // fix for angular < 1.2.0\n          if (val instanceof Function) {\n            val(this);\n          }\n        } else {\n          this.__requestHeaders = this.__requestHeaders || {};\n          this.__requestHeaders[header] = value;\n          orig.apply(this, arguments);\n        }\n      };\n    });\n\n    patchXHR('send', function (orig) {\n      return function () {\n        var xhr = this;\n        if (arguments[0] && arguments[0].__isFileAPIShim) {\n          var formData = arguments[0];\n          var config = {\n            url: xhr.__url,\n            jsonp: false, //removes the callback form param\n            cache: true, //removes the ?fileapiXXX in the url\n            complete: function (err, fileApiXHR) {\n              xhr.__completed = true;\n              if (!err && xhr.__listeners.load)\n                xhr.__listeners.load({\n                  type: 'load',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (!err && xhr.__listeners.loadend)\n                xhr.__listeners.loadend({\n                  type: 'loadend',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (err === 'abort' && xhr.__listeners.abort)\n                xhr.__listeners.abort({\n                  type: 'abort',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\n                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\n              });\n              if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\n                return fileApiXHR.statusText;\n              });\n              redefineProp(xhr, 'readyState', function () {\n                return 4;\n              });\n              if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\n                return fileApiXHR.response;\n              });\n              var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\n              redefineProp(xhr, 'responseText', function () {\n                return resp;\n              });\n              redefineProp(xhr, 'response', function () {\n                return resp;\n              });\n              if (err) redefineProp(xhr, 'err', function () {\n                return err;\n              });\n              xhr.__fileApiXHR = fileApiXHR;\n              if (xhr.onreadystatechange) xhr.onreadystatechange();\n              if (xhr.onload) xhr.onload();\n            },\n            progress: function (e) {\n              e.target = xhr;\n              if (xhr.__listeners.progress) xhr.__listeners.progress(e);\n              xhr.__total = e.total;\n              xhr.__loaded = e.loaded;\n              if (e.total === e.loaded) {\n                // fix flash issue that doesn't call complete if there is no response text from the server\n                var _this = this;\n                setTimeout(function () {\n                  if (!xhr.__completed) {\n                    xhr.getAllResponseHeaders = function () {\n                    };\n                    _this.complete(null, {status: 204, statusText: 'No Content'});\n                  }\n                }, FileAPI.noContentTimeout || 10000);\n              }\n            },\n            headers: xhr.__requestHeaders\n          };\n          config.data = {};\n          config.files = {};\n          for (var i = 0; i < formData.data.length; i++) {\n            var item = formData.data[i];\n            if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\n              config.files[item.key] = item.val;\n            } else {\n              config.data[item.key] = item.val;\n            }\n          }\n\n          setTimeout(function () {\n            if (!FileAPI.hasFlash) {\n              throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n            }\n            xhr.__fileApiXHR = FileAPI.upload(config);\n          }, 1);\n        } else {\n          if (this.__origError) {\n            throw this.__origError;\n          }\n          orig.apply(xhr, arguments);\n        }\n      };\n    });\n    window.XMLHttpRequest.__isFileAPIShim = true;\n    window.FormData = FormData = function () {\n      return {\n        append: function (key, val, name) {\n          if (val.__isFileAPIBlobShim) {\n            val = val.data[0];\n          }\n          this.data.push({\n            key: key,\n            val: val,\n            name: name\n          });\n        },\n        data: [],\n        __isFileAPIShim: true\n      };\n    };\n\n    window.Blob = Blob = function (b) {\n      return {\n        data: b,\n        __isFileAPIBlobShim: true\n      };\n    };\n  }\n\n})();\n\n(function () {\n  /** @namespace FileAPI.forceLoad */\n  /** @namespace window.FileAPI.jsUrl */\n  /** @namespace window.FileAPI.jsPath */\n\n  function isInputTypeFile(elem) {\n    return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\n  }\n\n  function hasFlash() {\n    try {\n      var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n      if (fo) return true;\n    } catch (e) {\n      if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\n    }\n    return false;\n  }\n\n  function getOffset(obj) {\n    var left = 0, top = 0;\n\n    if (window.jQuery) {\n      return jQuery(obj).offset();\n    }\n\n    if (obj.offsetParent) {\n      do {\n        left += (obj.offsetLeft - obj.scrollLeft);\n        top += (obj.offsetTop - obj.scrollTop);\n        obj = obj.offsetParent;\n      } while (obj);\n    }\n    return {\n      left: left,\n      top: top\n    };\n  }\n\n  if (FileAPI.shouldLoad) {\n\n    //load FileAPI\n    if (FileAPI.forceLoad) {\n      FileAPI.html5 = false;\n    }\n\n    if (!FileAPI.upload) {\n      var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\n      if (window.FileAPI.jsUrl) {\n        jsUrl = window.FileAPI.jsUrl;\n      } else if (window.FileAPI.jsPath) {\n        basePath = window.FileAPI.jsPath;\n      } else {\n        for (i = 0; i < allScripts.length; i++) {\n          src = allScripts[i].src;\n          index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\n          if (index > -1) {\n            basePath = src.substring(0, index + 1);\n            break;\n          }\n        }\n      }\n\n      if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\n      script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\n      document.getElementsByTagName('head')[0].appendChild(script);\n\n      FileAPI.hasFlash = hasFlash();\n    }\n\n    FileAPI.ngfFixIE = function (elem, createFileElemFn, bindAttr, changeFn) {\n      if (!hasFlash()) {\n        throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n      }\n      var makeFlashInput = function () {\n        if (elem.attr('disabled')) {\n          elem.$$ngfRefElem.removeClass('js-fileapi-wrapper');\n        } else {\n          var fileElem = elem.$$ngfRefElem;\n          if (!fileElem) {\n            fileElem = elem.$$ngfRefElem = createFileElemFn();\n            fileElem.addClass('js-fileapi-wrapper');\n            if (!isInputTypeFile(elem)) {\n//\t\t\t\t\t\tif (fileElem.parent().css('position') === '' || fileElem.parent().css('position') === 'static') {\n//\t\t\t\t\t\t\tfileElem.parent().css('position', 'relative');\n//\t\t\t\t\t\t}\n//\t\t\t\t\t\telem.parent()[0].insertBefore(fileElem[0], elem[0]);\n//\t\t\t\t\t\telem.css('overflow', 'hidden');\n            }\n            setTimeout(function () {\n              fileElem.bind('mouseenter', makeFlashInput);\n            }, 10);\n            fileElem.bind('change', function (evt) {\n              fileApiChangeFn.apply(this, [evt]);\n              changeFn.apply(this, [evt]);\n//\t\t\t\t\t\talert('change' +  evt);\n            });\n          } else {\n            bindAttr(elem.$$ngfRefElem);\n          }\n          if (!isInputTypeFile(elem)) {\n            fileElem.css('position', 'absolute')\n              .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\n              .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n              .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\n              .css('overflow', 'hidden').css('z-index', '900000')\n              .css('visibility', 'visible');\n          }\n        }\n      };\n\n      elem.bind('mouseenter', makeFlashInput);\n\n      var fileApiChangeFn = function (evt) {\n        var files = FileAPI.getFiles(evt);\n        //just a double check for #233\n        for (var i = 0; i < files.length; i++) {\n          if (files[i].size === undefined) files[i].size = 0;\n          if (files[i].name === undefined) files[i].name = 'file';\n          if (files[i].type === undefined) files[i].type = 'undefined';\n        }\n        if (!evt.target) {\n          evt.target = {};\n        }\n        evt.target.files = files;\n        // if evt.target.files is not writable use helper field\n        if (evt.target.files !== files) {\n          evt.__files_ = files;\n        }\n        (evt.__files_ || evt.target.files).item = function (i) {\n          return (evt.__files_ || evt.target.files)[i] || null;\n        };\n      };\n    };\n\n    FileAPI.disableFileInput = function (elem, disable) {\n      if (disable) {\n        elem.removeClass('js-fileapi-wrapper');\n      } else {\n        elem.addClass('js-fileapi-wrapper');\n      }\n    };\n  }\n})();\n\nif (!window.FileReader) {\n  window.FileReader = function () {\n    var _this = this, loadStarted = false;\n    this.listeners = {};\n    this.addEventListener = function (type, fn) {\n      _this.listeners[type] = _this.listeners[type] || [];\n      _this.listeners[type].push(fn);\n    };\n    this.removeEventListener = function (type, fn) {\n      if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\n    };\n    this.dispatchEvent = function (evt) {\n      var list = _this.listeners[evt.type];\n      if (list) {\n        for (var i = 0; i < list.length; i++) {\n          list[i].call(_this, evt);\n        }\n      }\n    };\n    this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\n\n    var constructEvent = function (type, evt) {\n      var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\n      if (evt.result != null) e.target.result = evt.result;\n      return e;\n    };\n    var listener = function (evt) {\n      if (!loadStarted) {\n        loadStarted = true;\n        if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\n      }\n      var e;\n      if (evt.type === 'load') {\n        if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\n        e = constructEvent('load', evt);\n        if (_this.onload) _this.onload(e);\n        _this.dispatchEvent(e);\n      } else if (evt.type === 'progress') {\n        e = constructEvent('progress', evt);\n        if (_this.onprogress) _this.onprogress(e);\n        _this.dispatchEvent(e);\n      } else {\n        e = constructEvent('error', evt);\n        if (_this.onerror) _this.onerror(e);\n        _this.dispatchEvent(e);\n      }\n    };\n    this.readAsArrayBuffer = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsBinaryString = function (file) {\n      FileAPI.readAsBinaryString(file, listener);\n    };\n    this.readAsDataURL = function (file) {\n      FileAPI.readAsDataURL(file, listener);\n    };\n    this.readAsText = function (file) {\n      FileAPI.readAsText(file, listener);\n    };\n  };\n}\n\n/**!\n * AngularJS file upload/drop directive and service with progress and abort\n * @author  Danial  <danial.farid@gmail.com>\n * @version 5.0.9\n */\n\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\n  window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\n    return function (header, value) {\n      if (header === '__setXHR_') {\n        var val = value(this);\n        // fix for angular < 1.2.0\n        if (val instanceof Function) {\n          val(this);\n        }\n      } else {\n        orig.apply(this, arguments);\n      }\n    };\n  })(window.XMLHttpRequest.prototype.setRequestHeader);\n}\n\nvar ngFileUpload = angular.module('ngFileUpload', []);\n\nngFileUpload.version = '5.0.9';\nngFileUpload.service('Upload', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\n  function sendHttp(config) {\n    config.method = config.method || 'POST';\n    config.headers = config.headers || {};\n\n    var deferred = $q.defer();\n    var promise = deferred.promise;\n\n    config.headers.__setXHR_ = function () {\n      return function (xhr) {\n        if (!xhr) return;\n        config.__XHR = xhr;\n        if (config.xhrFn) config.xhrFn(xhr);\n        xhr.upload.addEventListener('progress', function (e) {\n          e.config = config;\n          if (deferred.notify) {\n            deferred.notify(e);\n          } else if (promise.progressFunc) {\n            $timeout(function () {\n              promise.progressFunc(e);\n            });\n          }\n        }, false);\n        //fix for firefox not firing upload progress end, also IE8-9\n        xhr.upload.addEventListener('load', function (e) {\n          if (e.lengthComputable) {\n            e.config = config;\n            if (deferred.notify) {\n              deferred.notify(e);\n            } else if (promise.progressFunc) {\n              $timeout(function () {\n                promise.progressFunc(e);\n              });\n            }\n          }\n        }, false);\n      };\n    };\n\n    $http(config).then(function (r) {\n      deferred.resolve(r);\n    }, function (e) {\n      deferred.reject(e);\n    }, function (n) {\n      deferred.notify(n);\n    });\n\n    promise.success = function (fn) {\n      promise.then(function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.error = function (fn) {\n      promise.then(null, function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.progress = function (fn) {\n      promise.progressFunc = fn;\n      promise.then(null, null, function (update) {\n        fn(update);\n      });\n      return promise;\n    };\n    promise.abort = function () {\n      if (config.__XHR) {\n        $timeout(function () {\n          config.__XHR.abort();\n        });\n      }\n      return promise;\n    };\n    promise.xhr = function (fn) {\n      config.xhrFn = (function (origXhrFn) {\n        return function () {\n          if (origXhrFn) origXhrFn.apply(promise, arguments);\n          fn.apply(promise, arguments);\n        };\n      })(config.xhrFn);\n      return promise;\n    };\n\n    return promise;\n  }\n\n  this.upload = function (config) {\n    function addFieldToFormData(formData, val, key) {\n      if (val !== undefined) {\n        if (angular.isDate(val)) {\n          val = val.toISOString();\n        }\n        if (angular.isString(val)) {\n          formData.append(key, val);\n        } else if (config.sendFieldsAs === 'form') {\n          if (angular.isObject(val)) {\n            for (var k in val) {\n              if (val.hasOwnProperty(k)) {\n                addFieldToFormData(formData, val[k], key + '[' + k + ']');\n              }\n            }\n          } else {\n            formData.append(key, val);\n          }\n        } else {\n          val = angular.isString(val) ? val : JSON.stringify(val);\n          if (config.sendFieldsAs === 'json-blob') {\n            formData.append(key, new Blob([val], {type: 'application/json'}));\n          } else {\n            formData.append(key, val);\n          }\n        }\n      }\n    }\n\n    config.headers = config.headers || {};\n    config.headers['Content-Type'] = undefined;\n    config.transformRequest = config.transformRequest ?\n      (angular.isArray(config.transformRequest) ?\n        config.transformRequest : [config.transformRequest]) : [];\n    config.transformRequest.push(function (data) {\n      var formData = new FormData();\n      var allFields = {};\n      var key;\n      for (key in config.fields) {\n        if (config.fields.hasOwnProperty(key)) {\n          allFields[key] = config.fields[key];\n        }\n      }\n      if (data) allFields.data = data;\n      for (key in allFields) {\n        if (allFields.hasOwnProperty(key)) {\n          var val = allFields[key];\n          if (config.formDataAppender) {\n            config.formDataAppender(formData, key, val);\n          } else {\n            addFieldToFormData(formData, val, key);\n          }\n        }\n      }\n\n      if (config.file != null) {\n        var fileFormName = config.fileFormDataName || 'file';\n\n        if (angular.isArray(config.file)) {\n          var isFileFormNameString = angular.isString(fileFormName);\n          for (var i = 0; i < config.file.length; i++) {\n            formData.append(isFileFormNameString ? fileFormName : fileFormName[i], config.file[i],\n              (config.fileName && config.fileName[i]) || config.file[i].name);\n          }\n        } else {\n          formData.append(fileFormName, config.file, config.fileName || config.file.name);\n        }\n      }\n      return formData;\n    });\n\n    return sendHttp(config);\n  };\n\n  this.http = function (config) {\n    config.transformRequest = config.transformRequest || function (data) {\n        if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof Blob) {\n          return data;\n        }\n        return $http.defaults.transformRequest[0](arguments);\n      };\n    return sendHttp(config);\n  };\n}\n\n]);\n\n(function () {\n    ngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile', function ($parse, $timeout, $compile) {\n            return {\n                restrict: 'AEC',\n                require: '?ngModel',\n                link: function (scope, elem, attr, ngModel) {\n                    linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile);\n                }\n            };\n        }]);\n\n    function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile) {\n        /** @namespace attr.ngfSelect */\n        /** @namespace attr.ngfChange */\n        /** @namespace attr.ngModel */\n        /** @namespace attr.ngModelRejected */\n        /** @namespace attr.ngfMultiple */\n        /** @namespace attr.ngfCapture */\n        /** @namespace attr.ngfAccept */\n        /** @namespace attr.ngfMaxSize */\n        /** @namespace attr.ngfMinSize */\n        /** @namespace attr.ngfResetOnClick */\n        /** @namespace attr.ngfResetModelOnClick */\n        /** @namespace attr.ngfKeep */\n        /** @namespace attr.ngfKeepDistinct */\n\n        if (elem.attr('__ngf_gen__')) {\n            return;\n        }\n\n        scope.$on('$destroy', function () {\n            if (elem.$$ngfRefElem) elem.$$ngfRefElem.remove();\n        });\n\n        var disabled = false;\n        if (attr.ngfSelect.search(/\\W+$files\\W+/) === -1) {\n            scope.$watch(attr.ngfSelect, function (val) {\n                disabled = val === false;\n            });\n        }\n        function isInputTypeFile() {\n            return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\n        }\n\n        var isUpdating = false;\n\n        function changeFn(evt) {\n            if (!isUpdating) {\n                isUpdating = true;\n                try {\n                    var fileList = evt.__files_ || (evt.target && evt.target.files);\n                    var files = [], rejFiles = [];\n\n                    for (var i = 0; i < fileList.length; i++) {\n                        var file = fileList.item(i);\n                        if (validate(scope, $parse, attr, file, evt)) {\n                            files.push(file);\n                        } else {\n                            rejFiles.push(file);\n                        }\n                    }\n                    updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, files, rejFiles, evt);\n                    if (files.length === 0) evt.target.value = files;\n//                if (evt.target && evt.target.getAttribute('__ngf_gen__')) {\n//                    angular.element(evt.target).remove();\n//                }\n                } finally {\n                    isUpdating = false;\n                }\n            }\n        }\n\n        function bindAttrToFileInput(fileElem) {\n            if (attr.ngfMultiple) fileElem.attr('multiple', $parse(attr.ngfMultiple)(scope));\n            if (attr.ngfCapture) fileElem.attr('capture', $parse(attr.ngfCapture)(scope));\n            if (attr.accept) fileElem.attr('accept', attr.accept);\n            for (var i = 0; i < elem[0].attributes.length; i++) {\n                var attribute = elem[0].attributes[i];\n                if ((isInputTypeFile() && attribute.name !== 'type') ||\n                    (attribute.name !== 'type' && attribute.name !== 'class' &&\n                    attribute.name !== 'id' && attribute.name !== 'style')) {\n                    fileElem.attr(attribute.name, attribute.value);\n                }\n            }\n        }\n\n        function createFileInput(evt, resetOnClick) {\n            if (!resetOnClick && (evt || isInputTypeFile())) return elem.$$ngfRefElem || elem;\n\n            var fileElem = angular.element('<input type=\"file\">');\n            bindAttrToFileInput(fileElem);\n\n            if (isInputTypeFile()) {\n                elem.replaceWith(fileElem);\n                elem = fileElem;\n                fileElem.attr('__ngf_gen__', true);\n                $compile(elem)(scope);\n            } else {\n                fileElem.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\n                    .css('width', '0px').css('height', '0px').css('z-index', '-100000').css('border', 'none')\n                    .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\n                if (elem.$$ngfRefElem) {\n                    elem.$$ngfRefElem.remove();\n                }\n                elem.$$ngfRefElem = fileElem;\n                document.body.appendChild(fileElem[0]);\n            }\n\n            return fileElem;\n        }\n\n        function resetModel(evt) {\n            updateModel($parse, $timeout, scope, ngModel, attr, attr.ngfChange || attr.ngfSelect, [], [], evt, true);\n        }\n\n        function clickHandler(evt) {\n            if (elem.attr('disabled') || disabled) return false;\n            if (evt != null) {\n                evt.preventDefault();\n                evt.stopPropagation();\n            }\n            var resetOnClick = $parse(attr.ngfResetOnClick)(scope) !== false;\n            var fileElem = createFileInput(evt, resetOnClick);\n\n            function clickAndAssign(evt) {\n                if (evt) {\n                    fileElem[0].click();\n                }\n                /*if (isInputTypeFile() || !evt) {\n                    elem.bind('click touchend', clickHandler);\n                }*/\n            }\n\n            if (fileElem) {\n                if (!evt || resetOnClick) fileElem.bind('change', changeFn);\n                if (evt && resetOnClick && $parse(attr.ngfResetModelOnClick)(scope) !== false) resetModel(evt);\n\n                // fix for android native browser < 4.4\n                if (shouldClickLater(navigator.userAgent)) {\n                    setTimeout(function () {\n                        clickAndAssign(evt);\n                    }, 0);\n                } else {\n                    clickAndAssign(evt);\n                }\n            }\n            return false;\n        }\n\n        if (window.FileAPI && window.FileAPI.ngfFixIE) {\n            window.FileAPI.ngfFixIE(elem, createFileInput, bindAttrToFileInput, changeFn);\n        } else {\n            clickHandler();\n            //if (!isInputTypeFile()) {\n            //  elem.bind('click touchend', clickHandler);\n            //}\n        }\n    }\n\n    function shouldClickLater(ua) {\n        // android below 4.4\n        var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\n        if (m && m.length > 2) {\n            return parseInt(m[1]) < 4 || (parseInt(m[1]) === 4 && parseInt(m[2]) < 4);\n        }\n\n        // safari on windows\n        return /.*Windows.*Safari.*/.test(ua);\n    }\n\n    ngFileUpload.validate = function (scope, $parse, attr, file, evt) {\n        function globStringToRegex(str) {\n            if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n                return str.substring(1, str.length - 1);\n            }\n            var split = str.split(','), result = '';\n            if (split.length > 1) {\n                for (var i = 0; i < split.length; i++) {\n                    result += '(' + globStringToRegex(split[i]) + ')';\n                    if (i < split.length - 1) {\n                        result += '|';\n                    }\n                }\n            } else {\n                if (str.indexOf('.') === 0) {\n                    str = '*' + str;\n                }\n                result = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\' + '-]', 'g'), '\\\\$&') + '$';\n                result = result.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n            }\n            return result;\n        }\n\n        var accept = $parse(attr.ngfAccept)(scope, {$file: file, $event: evt});\n        var fileSizeMax = $parse(attr.ngfMaxSize)(scope, {$file: file, $event: evt}) || 9007199254740991;\n        var fileSizeMin = $parse(attr.ngfMinSize)(scope, {$file: file, $event: evt}) || -1;\n        if (accept != null && angular.isString(accept)) {\n            var regexp = new RegExp(globStringToRegex(accept), 'gi');\n            accept = (file.type != null && regexp.test(file.type.toLowerCase())) ||\n                (file.name != null && regexp.test(file.name.toLowerCase()));\n        }\n        return (accept == null || accept) && (file.size == null || (file.size < fileSizeMax && file.size > fileSizeMin));\n    };\n\n    ngFileUpload.updateModel = function ($parse, $timeout, scope, ngModel, attr, fileChange,\n                                         files, rejFiles, evt, noDelay) {\n        function update() {\n            if ($parse(attr.ngfKeep)(scope) === true) {\n                var prevFiles = (ngModel.$modelValue || []).slice(0);\n                if (!files || !files.length) {\n                    files = prevFiles;\n                } else if ($parse(attr.ngfKeepDistinct)(scope) === true) {\n                    var len = prevFiles.length;\n                    for (var i = 0; i < files.length; i++) {\n                        for (var j = 0; j < len; j++) {\n                            if (files[i].name === prevFiles[j].name) break;\n                        }\n                        if (j === len) {\n                            prevFiles.push(files[i]);\n                        }\n                    }\n                    files = prevFiles;\n                } else {\n                    files = prevFiles.concat(files);\n                }\n            }\n            if (ngModel) {\n                $parse(attr.ngModel).assign(scope, files);\n                $timeout(function () {\n                    if (ngModel) {\n                        ngModel.$setViewValue(files != null && files.length === 0 ? null : files);\n                    }\n                });\n            }\n            if (attr.ngModelRejected) {\n                $parse(attr.ngModelRejected).assign(scope, rejFiles);\n            }\n            if (fileChange) {\n                $parse(fileChange)(scope, {\n                    $files: files,\n                    $rejectedFiles: rejFiles,\n                    $event: evt\n                });\n            }\n        }\n\n        if (noDelay) {\n            update();\n        } else {\n            $timeout(function () {\n                update();\n            });\n        }\n    };\n\n    var validate = ngFileUpload.validate;\n    var updateModel = ngFileUpload.updateModel;\n\n})();\n\n(function () {\n  var validate = ngFileUpload.validate;\n  var updateModel = ngFileUpload.updateModel;\n\n  ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\n    return {\n      restrict: 'AEC',\n      require: '?ngModel',\n      link: function (scope, elem, attr, ngModel) {\n        linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location);\n      }\n    };\n  }]);\n\n  ngFileUpload.directive('ngfNoFileDrop', function () {\n    return function (scope, elem) {\n      if (dropAvailable()) elem.css('display', 'none');\n    };\n  });\n\n  ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', function ($parse, $timeout) {\n    return function (scope, elem, attr) {\n      if (dropAvailable()) {\n        var fn = $parse(attr.ngfDropAvailable);\n        $timeout(function () {\n          fn(scope);\n          if (fn.assign) {\n            fn.assign(scope, true);\n          }\n        });\n      }\n    };\n  }]);\n\n  function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location) {\n    var available = dropAvailable();\n    if (attr.dropAvailable) {\n      $timeout(function () {\n        if (scope[attr.dropAvailable]) {\n          scope[attr.dropAvailable].value = available;\n        } else {\n          scope[attr.dropAvailable] = available;\n        }\n      });\n    }\n    if (!available) {\n      if ($parse(attr.ngfHideOnDropNotAvailable)(scope) === true) {\n        elem.css('display', 'none');\n      }\n      return;\n    }\n\n    var disabled = false;\n    if (attr.ngfDrop.search(/\\W+$files\\W+/) === -1) {\n      scope.$watch(attr.ngfDrop, function(val) {\n        disabled = val === false;\n      });\n    }\n\n    var leaveTimeout = null;\n    var stopPropagation = $parse(attr.ngfStopPropagation);\n    var dragOverDelay = 1;\n    var actualDragOverClass;\n\n    elem[0].addEventListener('dragover', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      // handling dragover events from the Chrome download bar\n      if (navigator.userAgent.indexOf('Chrome') > -1) {\n        var b = evt.dataTransfer.effectAllowed;\n        evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\n      }\n      $timeout.cancel(leaveTimeout);\n      if (!scope.actualDragOverClass) {\n        actualDragOverClass = calculateDragOverClass(scope, attr, evt);\n      }\n      elem.addClass(actualDragOverClass);\n    }, false);\n    elem[0].addEventListener('dragenter', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n    }, false);\n    elem[0].addEventListener('dragleave', function () {\n      if (elem.attr('disabled') || disabled) return;\n      leaveTimeout = $timeout(function () {\n        elem.removeClass(actualDragOverClass);\n        actualDragOverClass = null;\n      }, dragOverDelay || 1);\n    }, false);\n    elem[0].addEventListener('drop', function (evt) {\n      if (elem.attr('disabled') || disabled) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      elem.removeClass(actualDragOverClass);\n      actualDragOverClass = null;\n      extractFiles(evt, function (files, rejFiles) {\n        updateModel($parse, $timeout, scope, ngModel, attr,\n          attr.ngfChange || attr.ngfDrop, files, rejFiles, evt);\n      }, $parse(attr.ngfAllowDir)(scope) !== false, attr.multiple || $parse(attr.ngfMultiple)(scope));\n    }, false);\n\n    function calculateDragOverClass(scope, attr, evt) {\n      var accepted = true;\n      var items = evt.dataTransfer.items;\n      if (items != null) {\n        for (var i = 0; i < items.length && accepted; i++) {\n          accepted = accepted &&\n            (items[i].kind === 'file' || items[i].kind === '') &&\n            validate(scope, $parse, attr, items[i], evt);\n        }\n      }\n      var clazz = $parse(attr.ngfDragOverClass)(scope, {$event: evt});\n      if (clazz) {\n        if (clazz.delay) dragOverDelay = clazz.delay;\n        if (clazz.accept) clazz = accepted ? clazz.accept : clazz.reject;\n      }\n      return clazz || attr.ngfDragOverClass || 'dragover';\n    }\n\n    function extractFiles(evt, callback, allowDir, multiple) {\n      var files = [], rejFiles = [], items = evt.dataTransfer.items, processing = 0;\n\n      function addFile(file) {\n        if (validate(scope, $parse, attr, file, evt)) {\n          files.push(file);\n        } else {\n          rejFiles.push(file);\n        }\n      }\n\n      function traverseFileTree(files, entry, path) {\n        if (entry != null) {\n          if (entry.isDirectory) {\n            var filePath = (path || '') + entry.name;\n            addFile({name: entry.name, type: 'directory', path: filePath});\n            var dirReader = entry.createReader();\n            var entries = [];\n            processing++;\n            var readEntries = function () {\n              dirReader.readEntries(function (results) {\n                try {\n                  if (!results.length) {\n                    for (var i = 0; i < entries.length; i++) {\n                      traverseFileTree(files, entries[i], (path ? path : '') + entry.name + '/');\n                    }\n                    processing--;\n                  } else {\n                    entries = entries.concat(Array.prototype.slice.call(results || [], 0));\n                    readEntries();\n                  }\n                } catch (e) {\n                  processing--;\n                  console.error(e);\n                }\n              }, function () {\n                processing--;\n              });\n            };\n            readEntries();\n          } else {\n            processing++;\n            entry.file(function (file) {\n              try {\n                processing--;\n                file.path = (path ? path : '') + file.name;\n                addFile(file);\n              } catch (e) {\n                processing--;\n                console.error(e);\n              }\n            }, function () {\n              processing--;\n            });\n          }\n        }\n      }\n\n      if (items && items.length > 0 && $location.protocol() !== 'file') {\n        for (var i = 0; i < items.length; i++) {\n          if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\n            var entry = items[i].webkitGetAsEntry();\n            if (entry.isDirectory && !allowDir) {\n              continue;\n            }\n            if (entry != null) {\n              traverseFileTree(files, entry);\n            }\n          } else {\n            var f = items[i].getAsFile();\n            if (f != null) addFile(f);\n          }\n          if (!multiple && files.length > 0) break;\n        }\n      } else {\n        var fileList = evt.dataTransfer.files;\n        if (fileList != null) {\n          for (var j = 0; j < fileList.length; j++) {\n            addFile(fileList.item(j));\n            if (!multiple && files.length > 0) {\n              break;\n            }\n          }\n        }\n      }\n      var delays = 0;\n      (function waitForProcess(delay) {\n        $timeout(function () {\n          if (!processing) {\n            if (!multiple && files.length > 1) {\n              i = 0;\n              while (files[i].type === 'directory') i++;\n              files = [files[i]];\n            }\n            callback(files, rejFiles);\n          } else {\n            if (delays++ * 10 < 20 * 1000) {\n              waitForProcess(10);\n            }\n          }\n        }, delay || 0);\n      })();\n    }\n  }\n\n  ngFileUpload.directive('ngfSrc', ['$parse', '$timeout', function ($parse, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        if (window.FileReader) {\n          scope.$watch(attr.ngfSrc, function (file) {\n            if (file &&\n              validate(scope, $parse, attr, file, null) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\n              (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\n              $timeout(function () {\n                //prefer URL.createObjectURL for handling refrences to files of all sizes\n                //since it doesn´t build a large string in memory\n                var URL = window.URL || window.webkitURL;\n                if (URL && URL.createObjectURL) {\n                  elem.attr('src', URL.createObjectURL(file));\n                } else {\n                  var fileReader = new FileReader();\n                  fileReader.readAsDataURL(file);\n                  fileReader.onload = function (e) {\n                    $timeout(function () {\n                      elem.attr('src', e.target.result);\n                    });\n                  };\n                }\n              });\n            } else {\n              elem.attr('src', attr.ngfDefaultSrc || '');\n            }\n          });\n        }\n      }\n    };\n  }]);\n\n  function dropAvailable() {\n    var div = document.createElement('div');\n    return ('draggable' in div) && ('ondrop' in div);\n  }\n\n})();\n"]}